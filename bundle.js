!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=52)}([function(e,t,n){"use strict";var r=n(5);Object.defineProperty(t,"__esModule",{value:!0}),t.logger=void 0;var o=r(n(63));const i=o.default.getLogger("matrix");t.logger=i,i.setLevel(o.default.levels.DEBUG)},function(e,t,n){var r=n(62);function o(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return o=function(){return e},e}e.exports=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var t=o();if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var a=i?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(n,s,a):n[s]=e[s]}return n.default=e,t&&t.set(e,n),n}},function(e,t,n){"use strict";var r=n(5);Object.defineProperty(t,"__esModule",{value:!0}),t.encodeParams=function(e){let t="";for(const n in e)e.hasOwnProperty(n)&&(t+="&"+encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.substring(1)},t.encodeUri=function(e,t){for(const n in t)t.hasOwnProperty(n)&&(e=e.replace(n,encodeURIComponent(t[n])));return e},t.map=function(e,t){const n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=t(e[r]);return n},t.filter=function(e,t){const n=[];for(let r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n},t.keys=function(e){const t=[];for(const n in e)e.hasOwnProperty(n)&&t.push(n);return t},t.values=function(e){const t=[];for(const n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t},t.forEach=function(e,t){for(let n=0;n<e.length;n++)t(e[n],n)},t.findElement=function(e,t,n){let r;if(n){for(r=e.length-1;r>=0;r--)if(t(e[r],r,e))return e[r]}else for(r=0;r<e.length;r++)if(t(e[r],r,e))return e[r]},t.removeElement=function(e,t,n){let r,o;if(n){for(r=e.length-1;r>=0;r--)if(t(e[r],r,e))return o=e[r],e.splice(r,1),o}else for(r=0;r<e.length;r++)if(t(e[r],r,e))return o=e[r],e.splice(r,1),o;return!1},t.isFunction=function(e){return"[object Function]"==Object.prototype.toString.call(e)},t.isArray=function(e){return Array.isArray?Array.isArray(e):Boolean(e&&e.constructor===Array)},t.checkObjectHasKeys=function(e,t){for(let n=0;n<t.length;n++)if(!e.hasOwnProperty(t[n]))throw new Error("Missing required key: "+t[n])},t.checkObjectHasNoAdditionalKeys=function(e,t){for(const n in e)if(e.hasOwnProperty(n)&&-1===t.indexOf(n))throw new Error("Unknown key: "+n)},t.deepCopy=function(e){return JSON.parse(JSON.stringify(e))},t.deepCompare=function e(t,n){if(t===n)return!0;if(typeof t!=typeof n)return!1;if("number"==typeof t&&isNaN(t)&&isNaN(n))return!0;if(null===t||null===n)return t===n;if(!(t instanceof Object))return!1;if(t.constructor!==n.constructor||t.prototype!==n.prototype)return!1;if(t instanceof RegExp||t instanceof Date)return t.toString()===n.toString();if(t instanceof Array){if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(!e(t[r],n[r]))return!1}else{let r;for(r in n)if(n.hasOwnProperty(r)!==t.hasOwnProperty(r))return!1;for(r in n){if(n.hasOwnProperty(r)!==t.hasOwnProperty(r))return!1;if(!e(t[r],n[r]))return!1}}return!0},t.extend=function(){const e=arguments[0]||{};for(let t=1;t<arguments.length;t++){const n=arguments[t];for(const t in n)e[t]=n[t]}return e},t.runPolyfills=function(){Array.prototype.filter||(Array.prototype.filter=function(e){if(null==this)throw new TypeError;const t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError;const r=[],o=arguments.length>=2?arguments[1]:void 0;for(let i=0;i<n;i++)if(i in t){const n=t[i];e.call(o,n,i,t)&&r.push(n)}return r});Array.prototype.map||(Array.prototype.map=function(e,t){let n,r;if(null==this)throw new TypeError(" this is null or not defined");const o=Object(this),i=o.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");arguments.length>1&&(n=t);const s=new Array(i);for(r=0;r<i;){var a,c;r in o&&(a=o[r],c=e.call(n,a,r,o),s[r]=c),r++}return s});Array.prototype.forEach||(Array.prototype.forEach=function(e,t){let n,r;if(null==this)throw new TypeError(" this is null or not defined");const o=Object(this),i=o.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(n=t),r=0;r<i;){var s;r in o&&(s=o[r],e.call(n,s,r,o)),r++}})},t.inherits=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},t.polyfillSuper=function(e,t,...n){try{t.call(e,...n)}catch(r){const o=new t(...n);Object.assign(e,o)}},t.isNumber=function(e){return"number"==typeof e&&isFinite(e)},t.removeHiddenChars=function(e){return(0,o.default)(e.normalize("NFD").replace(i,""))},t.escapeRegExp=s,t.globToRegexp=function(e,t){t="boolean"!=typeof t||t;let n=s(e);n=(n=n.replace(/\\\*/g,".*")).replace(/\?/g,"."),t&&(n=n.replace(/\\\[(!|)(.*)\\]/g,(function(e,t,n,r,o){return"["+(t?"^":"")+n.replace(/\\-/,"-")+"]"})));return n},t.ensureNoTrailingSlash=function(e){return e&&e.endsWith("/")?e.substr(0,e.length-1):e},t.sleep=function(e,t){return new Promise(n=>{setTimeout(n,e,t)})},t.isNullOrUndefined=function(e){return null==e},t.defer=function(){let e,t;const n=new Promise((n,r)=>{e=n,t=r});return{resolve:e,reject:t,promise:n}},t.promiseMapSeries=async function(e,t){for(const n of await e)await t(await n)},t.promiseTry=function(e){return new Promise(t=>t(e()))};var o=r(n(64));const i=/[\u2000-\u200F\u202A-\u202F\u0300-\u036f\uFEFF\s]/g;function s(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";var r,o="object"==typeof Reflect?Reflect:null,i=o&&"function"==typeof o.apply?o.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=o&&"function"==typeof o.ownKeys?o.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var c=10;function u(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function l(e,t,n,r){var o,i,s,a;if("function"!=typeof n)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n);if(void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),s=i[t]),void 0===s)s=i[t]=n,++e._eventsCount;else if("function"==typeof s?s=i[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(o=u(e))>0&&s.length>o&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,a=c,console&&console.warn&&console.warn(a)}return e}function d(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,i(this.listener,this.target,e))}function h(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=d.bind(r);return o.listener=n,r.wrapFn=o,o}function f(e,t,n){var r=e._events;if(void 0===r)return[];var o=r[t];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(o):g(o,o.length)}function p(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function g(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return u(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,o=this._events;if(void 0!==o)r=r&&void 0===o.error;else if(!r)return!1;if(r){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=o[e];if(void 0===c)return!1;if("function"==typeof c)i(c,this,t);else{var u=c.length,l=g(c,u);for(n=0;n<u;++n)i(l[n],this,t)}return!0},a.prototype.addListener=function(e,t){return l(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return l(this,e,t,!0)},a.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,h(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,h(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,r,o,i,s;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,i=n.length-1;i>=0;i--)if(n[i]===t||n[i].listener===t){s=n[i].listener,o=i;break}if(o<0)return this;0===o?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,o),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var o,i=Object.keys(n);for(r=0;r<i.length;++r)"removeListener"!==(o=i[r])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},a.prototype.listeners=function(e){return f(this,e,!0)},a.prototype.rawListeners=function(e){return f(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},a.prototype.listenerCount=p,a.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";var r=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixEvent=t.EventStatus=void 0;var o=n(4),i=r(n(2)),s=n(0);t.EventStatus={NOT_SENT:"not_sent",ENCRYPTING:"encrypting",SENDING:"sending",QUEUED:"queued",SENT:"sent",CANCELLED:"cancelled"};const a={};function c(e){return a[e]||(a[e]=e),a[e]}const u=function(e){["state_key","type","sender","room_id","membership"].forEach(t=>{e[t]&&(e[t]=c(e[t]))}),["membership","avatar_url","displayname"].forEach(t=>{e.content&&e.content[t]&&(e.content[t]=c(e.content[t]))}),["rel_type"].forEach(t=>{e.content&&e.content["m.relates_to"]&&e.content["m.relates_to"][t]&&(e.content["m.relates_to"][t]=c(e.content["m.relates_to"][t]))}),this.event=e||{},this.sender=null,this.target=null,this.status=null,this.error=null,this.forwardLooking=!0,this._pushActions=null,this._replacingEvent=null,this._localRedactionEvent=null,this._isCancelled=!1,this._clearEvent={},this._senderCurve25519Key=null,this._claimedEd25519Key=null,this._forwardingCurve25519KeyChain=[],this._decryptionPromise=null,this._retryDecryption=!1};t.MatrixEvent=u,i.inherits(u,o.EventEmitter),i.extend(u.prototype,{getId:function(){return this.event.event_id},getSender:function(){return this.event.sender||this.event.user_id},getType:function(){return this._clearEvent.type||this.event.type},getWireType:function(){return this.event.type},getRoomId:function(){return this.event.room_id},getTs:function(){return this.event.origin_server_ts},getDate:function(){return this.event.origin_server_ts?new Date(this.event.origin_server_ts):null},getOriginalContent:function(){return this._localRedactionEvent?{}:this._clearEvent.content||this.event.content||{}},getContent:function(){return this._localRedactionEvent?{}:this._replacingEvent?this._replacingEvent.getContent()["m.new_content"]||{}:this.getOriginalContent()},getWireContent:function(){return this.event.content||{}},getPrevContent:function(){return this.getUnsigned().prev_content||this.event.prev_content||{}},getDirectionalContent:function(){return this.forwardLooking?this.getContent():this.getPrevContent()},getAge:function(){return this.getUnsigned().age||this.event.age},getLocalAge:function(){return Date.now()-this.getTs()},getStateKey:function(){return this.event.state_key},isState:function(){return void 0!==this.event.state_key},makeEncrypted:function(e,t,n,r){this._clearEvent={type:this.event.type,content:this.event.content},this.event.type=e,this.event.content=t,this._senderCurve25519Key=n,this._claimedEd25519Key=r},isBeingDecrypted:function(){return null!=this._decryptionPromise},isDecryptionFailure:function(){return this._clearEvent&&this._clearEvent.content&&"m.bad.encrypted"===this._clearEvent.content.msgtype},attemptDecryption:async function(e){if(!this.isEncrypted())throw new Error("Attempt to decrypt event which isn't encrypted");if(this._clearEvent&&this._clearEvent.content&&"m.bad.encrypted"!==this._clearEvent.content.msgtype)throw new Error("Attempt to decrypt event which has already been encrypted");return this._decryptionPromise?(s.logger.log(`Event ${this.getId()} already being decrypted; queueing a retry`),this._retryDecryption=!0,this._decryptionPromise):(this._decryptionPromise=this._decryptionLoop(e),this._decryptionPromise)},cancelAndResendKeyRequest:function(e,t){const n=this.getWireContent();return e.requestRoomKey({algorithm:n.algorithm,room_id:this.getRoomId(),session_id:n.session_id,sender_key:n.sender_key},this.getKeyRequestRecipients(t),!0)},getKeyRequestRecipients:function(e){const t=this.getWireContent(),n=[{userId:e,deviceId:"*"}],r=this.getSender();return r!==e&&n.push({userId:r,deviceId:t.device_id}),n},_decryptionLoop:async function(e){for(await Promise.resolve();;){let t,n;this._retryDecryption=!1;try{t=e?await e.decryptEvent(this):this._badEncryptedMessage("Encryption not enabled")}catch(e){if("DecryptionError"!==e.name)return s.logger.error(`Error decrypting event (id=${this.getId()}): ${e.stack||e}`),this._decryptionPromise=null,void(this._retryDecryption=!1);if(n=e,this._retryDecryption){s.logger.log(`Got error decrypting event (id=${this.getId()}: `+`${e}), but retrying`);continue}s.logger.warn(`Error decrypting event (id=${this.getId()}): ${e.detailedString}`),t=this._badEncryptedMessage(e.message)}return this._decryptionPromise=null,this._retryDecryption=!1,this._setClearData(t),this.setPushActions(null),void this.emit("Event.decrypted",this,n)}},_badEncryptedMessage:function(e){return{clearEvent:{type:"m.room.message",content:{msgtype:"m.bad.encrypted",body:"** Unable to decrypt: "+e+" **"}}}},_setClearData:function(e){this._clearEvent=e.clearEvent,this._senderCurve25519Key=e.senderCurve25519Key||null,this._claimedEd25519Key=e.claimedEd25519Key||null,this._forwardingCurve25519KeyChain=e.forwardingCurve25519KeyChain||[]},getClearContent:function(){const e=this._clearEvent;return e&&e.content?e.content:null},isEncrypted:function(){return"m.room.encrypted"===this.event.type},getSenderKey:function(){return this._senderCurve25519Key},getKeysClaimed:function(){return{ed25519:this._claimedEd25519Key}},getClaimedEd25519Key:function(){return this._claimedEd25519Key},getForwardingCurve25519KeyChain:function(){return this._forwardingCurve25519KeyChain},getUnsigned:function(){return this.event.unsigned||{}},unmarkLocallyRedacted:function(){const e=this._localRedactionEvent;return this._localRedactionEvent=null,this.event.unsigned&&(this.event.unsigned.redacted_because=null),!!e},markLocallyRedacted:function(e){this._localRedactionEvent||(this.emit("Event.beforeRedaction",this,e),this._localRedactionEvent=e,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event)},makeRedacted:function(e){if(!e.event)throw new Error("invalid redaction_event in makeRedacted");let t;for(t in this._localRedactionEvent=null,this.emit("Event.beforeRedaction",this,e),this._replacingEvent=null,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event,this.event)this.event.hasOwnProperty(t)&&(l[t]||delete this.event[t]);const n=d[this.getType()]||{},r=this.getContent();for(t in r)r.hasOwnProperty(t)&&(n[t]||delete r[t])},isRedacted:function(){return Boolean(this.getUnsigned().redacted_because)},isRedaction:function(){return"m.room.redaction"===this.getType()},getPushActions:function(){return this._pushActions},setPushActions:function(e){this._pushActions=e},handleRemoteEcho:function(e){const t=this.getUnsigned(),n=this.getId();this.event=e,t.redacted_because&&(this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=t.redacted_because),this.setStatus(null),this.getId()!==n&&this.emit("Event.localEventIdReplaced",this)},isSending(){return!!this.status},setStatus(e){this.status=e,this.emit("Event.status",this,e)},replaceLocalEventId(e){this.event.event_id=e,this.emit("Event.localEventIdReplaced",this)},isRelation(e){const t=this.getWireContent(),n=t&&t["m.relates_to"];return n&&n.rel_type&&n.event_id&&(e&&n.rel_type===e||!e)},getRelation(){return this.isRelation()?this.getWireContent()["m.relates_to"]:null},makeReplaced(e){this.isRedacted()&&e||this._replacingEvent!==e&&(this._replacingEvent=e,this.emit("Event.replaced",this))},getAssociatedStatus(){return this._replacingEvent?this._replacingEvent.status:this._localRedactionEvent?this._localRedactionEvent.status:this.status},getServerAggregatedRelation(e){const t=this.getUnsigned()["m.relations"];if(t)return t[e]},replacingEventId(){const e=this.getServerAggregatedRelation("m.replace");return e?e.event_id:this._replacingEvent?this._replacingEvent.getId():void 0},replacingEvent(){return this._replacingEvent},replacingEventDate(){const e=this.getServerAggregatedRelation("m.replace");if(e){const t=e.origin_server_ts;if(Number.isFinite(t))return new Date(t)}else if(this._replacingEvent)return this._replacingEvent.getDate()},localRedactionEvent(){return this._localRedactionEvent},getAssociatedId(){const e=this.getRelation();return e?e.event_id:this.isRedaction()?this.event.redacts:void 0},hasAssocation(){return!!this.getAssociatedId()},updateAssociatedId(e){const t=this.getRelation();t?t.event_id=e:this.isRedaction()&&(this.event.redacts=e)},flagCancelled(e=!0){this._isCancelled=e},isCancelled(){return this._isCancelled},toJSON(){const e={type:this.getType(),sender:this.getSender(),content:this.getContent(),event_id:this.getId(),origin_server_ts:this.getTs(),unsigned:this.getUnsigned(),room_id:this.getRoomId()};return this.isRedaction()&&(e.redacts=this.event.redacts),this.isEncrypted()?{decrypted:e,encrypted:this.event}:e}});const l=["event_id","type","room_id","user_id","sender","state_key","prev_state","content","unsigned","origin_server_ts"].reduce((function(e,t){return e[t]=1,e}),{}),d={"m.room.member":{membership:1},"m.room.create":{creator:1},"m.room.join_rules":{join_rule:1},"m.room.power_levels":{ban:1,events:1,events_default:1,kick:1,redact:1,state_default:1,users:1,users_default:1},"m.room.aliases":{aliases:1}}},function(e,t,n){"use strict";(function(e,r){var o=n(5),i=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptMessageForDevice=async function(e,t,n,r,o,i,c){const u=i.getIdentityKey(),l=await r.getSessionIdForDevice(u);if(null===l)return;s.logger.log("Using sessionid "+l+" for device "+o+":"+i.deviceId);const d={sender:t,sender_device:n,keys:{ed25519:r.deviceEd25519Key},recipient:o,recipient_keys:{ed25519:i.getFingerprint()}};a.extend(d,c),e[u]=await r.encryptMessage(u,l,JSON.stringify(d))},t.ensureOlmSessionsForDevices=async function(e,t,n,r){const o=[],i={},a={};for(const t in n){if(!n.hasOwnProperty(t))continue;i[t]={};const s=n[t];for(let n=0;n<s.length;n++){const c=s[n],u=c.deviceId,l=c.getIdentityKey();e._sessionsInProgress[l]||(e._sessionsInProgress[l]=new Promise((t,n)=>{a[l]={resolve:(...n)=>{delete e._sessionsInProgress[l],t(...n)},reject:(...t)=>{delete e._sessionsInProgress[l],n(...t)}}}));const d=await e.getSessionIdForDevice(l,a[l]);null!==d&&a[l]&&(delete e._sessionsInProgress[l],a[l].resolve(),delete a[l]),(null===d||r)&&o.push([t,u]),i[t][u]={device:c,sessionId:d}}}if(0===o.length)return i;let c;try{c=await t.claimOneTimeKeys(o,"signed_curve25519")}catch(e){for(const e of Object.values(a))e.resolve();throw s.logger.log("failed to claim one-time keys",e,o),e}const l=c.one_time_keys||{},d=[];for(const t in n){if(!n.hasOwnProperty(t))continue;const o=l[t]||{},c=n[t];for(let n=0;n<c.length;n++){const l=c[n],h=l.deviceId,f=l.getIdentityKey();if(i[t][h].sessionId&&!r)continue;const p=o[h]||{};let g=null;for(const e in p)0===e.indexOf("signed_curve25519:")&&(g=p[e]);if(g)d.push(u(e,g,t,l).then(e=>{a[f]&&a[f].resolve(e),i[t][h].sessionId=e},e=>{throw a[f]&&a[f].resolve(),e}));else{const e="No one-time keys (alg=signed_curve25519) for device "+t+":"+h;s.logger.warn(e),a[f]&&a[f].resolve()}}}return await Promise.all(d),i},t.verifySignature=l,t.pkSign=function(t,n,r,o){let i=!1;if(n instanceof Uint8Array){const t=new e.Olm.PkSigning;o=t.init_with_seed(n),n=t,i=!0}const s=t.signatures||{};delete t.signatures;const a=t.unsigned;t.unsigned&&delete t.unsigned;try{const e=s[r]||{};return s[r]=e,e["ed25519:"+o]=n.sign(c.default.stringify(t))}finally{t.signatures=s,a&&(t.unsigned=a),i&&n.free()}},t.pkVerify=function(t,n,r){const o="ed25519:"+n;if(!(t.signatures&&t.signatures[r]&&t.signatures[r][o]))throw new Error("No signature");const i=t.signatures[r][o],s=new e.Olm.Utility,a=t.signatures;delete t.signatures;const u=t.unsigned;t.unsigned&&delete t.unsigned;try{s.ed25519_verify(n,c.default.stringify(t),i)}finally{t.signatures=a,u&&(t.unsigned=u),s.free()}},t.encodeBase64=function(e){return r.from(e).toString("base64")},t.decodeBase64=function(e){return r.from(e,"base64")},t.MEGOLM_BACKUP_ALGORITHM=t.MEGOLM_ALGORITHM=t.OLM_ALGORITHM=void 0;var s=n(0),a=i(n(2)),c=o(n(25));t.OLM_ALGORITHM="m.olm.v1.curve25519-aes-sha2";t.MEGOLM_ALGORITHM="m.megolm.v1.aes-sha2";async function u(e,t,n,r){const o=r.deviceId;try{await l(e,t,n,o,r.getFingerprint())}catch(e){return s.logger.error("Unable to verify signature on one-time key for device "+n+":"+o+":",e),null}let i;try{i=await e.createOutboundSession(r.getIdentityKey(),t.key)}catch(e){return s.logger.error("Error starting olm session with device "+n+":"+o+": "+e),null}return s.logger.log("Started new olm sessionid "+i+" for device "+n+":"+o),i}async function l(e,t,n,r,o){const i="ed25519:"+r,s=((t.signatures||{})[n]||{})[i];if(!s)throw Error("No signature");const a=Object.assign({},t);delete a.unsigned,delete a.signatures;const u=c.default.stringify(a);e.verifySignature(o,u,s)}t.MEGOLM_BACKUP_ALGORITHM="m.megolm_backup.v1.curve25519-aes-sha2"}).call(this,n(3),n(24).Buffer)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventTimeline=o;var r=n(36);function o(e){this._eventTimelineSet=e,this._roomId=e.room?e.room.roomId:null,this._events=[],this._baseIndex=0,this._startState=new r.RoomState(this._roomId),this._startState.paginationToken=null,this._endState=new r.RoomState(this._roomId),this._endState.paginationToken=null,this._prevTimeline=null,this._nextTimeline=null,this._paginationRequests={b:null,f:null},this._name=this._roomId+":"+(new Date).toISOString()}o.BACKWARDS="b",o.FORWARDS="f",o.prototype.initialiseState=function(e){if(this._events.length>0)throw new Error("Cannot initialise state after events are added");for(const t of e)Object.freeze(t);this._startState.setStateEvents(e),this._endState.setStateEvents(e)},o.prototype.forkLive=function(e){const t=this.getState(e),n=new o(this._eventTimelineSet);return n._startState=t.clone(),n._endState=t,this._endState=t.clone(),n},o.prototype.fork=function(e){const t=this.getState(e),n=new o(this._eventTimelineSet);return n._startState=t.clone(),n._endState=t.clone(),n},o.prototype.getRoomId=function(){return this._roomId},o.prototype.getFilter=function(){return this._eventTimelineSet.getFilter()},o.prototype.getTimelineSet=function(){return this._eventTimelineSet},o.prototype.getBaseIndex=function(){return this._baseIndex},o.prototype.getEvents=function(){return this._events},o.prototype.getState=function(e){if(e==o.BACKWARDS)return this._startState;if(e==o.FORWARDS)return this._endState;throw new Error("Invalid direction '"+e+"'")},o.prototype.getPaginationToken=function(e){return this.getState(e).paginationToken},o.prototype.setPaginationToken=function(e,t){this.getState(t).paginationToken=e},o.prototype.getNeighbouringTimeline=function(e){if(e==o.BACKWARDS)return this._prevTimeline;if(e==o.FORWARDS)return this._nextTimeline;throw new Error("Invalid direction '"+e+"'")},o.prototype.setNeighbouringTimeline=function(e,t){if(this.getNeighbouringTimeline(t))throw new Error("timeline already has a neighbouring timeline - cannot reset neighbour (direction: "+t+")");if(t==o.BACKWARDS)this._prevTimeline=e;else{if(t!=o.FORWARDS)throw new Error("Invalid direction '"+t+"'");this._nextTimeline=e}this.setPaginationToken(null,t)},o.prototype.addEvent=function(e,t){const n=t?this._startState:this._endState,r=this.getTimelineSet();let i;r.room&&r.room.getUnfilteredTimelineSet()===r&&(o.setEventMetadata(e,n,t),e.isState()&&(n.setStateEvents([e]),e.sender&&("m.room.member"!==e.getType()||t)||o.setEventMetadata(e,n,t))),i=t?0:this._events.length,this._events.splice(i,0,e),t&&this._baseIndex++},o.setEventMetadata=function(e,t,n){e.sender=t.getSentinelMember(e.getSender()),"m.room.member"===e.getType()&&(e.target=t.getSentinelMember(e.getStateKey())),e.isState()&&n&&(e.forwardLooking=!1)},o.prototype.removeEvent=function(e){for(let t=this._events.length-1;t>=0;t--){const n=this._events[t];if(n.getId()==e)return this._events.splice(t,1),t<this._baseIndex&&this._baseIndex--,n}return null},o.prototype.toString=function(){return this._name}},function(e,t,n){"use strict";(function(e){var r=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedDBCryptoStore=void 0;var o=n(0),i=n(89),s=n(17),a=r(n(90)),c=n(23),u=r(n(40));class l{constructor(e,t){this._indexedDB=e,this._dbName=t,this._backendPromise=null}static exists(e,t){return u.exists(e,t)}_connect(){return this._backendPromise?this._backendPromise:(this._backendPromise=new Promise((e,t)=>{if(!this._indexedDB)return void t(new Error("no indexeddb support available"));o.logger.log(`connecting to indexeddb ${this._dbName}`);const n=this._indexedDB.open(this._dbName,a.VERSION);n.onupgradeneeded=e=>{const t=e.target.result,n=e.oldVersion;a.upgradeDatabase(t,n)},n.onblocked=()=>{o.logger.log("can't yet open IndexedDBCryptoStore because it is open elsewhere")},n.onerror=e=>{o.logger.log("Error connecting to indexeddb",e),t(e.target.error)},n.onsuccess=t=>{const n=t.target.result;o.logger.log(`connected to indexeddb ${this._dbName}`),e(new a.Backend(n))}}).then(e=>e.doTxn("readonly",[l.STORE_INBOUND_GROUP_SESSIONS,l.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],t=>{e.getEndToEndInboundGroupSession("","",t,()=>{})}).then(()=>e)).catch(t=>{if("VersionError"===t.name)throw o.logger.warn("Crypto DB is too new for us to use!",t),new c.InvalidCryptoStoreError(c.InvalidCryptoStoreError.TOO_NEW);o.logger.warn(`unable to connect to indexeddb ${this._dbName}`+`: falling back to localStorage store: ${t}`);try{return new i.LocalStorageCryptoStore(e.localStorage)}catch(t){return o.logger.warn(`unable to open localStorage: falling back to in-memory store: ${t}`),new s.MemoryCryptoStore}}),this._backendPromise)}deleteAllData(){return new Promise((e,t)=>{if(!this._indexedDB)return void t(new Error("no indexeddb support available"));o.logger.log(`Removing indexeddb instance: ${this._dbName}`);const n=this._indexedDB.deleteDatabase(this._dbName);n.onblocked=()=>{o.logger.log("can't yet delete IndexedDBCryptoStore because it is open elsewhere")},n.onerror=e=>{o.logger.log("Error deleting data from indexeddb",e),t(e.target.error)},n.onsuccess=()=>{o.logger.log(`Removed indexeddb instance: ${this._dbName}`),e()}}).catch(e=>{o.logger.warn(`unable to delete IndexedDBCryptoStore: ${e}`)})}getOrAddOutgoingRoomKeyRequest(e){return this._connect().then(t=>t.getOrAddOutgoingRoomKeyRequest(e))}getOutgoingRoomKeyRequest(e){return this._connect().then(t=>t.getOutgoingRoomKeyRequest(e))}getOutgoingRoomKeyRequestByState(e){return this._connect().then(t=>t.getOutgoingRoomKeyRequestByState(e))}getOutgoingRoomKeyRequestsByTarget(e,t,n){return this._connect().then(r=>r.getOutgoingRoomKeyRequestsByTarget(e,t,n))}updateOutgoingRoomKeyRequest(e,t,n){return this._connect().then(r=>r.updateOutgoingRoomKeyRequest(e,t,n))}deleteOutgoingRoomKeyRequest(e,t){return this._connect().then(n=>n.deleteOutgoingRoomKeyRequest(e,t))}getAccount(e,t){this._backendPromise.then(n=>{n.getAccount(e,t)})}storeAccount(e,t){this._backendPromise.then(n=>{n.storeAccount(e,t)})}getCrossSigningKeys(e,t){this._backendPromise.then(n=>{n.getCrossSigningKeys(e,t)})}storeCrossSigningKeys(e,t){this._backendPromise.then(n=>{n.storeCrossSigningKeys(e,t)})}countEndToEndSessions(e,t){this._backendPromise.then(n=>{n.countEndToEndSessions(e,t)})}getEndToEndSession(e,t,n,r){this._backendPromise.then(o=>{o.getEndToEndSession(e,t,n,r)})}getEndToEndSessions(e,t,n){this._backendPromise.then(r=>{r.getEndToEndSessions(e,t,n)})}getAllEndToEndSessions(e,t){this._backendPromise.then(n=>{n.getAllEndToEndSessions(e,t)})}storeEndToEndSession(e,t,n,r){this._backendPromise.then(o=>{o.storeEndToEndSession(e,t,n,r)})}storeEndToEndSessionProblem(e,t,n){return this._backendPromise.then(async r=>{await r.storeEndToEndSessionProblem(e,t,n)})}getEndToEndSessionProblem(e,t){return this._backendPromise.then(async n=>await n.getEndToEndSessionProblem(e,t))}filterOutNotifiedErrorDevices(e){return this._backendPromise.then(async t=>await t.filterOutNotifiedErrorDevices(e))}getEndToEndInboundGroupSession(e,t,n,r){this._backendPromise.then(o=>{o.getEndToEndInboundGroupSession(e,t,n,r)})}getAllEndToEndInboundGroupSessions(e,t){this._backendPromise.then(n=>{n.getAllEndToEndInboundGroupSessions(e,t)})}addEndToEndInboundGroupSession(e,t,n,r){this._backendPromise.then(o=>{o.addEndToEndInboundGroupSession(e,t,n,r)})}storeEndToEndInboundGroupSession(e,t,n,r){this._backendPromise.then(o=>{o.storeEndToEndInboundGroupSession(e,t,n,r)})}storeEndToEndInboundGroupSessionWithheld(e,t,n,r){this._backendPromise.then(o=>{o.storeEndToEndInboundGroupSessionWithheld(e,t,n,r)})}storeEndToEndDeviceData(e,t){this._backendPromise.then(n=>{n.storeEndToEndDeviceData(e,t)})}getEndToEndDeviceData(e,t){this._backendPromise.then(n=>{n.getEndToEndDeviceData(e,t)})}storeEndToEndRoom(e,t,n){this._backendPromise.then(r=>{r.storeEndToEndRoom(e,t,n)})}getEndToEndRooms(e,t){this._backendPromise.then(n=>{n.getEndToEndRooms(e,t)})}getSessionsNeedingBackup(e){return this._connect().then(t=>t.getSessionsNeedingBackup(e))}countSessionsNeedingBackup(e){return this._connect().then(t=>t.countSessionsNeedingBackup(e))}unmarkSessionsNeedingBackup(e,t){return this._connect().then(n=>n.unmarkSessionsNeedingBackup(e,t))}markSessionsNeedingBackup(e,t){return this._connect().then(n=>n.markSessionsNeedingBackup(e,t))}doTxn(e,t,n){return this._connect().then(r=>r.doTxn(e,t,n))}}t.IndexedDBCryptoStore=l,l.STORE_ACCOUNT="account",l.STORE_SESSIONS="sessions",l.STORE_INBOUND_GROUP_SESSIONS="inbound_group_sessions",l.STORE_INBOUND_GROUP_SESSIONS_WITHHELD="inbound_group_sessions_withheld",l.STORE_DEVICE_DATA="device_data",l.STORE_ROOMS="rooms",l.STORE_BACKUP="sessions_needing_backup"}).call(this,n(3))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.newVerificationError=o,t.errorFactory=i,t.errorFromEvent=function(e){const t=e.getContent();if(t){const{code:e,reason:n}=t;return{code:e,reason:n}}return{code:"Unknown error",reason:"m.unknown"}},t.newInvalidMessageError=t.newUserMismatchError=t.newKeyMismatchError=t.newUnexpectedMessageError=t.newUnknownMethodError=t.newUnknownTransactionError=t.newTimeoutError=t.newUserCancelledError=void 0;var r=n(6);function o(e,t,n){return(n=n||{}).code=e,n.reason=t,new r.MatrixEvent({type:"m.key.verification.cancel",content:n})}function i(e,t){return function(n){return o(e,t,n)}}const s=i("m.user","Cancelled by user");t.newUserCancelledError=s;const a=i("m.timeout","Timed out");t.newTimeoutError=a;const c=i("m.unknown_transaction","Unknown transaction");t.newUnknownTransactionError=c;const u=i("m.unknown_method","Unknown method");t.newUnknownMethodError=u;const l=i("m.unexpected_message","Unexpected message");t.newUnexpectedMessageError=l;const d=i("m.key_mismatch","Key mismatch");t.newKeyMismatchError=d;const h=i("m.user_error","User mismatch");t.newUserMismatchError=h;const f=i("m.invalid_message","Invalid message");t.newInvalidMessageError=f},function(e,t,n){"use strict";e.exports=n(53)},function(e,t,n){"use strict";var r=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.User=s;var o=r(n(2)),i=n(4);function s(e){this.userId=e,this.presence="offline",this.presenceStatusMsg=null,this._unstable_statusMessage="",this.displayName=e,this.rawDisplayName=e,this.avatarUrl=null,this.lastActiveAgo=0,this.lastPresenceTs=0,this.currentlyActive=!1,this.events={presence:null,profile:null},this._updateModifiedTime()}o.inherits(s,i.EventEmitter),s.prototype.setPresenceEvent=function(e){if("m.presence"!==e.getType())return;const t=null===this.events.presence;this.events.presence=e;const n=[];(e.getContent().presence!==this.presence||t)&&n.push("User.presence"),e.getContent().avatar_url&&e.getContent().avatar_url!==this.avatarUrl&&n.push("User.avatarUrl"),e.getContent().displayname&&e.getContent().displayname!==this.displayName&&n.push("User.displayName"),void 0!==e.getContent().currently_active&&e.getContent().currently_active!==this.currentlyActive&&n.push("User.currentlyActive"),this.presence=e.getContent().presence,n.push("User.lastPresenceTs"),e.getContent().status_msg&&(this.presenceStatusMsg=e.getContent().status_msg),e.getContent().displayname&&(this.displayName=e.getContent().displayname),e.getContent().avatar_url&&(this.avatarUrl=e.getContent().avatar_url),this.lastActiveAgo=e.getContent().last_active_ago,this.lastPresenceTs=Date.now(),this.currentlyActive=e.getContent().currently_active,this._updateModifiedTime();for(let t=0;t<n.length;t++)this.emit(n[t],e,this)},s.prototype.setDisplayName=function(e){const t=this.displayName;this.displayName=e,e!==t&&this._updateModifiedTime()},s.prototype.setRawDisplayName=function(e){this.rawDisplayName=e},s.prototype.setAvatarUrl=function(e){const t=this.avatarUrl;this.avatarUrl=e,e!==t&&this._updateModifiedTime()},s.prototype._updateModifiedTime=function(){this._modified=Date.now()},s.prototype.getLastModifiedTime=function(){return this._modified},s.prototype.getLastActiveTs=function(){return this.lastPresenceTs-this.lastActiveAgo},s.prototype._unstable_updateStatusMessage=function(e){e.getContent()?this._unstable_statusMessage=e.getContent().status:this._unstable_statusMessage="",this._updateModifiedTime(),this.emit("User._unstable_statusMessage",this)}},function(e,t,n){"use strict";(function(e){var r=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixHttpApi=c,t.MatrixError=l,t.PREFIX_MEDIA_R0=t.PREFIX_IDENTITY_V2=t.PREFIX_IDENTITY_V1=t.PREFIX_UNSTABLE=t.PREFIX_R0=void 0;var o=n(75),i=r(n(2)),s=n(0),a=r(n(76));t.PREFIX_R0="/_matrix/client/r0";t.PREFIX_UNSTABLE="/_matrix/client/unstable";t.PREFIX_IDENTITY_V1="/_matrix/identity/api/v1";t.PREFIX_IDENTITY_V2="/_matrix/identity/v2";function c(e,t){i.checkObjectHasKeys(t,["baseUrl","request","prefix"]),t.onlyData=t.onlyData||!1,this.event_emitter=e,this.opts=t,this.useAuthorizationHeader=Boolean(t.useAuthorizationHeader),this.uploads=[]}t.PREFIX_MEDIA_R0="/_matrix/media/r0",c.prototype={setIdBaseUrl:function(e){this.opts.idBaseUrl=e},getContentUri:function(){const e={access_token:this.opts.accessToken};return{base:this.opts.baseUrl,path:"/_matrix/media/r0/upload",params:e}},uploadContent:function(t,n){i.isFunction(n)?n={callback:n}:void 0===n&&(n={});const r=!1!==n.includeFilename,o=n.type||t.type||"application/octet-stream",c=n.name||t.name;let l=t;l.stream&&"function"!=typeof l.stream&&(s.logger.warn("Using `file.stream` as the content to upload. Future versions of the js-sdk will change this to expect `file` to be the content directly."),l=l.stream);let d=n.rawResponse;void 0===d&&(e.XMLHttpRequest?d=!1:(s.logger.warn("Returning the raw JSON from uploadContent(). Future versions of the js-sdk will change this default, to return the parsed object. Set opts.rawResponse=false to change this behaviour now."),d=!0));let h=n.onlyContentUri;d||void 0!==h||(e.XMLHttpRequest?(s.logger.warn("Returning only the content-uri from uploadContent(). Future versions of the js-sdk will change this default, to return the whole response object. Set opts.onlyContentUri=false to change this behaviour now."),h=!0):h=!1);const f={loaded:0,total:0};let p,g=null;if(d||(g=function(e){let t=JSON.parse(e);if(h&&void 0===(t=t.content_uri))throw Error("Bad response");return t}),e.XMLHttpRequest){const t=i.defer(),s=new e.XMLHttpRequest;f.xhr=s;const d=u(t,n.callback,this.opts.onlyData),h=function(){s.abort(),d(new Error("Timeout"))};s.timeout_timer=a.setTimeout(h,3e4),s.onreadystatechange=function(){switch(s.readyState){case e.XMLHttpRequest.DONE:var t;a.clearTimeout(s.timeout_timer);try{if(!s.responseText)throw new Error("No response body.");t=s.responseText,g&&(t=g(t))}catch(e){return e.http_status=s.status,void d(e)}d(void 0,s,t)}},s.upload.addEventListener("progress",(function(e){a.clearTimeout(s.timeout_timer),f.loaded=e.loaded,f.total=e.total,s.timeout_timer=a.setTimeout(h,3e4),n.progressHandler&&n.progressHandler({loaded:e.loaded,total:e.total})}));let m=this.opts.baseUrl+"/_matrix/media/r0/upload";const y=[];r&&c&&y.push("filename="+encodeURIComponent(c)),this.useAuthorizationHeader||y.push("access_token="+encodeURIComponent(this.opts.accessToken)),y.length>0&&(m+="?"+y.join("&")),s.open("POST",m),this.useAuthorizationHeader&&s.setRequestHeader("Authorization","Bearer "+this.opts.accessToken),s.setRequestHeader("Content-Type",o),s.send(l),(p=t.promise).abort=s.abort.bind(s)}else{const e={};r&&c&&(e.filename=c),p=this.authedRequest(n.callback,"POST","/upload",e,l,{prefix:"/_matrix/media/r0",headers:{"Content-Type":o},json:!1,bodyParser:g})}const m=this,y=p.finally((function(){for(let e=0;e<m.uploads.length;++e)if(m.uploads[e]===f)return void m.uploads.splice(e,1)}));return y.abort=p.abort,f.promise=y,this.uploads.push(f),y},cancelUpload:function(e){return!!e.abort&&(e.abort(),!0)},getCurrentUploads:function(){return this.uploads},idServerRequest:function(e,t,n,r,o,s){if(!this.opts.idBaseUrl)throw new Error("No Identity Server base URL set");const a=this.opts.idBaseUrl+o+n;if(void 0!==e&&!i.isFunction(e))throw Error("Expected callback to be a function but got "+typeof e);const c={uri:a,method:t,withCredentials:!1,json:!0,_matrix_opts:this.opts,headers:{}};"GET"===t?c.qs=r:"object"==typeof r&&(c.json=r),s&&(c.headers.Authorization=`Bearer ${s}`);const l=i.defer();return this.opts.request(c,u(l,e,this.opts.onlyData)),l.promise},authedRequest:function(e,t,n,r,o,i){r||(r={}),this.useAuthorizationHeader?(isFinite(i)&&(i={localTimeoutMs:i}),i||(i={}),i.headers||(i.headers={}),i.headers.Authorization||(i.headers.Authorization="Bearer "+this.opts.accessToken),r.access_token&&delete r.access_token):r.access_token||(r.access_token=this.opts.accessToken);const s=this.request(e,t,n,r,o,i),a=this;return s.catch((function(e){"M_UNKNOWN_TOKEN"==e.errcode?a.event_emitter.emit("Session.logged_out",e):"M_CONSENT_NOT_GIVEN"==e.errcode&&a.event_emitter.emit("no_consent",e.message,e.data.consent_uri)})),s},request:function(e,t,n,r,o,i){const s=void 0!==(i=i||{}).prefix?i.prefix:this.opts.prefix,a=this.opts.baseUrl+s+n;return this.requestOtherUrl(e,t,a,r,o,i)},requestOtherUrl:function(e,t,n,r,o,i){return null==i?i={}:isFinite(i)&&(i={localTimeoutMs:i}),this._request(e,t,n,r,o,i)},getUrl:function(e,t,n){let r="";return t&&(r="?"+i.encodeParams(t)),this.opts.baseUrl+n+e+r},_request:function(e,t,n,r,o,s){if(void 0!==e&&!i.isFunction(e))throw Error("Expected callback to be a function but got "+typeof e);s=s||{};const c=this;if(this.opts.extraParams)for(const e in this.opts.extraParams)this.opts.extraParams.hasOwnProperty(e)&&(r[e]=this.opts.extraParams[e]);const d=i.extend({},s.headers||{}),h=void 0===s.json||s.json;let f=s.bodyParser;h&&(o&&(o=JSON.stringify(o),d["content-type"]="application/json"),d.accept||(d.accept="application/json"),void 0===f&&(f=function(e){return JSON.parse(e)}));const p=i.defer();let g,m,y=!1;const v=s.localTimeoutMs||this.opts.localTimeoutMs,_=()=>{v&&(g&&a.clearTimeout(g),g=a.setTimeout((function(){y=!0,m&&m.abort&&m.abort(),p.reject(new l({error:"Locally timed out waiting for a response",errcode:"ORG.MATRIX.JSSDK_TIMEOUT",timeout:v}))}),v))};_();const b=p.promise;try{(m=this.opts.request({uri:n,method:t,withCredentials:!1,qs:r,qsStringifyOptions:s.qsStringifyOptions,useQuerystring:!0,body:o,json:!1,timeout:v,headers:d||{},_matrix_opts:this.opts},(function(t,n,r){if(v&&(a.clearTimeout(g),y))return;u(p,e,c.opts.onlyData,f)(t,n,r)})))&&("onprogress"in m&&(m.onprogress=e=>{_()}),m.abort&&(b.abort=m.abort.bind(m)))}catch(t){p.reject(t),e&&e(t)}return b}};const u=function(e,t,n,r){return t=t||function(){},function(i,s,a){if(!i)try{s.statusCode>=400?i=function(e,t){const n=e.statusCode,r=function(e){let t;e.getResponseHeader?t=e.getResponseHeader("Content-Type"):e.headers&&(t=e.headers["content-type"]||null);if(!t)return null;try{return(0,o.parse)(t)}catch(e){throw new Error(`Error parsing Content-Type '${t}': ${e}`)}}(e);let i;if(r)if("application/json"===r.type){const e="object"==typeof t?t:JSON.parse(t);i=new l(e)}else"text/plain"===r.type&&(i=new Error(`Server returned ${n} error: ${t}`));i||(i=new Error(`Server returned ${n} error`));return i.httpStatus=n,i}(s,a):r&&(a=r(a))}catch(e){i=new Error(`Error parsing server response: ${e}`)}if(i)e.reject(i),t(i);else{const r={code:s.statusCode,headers:s.headers,data:a};e.resolve(n?a:r),t(null,n?a:r)}}};function l(e){e=e||{},this.errcode=e.errcode,this.name=e.errcode||"Unknown error code",this.message=e.error||"Unknown message",this.data=e}l.prototype=Object.create(Error.prototype),l.prototype.constructor=l}).call(this,n(3))},function(e,t,n){"use strict";var r=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.getHttpUriForMxc=function(e,t,n,r,i,s){if("string"!=typeof t||!t)return"";if(0!==t.indexOf("mxc://"))return s?t:"";let a=t.slice(6),c="/_matrix/media/r0/download/";const u={};n&&(u.width=Math.round(n));r&&(u.height=Math.round(r));i&&(u.method=i);o.keys(u).length>0&&(c="/_matrix/media/r0/thumbnail/");const l=a.indexOf("#");let d="";l>=0&&(d=a.substr(l),a=a.substr(0,l));return e+c+a+(0===o.keys(u).length?"":"?"+o.encodeParams(u))+d},t.getIdenticonUri=function(e,t,n,r){if(!t)return null;n||(n=96);r||(r=96);const i={width:n,height:r},s=o.encodeUri("/_matrix/media/unstable/identicon/$ident",{$ident:t});return e+s+(0===o.keys(i).length?"":"?"+o.encodeParams(i))};var o=r(n(2))},function(e,t,n){"use strict";function r(e){Object.defineProperty(this,"deviceId",{enumerable:!0,value:e}),this.algorithms=[],this.keys={},this.verified=o.UNVERIFIED,this.known=!1,this.unsigned={},this.signatures={}}Object.defineProperty(t,"__esModule",{value:!0}),t.DeviceInfo=r,r.fromStorage=function(e,t){const n=new r(t);for(const t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n},r.prototype.toStorage=function(){return{algorithms:this.algorithms,keys:this.keys,verified:this.verified,known:this.known,unsigned:this.unsigned,signatures:this.signatures}},r.prototype.getFingerprint=function(){return this.keys["ed25519:"+this.deviceId]},r.prototype.getIdentityKey=function(){return this.keys["curve25519:"+this.deviceId]},r.prototype.getDisplayName=function(){return this.unsigned.device_display_name||null},r.prototype.isBlocked=function(){return this.verified==o.BLOCKED},r.prototype.isVerified=function(){return this.verified==o.VERIFIED},r.prototype.isUnverified=function(){return this.verified==o.UNVERIFIED},r.prototype.isKnown=function(){return 1==this.known},r.DeviceVerification={VERIFIED:1,UNVERIFIED:0,BLOCKED:-1};const o=r.DeviceVerification},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.randomString=function(e){let t="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let r=0;r<e;++r)t+=n.charAt(Math.floor(Math.random()*n.length));return t}},function(e,t,n){"use strict";var r=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.MemoryCryptoStore=void 0;var o=n(0),i=r(n(2));t.MemoryCryptoStore=class{constructor(){this._outgoingRoomKeyRequests=[],this._account=null,this._crossSigningKeys=null,this._sessions={},this._sessionProblems={},this._notifiedErrorDevices={},this._inboundGroupSessions={},this._inboundGroupSessionsWithheld={},this._deviceData=null,this._rooms={},this._sessionsNeedingBackup={}}deleteAllData(){return Promise.resolve()}getOrAddOutgoingRoomKeyRequest(e){const t=e.requestBody;return i.promiseTry(()=>{const n=this._getOutgoingRoomKeyRequest(t);return n?(o.logger.log("already have key request outstanding for "+`${t.room_id} / ${t.session_id}: `+"not sending another"),n):(o.logger.log(`enqueueing key request for ${t.room_id} / `+t.session_id),this._outgoingRoomKeyRequests.push(e),e)})}getOutgoingRoomKeyRequest(e){return Promise.resolve(this._getOutgoingRoomKeyRequest(e))}_getOutgoingRoomKeyRequest(e){for(const t of this._outgoingRoomKeyRequests)if(i.deepCompare(t.requestBody,e))return t;return null}getOutgoingRoomKeyRequestByState(e){for(const t of this._outgoingRoomKeyRequests)for(const n of e)if(t.state===n)return Promise.resolve(t);return Promise.resolve(null)}getOutgoingRoomKeyRequestsByTarget(e,t,n){const r=[];for(const o of this._outgoingRoomKeyRequests)for(const i of n)o.state===i&&o.recipients.includes({userId:e,deviceId:t})&&r.push(o);return Promise.resolve(r)}updateOutgoingRoomKeyRequest(e,t,n){for(const r of this._outgoingRoomKeyRequests)if(r.requestId===e)return r.state!=t?(o.logger.warn(`Cannot update room key request from ${t} `+`as it was already updated to ${r.state}`),Promise.resolve(null)):(Object.assign(r,n),Promise.resolve(r));return Promise.resolve(null)}deleteOutgoingRoomKeyRequest(e,t){for(let n=0;n<this._outgoingRoomKeyRequests.length;n++){const r=this._outgoingRoomKeyRequests[n];if(r.requestId===e)return r.state!=t?(o.logger.warn(`Cannot delete room key request in state ${r.state} `+`(expected ${t})`),Promise.resolve(null)):(this._outgoingRoomKeyRequests.splice(n,1),Promise.resolve(r))}return Promise.resolve(null)}getAccount(e,t){t(this._account)}storeAccount(e,t){this._account=t}getCrossSigningKeys(e,t){t(this._crossSigningKeys)}storeCrossSigningKeys(e,t){this._crossSigningKeys=t}countEndToEndSessions(e,t){return Object.keys(this._sessions).length}getEndToEndSession(e,t,n,r){r((this._sessions[e]||{})[t]||null)}getEndToEndSessions(e,t,n){n(this._sessions[e]||{})}getAllEndToEndSessions(e,t){for(const e of Object.values(this._sessions))for(const n of Object.values(e))t(n)}storeEndToEndSession(e,t,n,r){let o=this._sessions[e];void 0===o&&(o={},this._sessions[e]=o),o[t]=n}async storeEndToEndSessionProblem(e,t,n){const r=this._sessionProblems[e]=this._sessionProblems[e]||[];r.push({type:t,fixed:n,time:Date.now()}),r.sort((e,t)=>e.time-t.time)}async getEndToEndSessionProblem(e,t){const n=this._sessionProblems[e]||[];if(!n.length)return null;const r=n[n.length-1];for(const e of n)if(e.time>t)return Object.assign({},e,{fixed:r.fixed});return r.fixed?null:r}async filterOutNotifiedErrorDevices(e){const t=this._notifiedErrorDevices,n=[];for(const r of e){const{userId:e,deviceInfo:o}=r;e in t?o.deviceId in t[e]||(n.push(r),t[e][o.deviceId]=!0):(n.push(r),t[e]={[o.deviceId]:!0})}return n}getEndToEndInboundGroupSession(e,t,n,r){const o=e+"/"+t;r(this._inboundGroupSessions[o]||null,this._inboundGroupSessionsWithheld[o]||null)}getAllEndToEndInboundGroupSessions(e,t){for(const e of Object.keys(this._inboundGroupSessions))t({senderKey:e.substr(0,43),sessionId:e.substr(44),sessionData:this._inboundGroupSessions[e]});t(null)}addEndToEndInboundGroupSession(e,t,n,r){const o=e+"/"+t;void 0===this._inboundGroupSessions[o]&&(this._inboundGroupSessions[o]=n)}storeEndToEndInboundGroupSession(e,t,n,r){this._inboundGroupSessions[e+"/"+t]=n}storeEndToEndInboundGroupSessionWithheld(e,t,n,r){const o=e+"/"+t;this._inboundGroupSessionsWithheld[o]=n}getEndToEndDeviceData(e,t){t(this._deviceData)}storeEndToEndDeviceData(e,t){this._deviceData=e}storeEndToEndRoom(e,t,n){this._rooms[e]=t}getEndToEndRooms(e,t){t(this._rooms)}getSessionsNeedingBackup(e){const t=[];for(const n in this._sessionsNeedingBackup)if(this._inboundGroupSessions[n]&&(t.push({senderKey:n.substr(0,43),sessionId:n.substr(44),sessionData:this._inboundGroupSessions[n]}),e&&n.length>=e))break;return Promise.resolve(t)}countSessionsNeedingBackup(){return Promise.resolve(Object.keys(this._sessionsNeedingBackup).length)}unmarkSessionsNeedingBackup(e){for(const t of e){const e=t.senderKey+"/"+t.sessionId;delete this._sessionsNeedingBackup[e]}return Promise.resolve()}markSessionsNeedingBackup(e){for(const t of e){const e=t.senderKey+"/"+t.sessionId;this._sessionsNeedingBackup[e]=!0}return Promise.resolve()}doTxn(e,t,n){return Promise.resolve(n(null))}}},function(e,t,n){"use strict";var r=n(68),o=n(70);function i(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=_,t.resolve=function(e,t){return _(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?_(e,!1,!0).resolveObject(t):t},t.format=function(e){o.isString(e)&&(e=_(e));return e instanceof i?e.format():i.prototype.format.call(e)},t.Url=i;var s=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,c=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,u=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),l=["'"].concat(u),d=["%","/","?",";","#"].concat(l),h=["/","?","#"],f=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,g={javascript:!0,"javascript:":!0},m={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},v=n(71);function _(e,t,n){if(e&&o.isObject(e)&&e instanceof i)return e;var r=new i;return r.parse(e,t,n),r}i.prototype.parse=function(e,t,n){if(!o.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var i=e.indexOf("?"),a=-1!==i&&i<e.indexOf("#")?"?":"#",u=e.split(a);u[0]=u[0].replace(/\\/g,"/");var _=e=u.join(a);if(_=_.trim(),!n&&1===e.split("#").length){var b=c.exec(_);if(b)return this.path=_,this.href=_,this.pathname=b[1],b[2]?(this.search=b[2],this.query=t?v.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var E=s.exec(_);if(E){var S=(E=E[0]).toLowerCase();this.protocol=S,_=_.substr(E.length)}if(n||E||_.match(/^\/\/[^@\/]+@[^@\/]+/)){var w="//"===_.substr(0,2);!w||E&&m[E]||(_=_.substr(2),this.slashes=!0)}if(!m[E]&&(w||E&&!y[E])){for(var k,T,I=-1,R=0;R<h.length;R++){-1!==(O=_.indexOf(h[R]))&&(-1===I||O<I)&&(I=O)}-1!==(T=-1===I?_.lastIndexOf("@"):_.lastIndexOf("@",I))&&(k=_.slice(0,T),_=_.slice(T+1),this.auth=decodeURIComponent(k)),I=-1;for(R=0;R<d.length;R++){var O;-1!==(O=_.indexOf(d[R]))&&(-1===I||O<I)&&(I=O)}-1===I&&(I=_.length),this.host=_.slice(0,I),_=_.slice(I),this.parseHost(),this.hostname=this.hostname||"";var C="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!C)for(var P=this.hostname.split(/\./),D=(R=0,P.length);R<D;R++){var A=P[R];if(A&&!A.match(f)){for(var x="",M=0,N=A.length;M<N;M++)A.charCodeAt(M)>127?x+="x":x+=A[M];if(!x.match(f)){var U=P.slice(0,R),L=P.slice(R+1),K=A.match(p);K&&(U.push(K[1]),L.unshift(K[2])),L.length&&(_="/"+L.join(".")+_),this.hostname=U.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),C||(this.hostname=r.toASCII(this.hostname));var j=this.port?":"+this.port:"",B=this.hostname||"";this.host=B+j,this.href+=this.host,C&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==_[0]&&(_="/"+_))}if(!g[S])for(R=0,D=l.length;R<D;R++){var F=l[R];if(-1!==_.indexOf(F)){var q=encodeURIComponent(F);q===F&&(q=escape(F)),_=_.split(F).join(q)}}var $=_.indexOf("#");-1!==$&&(this.hash=_.substr($),_=_.slice(0,$));var G=_.indexOf("?");if(-1!==G?(this.search=_.substr(G),this.query=_.substr(G+1),t&&(this.query=v.parse(this.query)),_=_.slice(0,G)):t&&(this.search="",this.query={}),_&&(this.pathname=_),y[S]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){j=this.pathname||"";var V=this.search||"";this.path=j+V}return this.href=this.format(),this},i.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",i=!1,s="";this.host?i=e+this.host:this.hostname&&(i=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&o.isObject(this.query)&&Object.keys(this.query).length&&(s=v.stringify(this.query));var a=this.search||s&&"?"+s||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||y[t])&&!1!==i?(i="//"+(i||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):i||(i=""),r&&"#"!==r.charAt(0)&&(r="#"+r),a&&"?"!==a.charAt(0)&&(a="?"+a),t+i+(n=n.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(a=a.replace("#","%23"))+r},i.prototype.resolve=function(e){return this.resolveObject(_(e,!1,!0)).format()},i.prototype.resolveObject=function(e){if(o.isString(e)){var t=new i;t.parse(e,!1,!0),e=t}for(var n=new i,r=Object.keys(this),s=0;s<r.length;s++){var a=r[s];n[a]=this[a]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var c=Object.keys(e),u=0;u<c.length;u++){var l=c[u];"protocol"!==l&&(n[l]=e[l])}return y[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!y[e.protocol]){for(var d=Object.keys(e),h=0;h<d.length;h++){var f=d[h];n[f]=e[f]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||m[e.protocol])n.pathname=e.pathname;else{for(var p=(e.pathname||"").split("/");p.length&&!(e.host=p.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),n.pathname=p.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var g=n.pathname||"",v=n.search||"";n.path=g+v}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var _=n.pathname&&"/"===n.pathname.charAt(0),b=e.host||e.pathname&&"/"===e.pathname.charAt(0),E=b||_||n.host&&e.pathname,S=E,w=n.pathname&&n.pathname.split("/")||[],k=(p=e.pathname&&e.pathname.split("/")||[],n.protocol&&!y[n.protocol]);if(k&&(n.hostname="",n.port=null,n.host&&(""===w[0]?w[0]=n.host:w.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===p[0]?p[0]=e.host:p.unshift(e.host)),e.host=null),E=E&&(""===p[0]||""===w[0])),b)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,w=p;else if(p.length)w||(w=[]),w.pop(),w=w.concat(p),n.search=e.search,n.query=e.query;else if(!o.isNullOrUndefined(e.search)){if(k)n.hostname=n.host=w.shift(),(C=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=C.shift(),n.host=n.hostname=C.shift());return n.search=e.search,n.query=e.query,o.isNull(n.pathname)&&o.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!w.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var T=w.slice(-1)[0],I=(n.host||e.host||w.length>1)&&("."===T||".."===T)||""===T,R=0,O=w.length;O>=0;O--)"."===(T=w[O])?w.splice(O,1):".."===T?(w.splice(O,1),R++):R&&(w.splice(O,1),R--);if(!E&&!S)for(;R--;R)w.unshift("..");!E||""===w[0]||w[0]&&"/"===w[0].charAt(0)||w.unshift(""),I&&"/"!==w.join("/").substr(-1)&&w.push("");var C,P=""===w[0]||w[0]&&"/"===w[0].charAt(0);k&&(n.hostname=n.host=P?"":w.length?w.shift():"",(C=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=C.shift(),n.host=n.hostname=C.shift()));return(E=E||n.host&&w.length)&&!P&&w.unshift(""),w.length?n.pathname=w.join("/"):(n.pathname=null,n.path=null),o.isNull(n.pathname)&&o.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},i.prototype.parseHost=function(){var e=this.host,t=a.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PushProcessor=s;var r=n(2);const o=["override","content","room","sender","underride"],i=[{rule_id:".m.rule.tombstone",default:!0,enabled:!0,conditions:[{kind:"event_match",key:"type",pattern:"m.room.tombstone"},{kind:"event_match",key:"state_key",pattern:""}],actions:["notify",{set_tweak:"highlight",value:!0}]},{rule_id:".m.rule.reaction",default:!0,enabled:!0,conditions:[{kind:"event_match",key:"type",pattern:"m.reaction"}],actions:["dont_notify"]}];function s(e){const t={},n=(e,t,n)=>{for(let r=0;r<o.length;++r){const i=o[r],s=t[i];for(let t=0;t<s.length;++t){const r=s[t];if(!r.enabled)continue;const o=a(i,r,n);if(o&&this.ruleMatchesEvent(o,e))return r.kind=i,r}}return null},a=function(e,t,n){const r={rule_id:t.rule_id,actions:t.actions,conditions:[]};switch(e){case"underride":case"override":r.conditions=t.conditions;break;case"room":if(!t.rule_id)return null;r.conditions.push({kind:"event_match",key:"room_id",value:t.rule_id});break;case"sender":if(!t.rule_id)return null;r.conditions.push({kind:"event_match",key:"user_id",value:t.rule_id});break;case"content":if(!t.pattern)return null;r.conditions.push({kind:"event_match",key:"content.body",pattern:t.pattern})}return n&&r.conditions.push({kind:"device",profile_tag:n}),r},c=function(e,t){const n={event_match:f,device:h,contains_display_name:d,room_member_count:l,sender_notification_permission:u};return!!n[e.kind]&&n[e.kind](e,t)},u=function(t,n){const r=t.key;if(!r)return!1;const o=e.getRoom(n.getRoomId());return!(!o||!o.currentState)&&o.currentState.mayTriggerNotifOfType(r,n.getSender())},l=function(t,n){if(!t.is)return!1;const r=e.getRoom(n.getRoomId());if(!r||!r.currentState||!r.currentState.members)return!1;const o=r.currentState.getJoinedMemberCount(),i=t.is.match(/^([=<>]*)([0-9]*)$/);if(!i)return!1;const s=i[1],a=parseInt(i[2]);if(isNaN(a))return!1;switch(s){case"":case"==":return o==a;case"<":return o<a;case">":return o>a;case"<=":return o<=a;case">=":return o>=a;default:return!1}},d=function(t,n){let o=n.getContent();if(n.isEncrypted()&&n.getClearContent()&&(o=n.getClearContent()),!o||!o.body||"string"!=typeof o.body)return!1;const i=e.getRoom(n.getRoomId());if(!(i&&i.currentState&&i.currentState.members&&i.currentState.getMember(e.credentials.userId)))return!1;const s=i.currentState.getMember(e.credentials.userId).name,a=new RegExp("(^|\\W)"+(0,r.escapeRegExp)(s)+"(\\W|$)","i");return o.body.search(a)>-1},h=function(e,t){return!1},f=function(e,t){if(!e.key)return!1;const n=g(e.key,t);if("string"!=typeof n)return!1;if(e.value)return e.value===n;let r;return r="content.body"==e.key?p("(^|\\W)",e.pattern,"(\\W|$)"):p("^",e.pattern,"$"),!!n.match(r)},p=function(e,n,o){return t[n]?t[n]:(t[n]=new RegExp(e+(0,r.globToRegexp)(n)+o,"i"),t[n])},g=function(e,t){const n=e.split(".");let o;const i=n[0];for("content"===i?(o=t.getContent(),n.shift()):"type"===i?(o=t.getType(),n.shift()):o=t.event;n.length>0;){const e=n.shift();if((0,r.isNullOrUndefined)(o[e]))return null;o=o[e]}return o},m=function(t,r){const o=function(t,r){if(!r||!r.device)return null;if(t.getSender()==e.credentials.userId)return null;const o=Object.keys(r.device);for(let e=0;e<o.length;++e){const t=o[e],i=r.device[t],s=n(i,t);if(s)return s}return n(t,r.global)}(t,r);if(!o)return{};const i=s.actionListToActionsObject(o.actions);return void 0===i.tweaks.highlight&&(i.tweaks.highlight="content"==o.kind),i};this.ruleMatchesEvent=function(e,t){let n=!0;for(let r=0;r<e.conditions.length;++r){const o=e.conditions[r];n&=c(o,t)}return n},this.actionsForEvent=function(t){const n=function(e){const t=JSON.parse(JSON.stringify(e));e.global||(e.global={}),e.global.override||(e.global.override=[]);const n=e.global.override;for(const e of i){if(!n.find(t=>t.rule_id===e.rule_id)){const t=e.rule_id;console.warn(`Adding default global override for ${t}`),n.push(e)}}return t}(e.pushRules);return m(t,n)},this.getPushRuleById=function(t){for(const n of["device","global"])if(void 0!==e.pushRules[n])for(const r of o)if(void 0!==e.pushRules[n][r])for(const o of e.pushRules[n][r])if(o.rule_id===t)return o;return null}}s.actionListToActionsObject=function(e){const t={notify:!1,tweaks:{}};for(let n=0;n<e.length;++n){const r=e[n];"notify"===r?t.notify=!0:"object"==typeof r&&(void 0===r.value&&(r.value=!0),t.tweaks[r.set_tweak]=r.value)}return t},s.rewriteDefaultRules=function(e){let t=JSON.parse(JSON.stringify(e));return t||(t={}),t.global||(t.global={}),t.global.override||(t.global.override=[]),t.global.override=t.global.override.map(e=>{const t=i.find(t=>t.rule_id===e.rule_id);return t?(e.default=t.default,e.conditions=t.conditions,e.actions=t.actions,e):e}),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Filter=i;var r=n(77);function o(e,t,n){const r=t.split(".");let o=e;for(let e=0;e<r.length-1;e++)o[r[e]]||(o[r[e]]={}),o=o[r[e]];o[r[r.length-1]]=n}function i(e,t){this.userId=e,this.filterId=t,this.definition={}}i.LAZY_LOADING_MESSAGES_FILTER={lazy_load_members:!0},i.LAZY_LOADING_SYNC_FILTER={room:{state:i.LAZY_LOADING_MESSAGES_FILTER}},i.prototype.getFilterId=function(){return this.filterId},i.prototype.getDefinition=function(){return this.definition},i.prototype.setDefinition=function(e){this.definition=e;const t=e.room,n={};t&&(t.rooms&&(n.rooms=t.rooms),t.rooms&&(n.not_rooms=t.not_rooms),this._include_leave=t.include_leave||!1),this._room_filter=new r.FilterComponent(n),this._room_timeline_filter=new r.FilterComponent(t&&t.timeline||{})},i.prototype.getRoomTimelineFilterComponent=function(){return this._room_timeline_filter},i.prototype.filterRoomTimeline=function(e){return this._room_timeline_filter.filter(this._room_filter.filter(e))},i.prototype.setTimelineLimit=function(e){o(this.definition,"room.timeline.limit",e)},i.prototype.setIncludeLeaveRooms=function(e){o(this.definition,"room.include_leave",e)},i.fromJson=function(e,t,n){const r=new i(e,t);return r.setDefinition(n),r}},function(e,t,n){"use strict";var r=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.RoomMember=a;var o=n(4),i=n(14),s=r(n(2));function a(e,t){this.roomId=e,this.userId=t,this.typing=!1,this.name=t,this.rawDisplayName=t,this.powerLevel=0,this.powerLevelNorm=0,this.user=null,this.membership=null,this.events={member:null},this._isOutOfBand=!1,this._updateModifiedTime()}s.inherits(a,o.EventEmitter),a.prototype.markOutOfBand=function(){this._isOutOfBand=!0},a.prototype.isOutOfBand=function(){return this._isOutOfBand},a.prototype.setMembershipEvent=function(e,t){if("m.room.member"!==e.getType())return;this._isOutOfBand=!1,this.events.member=e;const n=this.membership;this.membership=e.getDirectionalContent().membership;const r=this.name;this.name=function(e,t,n){if(!t||t===e)return e;if(!s.removeHiddenChars(t))return e;if(!n)return t;let r=/@.+:.+/.test(t);r||(r=/[\u200E\u200F\u202A-\u202F]/.test(t));if(!r){const o=n.getUserIdsWithDisplayName(t);r=o.some(t=>t!==e)}if(r)return t+" ("+e+")";return t}(this.userId,e.getDirectionalContent().displayname,t),this.rawDisplayName=e.getDirectionalContent().displayname||this.userId,n!==this.membership&&(this._updateModifiedTime(),this.emit("RoomMember.membership",e,this,n)),r!==this.name&&(this._updateModifiedTime(),this.emit("RoomMember.name",e,this,r))},a.prototype.setPowerLevelEvent=function(e){if("m.room.power_levels"!==e.getType())return;const t=e.getDirectionalContent();let n=t.users_default||0;s.forEach(s.values(t.users),(function(e){n=Math.max(n,e)}));const r=this.powerLevel,o=this.powerLevelNorm;t.users&&void 0!==t.users[this.userId]?this.powerLevel=t.users[this.userId]:void 0!==t.users_default?this.powerLevel=t.users_default:this.powerLevel=0,this.powerLevelNorm=0,n>0&&(this.powerLevelNorm=100*this.powerLevel/n),r===this.powerLevel&&o===this.powerLevelNorm||(this._updateModifiedTime(),this.emit("RoomMember.powerLevel",e,this))},a.prototype.setTypingEvent=function(e){if("m.typing"!==e.getType())return;const t=this.typing;this.typing=!1;const n=e.getContent().user_ids;s.isArray(n)&&(-1!==n.indexOf(this.userId)&&(this.typing=!0),t!==this.typing&&(this._updateModifiedTime(),this.emit("RoomMember.typing",e,this)))},a.prototype._updateModifiedTime=function(){this._modified=Date.now()},a.prototype.getLastModifiedTime=function(){return this._modified},a.prototype.isKicked=function(){return"leave"===this.membership&&this.events.member.getSender()!==this.events.member.getStateKey()},a.prototype.getDMInviter=function(){if(this.events.member){const e=this.events.member;let t=e.getContent(),n=e.getSender();if("join"===t.membership&&(t=e.getPrevContent(),n=e.getUnsigned().prev_sender),"invite"===t.membership&&t.is_direct)return n}},a.prototype.getAvatarUrl=function(e,t,n,r,o,s){void 0===o&&(o=!0);const a=this.getMxcAvatarUrl();if(!a&&!o)return null;const c=(0,i.getHttpUriForMxc)(e,a,t,n,r,s);return c||(o?(0,i.getIdenticonUri)(e,this.userId,t,n):null)},a.prototype.getMxcAvatarUrl=function(){return this.events.member?this.events.member.getDirectionalContent().avatar_url:this.user?this.user.avatarUrl:null}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReEmitter=void 0;t.ReEmitter=class{constructor(e){this.target=e,this.boundHandlers={}}_handleEvent(e,...t){this.target.emit(e,...t)}reEmit(e,t){const n=(t,...n)=>{t(...n,e)};for(const r of t){void 0===this.boundHandlers[r]&&(this.boundHandlers[r]=this._handleEvent.bind(this,r));const t=n.bind(this,this.boundHandlers[r]);e.on(r,t)}}}},function(e,t,n){"use strict";function r(e,t){const n=`Store is invalid because ${e}, `+"please stop the client, delete all data and start the client again",r=Reflect.construct(Error,[n]);return Reflect.setPrototypeOf(r,Reflect.getPrototypeOf(this)),r.reason=e,r.value=t,r}function o(e){const t=`Crypto store is invalid because ${e}, `+"please stop the client, delete all data and start the client again",n=Reflect.construct(Error,[t]);return Reflect.setPrototypeOf(n,Reflect.getPrototypeOf(this)),n.reason=e,n.name="InvalidCryptoStoreError",n}Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidStoreError=r,t.InvalidCryptoStoreError=o,r.TOGGLED_LAZY_LOADING="TOGGLED_LAZY_LOADING",r.prototype=Object.create(Error.prototype,{constructor:{value:Error,enumerable:!1,writable:!0,configurable:!0}}),Reflect.setPrototypeOf(r,Error),o.TOO_NEW="TOO_NEW",o.prototype=Object.create(Error.prototype,{constructor:{value:Error,enumerable:!1,writable:!0,configurable:!0}}),Reflect.setPrototypeOf(o,Error)},function(e,t,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var r=n(85),o=n(86),i=n(87);function s(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,n){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return u(this,e,t,n)}function u(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=h(e,t);return e}(e,t,n,r):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(t,n),o=(e=a(e,r)).write(t,n);o!==r&&(e=e.slice(0,o));return e}(e,t,n):function(e,t){if(c.isBuffer(t)){var n=0|f(t.length);return 0===(e=a(e,n)).length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?a(e,0):h(e,t);if("Buffer"===t.type&&i(t.data))return h(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function d(e,t){if(l(t),e=a(e,t<0?0:0|f(t)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function h(e,t){var n=t.length<0?0:0|f(t.length);e=a(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function f(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function p(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return F(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return q(e).length;default:if(r)return F(e).length;t=(""+t).toLowerCase(),r=!0}}function g(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return P(this,t,n);case"utf8":case"utf-8":return I(this,t,n);case"ascii":return O(this,t,n);case"latin1":case"binary":return C(this,t,n);case"base64":return T(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function m(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function y(e,t,n,r,o){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=o?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(o)return-1;n=e.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof t&&(t=c.from(t,r)),c.isBuffer(t))return 0===t.length?-1:v(e,t,n,r,o);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):v(e,[t],n,r,o);throw new TypeError("val must be string, number or Buffer")}function v(e,t,n,r,o){var i,s=1,a=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,n/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(o){var l=-1;for(i=n;i<a;i++)if(u(e,i)===u(t,-1===l?0:i-l)){if(-1===l&&(l=i),i-l+1===c)return l*s}else-1!==l&&(i-=i-l),l=-1}else for(n+c>a&&(n=a-c),i=n;i>=0;i--){for(var d=!0,h=0;h<c;h++)if(u(e,i+h)!==u(t,h)){d=!1;break}if(d)return i}return-1}function _(e,t,n,r){n=Number(n)||0;var o=e.length-n;r?(r=Number(r))>o&&(r=o):r=o;var i=t.length;if(i%2!=0)throw new TypeError("Invalid hex string");r>i/2&&(r=i/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[n+s]=a}return s}function b(e,t,n,r){return $(F(t,e.length-n),e,n,r)}function E(e,t,n,r){return $(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function S(e,t,n,r){return E(e,t,n,r)}function w(e,t,n,r){return $(q(t),e,n,r)}function k(e,t,n,r){return $(function(e,t){for(var n,r,o,i=[],s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),r=n>>8,o=n%256,i.push(o),i.push(r);return i}(t,e.length-n),e,n,r)}function T(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function I(e,t,n){n=Math.min(e.length,n);for(var r=[],o=t;o<n;){var i,s,a,c,u=e[o],l=null,d=u>239?4:u>223?3:u>191?2:1;if(o+d<=n)switch(d){case 1:u<128&&(l=u);break;case 2:128==(192&(i=e[o+1]))&&(c=(31&u)<<6|63&i)>127&&(l=c);break;case 3:i=e[o+1],s=e[o+2],128==(192&i)&&128==(192&s)&&(c=(15&u)<<12|(63&i)<<6|63&s)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:i=e[o+1],s=e[o+2],a=e[o+3],128==(192&i)&&128==(192&s)&&128==(192&a)&&(c=(15&u)<<18|(63&i)<<12|(63&s)<<6|63&a)>65535&&c<1114112&&(l=c)}null===l?(l=65533,d=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),o+=d}return function(e){var t=e.length;if(t<=R)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=R));return n}(r)}t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=s(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,n){return u(null,e,t,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,n){return function(e,t,n,r){return l(t),t<=0?a(e,t):void 0!==n?"string"==typeof r?a(e,t).fill(n,r):a(e,t).fill(n):a(e,t)}(null,e,t,n)},c.allocUnsafe=function(e){return d(null,e)},c.allocUnsafeSlow=function(e){return d(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,o=0,i=Math.min(n,r);o<i;++o)if(e[o]!==t[o]){n=e[o],r=t[o];break}return n<r?-1:r<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!i(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=c.allocUnsafe(t),o=0;for(n=0;n<e.length;++n){var s=e[n];if(!c.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,o),o+=s.length}return r},c.byteLength=p,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?I(this,0,e):g.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,n,r,o){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===o&&(o=this.length),t<0||n>e.length||r<0||o>this.length)throw new RangeError("out of range index");if(r>=o&&t>=n)return 0;if(r>=o)return-1;if(t>=n)return 1;if(this===e)return 0;for(var i=(o>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),a=Math.min(i,s),u=this.slice(r,o),l=e.slice(t,n),d=0;d<a;++d)if(u[d]!==l[d]){i=u[d],s=l[d];break}return i<s?-1:s<i?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},c.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var o=this.length-t;if((void 0===n||n>o)&&(n=o),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var i=!1;;)switch(r){case"hex":return _(this,e,t,n);case"utf8":case"utf-8":return b(this,e,t,n);case"ascii":return E(this,e,t,n);case"latin1":case"binary":return S(this,e,t,n);case"base64":return w(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var R=4096;function O(e,t,n){var r="";n=Math.min(e.length,n);for(var o=t;o<n;++o)r+=String.fromCharCode(127&e[o]);return r}function C(e,t,n){var r="";n=Math.min(e.length,n);for(var o=t;o<n;++o)r+=String.fromCharCode(e[o]);return r}function P(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var o="",i=t;i<n;++i)o+=B(e[i]);return o}function D(e,t,n){for(var r=e.slice(t,n),o="",i=0;i<r.length;i+=2)o+=String.fromCharCode(r[i]+256*r[i+1]);return o}function A(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function x(e,t,n,r,o,i){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<i)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function M(e,t,n,r){t<0&&(t=65535+t+1);for(var o=0,i=Math.min(e.length-n,2);o<i;++o)e[n+o]=(t&255<<8*(r?o:1-o))>>>8*(r?o:1-o)}function N(e,t,n,r){t<0&&(t=4294967295+t+1);for(var o=0,i=Math.min(e.length-n,4);o<i;++o)e[n+o]=t>>>8*(r?o:3-o)&255}function U(e,t,n,r,o,i){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function L(e,t,n,r,i){return i||U(e,0,n,4),o.write(e,t,n,r,23,4),n+4}function K(e,t,n,r,i){return i||U(e,0,n,8),o.write(e,t,n,r,52,8),n+8}c.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=c.prototype;else{var o=t-e;n=new c(o,void 0);for(var i=0;i<o;++i)n[i]=this[i+e]}return n},c.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||A(e,t,this.length);for(var r=this[e],o=1,i=0;++i<t&&(o*=256);)r+=this[e+i]*o;return r},c.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||A(e,t,this.length);for(var r=this[e+--t],o=1;t>0&&(o*=256);)r+=this[e+--t]*o;return r},c.prototype.readUInt8=function(e,t){return t||A(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||A(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||A(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||A(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||A(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||A(e,t,this.length);for(var r=this[e],o=1,i=0;++i<t&&(o*=256);)r+=this[e+i]*o;return r>=(o*=128)&&(r-=Math.pow(2,8*t)),r},c.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||A(e,t,this.length);for(var r=t,o=1,i=this[e+--r];r>0&&(o*=256);)i+=this[e+--r]*o;return i>=(o*=128)&&(i-=Math.pow(2,8*t)),i},c.prototype.readInt8=function(e,t){return t||A(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||A(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){t||A(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return t||A(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||A(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||A(e,4,this.length),o.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||A(e,4,this.length),o.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||A(e,8,this.length),o.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||A(e,8,this.length),o.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||x(this,e,t,n,Math.pow(2,8*n)-1,0);var o=1,i=0;for(this[t]=255&e;++i<n&&(o*=256);)this[t+i]=e/o&255;return t+n},c.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||x(this,e,t,n,Math.pow(2,8*n)-1,0);var o=n-1,i=1;for(this[t+o]=255&e;--o>=0&&(i*=256);)this[t+o]=e/i&255;return t+n},c.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):M(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):M(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):N(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):N(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var o=Math.pow(2,8*n-1);x(this,e,t,n,o-1,-o)}var i=0,s=1,a=0;for(this[t]=255&e;++i<n&&(s*=256);)e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+n},c.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var o=Math.pow(2,8*n-1);x(this,e,t,n,o-1,-o)}var i=n-1,s=1,a=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===a&&0!==this[t+i+1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):M(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):M(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):N(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):N(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,n){return L(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return L(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return K(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return K(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var o,i=r-n;if(this===e&&n<t&&t<r)for(o=i-1;o>=0;--o)e[o+t]=this[o+n];else if(i<1e3||!c.TYPED_ARRAY_SUPPORT)for(o=0;o<i;++o)e[o+t]=this[o+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+i),t);return i},c.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var o=e.charCodeAt(0);o<256&&(e=o)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var s=c.isBuffer(e)?e:F(new c(e,r).toString()),a=s.length;for(i=0;i<n-t;++i)this[i+t]=s[i%a]}return this};var j=/[^+\/0-9A-Za-z-_]/g;function B(e){return e<16?"0"+e.toString(16):e.toString(16)}function F(e,t){var n;t=t||1/0;for(var r=e.length,o=null,i=[],s=0;s<r;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!o){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&i.push(239,191,189);continue}o=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),o=n;continue}n=65536+(o-55296<<10|n-56320)}else o&&(t-=3)>-1&&i.push(239,191,189);if(o=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function q(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(j,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function $(e,t,n,r){for(var o=0;o<r&&!(o+n>=t.length||o>=e.length);++o)t[o+n]=e[o];return o}}).call(this,n(3))},function(e,t,n){"use strict";for(var r=/[\\\"\x00-\x1F]/g,o={},i=0;i<32;++i)o[String.fromCharCode(i)]="\\U"+("0000"+i.toString(16)).slice(-4).toUpperCase();function s(e){return r.lastIndex=0,e.replace(r,(function(e){return o[e]}))}function a(e){switch(typeof e){case"string":return'"'+s(e)+'"';case"number":return isFinite(e)?e:"null";case"boolean":return e;case"object":return null===e?"null":Array.isArray(e)?function(e){for(var t="[",n="",r=0;r<e.length;++r)n+=t,t=",",n+=a(e[r]);return","!=t?"[]":n+"]"}(e):function(e){var t="{",n="",r=Object.keys(e);r.sort();for(var o=0;o<r.length;++o){var i=r[o];n+=t+'"'+s(i)+'":',t=",",n+=a(e[i])}return","!=t?"{}":n+"}"}(e);default:throw new Error("Cannot stringify: "+typeof e)}}o["\b"]="\\b",o["\t"]="\\t",o["\n"]="\\n",o["\f"]="\\f",o["\r"]="\\r",o['"']='\\"',o["\\"]="\\\\",e.exports={stringify:a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.registerAlgorithm=function(e,t,n){r[e]=t,o[e]=n},t.UnknownDeviceError=t.DecryptionError=t.DecryptionAlgorithm=t.EncryptionAlgorithm=t.DECRYPTION_CLASSES=t.ENCRYPTION_CLASSES=void 0;const r={};t.ENCRYPTION_CLASSES=r;const o={};t.DECRYPTION_CLASSES=o;t.EncryptionAlgorithm=class{constructor(e){this._userId=e.userId,this._deviceId=e.deviceId,this._crypto=e.crypto,this._olmDevice=e.olmDevice,this._baseApis=e.baseApis,this._roomId=e.roomId}onRoomMembership(e,t,n){}};t.DecryptionAlgorithm=class{constructor(e){this._userId=e.userId,this._crypto=e.crypto,this._olmDevice=e.olmDevice,this._baseApis=e.baseApis,this._roomId=e.roomId}onRoomKeyEvent(e){}importRoomKey(e){}hasKeysForKeyRequest(e){return Promise.resolve(!1)}shareKeysWithDevice(e){throw new Error("shareKeysWithDevice not supported for this DecryptionAlgorithm")}async retryDecryptionFromSender(e){}};class i extends Error{constructor(e,t,n){super(t),this.code=e,this.name="DecryptionError",this.detailedString=function(e,t){let n=e.name+"[msg: "+e.message;t&&(n+=", "+Object.keys(t).map(e=>e+": "+t[e]).join(", "));return n+="]"}(this,n)}}t.DecryptionError=i;class s extends Error{constructor(e,t){super(e),this.name="UnknownDeviceError",this.devices=t}}t.UnknownDeviceError=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VerificationRequest=t.PHASE_DONE=t.PHASE_CANCELLED=t.PHASE_STARTED=t.PHASE_REQUESTED=t.PHASE_UNSENT=t.DONE_TYPE=t.CANCEL_TYPE=t.START_TYPE=t.REQUEST_TYPE=t.EVENT_PREFIX=void 0;var r=n(0),o=n(102),i=n(4),s=n(10);const a=6e5,c=3e3,u="m.key.verification.";t.EVENT_PREFIX=u;const l=u+"request";t.REQUEST_TYPE=l;const d=u+"start";t.START_TYPE=d;const h=u+"cancel";t.CANCEL_TYPE=h;const f=u+"done";t.DONE_TYPE=f;const p=1;t.PHASE_UNSENT=p;const g=2;t.PHASE_REQUESTED=g;const m=4;t.PHASE_STARTED=m;const y=5;t.PHASE_CANCELLED=y;const v=6;t.PHASE_DONE=v;class _ extends i.EventEmitter{constructor(e,t,n,r){super(),this.channel=e,this._verificationMethods=t,this._client=r,this._commonMethods=[],this._setPhase(p,!1),this._requestEvent=null,this._otherUserId=n,this._initiatedByMe=null,this._startTimestamp=null}static validateEvent(e,t,n,o){const i=t.getContent();if(!e.startsWith(u))return!1;if(e===l&&!Array.isArray(i.methods))return!1;if(!(e!==l&&e!==d||"string"==typeof i.from_device&&0!==i.from_device.length))return!1;if(Number.isFinite(n)){const e=Date.now()-n;if(e>a-c||e<-a/2)return r.logger.log("received verification that is too old or from the future"),!1}return!0}get methods(){return this._commonMethods}get timeout(){const e=Date.now()-this._startTimestamp;return Math.max(0,a-e)}get event(){return this._requestEvent}get phase(){return this._phase}get verifier(){return this._verifier}get pending(){return this._phase!==p&&this._phase!==v&&this._phase!==y}get initiatedByMe(){return this._initiatedByMe}get requestingUserId(){return this.initiatedByMe?this._client.getUserId():this._otherUserId}get receivingUserId(){return this.initiatedByMe?this._otherUserId:this._client.getUserId()}beginKeyVerification(e,t=null){if(!this._verifier&&this._hasValidPreStartPhase()){if(this._commonMethods.length&&!this._commonMethods.includes(e))throw(0,s.newUnknownMethodError)();if(this._verifier=this._createVerifier(e,null,t),!this._verifier)throw(0,s.newUnknownMethodError)()}return this._verifier}async sendRequest(){if(this._phase===p){this._initiatedByMe=!0,this._setPhase(g,!1);const e=[...this._verificationMethods.keys()];await this.channel.send(l,{methods:e}),this.emit("change")}}async cancel({reason:e="User declined",code:t="m.user"}={}){if(this._phase!==y){if(this._verifier)return this._verifier.cancel((0,s.errorFactory)(t,e));this._setPhase(y,!1),await this.channel.send(h,{code:t,reason:e}),this.emit("change")}}waitForVerifier(){return this.verifier?Promise.resolve(this.verifier):new Promise(e=>{const t=()=>{this.verifier&&(this.off("change",t),e(this.verifier))};this.on("change",t)})}_setPhase(e,t=!0){this._phase=e,t&&this.emit("change")}async handleEvent(e,t,n){const r=t.getContent();e!==l&&e!==d||null===this._startTimestamp&&(this._startTimestamp=n),e===l?await this._handleRequest(r,t):e===d&&await this._handleStart(r,t),this._verifier&&(e===h||this._verifier.events&&this._verifier.events.includes(e))&&this._verifier.handleEvent(t),e===h?this._handleCancel():e===f&&this._handleDone()}async _handleRequest(e,t){if(this._phase===p){const n=e.methods;this._commonMethods=n.filter(e=>this._verificationMethods.has(e)),this._requestEvent=t,this._initiatedByMe=this._wasSentByMe(t),this._setPhase(g)}else this._phase!==g&&(r.logger.warn("Ignoring flagged verification request from "+t.getSender()),await this.cancel((0,s.errorFromEvent)((0,s.newUnexpectedMessageError)())))}_hasValidPreStartPhase(){return this._phase===g||this.channel.constructor.canCreateRequest(d)&&this._phase===p}async _handleStart(e,t){if(this._hasValidPreStartPhase()){const{method:n}=e;this._verificationMethods.has(n)?(this.phase===p&&(this._initiatedByMe=this._wasSentByMe(t)),this._verifier=this._createVerifier(n,t),this._setPhase(m)):await this.cancel((0,s.errorFromEvent)((0,s.newUnknownMethodError)()))}}handleVerifierSend(e,t){e===h?this._handleCancel():e===d&&(this._phase!==p&&this._phase!==g||(this._initiatedByMe=this.phase===p,this._setPhase(m)))}_handleCancel(){this._phase!==y&&this._setPhase(y)}_handleDone(){this._phase===m&&this._setPhase(v)}_createVerifier(e,t=null,n=null){const r=t&&this._wasSentByMe(t),{userId:i,deviceId:s}=this._getVerifierTarget(t,n),a=this._verificationMethods.get(e);if(a)return new a(new o.RequestCallbackChannel(this,this.channel),this._client,i,s,r?null:t);console.warn("could not find verifier constructor for method",e)}_getVerifierTarget(e,t){if(t)return t;{let t;if(e&&!this._wasSentByMe(e))t=e;else{if(!this._requestEvent||this._wasSentByMe(this._requestEvent))throw new Error("can't determine who the verifier should be targeted at. No .request or .start event and no targetDevice");t=this._requestEvent}const n=t.getSender(),r=t.getContent();return{userId:n,deviceId:r&&r.from_device}}}_wasSentByMe(e){if(e.getSender()!==this._client.getUserId())return!1;const t=e.getContent();return!(!t||t.from_device!==this._client.getDeviceId())}}t.VerificationRequest=_},function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty,o=Array.isArray,i=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),s=function(e,t){for(var n=t&&t.plainObjects?Object.create(null):{},r=0;r<e.length;++r)void 0!==e[r]&&(n[r]=e[r]);return n};e.exports={arrayToObject:s,assign:function(e,t){return Object.keys(t).reduce((function(e,n){return e[n]=t[n],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],n=[],r=0;r<t.length;++r)for(var i=t[r],s=i.obj[i.prop],a=Object.keys(s),c=0;c<a.length;++c){var u=a[c],l=s[u];"object"==typeof l&&null!==l&&-1===n.indexOf(l)&&(t.push({obj:s,prop:u}),n.push(l))}return function(e){for(;e.length>1;){var t=e.pop(),n=t.obj[t.prop];if(o(n)){for(var r=[],i=0;i<n.length;++i)void 0!==n[i]&&r.push(n[i]);t.obj[t.prop]=r}}}(t),e},decode:function(e,t,n){var r=e.replace(/\+/g," ");if("iso-8859-1"===n)return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(e){return r}},encode:function(e,t,n){if(0===e.length)return e;var r=e;if("symbol"==typeof e?r=Symbol.prototype.toString.call(e):"string"!=typeof e&&(r=String(e)),"iso-8859-1"===n)return escape(r).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var o="",s=0;s<r.length;++s){var a=r.charCodeAt(s);45===a||46===a||95===a||126===a||a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122?o+=r.charAt(s):a<128?o+=i[a]:a<2048?o+=i[192|a>>6]+i[128|63&a]:a<55296||a>=57344?o+=i[224|a>>12]+i[128|a>>6&63]+i[128|63&a]:(s+=1,a=65536+((1023&a)<<10|1023&r.charCodeAt(s)),o+=i[240|a>>18]+i[128|a>>12&63]+i[128|a>>6&63]+i[128|63&a])}return o},isBuffer:function(e){return!(!e||"object"!=typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},merge:function e(t,n,i){if(!n)return t;if("object"!=typeof n){if(o(t))t.push(n);else{if(!t||"object"!=typeof t)return[t,n];(i&&(i.plainObjects||i.allowPrototypes)||!r.call(Object.prototype,n))&&(t[n]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(n);var a=t;return o(t)&&!o(n)&&(a=s(t,i)),o(t)&&o(n)?(n.forEach((function(n,o){if(r.call(t,o)){var s=t[o];s&&"object"==typeof s&&n&&"object"==typeof n?t[o]=e(s,n,i):t.push(n)}else t[o]=n})),t):Object.keys(n).reduce((function(t,o){var s=n[o];return r.call(t,o)?t[o]=e(t[o],s,i):t[o]=s,t}),a)}}},function(e,t,n){"use strict";
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;function s(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var n,a,c=s(e),u=1;u<arguments.length;u++){for(var l in n=Object(arguments[u]))o.call(n,l)&&(c[l]=n[l]);if(r){a=r(n);for(var d=0;d<a.length;d++)i.call(n,a[d])&&(c[a[d]]=n[a[d]])}}return c}},function(e,t,n){e.exports=n(59)()},function(e,t,n){"use strict";(function(e){var r=n(5);Object.defineProperty(t,"__esModule",{value:!0});var o={ContentHelpers:!0,request:!0,getRequest:!0,wrapRequest:!0,setCryptoStoreFactory:!0,createClient:!0,createNewMatrixCall:!0,setMatrixCallAudioOutput:!0,setMatrixCallAudioInput:!0,setMatrixCallVideoInput:!0};t.request=function(e){A=e},t.getRequest=function(){return A},t.wrapRequest=function(e){const t=A;A=function(n,r){return e(t,n,r)}},t.setCryptoStoreFactory=function(e){x=e},t.createClient=function(t){"string"==typeof t&&(t={baseUrl:t});return t.request=t.request||A,t.store=t.store||new a.MemoryStore({localStorage:e.localStorage}),t.scheduler=t.scheduler||new c.MatrixScheduler,t.cryptoStore=t.cryptoStore||x(),new u.MatrixClient(t)},Object.defineProperty(t,"createNewMatrixCall",{enumerable:!0,get:function(){return P.createNewMatrixCall}}),Object.defineProperty(t,"setMatrixCallAudioOutput",{enumerable:!0,get:function(){return P.setAudioOutput}}),Object.defineProperty(t,"setMatrixCallAudioInput",{enumerable:!0,get:function(){return P.setAudioInput}}),Object.defineProperty(t,"setMatrixCallVideoInput",{enumerable:!0,get:function(){return P.setVideoInput}}),t.ContentHelpers=void 0;var i=r(n(1)),s=n(17);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}}))}));var a=n(32);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))}));var c=n(66);Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}}))}));var u=n(67);Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}}))}));var l=n(13);Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}}))}));var d=n(105);Object.keys(d).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}}))}));var h=n(47);Object.keys(h).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return h[e]}}))}));var f=n(23);Object.keys(f).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}}))}));var p=n(6);Object.keys(p).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return p[e]}}))}));var g=n(34);Object.keys(g).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return g[e]}}))}));var m=n(37);Object.keys(m).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return m[e]}}))}));var y=n(8);Object.keys(y).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return y[e]}}))}));var v=n(35);Object.keys(v).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return v[e]}}))}));var _=n(21);Object.keys(_).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return _[e]}}))}));var b=n(36);Object.keys(b).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return b[e]}}))}));var E=n(12);Object.keys(E).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return E[e]}}))}));var S=n(20);Object.keys(S).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return S[e]}}))}));var w=n(106);Object.keys(w).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return w[e]}}))}));var k=n(107);Object.keys(k).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return k[e]}}))}));var T=n(33);Object.keys(T).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return T[e]}}))}));var I=n(108);Object.keys(I).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return I[e]}}))}));var R=n(111);Object.keys(R).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return R[e]}}))}));var O=n(9);Object.keys(O).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return O[e]}}))}));var C=n(14);Object.keys(C).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return C[e]}}))}));var P=n(38);const D=Promise.resolve().then(()=>(0,i.default)(n(39)));let A;t.ContentHelpers=D;let x=()=>new s.MemoryCryptoStore}).call(this,n(3))},function(e,t,n){"use strict";var r=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.MemoryStore=s;var o=n(12),i=r(n(2));function s(e){e=e||{},this.rooms={},this.groups={},this.users={},this.syncToken=null,this.filters={},this.accountData={},this.localStorage=e.localStorage,this._oobMembers={},this._clientOptions={}}s.prototype={getSyncToken:function(){return this.syncToken},isNewlyCreated:function(){return Promise.resolve(!0)},setSyncToken:function(e){this.syncToken=e},storeGroup:function(e){this.groups[e.groupId]=e},getGroup:function(e){return this.groups[e]||null},getGroups:function(){return i.values(this.groups)},storeRoom:function(e){this.rooms[e.roomId]=e,e.currentState.on("RoomState.members",this._onRoomMember.bind(this));const t=this;e.currentState.getMembers().forEach((function(n){t._onRoomMember(null,e.currentState,n)}))},_onRoomMember:function(e,t,n){if("invite"===n.membership)return;const r=this.users[n.userId]||new o.User(n.userId);n.name&&(r.setDisplayName(n.name),n.events.member&&r.setRawDisplayName(n.events.member.getDirectionalContent().displayname)),n.events.member&&n.events.member.getContent().avatar_url&&r.setAvatarUrl(n.events.member.getContent().avatar_url),this.users[r.userId]=r},getRoom:function(e){return this.rooms[e]||null},getRooms:function(){return i.values(this.rooms)},removeRoom:function(e){this.rooms[e]&&this.rooms[e].removeListener("RoomState.members",this._onRoomMember),delete this.rooms[e]},getRoomSummaries:function(){return i.map(i.values(this.rooms),(function(e){return e.summary}))},storeUser:function(e){this.users[e.userId]=e},getUser:function(e){return this.users[e]||null},getUsers:function(){return i.values(this.users)},scrollback:function(e,t){return[]},storeEvents:function(e,t,n,r){},storeFilter:function(e){e&&(this.filters[e.userId]||(this.filters[e.userId]={}),this.filters[e.userId][e.filterId]=e)},getFilter:function(e,t){return this.filters[e]&&this.filters[e][t]?this.filters[e][t]:null},getFilterIdByName:function(e){if(!this.localStorage)return null;try{return this.localStorage.getItem("mxjssdk_memory_filter_"+e)}catch(e){}return null},setFilterIdByName:function(e,t){if(this.localStorage)try{this.localStorage.setItem("mxjssdk_memory_filter_"+e,t)}catch(e){}},storeAccountDataEvents:function(e){const t=this;e.forEach((function(e){t.accountData[e.getType()]=e}))},getAccountData:function(e){return this.accountData[e]},setSyncData:function(e){return Promise.resolve()},wantsSave:function(){return!1},save:function(e){},startup:function(){return Promise.resolve()},getSavedSync:function(){return Promise.resolve(null)},getSavedSyncToken:function(){return Promise.resolve(null)},deleteAllData:function(){return this.rooms={},this.users={},this.syncToken=null,this.filters={},this.accountData={},Promise.resolve()},getOutOfBandMembers:function(e){return Promise.resolve(this._oobMembers[e]||null)},setOutOfBandMembers:function(e,t){return this._oobMembers[e]=t,Promise.resolve()},clearOutOfBandMembers:function(){return this._oobMembers={},Promise.resolve()},getClientOptions:function(){return Promise.resolve(this._clientOptions)},storeClientOptions:function(e){return this._clientOptions=Object.assign({},e),Promise.resolve()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SERVICE_TYPES=void 0;const r=Object.freeze({IS:"SERVICE_TYPE_IS",IM:"SERVICE_TYPE_IM"});t.SERVICE_TYPES=r},function(e,t,n){"use strict";var r=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.Room=m;var o=n(4),i=n(35),s=n(8),a=n(14),c=r(n(2)),u=n(6),l=n(21),d=n(81),h=n(0),f=n(22);const p=["1","2","3","4","5"];function g(e,t,n){const r={content:{},type:"m.receipt",room_id:t.getRoomId()};return r.content[t.getId()]={},r.content[t.getId()][n]={},r.content[t.getId()][n][e]={ts:t.getTs()},new u.MatrixEvent(r)}function m(e,t,n,r){if((r=r||{}).pendingEventOrdering=r.pendingEventOrdering||"chronological",this.reEmitter=new f.ReEmitter(this),-1===["chronological","detached"].indexOf(r.pendingEventOrdering))throw new Error("opts.pendingEventOrdering MUST be either 'chronological' or 'detached'. Got: '"+r.pendingEventOrdering+"'");this.myUserId=n,this.roomId=e,this.name=e,this.tags={},this.accountData={},this.summary=null,this.storageToken=r.storageToken,this._opts=r,this._txnToEvent={},this._receipts={},this._receiptCacheByEventId={},this._realReceipts={},this._notificationCounts={},this._timelineSets=[new i.EventTimelineSet(this,r)],this.reEmitter.reEmit(this.getUnfilteredTimelineSet(),["Room.timeline","Room.timelineReset"]),this._fixUpLegacyTimelineFields(),this._filteredTimelineSets={},"detached"==this._opts.pendingEventOrdering&&(this._pendingEventList=[]),this._blacklistUnverifiedDevices=null,this._selfMembership=null,this._summaryHeroes=null,this._client=t,this._opts.lazyLoadMembers?this._membersPromise=null:this._membersPromise=Promise.resolve()}c.inherits(m,o.EventEmitter),m.prototype.getVersion=function(){const e=this.currentState.getStateEvents("m.room.create","");if(!e)return h.logger.warn("Room "+this.room_id+" does not have an m.room.create event"),"1";const t=e.getContent().room_version;return void 0===t?"1":t},m.prototype.shouldUpgradeToVersion=function(){return p.includes(this.getVersion())?null:"5"},m.prototype.getRecommendedVersion=async function(){let e=(await this._client.getCapabilities())["m.room_versions"];if(!e){e={default:"5",available:{}};for(const t of p)e.available[t]="stable"}let t=this._checkVersionAgainstCapability(e);if(t.urgent&&t.needsUpgrade){if(h.logger.warn("Refreshing room version capability because the server looks to be supporting a newer room version we don't know about."),!(e=(await this._client.getCapabilities(!0))["m.room_versions"]))return h.logger.warn("No room version capability - assuming upgrade required."),t;t=this._checkVersionAgainstCapability(e)}return t},m.prototype._checkVersionAgainstCapability=function(e){const t=this.getVersion();h.logger.log(`[${this.roomId}] Current version: ${t}`),h.logger.log(`[${this.roomId}] Version capability: `,e);const n={version:t,needsUpgrade:!1,urgent:!1};return t===e.default?n:Object.keys(e.available).filter(t=>"stable"===e.available[t]).includes(t)?n:(n.version=e.default,n.needsUpgrade=!0,n.urgent=!!this.getVersion().match(/^[0-9]+[0-9.]*$/g),n.urgent?h.logger.warn(`URGENT upgrade required on ${this.roomId}`):h.logger.warn(`Non-urgent upgrade required on ${this.roomId}`),n)},m.prototype.userMayUpgradeRoom=function(e){return this.currentState.maySendStateEvent("m.room.tombstone",e)},m.prototype.getPendingEvents=function(){if("detached"!==this._opts.pendingEventOrdering)throw new Error("Cannot call getPendingEvents with pendingEventOrdering == "+this._opts.pendingEventOrdering);return this._pendingEventList},m.prototype.hasPendingEvent=function(e){if("detached"!==this._opts.pendingEventOrdering)throw new Error("Cannot call hasPendingEvent with pendingEventOrdering == "+this._opts.pendingEventOrdering);return this._pendingEventList.some(t=>t.getId()===e)},m.prototype.getLiveTimeline=function(){return this.getUnfilteredTimelineSet().getLiveTimeline()},m.prototype.getLastActiveTimestamp=function(){const e=this.getLiveTimeline().getEvents();if(e.length){return e[e.length-1].getTs()}return Number.MIN_SAFE_INTEGER},m.prototype.getMyMembership=function(){return this._selfMembership},m.prototype.getDMInviter=function(){if(this.myUserId){const e=this.getMember(this.myUserId);if(e)return e.getDMInviter()}if("invite"===this._selfMembership){if(2==this.getInvitedAndJoinedMemberCount()&&this._summaryHeroes.length)return this._summaryHeroes[0]}},m.prototype.guessDMUserId=function(){const e=this.getMember(this.myUserId);if(e){const t=e.getDMInviter();if(t)return t}if(Array.isArray(this._summaryHeroes)&&this._summaryHeroes.length)return this._summaryHeroes[0];const t=this.currentState.getMembers().find(e=>e.userId!==this.myUserId);return t?t.userId:this.myUserId},m.prototype.getAvatarFallbackMember=function(){if(this.getInvitedAndJoinedMemberCount()>2)return;const e=Array.isArray(this._summaryHeroes)&&this._summaryHeroes.length;if(e){const e=this._summaryHeroes.map(e=>this.getMember(e)).find(e=>!!e);if(e)return e}const t=this.currentState.getMembers();if(t.length<=2){const e=t.find(e=>e.userId!==this.myUserId);if(e)return e}if(e){const e=this._summaryHeroes.map(e=>this._client.getUser(e)).find(e=>!!e);if(e){const t=new l.RoomMember(this.roomId,e.userId);return t.user=e,t}}},m.prototype.updateMyMembership=function(e){const t=this._selfMembership;this._selfMembership=e,t!==e&&("leave"===e&&this._cleanupAfterLeaving(),this.emit("Room.myMembership",this,e,t))},m.prototype._loadMembersFromServer=async function(){const e=this._client.store.getSyncToken(),t=c.encodeParams({not_membership:"leave",at:e}),n=c.encodeUri("/rooms/$roomId/members?"+t,{$roomId:this.roomId}),r=this._client._http;return(await r.authedRequest(void 0,"GET",n)).chunk},m.prototype._loadMembers=async function(){let e=!1,t=await this._client.store.getOutOfBandMembers(this.roomId);return null===t&&(e=!0,t=await this._loadMembersFromServer(),h.logger.log(`LL: got ${t.length} `+`members from server for room ${this.roomId}`)),{memberEvents:t.map(this._client.getEventMapper()),fromServer:e}},m.prototype.loadMembersIfNeeded=function(){if(this._membersPromise)return this._membersPromise;this.currentState.markOutOfBandMembersStarted();const e=this._loadMembers().then(e=>(this.currentState.setOutOfBandMembers(e.memberEvents),this._client.isCryptoEnabled()&&this._client.isRoomEncrypted(this.roomId)&&this._client._crypto.trackRoomDevices(this.roomId),e.fromServer)).catch(e=>{throw this._membersPromise=null,this.currentState.markOutOfBandMembersFailed(),e});return e.then(e=>{if(e){const e=this.currentState.getMembers().filter(e=>e.isOutOfBand()).map(e=>e.events.member.event);return h.logger.log(`LL: telling store to write ${e.length}`+` members for room ${this.roomId}`),this._client.store.setOutOfBandMembers(this.roomId,e).catch(e=>{h.logger.log("LL: storing OOB room members failed, oh well",e)})}}).catch(e=>{h.logger.error(e)}),this._membersPromise=e,this._membersPromise},m.prototype.clearLoadedMembersIfNeeded=async function(){this._opts.lazyLoadMembers&&this._membersPromise&&(await this.loadMembersIfNeeded(),await this._client.store.clearOutOfBandMembers(this.roomId),this.currentState.clearOutOfBandMembers(),this._membersPromise=null)},m.prototype._cleanupAfterLeaving=function(){this.clearLoadedMembersIfNeeded().catch(e=>{h.logger.error("error after clearing loaded members from "+`room ${this.roomId} after leaving`),h.logger.log(e)})},m.prototype.resetLiveTimeline=function(e,t){for(let n=0;n<this._timelineSets.length;n++)this._timelineSets[n].resetLiveTimeline(e,t);this._fixUpLegacyTimelineFields()},m.prototype._fixUpLegacyTimelineFields=function(){this.timeline=this.getLiveTimeline().getEvents(),this.oldState=this.getLiveTimeline().getState(s.EventTimeline.BACKWARDS),this.currentState=this.getLiveTimeline().getState(s.EventTimeline.FORWARDS)},m.prototype.hasUnverifiedDevices=async function(){if(!this._client.isRoomEncrypted(this.roomId))return!1;const e=await this.getEncryptionTargetMembers();for(const t of e){if((await this._client.getStoredDevicesForUser(t.userId)).some(e=>e.isUnverified()))return!0}return!1},m.prototype.getTimelineSets=function(){return this._timelineSets},m.prototype.getUnfilteredTimelineSet=function(){return this._timelineSets[0]},m.prototype.getTimelineForEvent=function(e){return this.getUnfilteredTimelineSet().getTimelineForEvent(e)},m.prototype.addTimeline=function(){return this.getUnfilteredTimelineSet().addTimeline()},m.prototype.findEventById=function(e){return this.getUnfilteredTimelineSet().findEventById(e)},m.prototype.getUnreadNotificationCount=function(e){return e=e||"total",this._notificationCounts[e]},m.prototype.setUnreadNotificationCount=function(e,t){this._notificationCounts[e]=t},m.prototype.setSummary=function(e){const t=e["m.heroes"],n=e["m.joined_member_count"],r=e["m.invited_member_count"];Number.isInteger(n)&&this.currentState.setJoinedMemberCount(n),Number.isInteger(r)&&this.currentState.setInvitedMemberCount(r),Array.isArray(t)&&(this._summaryHeroes=t.filter(e=>e!==this.myUserId))},m.prototype.setBlacklistUnverifiedDevices=function(e){this._blacklistUnverifiedDevices=e},m.prototype.getBlacklistUnverifiedDevices=function(){return this._blacklistUnverifiedDevices},m.prototype.getAvatarUrl=function(e,t,n,r,o){const i=this.currentState.getStateEvents("m.room.avatar","");if(void 0===o&&(o=!0),!i&&!o)return null;const s=i?i.getContent().url:null;return s?(0,a.getHttpUriForMxc)(e,s,t,n,r):o?(0,a.getIdenticonUri)(e,this.roomId,t,n):null},m.prototype.getAliases=function(){const e=[],t=this.currentState.getStateEvents("m.room.aliases");if(t)for(let n=0;n<t.length;++n){const r=t[n];if(c.isArray(r.getContent().aliases)){const t=r.getContent().aliases.filter(e=>"string"==typeof e&&("#"===e[0]&&!!e.endsWith(`:${r.getStateKey()}`)));Array.prototype.push.apply(e,t)}}return e},m.prototype.getCanonicalAlias=function(){const e=this.currentState.getStateEvents("m.room.canonical_alias","");return e?e.getContent().alias:null},m.prototype.addEventsToTimeline=function(e,t,n,r){n.getTimelineSet().addEventsToTimeline(e,t,n,r)},m.prototype.getMember=function(e){return this.currentState.getMember(e)},m.prototype.getJoinedMembers=function(){return this.getMembersWithMembership("join")},m.prototype.getJoinedMemberCount=function(){return this.currentState.getJoinedMemberCount()},m.prototype.getInvitedMemberCount=function(){return this.currentState.getInvitedMemberCount()},m.prototype.getInvitedAndJoinedMemberCount=function(){return this.getInvitedMemberCount()+this.getJoinedMemberCount()},m.prototype.getMembersWithMembership=function(e){return c.filter(this.currentState.getMembers(),(function(t){return t.membership===e}))},m.prototype.getEncryptionTargetMembers=async function(){await this.loadMembersIfNeeded();let e=this.getMembersWithMembership("join");return this.shouldEncryptForInvitedMembers()&&(e=e.concat(this.getMembersWithMembership("invite"))),e},m.prototype.shouldEncryptForInvitedMembers=function(){const e=this.currentState.getStateEvents("m.room.history_visibility","");return e&&e.getContent()&&"joined"!==e.getContent().history_visibility},m.prototype.getDefaultRoomName=function(e){return v(this,e,!0)},m.prototype.hasMembershipState=function(e,t){const n=this.getMember(e);return!!n&&n.membership===t},m.prototype.getOrCreateFilteredTimelineSet=function(e){if(this._filteredTimelineSets[e.filterId])return this._filteredTimelineSets[e.filterId];const t=Object.assign({filter:e},this._opts),n=new i.EventTimelineSet(this,t);this.reEmitter.reEmit(n,["Room.timeline","Room.timelineReset"]),this._filteredTimelineSets[e.filterId]=n,this._timelineSets.push(n);const r=this.getLiveTimeline();r.getEvents().forEach((function(e){n.addLiveEvent(e)}));let o=r;for(;o.getNeighbouringTimeline(s.EventTimeline.BACKWARDS);)o=o.getNeighbouringTimeline(s.EventTimeline.BACKWARDS);return n.getLiveTimeline().setPaginationToken(o.getPaginationToken(s.EventTimeline.BACKWARDS),s.EventTimeline.BACKWARDS),n},m.prototype.removeFilteredTimelineSet=function(e){const t=this._filteredTimelineSets[e.filterId];delete this._filteredTimelineSets[e.filterId];const n=this._timelineSets.indexOf(t);n>-1&&this._timelineSets.splice(n,1)},m.prototype._addLiveEvent=function(e,t){if(e.isRedaction()){const t=e.event.redacts,n=this.getUnfilteredTimelineSet().findEventById(t);if(n){if(n.makeRedacted(e),n.getStateKey()){this.currentState.getStateEvents(n.getType(),n.getStateKey()).getId()===n.getId()&&this.currentState.setStateEvents([n])}this.emit("Room.redaction",e,this)}}if(e.getUnsigned().transaction_id){const t=this._txnToEvent[e.getUnsigned().transaction_id];if(t)return void this._handleRemoteEcho(e,t)}for(let n=0;n<this._timelineSets.length;n++)this._timelineSets[n].addLiveEvent(e,t);e.sender&&"m.room.redaction"!==e.getType()&&this.addReceipt(g(e.sender.userId,e,"m.read"),!0)},m.prototype.addPendingEvent=function(e,t){if(e.status!==u.EventStatus.SENDING)throw new Error("addPendingEvent called on an event with status "+e.status);if(this._txnToEvent[t])throw new Error("addPendingEvent called on an event with known txnId "+t);if(s.EventTimeline.setEventMetadata(e,this.getLiveTimeline().getState(s.EventTimeline.FORWARDS),!1),this._txnToEvent[t]=e,"detached"==this._opts.pendingEventOrdering){if(this._pendingEventList.some(e=>e.status===u.EventStatus.NOT_SENT)&&(h.logger.warn("Setting event as NOT_SENT due to messages in the same state"),e.setStatus(u.EventStatus.NOT_SENT)),this._pendingEventList.push(e),e.isRelation()&&this._aggregateNonLiveRelation(e),e.isRedaction()){const t=e.event.redacts;let n=this._pendingEventList&&this._pendingEventList.find(e=>e.getId()===t);n||(n=this.getUnfilteredTimelineSet().findEventById(t)),n&&(n.markLocallyRedacted(e),this.emit("Room.redaction",e,this))}}else for(let t=0;t<this._timelineSets.length;t++){const n=this._timelineSets[t];n.getFilter()?n.getFilter().filterRoomTimeline([e]).length&&n.addEventToTimeline(e,n.getLiveTimeline(),!1):n.addEventToTimeline(e,n.getLiveTimeline(),!1)}this.emit("Room.localEchoUpdated",e,this,null,null)},m.prototype._aggregateNonLiveRelation=function(e){for(let t=0;t<this._timelineSets.length;t++){const n=this._timelineSets[t];n.getFilter()?n.getFilter().filterRoomTimeline([e]).length&&n.aggregateRelations(e):n.aggregateRelations(e)}},m.prototype._handleRemoteEcho=function(e,t){const n=t.getId(),r=e.getId(),o=t.status;delete this._txnToEvent[e.getUnsigned().transaction_id],this._pendingEventList&&c.removeElement(this._pendingEventList,(function(e){return e.getId()==n}),!1),t.handleRemoteEcho(e.event);for(let e=0;e<this._timelineSets.length;e++){this._timelineSets[e].handleRemoteEcho(t,n,r)}this.emit("Room.localEchoUpdated",t,this,n,o)};const y={};function v(e,t,n){if(!n){const t=e.currentState.getStateEvents("m.room.name","");if(t&&t.getContent()&&t.getContent().name)return t.getContent().name}let r=e.getCanonicalAlias();if(!r){const t=e.getAliases();t.length&&(r=t[0])}if(r)return r;const o=e.currentState.getJoinedMemberCount()+e.currentState.getInvitedMemberCount()-1;let i=null;if(e._summaryHeroes)i=e._summaryHeroes.map(t=>{const n=e.getMember(t);return n?n.name:t});else{let n=e.currentState.getMembers().filter(e=>e.userId!==t&&("invite"===e.membership||"join"===e.membership));n.sort((e,t)=>e.userId.localeCompare(t.userId)),i=(n=n.slice(0,5)).map(e=>e.name)}if(o)return _(i,o);if("join"==e.getMyMembership()){const t=e.currentState.getStateEvents("m.room.third_party_invite");if(t&&t.length){return`Inviting ${_(t.map(e=>e.getContent().display_name))}`}}let s=i;return s.length||(s=e.currentState.getMembers().filter(e=>e.userId!==t&&"invite"!==e.membership&&"join"!==e.membership).map(e=>e.name)),s.length?`Empty room (was ${_(s)})`:"Empty room"}function _(e,t=e.length+1){const n=t-1;if(e.length){if(1===e.length&&n<=1)return e[0];if(2===e.length&&n<=2)return`${e[0]} and ${e[1]}`;return n>1?`${e[0]} and ${n} others`:`${e[0]} and 1 other`}return"Empty room"}y[u.EventStatus.ENCRYPTING]=[u.EventStatus.SENDING,u.EventStatus.NOT_SENT],y[u.EventStatus.SENDING]=[u.EventStatus.ENCRYPTING,u.EventStatus.QUEUED,u.EventStatus.NOT_SENT,u.EventStatus.SENT],y[u.EventStatus.QUEUED]=[u.EventStatus.SENDING,u.EventStatus.CANCELLED],y[u.EventStatus.SENT]=[],y[u.EventStatus.NOT_SENT]=[u.EventStatus.SENDING,u.EventStatus.QUEUED,u.EventStatus.CANCELLED],y[u.EventStatus.CANCELLED]=[],m.prototype.updatePendingEvent=function(e,t,n){if(h.logger.log(`setting pendingEvent status to ${t} in ${e.getRoomId()}`),t==u.EventStatus.SENT&&!n)throw new Error("updatePendingEvent called with status=SENT, but no new event id");if(t==u.EventStatus.SENT){if(this.getUnfilteredTimelineSet().eventIdToTimeline(n))return}const r=e.status,o=e.getId();if(!r)throw new Error("updatePendingEventStatus called on an event which is not a local echo.");const i=y[r];if(!i||i.indexOf(t)<0)throw new Error("Invalid EventStatus transition "+r+"->"+t);if(e.setStatus(t),t==u.EventStatus.SENT){e.replaceLocalEventId(n);for(let e=0;e<this._timelineSets.length;e++)this._timelineSets[e].replaceEventId(o,n)}else if(t==u.EventStatus.CANCELLED){if(this._pendingEventList){const e=this._pendingEventList.findIndex(e=>e.getId()===o);if(-1!==e){const[t]=this._pendingEventList.splice(e,1);t.isRedaction()&&this._revertRedactionLocalEcho(t)}}this.removeEvent(o)}this.emit("Room.localEchoUpdated",e,this,o,r)},m.prototype._revertRedactionLocalEcho=function(e){const t=e.event.redacts;if(!t)return;const n=this.getUnfilteredTimelineSet().findEventById(t);n&&(n.unmarkLocallyRedacted(),this.emit("Room.redactionCancelled",e,this),n.isRelation()&&this._aggregateNonLiveRelation(n))},m.prototype.addLiveEvents=function(e,t){let n;if(t&&-1===["replace","ignore"].indexOf(t))throw new Error("duplicateStrategy MUST be either 'replace' or 'ignore'");for(n=0;n<this._timelineSets.length;n++){const e=this._timelineSets[n].getLiveTimeline();if(e.getPaginationToken(s.EventTimeline.FORWARDS))throw new Error("live timeline "+n+" is no longer live - it has a pagination token ("+e.getPaginationToken(s.EventTimeline.FORWARDS)+")");if(e.getNeighbouringTimeline(s.EventTimeline.FORWARDS))throw new Error("live timeline "+n+" is no longer live - it has a neighbouring timeline")}for(n=0;n<e.length;n++)this._addLiveEvent(e[n],t)},m.prototype.addEphemeralEvents=function(e){for(const t of e)"m.typing"===t.getType()?this.currentState.setTypingEvent(t):"m.receipt"===t.getType()&&this.addReceipt(t)},m.prototype.removeEvents=function(e){for(let t=0;t<e.length;++t)this.removeEvent(e[t])},m.prototype.removeEvent=function(e){let t=!1;for(let n=0;n<this._timelineSets.length;n++){const r=this._timelineSets[n].removeEvent(e);r&&(r.isRedaction()&&this._revertRedactionLocalEcho(r),t=!0)}return t},m.prototype.recalculate=function(){const e=this,t=this.currentState.getStateEvents("m.room.member",this.myUserId);if(t&&"invite"===t.getContent().membership){const n=t.event.invite_room_state||[];c.forEach(n,(function(t){e.currentState.getStateEvents(t.type,t.state_key)||e.currentState.setStateEvents([new u.MatrixEvent({type:t.type,state_key:t.state_key,content:t.content,event_id:"$fake"+Date.now(),room_id:e.roomId,user_id:e.myUserId})])}))}const n=this.name;this.name=v(this,this.myUserId),this.summary=new d.RoomSummary(this.roomId,{title:this.name}),n!==this.name&&this.emit("Room.name",this)},m.prototype.getUsersReadUpTo=function(e){return this.getReceiptsForEvent(e).filter((function(e){return"m.read"===e.type})).map((function(e){return e.userId}))},m.prototype.getEventReadUpTo=function(e,t){let n=this._receipts;return t&&(n=this._realReceipts),void 0===n["m.read"]||void 0===n["m.read"][e]?null:n["m.read"][e].eventId},m.prototype.hasUserReadEvent=function(e,t){const n=this.getEventReadUpTo(e,!1);if(n===t)return!0;if(this.timeline.length&&this.timeline[this.timeline.length-1].getSender()&&this.timeline[this.timeline.length-1].getSender()===e)return!0;for(let e=this.timeline.length-1;e>=0;--e){const r=this.timeline[e];if(r.getId()===t)return!1;if(r.getId()===n)return!0}return!1},m.prototype.getReceiptsForEvent=function(e){return this._receiptCacheByEventId[e.getId()]||[]},m.prototype.addReceipt=function(e,t){void 0===t&&(t=!1),t||this._addReceiptsToStructure(e,this._realReceipts),this._addReceiptsToStructure(e,this._receipts),this._receiptCacheByEventId=this._buildReceiptCache(this._receipts),this.emit("Room.receipt",e,this)},m.prototype._addReceiptsToStructure=function(e,t){const n=this;c.keys(e.getContent()).forEach((function(r){c.keys(e.getContent()[r]).forEach((function(o){c.keys(e.getContent()[r][o]).forEach((function(i){const s=e.getContent()[r][o][i];t[o]||(t[o]={});const a=t[o][i];if(a){const e=n.getUnfilteredTimelineSet().compareEventOrdering(a.eventId,r);if(null!==e&&e>=0)return}else t[o][i]={};t[o][i]={eventId:r,data:s}}))}))}))},m.prototype._buildReceiptCache=function(e){const t={};return c.keys(e).forEach((function(n){c.keys(e[n]).forEach((function(r){const o=e[n][r];t[o.eventId]||(t[o.eventId]=[]),t[o.eventId].push({userId:r,type:n,data:o.data})}))})),t},m.prototype._addLocalEchoReceipt=function(e,t,n){this.addReceipt(g(e,t,n),!0)},m.prototype.addTags=function(e){this.tags=e.getContent().tags||{},this.emit("Room.tags",e,this)},m.prototype.addAccountData=function(e){for(let t=0;t<e.length;t++){const n=e[t];"m.tag"===n.getType()&&this.addTags(n),this.accountData[n.getType()]=n,this.emit("Room.accountData",n,this)}},m.prototype.getAccountData=function(e){return this.accountData[e]},m.prototype.maySendMessage=function(){return"join"===this.getMyMembership()&&this.currentState.maySendEvent("m.room.message",this.myUserId)}},function(e,t,n){"use strict";var r=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.EventTimelineSet=d;var o=n(4),i=n(8),s=n(6),a=r(n(2)),c=n(0),u=n(79);let l;function d(e,t){this.room=e,this._timelineSupport=Boolean(t.timelineSupport),this._liveTimeline=new i.EventTimeline(this),this._unstableClientRelationAggregation=!!t.unstableClientRelationAggregation,this._timelines=[this._liveTimeline],this._eventIdToTimeline={},this._filter=t.filter||null,this._unstableClientRelationAggregation&&(this._relations={})}l=c.logger.log.bind(c.logger),a.inherits(d,o.EventEmitter),d.prototype.getTimelines=function(){return this._timelines},d.prototype.getFilter=function(){return this._filter},d.prototype.setFilter=function(e){this._filter=e},d.prototype.getPendingEvents=function(){return this.room?this._filter?this._filter.filterRoomTimeline(this.room.getPendingEvents()):this.room.getPendingEvents():[]},d.prototype.getLiveTimeline=function(){return this._liveTimeline},d.prototype.eventIdToTimeline=function(e){return this._eventIdToTimeline[e]},d.prototype.replaceEventId=function(e,t){const n=this._eventIdToTimeline[e];n&&(delete this._eventIdToTimeline[e],this._eventIdToTimeline[t]=n)},d.prototype.resetLiveTimeline=function(e,t){const n=!this._timelineSupport||!t,r=this._liveTimeline,o=n?r.forkLive(i.EventTimeline.FORWARDS):r.fork(i.EventTimeline.FORWARDS);n?(this._timelines=[o],this._eventIdToTimeline={}):this._timelines.push(o),t&&r.setPaginationToken(t,i.EventTimeline.FORWARDS),o.setPaginationToken(e,i.EventTimeline.BACKWARDS),this._liveTimeline=o,this.emit("Room.timelineReset",this.room,this,n)},d.prototype.getTimelineForEvent=function(e){const t=this._eventIdToTimeline[e];return void 0===t?null:t},d.prototype.findEventById=function(e){const t=this.getTimelineForEvent(e);if(t)return a.findElement(t.getEvents(),(function(t){return t.getId()==e}))},d.prototype.addTimeline=function(){if(!this._timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");const e=new i.EventTimeline(this);return this._timelines.push(e),e},d.prototype.addEventsToTimeline=function(e,t,n,r){if(!n)throw new Error("'timeline' not specified for EventTimelineSet.addEventsToTimeline");if(!t&&n==this._liveTimeline)throw new Error("EventTimelineSet.addEventsToTimeline cannot be used for adding events to the live timeline - use Room.addLiveEvents instead");if(this._filter&&!(e=this._filter.filterRoomTimeline(e)).length)return;const o=t?i.EventTimeline.BACKWARDS:i.EventTimeline.FORWARDS,s=t?i.EventTimeline.FORWARDS:i.EventTimeline.BACKWARDS;let a=!1,u=!1;for(let r=0;r<e.length;r++){const d=e[r],h=d.getId(),f=this._eventIdToTimeline[h];if(!f){this.addEventToTimeline(d,n,t),u=!0,a=!0;continue}if(u=!1,f==n){l("Event "+h+" already in timeline "+n);continue}const p=n.getNeighbouringTimeline(o);if(p){l(f==p?"Event "+h+" in neighbouring timeline - switching to "+f:"Event "+h+" already in a different timeline "+f),n=f;continue}c.logger.info("Already have timeline for "+h+" - joining timeline "+n+" to "+f);const g=f===this._liveTimeline,m=n===this._liveTimeline,y=o===i.EventTimeline.BACKWARDS&&g,v=o===i.EventTimeline.FORWARDS&&m;y||v?(y&&c.logger.warn("Refusing to set a preceding existingTimeLine on our timeline as the existingTimeLine is live ("+f+")"),v&&c.logger.warn("Refusing to set our preceding timeline on a existingTimeLine as our timeline is live ("+n+")")):(n.setNeighbouringTimeline(f,o),f.setNeighbouringTimeline(n,s),n=f,a=!0)}if(u||!a){if(o===i.EventTimeline.FORWARDS&&n===this._liveTimeline)return c.logger.warn({lastEventWasNew:u,didUpdate:a}),void c.logger.warn("Refusing to set forwards pagination token of live timeline "+`${n} to ${r}`);n.setPaginationToken(r,o)}},d.prototype.addLiveEvent=function(e,t){if(this._filter){if(!this._filter.filterRoomTimeline([e]).length)return}const n=this._eventIdToTimeline[e.getId()];if(n)if("replace"===t){l("EventTimelineSet.addLiveEvent: replacing duplicate event "+e.getId());const t=n.getEvents();for(let r=0;r<t.length;r++)if(t[r].getId()===e.getId()){i.EventTimeline.setEventMetadata(e,n.getState(i.EventTimeline.FORWARDS),!1),t[r].encryptedType||(t[r]=e);break}}else l("EventTimelineSet.addLiveEvent: ignoring duplicate event "+e.getId());else this.addEventToTimeline(e,this._liveTimeline,!1)},d.prototype.addEventToTimeline=function(e,t,n){const r=e.getId();t.addEvent(e,n),this._eventIdToTimeline[r]=t,this.setRelationsTarget(e),this.aggregateRelations(e);const o={timeline:t,liveEvent:!n&&t==this._liveTimeline};this.emit("Room.timeline",e,this.room,Boolean(n),!1,o)},d.prototype.handleRemoteEcho=function(e,t,n){const r=this._eventIdToTimeline[t];r?(delete this._eventIdToTimeline[t],this._eventIdToTimeline[n]=r):this._filter?this._filter.filterRoomTimeline([e]).length&&this.addEventToTimeline(e,this._liveTimeline,!1):this.addEventToTimeline(e,this._liveTimeline,!1)},d.prototype.removeEvent=function(e){const t=this._eventIdToTimeline[e];if(!t)return null;const n=t.removeEvent(e);if(n){delete this._eventIdToTimeline[e];const r={timeline:t};this.emit("Room.timeline",n,this.room,void 0,!0,r)}return n},d.prototype.compareEventOrdering=function(e,t){if(e==t)return 0;const n=this._eventIdToTimeline[e],r=this._eventIdToTimeline[t];if(void 0===n)return null;if(void 0===r)return null;if(n===r){let r,o;const i=n.getEvents();for(let n=0;n<i.length&&(void 0===r||void 0===o);n++){const s=i[n].getId();s==e&&(r=n),s==t&&(o=n)}return r-o}let o=n;for(;o;){if(o===r)return-1;o=o.getNeighbouringTimeline(i.EventTimeline.FORWARDS)}for(o=n;o;){if(o===r)return 1;o=o.getNeighbouringTimeline(i.EventTimeline.BACKWARDS)}return null},d.prototype.getRelationsForEvent=function(e,t,n){if(!this._unstableClientRelationAggregation)throw new Error("Client-side relation aggregation is disabled");if(!e||!t||!n)throw new Error("Invalid arguments for `getRelationsForEvent`");return((this._relations[e]||{})[t]||{})[n]},d.prototype.setRelationsTarget=function(e){if(!this._unstableClientRelationAggregation)return;const t=this._relations[e.getId()];if(!t)return;const n=t["m.replace"];if(!n)return;const r=n["m.room.message"];r&&r.setTargetEvent(e)},d.prototype.aggregateRelations=function(e){if(!this._unstableClientRelationAggregation)return;if(e.isRedacted()||e.status===s.EventStatus.CANCELLED)return;if(e.isBeingDecrypted())return void e.once("Event.decrypted",()=>{this.aggregateRelations(e)});const t=e.getRelation();if(!t)return;const n=t.event_id,r=t.rel_type,o=e.getType();let i=this._relations[n];i||(i=this._relations[n]={});let a=i[r];a||(a=i[r]={});let c,l=a[o],d=!1;l||(l=a[o]=new u.Relations(r,o,this.room),d=!0,(c=this.findEventById(n))&&l.setTargetEvent(c)),l.addEvent(e),d&&c&&c.emit("Event.relationsCreated",r,o)}},function(e,t,n){"use strict";var r=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.RoomState=u;var o=n(4),i=n(21),s=n(0),a=r(n(2));const c=1;function u(e,t){this.roomId=e,this.members={},this.events={},this.paginationToken=null,this._sentinels={},this._updateModifiedTime(),this._displayNameToUserIds={},this._userIdsToDisplayNames={},this._tokenToInvite={},this._joinedMemberCount=null,this._summaryJoinedMemberCount=null,this._invitedMemberCount=null,this._summaryInvitedMemberCount=null,t||(t={status:c}),this._oobMemberFlags=t}function l(e,t,n){const r=e._userIdsToDisplayNames[t];if(delete e._userIdsToDisplayNames[t],r){const n=a.removeHiddenChars(r),o=e._displayNameToUserIds[n];if(o){const r=o.filter(e=>e!==t);e._displayNameToUserIds[n]=r}}e._userIdsToDisplayNames[t]=n;const o=n&&a.removeHiddenChars(n);o&&(e._displayNameToUserIds[o]||(e._displayNameToUserIds[o]=[]),e._displayNameToUserIds[o].push(t))}a.inherits(u,o.EventEmitter),u.prototype.getJoinedMemberCount=function(){return null!==this._summaryJoinedMemberCount?this._summaryJoinedMemberCount:(null===this._joinedMemberCount&&(this._joinedMemberCount=this.getMembers().reduce((e,t)=>"join"===t.membership?e+1:e,0)),this._joinedMemberCount)},u.prototype.setJoinedMemberCount=function(e){this._summaryJoinedMemberCount=e},u.prototype.getInvitedMemberCount=function(){return null!==this._summaryInvitedMemberCount?this._summaryInvitedMemberCount:(null===this._invitedMemberCount&&(this._invitedMemberCount=this.getMembers().reduce((e,t)=>"invite"===t.membership?e+1:e,0)),this._invitedMemberCount)},u.prototype.setInvitedMemberCount=function(e){this._summaryInvitedMemberCount=e},u.prototype.getMembers=function(){return a.values(this.members)},u.prototype.getMembersExcept=function(e){return a.values(this.members).filter(t=>!e.includes(t.userId))},u.prototype.getMember=function(e){return this.members[e]||null},u.prototype.getSentinelMember=function(e){if(!e)return null;let t=this._sentinels[e];if(void 0===t){t=new i.RoomMember(this.roomId,e);const n=this.members[e];n&&t.setMembershipEvent(n.events.member,this),this._sentinels[e]=t}return t},u.prototype.getStateEvents=function(e,t){if(!this.events[e])return void 0===t?[]:null;if(void 0===t)return a.values(this.events[e]);const n=this.events[e][t];return n||null},u.prototype.clone=function(){const e=new u(this.roomId,this._oobMemberFlags),t=this._oobMemberFlags.status;return this._oobMemberFlags.status=c,Object.values(this.events).forEach(t=>{const n=Object.values(t);e.setStateEvents(n)}),this._oobMemberFlags.status=t,null!==this._summaryInvitedMemberCount&&e.setInvitedMemberCount(this.getInvitedMemberCount()),null!==this._summaryJoinedMemberCount&&e.setJoinedMemberCount(this.getJoinedMemberCount()),3==this._oobMemberFlags.status&&this.getMembers().forEach(t=>{if(t.isOutOfBand()){e.getMember(t.userId).markOutOfBand()}}),e},u.prototype.setUnknownStateEvents=function(e){const t=e.filter(e=>void 0===this.events[e.getType()]||void 0===this.events[e.getType()][e.getStateKey()]);this.setStateEvents(t)},u.prototype.setStateEvents=function(e){const t=this;this._updateModifiedTime(),a.forEach(e,(function(e){e.getRoomId()===t.roomId&&e.isState()&&(t._setStateEvent(e),"m.room.member"===e.getType()&&(l(t,e.getStateKey(),e.getContent().displayname),function(e,t){if(!t.getContent().third_party_invite)return;const n=(t.getContent().third_party_invite.signed||{}).token;if(!n)return;if(!e.getStateEvents("m.room.third_party_invite",n))return;e._tokenToInvite[n]=t}(t,e)),t.emit("RoomState.events",e,t))})),a.forEach(e,(function(e){if(e.getRoomId()===t.roomId&&e.isState())if("m.room.member"===e.getType()){const n=e.getStateKey();"leave"!==e.getContent().membership&&"ban"!==e.getContent().membership||(e.getContent().avatar_url=e.getContent().avatar_url||e.getPrevContent().avatar_url,e.getContent().displayname=e.getContent().displayname||e.getPrevContent().displayname);const r=t._getOrCreateMember(n,e);r.setMembershipEvent(e,t),t._updateMember(r),t.emit("RoomState.members",e,t,r)}else if("m.room.power_levels"===e.getType()){const n=a.values(t.members);a.forEach(n,(function(n){n.setPowerLevelEvent(e),t.emit("RoomState.members",e,t,n)})),t._sentinels={}}}))},u.prototype._getOrCreateMember=function(e,t){let n=this.members[e];return n||(n=new i.RoomMember(this.roomId,e),this.members[e]=n,this.emit("RoomState.newMember",t,this,n)),n},u.prototype._setStateEvent=function(e){void 0===this.events[e.getType()]&&(this.events[e.getType()]={}),this.events[e.getType()][e.getStateKey()]=e},u.prototype._updateMember=function(e){const t=this.getStateEvents("m.room.power_levels","");t&&e.setPowerLevelEvent(t),delete this._sentinels[e.userId],this.members[e.userId]=e,this._joinedMemberCount=null,this._invitedMemberCount=null},u.prototype.needsOutOfBandMembers=function(){return this._oobMemberFlags.status===c},u.prototype.markOutOfBandMembersStarted=function(){this._oobMemberFlags.status===c&&(this._oobMemberFlags.status=2)},u.prototype.markOutOfBandMembersFailed=function(){2===this._oobMemberFlags.status&&(this._oobMemberFlags.status=c)},u.prototype.clearOutOfBandMembers=function(){let e=0;Object.keys(this.members).forEach(t=>{this.members[t].isOutOfBand()&&(++e,delete this.members[t])}),s.logger.log(`LL: RoomState removed ${e} members...`),this._oobMemberFlags.status=c},u.prototype.setOutOfBandMembers=function(e){s.logger.log(`LL: RoomState about to set ${e.length} OOB members ...`),2===this._oobMemberFlags.status&&(s.logger.log("LL: RoomState put in OOB_STATUS_FINISHED state ..."),this._oobMemberFlags.status=3,e.forEach(e=>this._setOutOfBandMember(e)))},u.prototype._setOutOfBandMember=function(e){if("m.room.member"!==e.getType())return;const t=e.getStateKey(),n=this.getMember(t);if(n&&!n.isOutOfBand())return;const r=this._getOrCreateMember(t,e);r.setMembershipEvent(e,this),r.markOutOfBand(),l(this,r.userId,r.name),this._setStateEvent(e),this._updateMember(r),this.emit("RoomState.members",e,this,r)},u.prototype.setTypingEvent=function(e){a.forEach(a.values(this.members),(function(t){t.setTypingEvent(e)}))},u.prototype.getInviteForThreePidToken=function(e){return this._tokenToInvite[e]||null},u.prototype._updateModifiedTime=function(){this._modified=Date.now()},u.prototype.getLastModifiedTime=function(){return this._modified},u.prototype.getUserIdsWithDisplayName=function(e){return this._displayNameToUserIds[a.removeHiddenChars(e)]||[]},u.prototype.maySendRedactionForEvent=function(e,t){const n=this.getMember(t);if(!n||"leave"===n.membership)return!1;if(e.status||e.isRedacted())return!1;const r=this.maySendEvent("m.room.redaction",t);return e.getSender()===t?r:this._hasSufficientPowerLevelFor("redact",n.powerLevel)},u.prototype._hasSufficientPowerLevelFor=function(e,t){const n=this.getStateEvents("m.room.power_levels","");let r={};n&&(r=n.getContent());let o=50;return a.isNumber(r[e])&&(o=r[e]),t>=o},u.prototype.maySendMessage=function(e){return this._maySendEventOfType("m.room.message",e,!1)},u.prototype.maySendEvent=function(e,t){return this._maySendEventOfType(e,t,!1)},u.prototype.mayClientSendStateEvent=function(e,t){return!t.isGuest()&&this.maySendStateEvent(e,t.credentials.userId)},u.prototype.maySendStateEvent=function(e,t){return this._maySendEventOfType(e,t,!0)},u.prototype._maySendEventOfType=function(e,t,n){const r=this.getStateEvents("m.room.power_levels","");let o,i={},s=0,a=0,c=0;if(r){i=(o=r.getContent()).events||{},s=Number.isFinite(o.state_default)?o.state_default:50;const e=o.users&&o.users[t];Number.isFinite(e)?c=e:Number.isFinite(o.users_default)&&(c=o.users_default),Number.isFinite(o.events_default)&&(a=o.events_default)}let u=n?s:a;return Number.isFinite(i[e])&&(u=i[e]),c>=u},u.prototype.mayTriggerNotifOfType=function(e,t){const n=this.getMember(t);if(!n)return!1;const r=this.getStateEvents("m.room.power_levels","");let o=50;return r&&r.getContent()&&r.getContent().notifications&&a.isNumber(r.getContent().notifications[e])&&(o=r.getContent().notifications[e]),n.powerLevel>=o}},function(e,t,n){"use strict";var r=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.Group=s;var o=r(n(2)),i=n(4);function s(e){this.groupId=e,this.name=null,this.avatarUrl=null,this.myMembership=null,this.inviter=null}o.inherits(s,i.EventEmitter),s.prototype.setProfile=function(e,t){this.name===e&&this.avatarUrl===t||(this.name=e||this.groupId,this.avatarUrl=t,this.emit("Group.profile",this))},s.prototype.setMyMembership=function(e){this.myMembership!==e&&(this.myMembership=e,this.emit("Group.myMembership",this))},s.prototype.setInviter=function(e){this.inviter=e}},function(e,t,n){"use strict";(function(e){var r=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixCall=a,t.setAudioOutput=function(e){R=e},t.setAudioInput=function(e){O=e},t.setVideoInput=function(e){C=e},t.createNewMatrixCall=function(t,n,r){const i=e.window,s=e.document;if(!i||!s)return null;const c={};c.isOpenWebRTC=function(){const e=s.getElementById("script");if(!e||!e.length)return!1;for(let t=0;t<e.length;t++)if(e[t].src.indexOf("owr.js")>-1)return!0;return!1};const u=i.navigator.getUserMedia||i.navigator.webkitGetUserMedia||i.navigator.mozGetUserMedia;u&&(c.getUserMedia=function(){return u.apply(i.navigator,arguments)});try{c.RtcPeerConnection=i.RTCPeerConnection||i.webkitRTCPeerConnection||i.mozRTCPeerConnection,c.RtcSessionDescription=i.RTCSessionDescription||i.webkitRTCSessionDescription||i.mozRTCSessionDescription,c.RtcIceCandidate=i.RTCIceCandidate||i.webkitRTCIceCandidate||i.mozRTCIceCandidate,c.vendor=null,i.mozRTCPeerConnection?c.vendor="mozilla":i.webkitRTCPeerConnection?c.vendor="webkit":i.RTCPeerConnection&&(c.vendor="generic")}catch(e){return o.logger.error("Failed to set up WebRTC object: possible browser interference?"),o.logger.error(e),null}if(!(c.RtcIceCandidate&&c.RtcSessionDescription&&c.RtcPeerConnection&&c.getUserMedia))return null;const l=!!r&&r.forceTURN;return new a({webRtc:c,client:t,URL:i.URL,roomId:n,turnServers:t.getTurnServers(),forceTURN:t._forceTURN||l})};var o=n(0),i=n(4),s=r(n(2));function a(e){this.roomId=e.roomId,this.client=e.client,this.webRtc=e.webRtc,this.forceTURN=e.forceTURN,this.URL=e.URL,this.turnServers=e.turnServers||[],0===this.turnServers.length&&this.client.isFallbackICEServerAllowed()&&this.turnServers.push({urls:[a.FALLBACK_ICE_SERVER]}),s.forEach(this.turnServers,(function(e){s.checkObjectHasKeys(e,["urls"])})),this.callId="c"+(new Date).getTime()+Math.random(),this.state="fledgling",this.didConnect=!1,this.candidateSendQueue=[],this.candidateSendTries=0,this.mediaPromises=Object.create(null),this.screenSharingStream=null,this._answerContent=null}a.CALL_TIMEOUT_MS=6e4,a.FALLBACK_ICE_SERVER="stun:turn.matrix.org",a.ERR_LOCAL_OFFER_FAILED="local_offer_failed",a.ERR_NO_USER_MEDIA="no_user_media",a.ERR_UNKNOWN_DEVICES="unknown_devices",a.ERR_SEND_INVITE="send_invite",a.ERR_SEND_ANSWER="send_answer",s.inherits(a,i.EventEmitter),a.prototype.placeVoiceCall=function(){_("placeVoiceCall"),y(this),E(this,k("voice")),this.type="voice"},a.prototype.placeVideoCall=function(e,t){_("placeVideoCall"),y(this),this.localVideoElement=t,this.remoteVideoElement=e,E(this,k("video")),this.type="video",g(this)},a.prototype.placeScreenSharingCall=function(e,t){_("placeScreenSharingCall"),y(this);const n=w(this);if(!n)return;this.localVideoElement=t,this.remoteVideoElement=e;const r=this;this.webRtc.getUserMedia(n,(function(e){r.screenSharingStream=e,_("Got screen stream, requesting audio stream...");const t=k("voice");E(r,t)}),(function(e){r.emit("error",v(a.ERR_NO_USER_MEDIA,"Failed to get screen-sharing stream: "+e))})),this.type="video",g(this)},a.prototype.playElement=function(e,t){o.logger.log("queuing play on "+t+" and element "+e),this.mediaPromises[t]?this.mediaPromises[t]=this.mediaPromises[t].then((function(){return o.logger.log("previous promise completed for "+t),e.play()}),(function(){return o.logger.log("previous promise failed for "+t),e.play()})):this.mediaPromises[t]=e.play()},a.prototype.pauseElement=function(e,t){o.logger.log("queuing pause on "+t+" and element "+e),this.mediaPromises[t]?this.mediaPromises[t]=this.mediaPromises[t].then((function(){return o.logger.log("previous promise completed for "+t),e.pause()}),(function(){return o.logger.log("previous promise failed for "+t),e.pause()})):this.mediaPromises[t]=e.pause()},a.prototype.assignElement=function(e,t,n){o.logger.log("queuing assign on "+n+" element "+e+" for "+t),this.mediaPromises[n]?this.mediaPromises[n]=this.mediaPromises[n].then((function(){o.logger.log("previous promise completed for "+n),e.srcObject=t}),(function(){o.logger.log("previous promise failed for "+n),e.srcObject=t})):e.srcObject=t},a.prototype.getLocalVideoElement=function(){return this.localVideoElement},a.prototype.getRemoteVideoElement=function(){return this.remoteVideoElement},a.prototype.getRemoteAudioElement=function(){return this.remoteAudioElement},a.prototype.setLocalVideoElement=function(e){if(this.localVideoElement=e,e&&this.localAVStream&&"video"===this.type){e.autoplay=!0,this.assignElement(e,this.localAVStream,"localVideo"),e.muted=!0;const t=this;setTimeout((function(){const e=t.getLocalVideoElement();e.play&&t.playElement(e,"localVideo")}),0)}},a.prototype.setRemoteVideoElement=function(e){this.remoteVideoElement=e,g(this)},a.prototype.setRemoteAudioElement=function(e){this.remoteVideoElement.muted=!0,this.remoteAudioElement=e,this.remoteAudioElement.muted=!1,m(this)},a.prototype._initWithInvite=function(e){this.msg=e.getContent(),this.peerConn=S(this);const t=this;this.peerConn&&this.peerConn.setRemoteDescription(new this.webRtc.RtcSessionDescription(this.msg.offer),T(t,t._onSetRemoteDescriptionSuccess),T(t,t._onSetRemoteDescriptionError)),l(this,"ringing"),this.direction="inbound",this.msg.offer&&this.msg.offer.sdp&&this.msg.offer.sdp.indexOf("m=video")>-1?this.type="video":this.type="voice",e.getAge()&&setTimeout((function(){"ringing"==t.state&&(_("Call invite has expired. Hanging up."),t.hangupParty="remote",l(t,"ended"),p(t),"closed"!=t.peerConn.signalingState&&t.peerConn.close(),t.emit("hangup",t))}),this.msg.lifetime-e.getAge())},a.prototype._initWithHangup=function(e){this.msg=e.getContent(),l(this,"ended")},a.prototype.answer=function(){_("Answering call %s of type %s",this.callId,this.type);const e=this;e._answerContent?e._sendAnswer():this.localAVStream||this.waitForLocalAVStream?this.localAVStream?this._maybeGotUserMediaForAnswer(this.localAVStream):this.waitForLocalAVStream&&l(this,"wait_local_media"):(this.webRtc.getUserMedia(k(this.type),T(e,e._maybeGotUserMediaForAnswer),T(e,e._maybeGotUserMediaForAnswer)),l(this,"wait_local_media"))},a.prototype._replacedBy=function(e){_(this.callId+" being replaced by "+e.callId),"wait_local_media"==this.state?(_("Telling new call to wait for local media"),e.waitForLocalAVStream=!0):"create_offer"==this.state?(_("Handing local stream to new call"),e._maybeGotUserMediaForAnswer(this.localAVStream),delete this.localAVStream):"invite_sent"==this.state&&(_("Handing local stream to new call"),e._maybeGotUserMediaForAnswer(this.localAVStream),delete this.localAVStream),e.localVideoElement=this.localVideoElement,e.remoteVideoElement=this.remoteVideoElement,e.remoteAudioElement=this.remoteAudioElement,this.successor=e,this.emit("replaced",e),this.hangup(!0)},a.prototype.hangup=function(e,t){if("ended"==this.state)return;_("Ending call "+this.callId),f(this,"local",e,!t);const n={version:0,call_id:this.callId,reason:e};d(this,"m.call.hangup",n)},a.prototype.setLocalVideoMuted=function(e){this.localAVStream&&c(this.localAVStream.getVideoTracks(),!e)},a.prototype.isLocalVideoMuted=function(){return!!this.localAVStream&&!u(this.localAVStream.getVideoTracks())},a.prototype.setMicrophoneMuted=function(e){this.localAVStream&&c(this.localAVStream.getAudioTracks(),!e)},a.prototype.isMicrophoneMuted=function(){return!!this.localAVStream&&!u(this.localAVStream.getAudioTracks())},a.prototype._maybeGotUserMediaForInvite=function(e){if(this.successor)return void this.successor._maybeGotUserMediaForAnswer(e);if("ended"==this.state)return;_("_maybeGotUserMediaForInvite -> "+this.type);const t=this,n=e,r={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:"video"===t.type}};if(e instanceof MediaStream){const n=this.getLocalVideoElement();n&&"video"==this.type&&(n.autoplay=!0,this.screenSharingStream?(_("Setting screen sharing stream to the local video element"),this.assignElement(n,this.screenSharingStream,"localVideo")):this.assignElement(n,e,"localVideo"),n.muted=!0,setTimeout((function(){const e=t.getLocalVideoElement();e.play&&t.playElement(e,"localVideo")}),0)),this.screenSharingStream&&(this.screenSharingStream.addTrack(e.getAudioTracks()[0]),e=this.screenSharingStream),this.localAVStream=e,c(e.getAudioTracks(),!0),this.peerConn=S(this),this.peerConn.addStream(e)}else{if("PermissionDeniedError"!==n.name)return _("Failed to getUserMedia: "+n.name),void this._getUserMediaFailed(n);_("User denied access to camera/microphone. Or possibly you are using an insecure domain. Receiving only."),this.peerConn=S(this)}this.peerConn.createOffer(T(t,t._gotLocalOffer),T(t,t._getLocalOfferFailed),r),l(t,"create_offer")},a.prototype._sendAnswer=function(e){d(this,"m.call.answer",this._answerContent).then(()=>{l(this,"connecting"),b(this)}).catch(e=>{l(this,"ringing"),this.client.cancelPendingEvent(e.event);let t=a.ERR_SEND_ANSWER,n="Failed to send answer";throw"UnknownDeviceError"==e.name&&(t=a.ERR_UNKNOWN_DEVICES,n="Unknown devices present in the room"),this.emit("error",v(t,n)),e})},a.prototype._maybeGotUserMediaForAnswer=function(e){const t=this;if("ended"==t.state)return;const n=e;if(e instanceof MediaStream){const n=t.getLocalVideoElement();n&&"video"==t.type&&(n.autoplay=!0,this.assignElement(n,e,"localVideo"),n.muted=!0,setTimeout((function(){const e=t.getLocalVideoElement();e.play&&t.playElement(e,"localVideo")}),0)),t.localAVStream=e,c(e.getAudioTracks(),!0),t.peerConn.addStream(e)}else{if("PermissionDeniedError"!==n.name)return _("Failed to getUserMedia: "+n.name),void this._getUserMediaFailed(n);_("User denied access to camera/microphone. Or possibly you are using an insecure domain. Receiving only.")}const r={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:"video"===t.type}};t.peerConn.createAnswer((function(e){_("Created answer: ",e),t.peerConn.setLocalDescription(e,(function(){t._answerContent={version:0,call_id:t.callId,answer:{sdp:t.peerConn.localDescription.sdp,type:t.peerConn.localDescription.type}},t._sendAnswer()}),(function(){_("Error setting local description!")}),r)}),(function(e){_("Failed to create answer: "+e)})),l(t,"create_answer")},a.prototype._gotLocalIceCandidate=function(e){if(e.candidate){if(_("Got local ICE "+e.candidate.sdpMid+" candidate: "+e.candidate.candidate),"ended"==this.state)return;const t={candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex};h(this,t)}},a.prototype._gotRemoteIceCandidate=function(e){"ended"!=this.state&&(_("Got remote ICE "+e.sdpMid+" candidate: "+e.candidate),this.peerConn.addIceCandidate(new this.webRtc.RtcIceCandidate(e),(function(){}),(function(e){})))},a.prototype._receivedAnswer=function(e){if("ended"==this.state)return;this.peerConn.setRemoteDescription(new this.webRtc.RtcSessionDescription(e.answer),T(this,this._onSetRemoteDescriptionSuccess),T(this,this._onSetRemoteDescriptionError)),l(this,"connecting")},a.prototype._gotLocalOffer=function(e){const t=this;_("Created offer: ",e),"ended"!=t.state?t.peerConn.setLocalDescription(e,(function(){const e={version:0,call_id:t.callId,offer:{sdp:t.peerConn.localDescription.sdp,type:t.peerConn.localDescription.type},lifetime:a.CALL_TIMEOUT_MS};d(t,"m.call.invite",e).then(()=>{l(t,"invite_sent"),setTimeout((function(){"invite_sent"==t.state&&t.hangup("invite_timeout")}),a.CALL_TIMEOUT_MS)}).catch(e=>{let n=a.ERR_SEND_INVITE,r="Failed to send invite";throw"UnknownDeviceError"==e.name&&(n=a.ERR_UNKNOWN_DEVICES,r="Unknown devices present in the room"),t.client.cancelPendingEvent(e.event),f(t,"local",n,!1),t.emit("error",v(n,r)),e})}),(function(){_("Error setting local description!")})):_("Ignoring newly created offer on call ID "+t.callId+" because the call has ended")},a.prototype._getLocalOfferFailed=function(e){this.emit("error",v(a.ERR_LOCAL_OFFER_FAILED,"Failed to start audio for call!"))},a.prototype._getUserMediaFailed=function(e){f(this,"local","user_media_failed",!1),this.emit("error",v(a.ERR_NO_USER_MEDIA,"Couldn't start capturing media! Is your microphone set up and does this app have permission?"))},a.prototype._onIceConnectionStateChanged=function(){"ended"!=this.state&&(_("Ice connection state changed to: "+this.peerConn.iceConnectionState),"completed"==this.peerConn.iceConnectionState||"connected"==this.peerConn.iceConnectionState?(l(this,"connected"),this.didConnect=!0):"failed"==this.peerConn.iceConnectionState&&this.hangup("ice_failed"))},a.prototype._onSignallingStateChanged=function(){_("call "+this.callId+": Signalling state changed to: "+this.peerConn.signalingState)},a.prototype._onSetRemoteDescriptionSuccess=function(){_("Set remote description")},a.prototype._onSetRemoteDescriptionError=function(e){_("Failed to set remote description"+e)},a.prototype._onAddStream=function(e){_("Stream id "+e.stream.id+" added");const t=e.stream;t.getVideoTracks().length>0?(this.type="video",this.remoteAVStream=t,this.remoteAStream=t):(this.type="voice",this.remoteAStream=t);const n=this;I(t,(function(e){_("Track id "+e.id+" added"),e.onstarted=T(n,n._onRemoteStreamTrackStarted)})),void 0!==e.stream.oninactive?e.stream.oninactive=T(n,n._onRemoteStreamEnded):e.stream.onended=T(n,n._onRemoteStreamEnded),e.stream.onstarted=T(n,n._onRemoteStreamStarted),"video"===this.type?(g(this),m(this)):m(this)},a.prototype._onRemoteStreamStarted=function(e){l(this,"connected")},a.prototype._onRemoteStreamEnded=function(e){_("Remote stream ended"),this.hangupParty="remote",l(this,"ended"),p(this),"closed"!=this.peerConn.signalingState&&this.peerConn.close(),this.emit("hangup",this)},a.prototype._onRemoteStreamTrackStarted=function(e){l(this,"connected")},a.prototype._onHangupReceived=function(e){_("Hangup received"),f(this,"remote",e.reason,!0)},a.prototype._onAnsweredElsewhere=function(e){_("Answered elsewhere"),f(this,"remote","answered_elsewhere",!0)};const c=function(e,t){for(let n=0;n<e.length;n++)e[n].enabled=t},u=function(e){for(let t=0;t<e.length;t++)if(e[t].enabled)return!0;return!1},l=function(e,t){const n=e.state;e.state=t,e.emit("state",t,n)},d=function(e,t,n){return e.client.sendEvent(e.roomId,t,n)},h=function(e,t){e.candidateSendQueue.push(t),"ringing"!=e.state&&0===e.candidateSendTries&&setTimeout((function(){b(e)}),100)},f=function(e,t,n,r){e.getRemoteVideoElement()&&(e.getRemoteVideoElement().pause&&e.pauseElement(e.getRemoteVideoElement(),"remoteVideo"),e.assignElement(e.getRemoteVideoElement(),null,"remoteVideo")),e.getRemoteAudioElement()&&(e.getRemoteAudioElement().pause&&e.pauseElement(e.getRemoteAudioElement(),"remoteAudio"),e.assignElement(e.getRemoteAudioElement(),null,"remoteAudio")),e.getLocalVideoElement()&&(e.getLocalVideoElement().pause&&e.pauseElement(e.getLocalVideoElement(),"localVideo"),e.assignElement(e.getLocalVideoElement(),null,"localVideo")),e.hangupParty=t,e.hangupReason=n,l(e,"ended"),p(e),e.peerConn&&"closed"!==e.peerConn.signalingState&&e.peerConn.close(),r&&e.emit("hangup",e)},p=function(e){_("stopAllMedia (stream=%s)",e.localAVStream),e.localAVStream&&(I(e.localAVStream,(function(e){e.stop&&e.stop()})),e.localAVStream.stop&&e.localAVStream.stop()),e.screenSharingStream&&(I(e.screenSharingStream,(function(e){e.stop&&e.stop()})),e.screenSharingStream.stop&&e.screenSharingStream.stop()),e.remoteAVStream&&I(e.remoteAVStream,(function(e){e.stop&&e.stop()})),e.remoteAStream&&I(e.remoteAStream,(function(e){e.stop&&e.stop()}))},g=function(e){if(e.getRemoteVideoElement()&&e.remoteAVStream){const t=e.getRemoteVideoElement();t.autoplay=!0,e.assignElement(t,e.remoteAVStream,"remoteVideo"),setTimeout((function(){const t=e.getRemoteVideoElement();t.play&&e.playElement(t,"remoteVideo"),e.webRtc.isOpenWebRTC()&&l(e,"connected")}),0)}},m=async function(e){if(e.getRemoteAudioElement()&&e.remoteAStream){const t=e.getRemoteAudioElement();R&&await t.setSinkId(R),t.autoplay=!0,e.assignElement(t,e.remoteAStream,"remoteAudio"),setTimeout((function(){const t=e.getRemoteAudioElement();t.play&&e.playElement(t,"remoteAudio"),e.webRtc.isOpenWebRTC()&&l(e,"connected")}),0)}},y=function(e){if(0===e.listeners("error").length)throw new Error("You MUST attach an error listener using call.on('error', function() {})")},v=function(e,t){const n=new Error(t);return n.code=e,n},_=function(){o.logger.log(...arguments)},b=function(e){if(0===e.candidateSendQueue.length)return;const t=e.candidateSendQueue;e.candidateSendQueue=[],++e.candidateSendTries;const n={version:0,call_id:e.callId,candidates:t};_("Attempting to send "+t.length+" candidates"),d(e,"m.call.candidates",n).then((function(){e.candidateSendTries=0,b(e)}),(function(n){for(let n=0;n<t.length;n++)e.candidateSendQueue.push(t[n]);if(e.candidateSendTries>5)return _("Failed to send candidates on attempt %s. Giving up for now.",e.candidateSendTries),void(e.candidateSendTries=0);const r=500*Math.pow(2,e.candidateSendTries);++e.candidateSendTries,_("Failed to send candidates. Retrying in "+r+"ms"),setTimeout((function(){b(e)}),r)}))},E=function(e,t){e.client.callList[e.callId]=e,e.webRtc.getUserMedia(t,T(e,e._maybeGotUserMediaForInvite),T(e,e._maybeGotUserMediaForInvite)),l(e,"wait_local_media"),e.direction="outbound",e.config=t},S=function(e){const t=new e.webRtc.RtcPeerConnection({iceTransportPolicy:e.forceTURN?"relay":void 0,iceServers:e.turnServers});return t.oniceconnectionstatechange=T(e,e._onIceConnectionStateChanged),t.onsignalingstatechange=T(e,e._onSignallingStateChanged),t.onicecandidate=T(e,e._gotLocalIceCandidate),t.onaddstream=T(e,e._onAddStream),t},w=function(t){const n=e.screen;if(n)return{video:{mediaSource:"screen",mandatory:{chromeMediaSource:"screen",chromeMediaSourceId:""+Date.now(),maxWidth:n.width,maxHeight:n.height,minFrameRate:1,maxFrameRate:10}}};t.emit("error",v(a.ERR_NO_USER_MEDIA,"Couldn't determine screen sharing constaints."))},k=function(t){const n=!!e.window.navigator.webkitGetUserMedia;switch(t){case"voice":return{audio:{deviceId:O?{ideal:O}:void 0},video:!1};case"video":return{audio:{deviceId:O?{ideal:O}:void 0},video:{deviceId:C?{ideal:C}:void 0,width:n?{exact:640}:{ideal:640},height:n?{exact:360}:{ideal:360}}}}},T=function(e,t){return function(){return t.apply(e,arguments)}},I=function(e,t){!function(e,t){const n=e.getVideoTracks();for(let e=0;e<n.length;e++)t(n[e])}(e,t),function(e,t){const n=e.getAudioTracks();for(let e=0;e<n.length;e++)t(n[e])}(e,t)};let R,O,C}).call(this,n(3))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeHtmlMessage=function(e,t){return{msgtype:"m.text",format:"org.matrix.custom.html",body:e,formatted_body:t}},t.makeHtmlNotice=function(e,t){return{msgtype:"m.notice",format:"org.matrix.custom.html",body:e,formatted_body:t}},t.makeHtmlEmote=function(e,t){return{msgtype:"m.emote",format:"org.matrix.custom.html",body:e,formatted_body:t}},t.makeTextMessage=function(e){return{msgtype:"m.text",body:e}},t.makeNotice=function(e){return{msgtype:"m.notice",body:e}},t.makeEmoteMessage=function(e){return{msgtype:"m.emote",body:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.exists=function(e,t){return new Promise((n,r)=>{let o=!0;const i=e.open(t);i.onupgradeneeded=()=>{o=!1},i.onblocked=()=>r(),i.onsuccess=()=>{i.result.close(),o||e.deleteDatabase(t),n(o)},i.onerror=e=>r(e.target.error)})}},function(e,t,n){"use strict";(function(e){var r=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.OlmDevice=u,t.WITHHELD_MESSAGES=void 0;var o=n(0),i=n(9),s=r(n(42));const a=49152;function c(e){if(void 0===e)throw new Error("payloadString undefined");if(e.length>a)throw new Error("Message too long ("+e.length+" bytes). The maximum for an encrypted message is "+a+" bytes.")}function u(e){this._cryptoStore=e,this._pickleKey="DEFAULT_KEY",this.deviceCurve25519Key=null,this.deviceEd25519Key=null,this._maxOneTimeKeys=null,this._outboundGroupSessionStore={},this._inboundGroupSessionMessageIndexes={},this._sessionsInProgress={}}u.prototype.init=async function(){let t;const n=new e.Olm.Account;try{await async function(e,t,n){await e.doTxn("readwrite",[i.IndexedDBCryptoStore.STORE_ACCOUNT],r=>{e.getAccount(r,o=>{null!==o?n.unpickle(t,o):(n.create(),o=n.pickle(t),e.storeAccount(r,o))})})}(this._cryptoStore,this._pickleKey,n),t=JSON.parse(n.identity_keys()),this._maxOneTimeKeys=n.max_number_of_one_time_keys()}finally{n.free()}this.deviceCurve25519Key=t.curve25519,this.deviceEd25519Key=t.ed25519},u.getOlmVersion=function(){return e.Olm.get_library_version()},u.prototype._getAccount=function(t,n){this._cryptoStore.getAccount(t,t=>{const r=new e.Olm.Account;try{r.unpickle(this._pickleKey,t),n(r)}finally{r.free()}})},u.prototype._storeAccount=function(e,t){this._cryptoStore.storeAccount(e,t.pickle(this._pickleKey))},u.prototype._getSession=function(e,t,n,r){this._cryptoStore.getEndToEndSession(e,t,n,e=>{this._unpickleSession(e,r)})},u.prototype._unpickleSession=function(t,n){const r=new e.Olm.Session;try{r.unpickle(this._pickleKey,t.session),n(Object.assign({},t,{session:r}))}finally{r.free()}},u.prototype._saveSession=function(e,t,n){const r=t.session.session_id(),o=Object.assign(t,{session:t.session.pickle(this._pickleKey)});this._cryptoStore.storeEndToEndSession(e,r,o,n)},u.prototype._getUtility=function(t){const n=new e.Olm.Utility;try{return t(n)}finally{n.free()}},u.prototype.sign=async function(e){let t;return await this._cryptoStore.doTxn("readonly",[i.IndexedDBCryptoStore.STORE_ACCOUNT],n=>{this._getAccount(n,n=>{t=n.sign(e)})}),t},u.prototype.getOneTimeKeys=async function(){let e;return await this._cryptoStore.doTxn("readonly",[i.IndexedDBCryptoStore.STORE_ACCOUNT],t=>{this._getAccount(t,t=>{e=JSON.parse(t.one_time_keys())})}),e},u.prototype.maxNumberOfOneTimeKeys=function(){return this._maxOneTimeKeys},u.prototype.markKeysAsPublished=async function(){await this._cryptoStore.doTxn("readwrite",[i.IndexedDBCryptoStore.STORE_ACCOUNT],e=>{this._getAccount(e,t=>{t.mark_keys_as_published(),this._storeAccount(e,t)})})},u.prototype.generateOneTimeKeys=function(e){return this._cryptoStore.doTxn("readwrite",[i.IndexedDBCryptoStore.STORE_ACCOUNT],t=>{this._getAccount(t,n=>{n.generate_one_time_keys(e),this._storeAccount(t,n)})})},u.prototype.createOutboundSession=async function(t,n){let r;return await this._cryptoStore.doTxn("readwrite",[i.IndexedDBCryptoStore.STORE_ACCOUNT,i.IndexedDBCryptoStore.STORE_SESSIONS],o=>{this._getAccount(o,i=>{const s=new e.Olm.Session;try{s.create_outbound(i,t,n),r=s.session_id(),this._storeAccount(o,i);const e={session:s,lastReceivedMessageTs:Date.now()};this._saveSession(t,e,o)}finally{s.free()}})}),r},u.prototype.createInboundSession=async function(t,n,r){if(0!==n)throw new Error("Need messageType == 0 to create inbound session");let o;return await this._cryptoStore.doTxn("readwrite",[i.IndexedDBCryptoStore.STORE_ACCOUNT,i.IndexedDBCryptoStore.STORE_SESSIONS],i=>{this._getAccount(i,s=>{const a=new e.Olm.Session;try{a.create_inbound_from(s,t,r),s.remove_one_time_keys(a),this._storeAccount(i,s);const e=a.decrypt(n,r),c={session:a,lastReceivedMessageTs:Date.now()};this._saveSession(t,c,i),o={payload:e,session_id:a.session_id()}}finally{a.free()}})}),o},u.prototype.getSessionIdsForDevice=async function(e){if(this._sessionsInProgress[e]){o.logger.log("waiting for olm session to be created");try{await this._sessionsInProgress[e]}catch(e){}}let t;return await this._cryptoStore.doTxn("readonly",[i.IndexedDBCryptoStore.STORE_SESSIONS],n=>{this._cryptoStore.getEndToEndSessions(e,n,e=>{t=Object.keys(e)})}),t},u.prototype.getSessionIdForDevice=async function(e,t){const n=await this.getSessionInfoForDevice(e,t);if(0===n.length)return null;let r=0;for(let e=1;e<n.length;e++){const t=n[e],o=void 0===t.lastReceivedMessageTs?0:t.lastReceivedMessageTs,i=n[r],s=void 0===i.lastReceivedMessageTs?0:i.lastReceivedMessageTs;(o>s||o===s&&t.sessionId<i.sessionId)&&(r=e)}return n[r].sessionId},u.prototype.getSessionInfoForDevice=async function(e,t){if(this._sessionsInProgress[e]&&!t){o.logger.log("waiting for olm session to be created");try{await this._sessionsInProgress[e]}catch(e){}}const n=[];return await this._cryptoStore.doTxn("readonly",[i.IndexedDBCryptoStore.STORE_SESSIONS],t=>{this._cryptoStore.getEndToEndSessions(e,t,e=>{const t=Object.keys(e).sort();for(const r of t)this._unpickleSession(e[r],e=>{n.push({lastReceivedMessageTs:e.lastReceivedMessageTs,hasReceivedMessage:e.session.has_received_message(),sessionId:r})})})}),n},u.prototype.encryptMessage=async function(e,t,n){let r;return c(n),await this._cryptoStore.doTxn("readwrite",[i.IndexedDBCryptoStore.STORE_SESSIONS],i=>{this._getSession(e,t,i,s=>{const a=s.session.describe();o.logger.log("encryptMessage: Olm Session ID "+t+" to "+e+": "+a),r=s.session.encrypt(n),this._saveSession(e,s,i)})}),r},u.prototype.decryptMessage=async function(e,t,n,r){let s;return await this._cryptoStore.doTxn("readwrite",[i.IndexedDBCryptoStore.STORE_SESSIONS],i=>{this._getSession(e,t,i,a=>{const c=a.session.describe();o.logger.log("decryptMessage: Olm Session ID "+t+" from "+e+": "+c),s=a.session.decrypt(n,r),a.lastReceivedMessageTs=Date.now(),this._saveSession(e,a,i)})}),s},u.prototype.matchesSession=async function(e,t,n,r){if(0!==n)return!1;let o;return await this._cryptoStore.doTxn("readonly",[i.IndexedDBCryptoStore.STORE_SESSIONS],n=>{this._getSession(e,t,n,e=>{o=e.session.matches_inbound(r)})}),o},u.prototype.recordSessionProblem=async function(e,t,n){await this._cryptoStore.storeEndToEndSessionProblem(e,t,n)},u.prototype.sessionMayHaveProblems=async function(e,t){return await this._cryptoStore.getEndToEndSessionProblem(e,t)},u.prototype.filterOutNotifiedErrorDevices=async function(e){return await this._cryptoStore.filterOutNotifiedErrorDevices(e)},u.prototype._saveOutboundGroupSession=function(e){const t=e.pickle(this._pickleKey);this._outboundGroupSessionStore[e.session_id()]=t},u.prototype._getOutboundGroupSession=function(t,n){const r=this._outboundGroupSessionStore[t];if(void 0===r)throw new Error("Unknown outbound group session "+t);const o=new e.Olm.OutboundGroupSession;try{return o.unpickle(this._pickleKey,r),n(o)}finally{o.free()}},u.prototype.createOutboundGroupSession=function(){const t=new e.Olm.OutboundGroupSession;try{return t.create(),this._saveOutboundGroupSession(t),t.session_id()}finally{t.free()}},u.prototype.encryptGroupMessage=function(e,t){const n=this;return o.logger.log(`encrypting msg with megolm session ${e}`),c(t),this._getOutboundGroupSession(e,(function(e){const r=e.encrypt(t);return n._saveOutboundGroupSession(e),r}))},u.prototype.getOutboundGroupSessionKey=function(e){return this._getOutboundGroupSession(e,(function(e){return{chain_index:e.message_index(),key:e.session_key()}}))},u.prototype._unpickleInboundGroupSession=function(t,n){const r=new e.Olm.InboundGroupSession;try{return r.unpickle(this._pickleKey,t.session),n(r)}finally{r.free()}},u.prototype._getInboundGroupSession=function(e,t,n,r,o){this._cryptoStore.getEndToEndInboundGroupSession(t,n,r,(t,n)=>{if(null!==t){if(null!==e&&e!==t.room_id)throw new Error("Mismatched room_id for inbound group session (expected "+t.room_id+", was "+e+")");this._unpickleInboundGroupSession(t,e=>{o(e,t,n)})}else o(null,null,n)})},u.prototype.addInboundGroupSession=async function(t,n,r,s,a,c,u){await this._cryptoStore.doTxn("readwrite",[i.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,i.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],i=>{this._getInboundGroupSession(t,n,s,i,(l,d)=>{const h=new e.Olm.InboundGroupSession;try{if(u?h.import_session(a):h.create(a),s!=h.session_id())throw new Error("Mismatched group session ID from senderKey: "+n);if(l&&(o.logger.log("Update for megolm session "+n+"/"+s),l.first_known_index()<=h.first_known_index()))return void o.logger.log(`Keeping existing megolm session ${s}`);const e={room_id:t,session:h.pickle(this._pickleKey),keysClaimed:c,forwardingCurve25519KeyChain:r};this._cryptoStore.storeEndToEndInboundGroupSession(n,s,e,i)}finally{h.free()}})})},u.prototype.addInboundGroupSessionWithheld=async function(e,t,n,r,o){await this._cryptoStore.doTxn("readwrite",[i.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],i=>{this._cryptoStore.storeEndToEndInboundGroupSessionWithheld(t,n,{room_id:e,code:r,reason:o},i)})};const l={"m.unverified":"The sender has disabled encrypting to unverified devices.","m.blacklisted":"The sender has blocked you.","m.unauthorised":"You are not authorised to read the message.","m.no_olm":"Unable to establish a secure channel."};function d(e){return e.code&&e.code in l?l[e.code]:e.reason?e.reason:"decryption key withheld"}t.WITHHELD_MESSAGES=l,u.prototype.decryptGroupMessage=async function(e,t,n,r,o,a){let c,u;if(await this._cryptoStore.doTxn("readwrite",[i.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,i.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],i=>{this._getInboundGroupSession(e,t,n,i,(e,l,h)=>{if(null===e)return h&&(u=new s.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",d(h),{session:t+"|"+n})),void(c=null);let f;try{f=e.decrypt(r)}catch(e){return void(u=e&&"OLM.UNKNOWN_MESSAGE_INDEX"===e.message&&h?new s.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",d(h),{session:t+"|"+n}):e)}let p=f.plaintext;if(void 0===p)p=f;else{const e=t+"|"+n+"|"+f.message_index;if(e in this._inboundGroupSessionMessageIndexes){const t=this._inboundGroupSessionMessageIndexes[e];if(t.id!==o||t.timestamp!==a)return void(u=new Error("Duplicate message index, possible replay attack: "+e))}this._inboundGroupSessionMessageIndexes[e]={id:o,timestamp:a}}l.session=e.pickle(this._pickleKey),this._cryptoStore.storeEndToEndInboundGroupSession(t,n,l,i),c={result:p,keysClaimed:l.keysClaimed||{},senderKey:t,forwardingCurve25519KeyChain:l.forwardingCurve25519KeyChain||[]}})}),u)throw u;return c},u.prototype.hasInboundSessionKeys=async function(e,t,n){let r;return await this._cryptoStore.doTxn("readonly",[i.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,i.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],i=>{this._cryptoStore.getEndToEndInboundGroupSession(t,n,i,i=>{null!==i?e!==i.room_id?(o.logger.warn(`requested keys for inbound group session ${t}|`+`${n}, with incorrect room_id `+`(expected ${i.room_id}, `+`was ${e})`),r=!1):r=!0:r=!1})}),r},u.prototype.getInboundGroupSessionKey=async function(e,t,n,r){let o;return await this._cryptoStore.doTxn("readonly",[i.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,i.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],i=>{this._getInboundGroupSession(e,t,n,i,(e,t)=>{if(null===e)return void(o=null);void 0===r&&(r=e.first_known_index());const n=e.export_session(r),i=(t.keysClaimed||{}).ed25519||null;o={chain_index:r,key:n,forwarding_curve25519_key_chain:t.forwardingCurve25519KeyChain||[],sender_claimed_ed25519_key:i}})}),o},u.prototype.exportInboundGroupSession=function(e,t,n){return this._unpickleInboundGroupSession(n,r=>{const o=r.first_known_index();return{sender_key:e,sender_claimed_keys:n.keysClaimed,room_id:n.room_id,session_id:t,session_key:r.export_session(o),forwarding_curve25519_key_chain:r.forwardingCurve25519KeyChain||[],first_known_index:r.first_known_index()}})},u.prototype.verifySignature=function(e,t,n){this._getUtility((function(r){r.ed25519_verify(e,t,n)}))}}).call(this,n(3))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(92),n(93);var r=n(26);Object.keys(r).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})}))},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.DeviceTrustLevel=t.UserTrustLevel=t.CrossSigningLevel=t.CrossSigningInfo=void 0;var r=n(7),o=n(4),i=n(0);function s(e){return Object.values(e.keys)[0]}class a extends o.EventEmitter{constructor(e,t){super(),Object.defineProperty(this,"userId",{enumerable:!0,value:e}),this._callbacks=t||{},this.keys={},this.firstUse=!0}async getCrossSigningKey(t,n){if(!this._callbacks.getCrossSigningKey)throw new Error("No getCrossSigningKey callback supplied");void 0===n&&(n=this.getId(t));const r=await this._callbacks.getCrossSigningKey(t,n);if(!r)throw new Error("getCrossSigningKey callback for "+t+" returned falsey");const o=new e.Olm.PkSigning,i=o.init_with_seed(r);if(i!==n)throw o.free(),new Error("Key type "+t+" from getCrossSigningKey callback did not match");return[i,o]}static fromStorage(e,t){const n=new a(t);for(const t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}toStorage(){return{keys:this.keys,firstUse:this.firstUse}}async isStoredInSecretStorage(e){let t=!0;for(const n of["master","self_signing","user_signing"])t&=await e.isStored(`m.cross_signing.${n}`,!1);return t}static async storeInSecretStorage(e,t){for(const n of Object.keys(e)){const o=(0,r.encodeBase64)(e[n]);await t.store(`m.cross_signing.${n}`,o)}}static async getFromSecretStorage(e,t){const n=await t.get(`m.cross_signing.${e}`);return(0,r.decodeBase64)(n)}getId(e){if(e=e||"master",!this.keys[e])return null;return s(this.keys[e])}async resetKeys(t){if(!this._callbacks.saveCrossSigningKeys)throw new Error("No saveCrossSigningKeys callback supplied");if(void 0===t||t&c.MASTER||!this.keys.master)t=c.MASTER|c.USER_SIGNING|c.SELF_SIGNING;else if(0===t)return;const n={},o={};let i,s;try{if(t&c.MASTER?(i=new e.Olm.PkSigning,n.master=i.generate_seed(),s=i.init_with_seed(n.master),o.master={user_id:this.userId,usage:["master"],keys:{["ed25519:"+s]:s}}):[s,i]=await this.getCrossSigningKey("master"),t&c.SELF_SIGNING){const t=new e.Olm.PkSigning;try{n.self_signing=t.generate_seed();const e=t.init_with_seed(n.self_signing);o.self_signing={user_id:this.userId,usage:["self_signing"],keys:{["ed25519:"+e]:e}},(0,r.pkSign)(o.self_signing,i,this.userId,s)}finally{t.free()}}if(t&c.USER_SIGNING){const t=new e.Olm.PkSigning;try{n.user_signing=t.generate_seed();const e=t.init_with_seed(n.user_signing);o.user_signing={user_id:this.userId,usage:["user_signing"],keys:{["ed25519:"+e]:e}},(0,r.pkSign)(o.user_signing,i,this.userId,s)}finally{t.free()}}Object.assign(this.keys,o),this._callbacks.saveCrossSigningKeys(n)}finally{i&&i.free()}}setKeys(e){const t={};if(e.master){if(e.master.user_id!==this.userId){const t="Mismatched user ID "+e.master.user_id+" in master key from "+this.userId;throw i.logger.error(t),new Error(t)}this.keys.master?s(e.master)!==this.getId()&&(this.firstUse=!1):this.firstUse=!0,t.master=e.master}else{if(!this.keys.master)throw new Error("Tried to set cross-signing keys without a master key");t.master=this.keys.master}const n=s(t.master);if(e.user_signing){if(e.user_signing.user_id!==this.userId){const t="Mismatched user ID "+e.master.user_id+" in user_signing key from "+this.userId;throw i.logger.error(t),new Error(t)}try{(0,r.pkVerify)(e.user_signing,n,this.userId)}catch(e){throw i.logger.error("invalid signature on user-signing key"),e}}if(e.self_signing){if(e.self_signing.user_id!==this.userId){const t="Mismatched user ID "+e.master.user_id+" in self_signing key from "+this.userId;throw i.logger.error(t),new Error(t)}try{(0,r.pkVerify)(e.self_signing,n,this.userId)}catch(e){throw i.logger.error("invalid signature on self-signing key"),e}}e.master&&(this.keys.master=e.master,this.keys.self_signing=null,this.keys.user_signing=null),e.self_signing&&(this.keys.self_signing=e.self_signing),e.user_signing&&(this.keys.user_signing=e.user_signing)}async signObject(e,t){if(!this.keys[t])throw new Error("Attempted to sign with "+t+" key but no such key present");const[n,o]=await this.getCrossSigningKey(t);try{return(0,r.pkSign)(e,o,this.userId,n),e}finally{o.free()}}async signUser(e){if(this.keys.user_signing)return this.signObject(e.keys.master,"user_signing")}async signDevice(e,t){if(e!==this.userId)throw new Error(`Trying to sign ${e}'s device; can only sign our own device`);if(this.keys.self_signing)return this.signObject({algorithms:t.algorithms,keys:t.keys,device_id:t.deviceId,user_id:e},"self_signing")}checkUserTrust(e){if(this.userId===e.userId&&this.getId()&&this.getId()===e.getId()&&this.getId("self_signing")&&this.getId("self_signing")===e.getId("self_signing"))return new u(!0,this.firstUse);if(!this.keys.user_signing)return new u(!1,e.firstUse);let t;const n=e.keys.master,o=this.getId("user_signing");try{(0,r.pkVerify)(n,o,this.userId),t=!0}catch(e){t=!1}return new u(t,e.firstUse)}checkDeviceTrust(e,t,n){const o=this.checkUserTrust(e),i=e.keys.self_signing;if(!i)return new l(!1,!1,n);const a=function(e,t){return{algorithms:e.algorithms,keys:e.keys,device_id:e.deviceId,user_id:t,signatures:e.signatures}}(t,e.userId);try{return(0,r.pkVerify)(i,e.getId(),e.userId),(0,r.pkVerify)(a,s(i),e.userId),l.fromUserTrustLevel(o,n)}catch(e){return new l(!1,!1,n)}}}t.CrossSigningInfo=a;const c={MASTER:4,USER_SIGNING:2,SELF_SIGNING:1};t.CrossSigningLevel=c;class u{constructor(e,t){this._crossSigningVerified=e,this._tofu=t}isVerified(){return this.isCrossSigningVerified()}isCrossSigningVerified(){return this._crossSigningVerified}isTofu(){return this._tofu}}t.UserTrustLevel=u;class l{constructor(e,t,n){this._crossSigningVerified=e,this._tofu=t,this._localVerified=n}static fromUserTrustLevel(e,t){return new l(e._crossSigningVerified,e._tofu,t)}isVerified(){return this.isCrossSigningVerified()||this.isLocallyVerified()}isCrossSigningVerified(){return this._crossSigningVerified}isLocallyVerified(){return this._localVerified}isTofu(){return this._tofu}}t.DeviceTrustLevel=l}).call(this,n(3))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VerificationBase=void 0;var r=n(6),o=n(4),i=n(0),s=n(15),a=n(10);const c=new Error("Verification timed out");class u extends o.EventEmitter{constructor(e,t,n,r,o,i){super(),this._channel=e,this._baseApis=t,this.userId=n,this.deviceId=r,this.startEvent=o,this.request=i,this.cancelled=!1,this._done=!1,this._promise=null,this._transactionTimeoutTimer=null,this._resetTimer()}_resetTimer(){i.logger.info("Refreshing/starting the verification transaction timeout timer"),null!==this._transactionTimeoutTimer&&clearTimeout(this._transactionTimeoutTimer),this._transactionTimeoutTimer=setTimeout(()=>{this._done||this.cancelled||(i.logger.info("Triggering verification timeout"),this.cancel(c))},6e5)}_endTimer(){null!==this._transactionTimeoutTimer&&(clearTimeout(this._transactionTimeoutTimer),this._transactionTimeoutTimer=null)}_send(e,t){return this._channel.send(e,t)}_waitForEvent(e){return this._done?Promise.reject(new Error("Verification is already done")):(this._expectedEvent=e,new Promise((e,t)=>{this._resolveEvent=e,this._rejectEvent=t}))}handleEvent(e){if(!this._done)if(e.getType()===this._expectedEvent)"m.key.verification.done"!==this._expectedEvent&&(this._expectedEvent=void 0,this._rejectEvent=void 0,this._resetTimer(),this._resolveEvent(e));else if("m.key.verification.cancel"===e.getType()){const e=this._reject;this._reject=void 0,e(new Error("Other side cancelled verification"))}else{const t=new Error("Unexpected message: expecting "+this._expectedEvent+" but got "+e.getType());if(this._expectedEvent=void 0,this._rejectEvent){const e=this._rejectEvent;this._rejectEvent=void 0,e(t)}this.cancel(t)}}done(){this._endTimer(),this._done||(this._channel.needsDoneMessage&&this._send("m.key.verification.done",{}),this._resolve())}cancel(e){if(this._endTimer(),!this._done){if(this.cancelled=!0,this.userId&&this.deviceId)if(e===c){const e=(0,a.newTimeoutError)();this._send(e.getType(),e.getContent())}else if(e instanceof r.MatrixEvent){if(e.getSender()!==this.userId){const t=e.getContent();"m.key.verification.cancel"===e.getType()?(t.code=t.code||"m.unknown",t.reason=t.reason||t.body||"Unknown reason",this._send("m.key.verification.cancel",t)):this._send("m.key.verification.cancel",{code:"m.unknown",reason:t.body||"Unknown reason"})}}else this._send("m.key.verification.cancel",{code:"m.unknown",reason:e.toString()});null!==this._promise?this._reject&&this._reject(e):this._promise=Promise.reject(e),this.emit("cancel",e)}}verify(){return this._promise?this._promise:(this._promise=new Promise((e,t)=>{this._resolve=(...t)=>{this._done=!0,this._endTimer(),e(...t)},this._reject=(...e)=>{this._done=!0,this._endTimer(),t(...e)}}),this._doVerification&&!this._started&&(this._started=!0,this._resetTimer(),Promise.resolve(this._doVerification()).then(this.done.bind(this),this.cancel.bind(this))),this._promise)}async _verifyKeys(e,t,n){const r=[];for(const[o,a]of Object.entries(t)){const t=o.split(":",2)[1],c=await this._baseApis.getStoredDevice(e,t);if(c)await n(o,c,a),r.push(t);else{const c=this._baseApis._crypto._deviceList.getStoredCrossSigningForUser(e);c&&c.getId()===t?(await n(o,s.DeviceInfo.fromStorage({keys:{[o]:t}},t),a),r.push(t)):i.logger.warn(`verification: Could not find device ${t} to verify`)}}if(!r.length)throw new Error("No devices could be verified");for(const t of r)await this._baseApis.setDeviceVerified(e,t)}}t.VerificationBase=u},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.keyFromAuthData=async function(t,n){if(!e.Olm)throw new Error("Olm is not available");if(!t.private_key_salt||!t.private_key_iterations)throw new Error("Salt and/or iterations not found: this backup cannot be restored with a passphrase");return await i(n,t.private_key_salt,t.private_key_iterations)},t.keyFromPassphrase=async function(t){if(!e.Olm)throw new Error("Olm is not available");const n=(0,r.randomString)(32);return{key:await i(t,n,o),salt:n,iterations:o}},t.deriveKey=i;var r=n(16);const o=5e5;async function i(t,n,r){const o=e.crypto.subtle,i=e.TextEncoder;if(!o||!i)throw new Error("Password-based backup is not avaiable on this platform");const s=await o.importKey("raw",(new i).encode(t),{name:"PBKDF2"},!1,["deriveBits"]),a=await o.deriveBits({name:"PBKDF2",salt:(new i).encode(n),iterations:r,hash:"SHA-512"},s,8*e.Olm.PRIVATE_KEY_LENGTH);return new Uint8Array(a)}}).call(this,n(3))},function(e,t,n){"use strict";(function(e,r){var o=n(5);Object.defineProperty(t,"__esModule",{value:!0}),t.encodeRecoveryKey=function(t){const n=new e(s.length+t.length+1);n.set(s,0),n.set(t,s.length);let r=0;for(let e=0;e<n.length-1;++e)r^=n[e];return n[n.length-1]=r,i.default.encode(n).match(/.{1,4}/g).join(" ")},t.decodeRecoveryKey=function(e){const t=i.default.decode(e.replace(/ /g,""));let n=0;for(const e of t)n^=e;if(0!==n)throw new Error("Incorrect parity");for(let e=0;e<s.length;++e)if(t[e]!==s[e])throw new Error("Incorrect prefix");if(t.length!==s.length+r.Olm.PRIVATE_KEY_LENGTH+1)throw new Error("Incorrect length");return t.slice(s.length,s.length+r.Olm.PRIVATE_KEY_LENGTH)};var i=o(n(99));const s=[139,1]}).call(this,n(24).Buffer,n(3))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncAccumulator=void 0;var r=n(0),o=n(2);function i(e,t){null!==t.state_key&&void 0!==t.state_key&&t.type&&(e[t.type]||(e[t.type]=Object.create(null)),e[t.type][t.state_key]=t)}t.SyncAccumulator=class{constructor(e){(e=e||{}).maxTimelineEntries=e.maxTimelineEntries||50,this.opts=e,this.accountData={},this.inviteRooms={},this.joinRooms={},this.nextBatch=null,this.groups={invite:{},join:{},leave:{}}}accumulate(e){this._accumulateRooms(e),this._accumulateGroups(e),this._accumulateAccountData(e),this.nextBatch=e.next_batch}_accumulateAccountData(e){e.account_data&&e.account_data.events&&e.account_data.events.forEach(e=>{this.accountData[e.type]=e})}_accumulateRooms(e){e.rooms&&(e.rooms.invite&&Object.keys(e.rooms.invite).forEach(t=>{this._accumulateRoom(t,"invite",e.rooms.invite[t])}),e.rooms.join&&Object.keys(e.rooms.join).forEach(t=>{this._accumulateRoom(t,"join",e.rooms.join[t])}),e.rooms.leave&&Object.keys(e.rooms.leave).forEach(t=>{this._accumulateRoom(t,"leave",e.rooms.leave[t])}))}_accumulateRoom(e,t,n){switch(t){case"invite":this._accumulateInviteState(e,n);break;case"join":this.inviteRooms[e]&&delete this.inviteRooms[e],this._accumulateJoinState(e,n);break;case"leave":this.inviteRooms[e]?delete this.inviteRooms[e]:delete this.joinRooms[e];break;default:r.logger.error("Unknown cateogory: ",t)}}_accumulateInviteState(e,t){if(!t.invite_state||!t.invite_state.events)return;if(!this.inviteRooms[e])return void(this.inviteRooms[e]={invite_state:t.invite_state});const n=this.inviteRooms[e];t.invite_state.events.forEach(e=>{let t=!1;for(let r=0;r<n.invite_state.events.length;r++){const o=n.invite_state.events[r];o.type===e.type&&o.state_key==e.state_key&&(n.invite_state.events[r]=e,t=!0)}t||n.invite_state.events.push(e)})}_accumulateJoinState(e,t){this.joinRooms[e]||(this.joinRooms[e]={_currentState:Object.create(null),_timeline:[],_accountData:Object.create(null),_unreadNotifications:{},_summary:{},_readReceipts:{}});const n=this.joinRooms[e];if(t.account_data&&t.account_data.events&&t.account_data.events.forEach(e=>{n._accountData[e.type]=e}),t.unread_notifications&&(n._unreadNotifications=t.unread_notifications),t.summary){const e="m.heroes",r="m.invited_member_count",o="m.joined_member_count",i=n._summary,s=t.summary;i[e]=s[e]||i[e],i[o]=s[o]||i[o],i[r]=s[r]||i[r]}if(t.ephemeral&&t.ephemeral.events&&t.ephemeral.events.forEach(e=>{"m.receipt"===e.type&&e.content&&Object.keys(e.content).forEach(t=>{e.content[t]["m.read"]&&Object.keys(e.content[t]["m.read"]).forEach(r=>{n._readReceipts[r]={data:e.content[t]["m.read"][r],eventId:t}})})}),t.timeline&&t.timeline.limited&&(n._timeline=[]),t.state&&t.state.events&&t.state.events.forEach(e=>{i(n._currentState,e)}),t.timeline&&t.timeline.events&&t.timeline.events.forEach((e,r)=>{i(n._currentState,e),n._timeline.push({event:e,token:0===r?t.timeline.prev_batch:null})}),n._timeline.length>this.opts.maxTimelineEntries){for(let e=n._timeline.length-this.opts.maxTimelineEntries;e<n._timeline.length;e++)if(n._timeline[e].token){n._timeline=n._timeline.slice(e,n._timeline.length);break}}}_accumulateGroups(e){e.groups&&(e.groups.invite&&Object.keys(e.groups.invite).forEach(t=>{this._accumulateGroup(t,"invite",e.groups.invite[t])}),e.groups.join&&Object.keys(e.groups.join).forEach(t=>{this._accumulateGroup(t,"join",e.groups.join[t])}),e.groups.leave&&Object.keys(e.groups.leave).forEach(t=>{this._accumulateGroup(t,"leave",e.groups.leave[t])}))}_accumulateGroup(e,t,n){for(const t of["invite","join","leave"])delete this.groups[t][e];this.groups[t][e]=n}getJSON(){const e={join:{},invite:{},leave:{}};Object.keys(this.inviteRooms).forEach(t=>{e.invite[t]=this.inviteRooms[t]}),Object.keys(this.joinRooms).forEach(t=>{const n=this.joinRooms[t],r={ephemeral:{events:[]},account_data:{events:[]},state:{events:[]},timeline:{events:[],prev_batch:null},unread_notifications:n._unreadNotifications,summary:n._summary};Object.keys(n._accountData).forEach(e=>{r.account_data.events.push(n._accountData[e])});const s={type:"m.receipt",room_id:t,content:{}};Object.keys(n._readReceipts).forEach(e=>{const t=n._readReceipts[e];s.content[t.eventId]||(s.content[t.eventId]={"m.read":{}}),s.content[t.eventId]["m.read"][e]=t.data}),Object.keys(s.content).length>0&&r.ephemeral.events.push(s),n._timeline.forEach(e=>{if(!r.timeline.prev_batch){if(!e.token)return;r.timeline.prev_batch=e.token}r.timeline.events.push(e.event)});const a=Object.create(null);for(let e=r.timeline.events.length-1;e>=0;e--){const t=r.timeline.events[e];if(null===t.state_key||void 0===t.state_key)continue;const n=(0,o.deepCopy)(t);n.unsigned&&(n.unsigned.prev_content&&(n.content=n.unsigned.prev_content),n.unsigned.prev_sender&&(n.sender=n.unsigned.prev_sender)),i(a,n)}Object.keys(n._currentState).forEach(e=>{Object.keys(n._currentState[e]).forEach(t=>{let o=n._currentState[e][t];a[e]&&a[e][t]&&(o=a[e][t]),r.state.events.push(o)})}),e.join[t]=r});const t=[];return Object.keys(this.accountData).forEach(e=>{t.push(this.accountData[e])}),{nextBatch:this.nextBatch,roomsData:e,groupsData:this.groups,accountData:t}}getNextBatchToken(){return this.nextBatch}}},function(e,t,n){"use strict";var r=String.prototype.replace,o=/%20/g,i=n(28),s={RFC1738:"RFC1738",RFC3986:"RFC3986"};e.exports=i.assign({default:s.RFC3986,formatters:{RFC1738:function(e){return r.call(e,o,"+")},RFC3986:function(e){return String(e)}}},s)},function(e,t){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0,o=n;return[o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]]].join("")}},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",r=e[3];if(!r)return n;if(t&&"function"==typeof btoa){var o=(s=r,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */"),i=r.sources.map((function(e){return"/*# sourceURL="+r.sourceRoot+e+" */"}));return[n].concat(i).concat([o]).join("\n")}var s;return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n})).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},o=0;o<this.length;o++){var i=this[o][0];null!=i&&(r[i]=!0)}for(o=0;o<e.length;o++){var s=e[o];null!=s[0]&&r[s[0]]||(n&&!s[2]?s[2]=n:n&&(s[2]="("+s[2]+") and ("+n+")"),t.push(s))}},t}},function(e,t,n){var r,o,i={},s=(r=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===o&&(o=r.apply(this,arguments)),o}),a=function(e,t){return t?t.querySelector(e):document.querySelector(e)},c=function(e){var t={};return function(e,n){if("function"==typeof e)return e();if(void 0===t[e]){var r=a.call(this,e,n);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}}(),u=null,l=0,d=[],h=n(125);function f(e,t){for(var n=0;n<e.length;n++){var r=e[n],o=i[r.id];if(o){o.refs++;for(var s=0;s<o.parts.length;s++)o.parts[s](r.parts[s]);for(;s<r.parts.length;s++)o.parts.push(_(r.parts[s],t))}else{var a=[];for(s=0;s<r.parts.length;s++)a.push(_(r.parts[s],t));i[r.id]={id:r.id,refs:1,parts:a}}}}function p(e,t){for(var n=[],r={},o=0;o<e.length;o++){var i=e[o],s=t.base?i[0]+t.base:i[0],a={css:i[1],media:i[2],sourceMap:i[3]};r[s]?r[s].parts.push(a):n.push(r[s]={id:s,parts:[a]})}return n}function g(e,t){var n=c(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=d[d.length-1];if("top"===e.insertAt)r?r.nextSibling?n.insertBefore(t,r.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),d.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var o=c(e.insertAt.before,n);n.insertBefore(t,o)}}function m(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=d.indexOf(e);t>=0&&d.splice(t,1)}function y(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var r=function(){0;return n.nc}();r&&(e.attrs.nonce=r)}return v(t,e.attrs),g(e,t),t}function v(e,t){Object.keys(t).forEach((function(n){e.setAttribute(n,t[n])}))}function _(e,t){var n,r,o,i;if(t.transform&&e.css){if(!(i="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=i}if(t.singleton){var s=l++;n=u||(u=y(t)),r=S.bind(null,n,s,!1),o=S.bind(null,n,s,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",v(t,e.attrs),g(e,t),t}(t),r=k.bind(null,n,t),o=function(){m(n),n.href&&URL.revokeObjectURL(n.href)}):(n=y(t),r=w.bind(null,n),o=function(){m(n)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else o()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=s()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=p(e,t);return f(n,t),function(e){for(var r=[],o=0;o<n.length;o++){var s=n[o];(a=i[s.id]).refs--,r.push(a)}e&&f(p(e,t),t);for(o=0;o<r.length;o++){var a;if(0===(a=r[o]).refs){for(var c=0;c<a.parts.length;c++)a.parts[c]();delete i[a.id]}}}};var b,E=(b=[],function(e,t){return b[e]=t,b.filter(Boolean).join("\n")});function S(e,t,n,r){var o=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=E(t,o);else{var i=document.createTextNode(o),s=e.childNodes;s[t]&&e.removeChild(s[t]),s.length?e.insertBefore(i,s[t]):e.appendChild(i)}}function w(e,t){var n=t.css,r=t.media;if(r&&e.setAttribute("media",r),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function k(e,t,n){var r=n.css,o=n.sourceMap,i=void 0===t.convertToAbsoluteUrls&&o;(t.convertToAbsoluteUrls||i)&&(r=h(r)),o&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var s=new Blob([r],{type:"text/css"}),a=e.href;e.href=URL.createObjectURL(s),a&&URL.revokeObjectURL(a)}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=a(n(11)),i=n(54),s=a(n(58));function a(e){return e&&e.__esModule?e:{default:e}}n(126);var c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"render",value:function(){return o.default.createElement("div",null,o.default.createElement("div",{className:"wrapper"},o.default.createElement("div",{className:"flex-container"},o.default.createElement("div",{className:"flex-item desc"},o.default.createElement("h1",null,"OCRCC Chatbox Demo"))),o.default.createElement("div",{className:"flex-container"},o.default.createElement("div",{className:"flex-item"},o.default.createElement(s.default,null)))),o.default.createElement("footer",null,o.default.createElement("small",null,"Created by ",o.default.createElement("a",{href:"https://www.nomadiclabs.ca"},"Nomadic Labs"))))}}]),t}(o.default.Component);(0,i.render)(o.default.createElement(c,null),document.getElementById("root"))},function(e,t,n){"use strict";
/** @license React v16.11.0
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r=n(29),o="function"==typeof Symbol&&Symbol.for,i=o?Symbol.for("react.element"):60103,s=o?Symbol.for("react.portal"):60106,a=o?Symbol.for("react.fragment"):60107,c=o?Symbol.for("react.strict_mode"):60108,u=o?Symbol.for("react.profiler"):60114,l=o?Symbol.for("react.provider"):60109,d=o?Symbol.for("react.context"):60110,h=o?Symbol.for("react.forward_ref"):60112,f=o?Symbol.for("react.suspense"):60113;o&&Symbol.for("react.suspense_list");var p=o?Symbol.for("react.memo"):60115,g=o?Symbol.for("react.lazy"):60116;o&&Symbol.for("react.fundamental"),o&&Symbol.for("react.responder"),o&&Symbol.for("react.scope");var m="function"==typeof Symbol&&Symbol.iterator;function y(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_={};function b(e,t,n){this.props=e,this.context=t,this.refs=_,this.updater=n||v}function E(){}function S(e,t,n){this.props=e,this.context=t,this.refs=_,this.updater=n||v}b.prototype.isReactComponent={},b.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error(y(85));this.updater.enqueueSetState(this,e,t,"setState")},b.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},E.prototype=b.prototype;var w=S.prototype=new E;w.constructor=S,r(w,b.prototype),w.isPureReactComponent=!0;var k={current:null},T={current:null},I=Object.prototype.hasOwnProperty,R={key:!0,ref:!0,__self:!0,__source:!0};function O(e,t,n){var r,o={},s=null,a=null;if(null!=t)for(r in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(s=""+t.key),t)I.call(t,r)&&!R.hasOwnProperty(r)&&(o[r]=t[r]);var c=arguments.length-2;if(1===c)o.children=n;else if(1<c){for(var u=Array(c),l=0;l<c;l++)u[l]=arguments[l+2];o.children=u}if(e&&e.defaultProps)for(r in c=e.defaultProps)void 0===o[r]&&(o[r]=c[r]);return{$$typeof:i,type:e,key:s,ref:a,props:o,_owner:T.current}}function C(e){return"object"==typeof e&&null!==e&&e.$$typeof===i}var P=/\/+/g,D=[];function A(e,t,n,r){if(D.length){var o=D.pop();return o.result=e,o.keyPrefix=t,o.func=n,o.context=r,o.count=0,o}return{result:e,keyPrefix:t,func:n,context:r,count:0}}function x(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>D.length&&D.push(e)}function M(e,t,n){return null==e?0:function e(t,n,r,o){var a=typeof t;"undefined"!==a&&"boolean"!==a||(t=null);var c=!1;if(null===t)c=!0;else switch(a){case"string":case"number":c=!0;break;case"object":switch(t.$$typeof){case i:case s:c=!0}}if(c)return r(o,t,""===n?"."+N(t,0):n),1;if(c=0,n=""===n?".":n+":",Array.isArray(t))for(var u=0;u<t.length;u++){var l=n+N(a=t[u],u);c+=e(a,l,r,o)}else if(null===t||"object"!=typeof t?l=null:l="function"==typeof(l=m&&t[m]||t["@@iterator"])?l:null,"function"==typeof l)for(t=l.call(t),u=0;!(a=t.next()).done;)c+=e(a=a.value,l=n+N(a,u++),r,o);else if("object"===a)throw r=""+t,Error(y(31,"[object Object]"===r?"object with keys {"+Object.keys(t).join(", ")+"}":r,""));return c}(e,"",t,n)}function N(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,(function(e){return t[e]}))}(e.key):t.toString(36)}function U(e,t){e.func.call(e.context,t,e.count++)}function L(e,t,n){var r=e.result,o=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?K(e,r,n,(function(e){return e})):null!=e&&(C(e)&&(e=function(e,t){return{$$typeof:i,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(e,o+(!e.key||t&&t.key===e.key?"":(""+e.key).replace(P,"$&/")+"/")+n)),r.push(e))}function K(e,t,n,r,o){var i="";null!=n&&(i=(""+n).replace(P,"$&/")+"/"),M(e,L,t=A(t,i,r,o)),x(t)}function j(){var e=k.current;if(null===e)throw Error(y(321));return e}var B={Children:{map:function(e,t,n){if(null==e)return e;var r=[];return K(e,r,null,t,n),r},forEach:function(e,t,n){if(null==e)return e;M(e,U,t=A(null,null,t,n)),x(t)},count:function(e){return M(e,(function(){return null}),null)},toArray:function(e){var t=[];return K(e,t,null,(function(e){return e})),t},only:function(e){if(!C(e))throw Error(y(143));return e}},createRef:function(){return{current:null}},Component:b,PureComponent:S,createContext:function(e,t){return void 0===t&&(t=null),(e={$$typeof:d,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:l,_context:e},e.Consumer=e},forwardRef:function(e){return{$$typeof:h,render:e}},lazy:function(e){return{$$typeof:g,_ctor:e,_status:-1,_result:null}},memo:function(e,t){return{$$typeof:p,type:e,compare:void 0===t?null:t}},useCallback:function(e,t){return j().useCallback(e,t)},useContext:function(e,t){return j().useContext(e,t)},useEffect:function(e,t){return j().useEffect(e,t)},useImperativeHandle:function(e,t,n){return j().useImperativeHandle(e,t,n)},useDebugValue:function(){},useLayoutEffect:function(e,t){return j().useLayoutEffect(e,t)},useMemo:function(e,t){return j().useMemo(e,t)},useReducer:function(e,t,n){return j().useReducer(e,t,n)},useRef:function(e){return j().useRef(e)},useState:function(e){return j().useState(e)},Fragment:a,Profiler:u,StrictMode:c,Suspense:f,createElement:O,cloneElement:function(e,t,n){if(null==e)throw Error(y(267,e));var o=r({},e.props),s=e.key,a=e.ref,c=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,c=T.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(l in t)I.call(t,l)&&!R.hasOwnProperty(l)&&(o[l]=void 0===t[l]&&void 0!==u?u[l]:t[l])}var l=arguments.length-2;if(1===l)o.children=n;else if(1<l){u=Array(l);for(var d=0;d<l;d++)u[d]=arguments[d+2];o.children=u}return{$$typeof:i,type:e.type,key:s,ref:a,props:o,_owner:c}},createFactory:function(e){var t=O.bind(null,e);return t.type=e,t},isValidElement:C,version:"16.11.0",__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{ReactCurrentDispatcher:k,ReactCurrentBatchConfig:{suspense:null},ReactCurrentOwner:T,IsSomeRendererActing:{current:!1},assign:r}},F={default:B},q=F&&B||F;e.exports=q.default||q},function(e,t,n){"use strict";!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE){0;try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}}(),e.exports=n(55)},function(e,t,n){"use strict";
/** @license React v16.11.0
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r=n(11),o=n(29),i=n(56);function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!r)throw Error(s(227));var a=null,c={};function u(){if(a)for(var e in c){var t=c[e],n=a.indexOf(e);if(!(-1<n))throw Error(s(96,e));if(!d[n]){if(!t.extractEvents)throw Error(s(97,e));for(var r in d[n]=t,n=t.eventTypes){var o=void 0,i=n[r],u=t,f=r;if(h.hasOwnProperty(f))throw Error(s(99,f));h[f]=i;var p=i.phasedRegistrationNames;if(p){for(o in p)p.hasOwnProperty(o)&&l(p[o],u,f);o=!0}else i.registrationName?(l(i.registrationName,u,f),o=!0):o=!1;if(!o)throw Error(s(98,r,e))}}}}function l(e,t,n){if(f[e])throw Error(s(100,e));f[e]=t,p[e]=t.eventTypes[n].dependencies}var d=[],h={},f={},p={};function g(e,t,n,r,o,i,s,a,c){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(e){this.onError(e)}}var m=!1,y=null,v=!1,_=null,b={onError:function(e){m=!0,y=e}};function E(e,t,n,r,o,i,s,a,c){m=!1,y=null,g.apply(b,arguments)}var S=null,w=null,k=null;function T(e,t,n){var r=e.type||"unknown-event";e.currentTarget=k(n),function(e,t,n,r,o,i,a,c,u){if(E.apply(this,arguments),m){if(!m)throw Error(s(198));var l=y;m=!1,y=null,v||(v=!0,_=l)}}(r,t,void 0,e),e.currentTarget=null}function I(e,t){if(null==t)throw Error(s(30));return null==e?t:Array.isArray(e)?Array.isArray(t)?(e.push.apply(e,t),e):(e.push(t),e):Array.isArray(t)?[e].concat(t):[e,t]}function R(e,t,n){Array.isArray(e)?e.forEach(t,n):e&&t.call(n,e)}var O=null;function C(e){if(e){var t=e._dispatchListeners,n=e._dispatchInstances;if(Array.isArray(t))for(var r=0;r<t.length&&!e.isPropagationStopped();r++)T(e,t[r],n[r]);else t&&T(e,t,n);e._dispatchListeners=null,e._dispatchInstances=null,e.isPersistent()||e.constructor.release(e)}}function P(e){if(null!==e&&(O=I(O,e)),e=O,O=null,e){if(R(e,C),O)throw Error(s(95));if(v)throw e=_,v=!1,_=null,e}}var D={injectEventPluginOrder:function(e){if(a)throw Error(s(101));a=Array.prototype.slice.call(e),u()},injectEventPluginsByName:function(e){var t,n=!1;for(t in e)if(e.hasOwnProperty(t)){var r=e[t];if(!c.hasOwnProperty(t)||c[t]!==r){if(c[t])throw Error(s(102,t));c[t]=r,n=!0}}n&&u()}};function A(e,t){var n=e.stateNode;if(!n)return null;var r=S(n);if(!r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(s(231,t,typeof n));return n}var x=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;x.hasOwnProperty("ReactCurrentDispatcher")||(x.ReactCurrentDispatcher={current:null}),x.hasOwnProperty("ReactCurrentBatchConfig")||(x.ReactCurrentBatchConfig={suspense:null});var M=/^(.*)[\\\/]/,N="function"==typeof Symbol&&Symbol.for,U=N?Symbol.for("react.element"):60103,L=N?Symbol.for("react.portal"):60106,K=N?Symbol.for("react.fragment"):60107,j=N?Symbol.for("react.strict_mode"):60108,B=N?Symbol.for("react.profiler"):60114,F=N?Symbol.for("react.provider"):60109,q=N?Symbol.for("react.context"):60110,$=N?Symbol.for("react.concurrent_mode"):60111,G=N?Symbol.for("react.forward_ref"):60112,V=N?Symbol.for("react.suspense"):60113,W=N?Symbol.for("react.suspense_list"):60120,z=N?Symbol.for("react.memo"):60115,H=N?Symbol.for("react.lazy"):60116;N&&Symbol.for("react.fundamental"),N&&Symbol.for("react.responder"),N&&Symbol.for("react.scope");var Y="function"==typeof Symbol&&Symbol.iterator;function Q(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=Y&&e[Y]||e["@@iterator"])?e:null}function X(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case K:return"Fragment";case L:return"Portal";case B:return"Profiler";case j:return"StrictMode";case V:return"Suspense";case W:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case q:return"Context.Consumer";case F:return"Context.Provider";case G:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case z:return X(e.type);case H:if(e=1===e._status?e._result:null)return X(e)}return null}function J(e){var t="";do{e:switch(e.tag){case 3:case 4:case 6:case 7:case 10:case 9:var n="";break e;default:var r=e._debugOwner,o=e._debugSource,i=X(e.type);n=null,r&&(n=X(r.type)),r=i,i="",o?i=" (at "+o.fileName.replace(M,"")+":"+o.lineNumber+")":n&&(i=" (created by "+n+")"),n="\n    in "+(r||"Unknown")+i}t+=n,e=e.return}while(e);return t}var Z=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),ee=null,te=null,ne=null;function re(e){if(e=w(e)){if("function"!=typeof ee)throw Error(s(280));var t=S(e.stateNode);ee(e.stateNode,e.type,t)}}function oe(e){te?ne?ne.push(e):ne=[e]:te=e}function ie(){if(te){var e=te,t=ne;if(ne=te=null,re(e),t)for(e=0;e<t.length;e++)re(t[e])}}function se(e,t){return e(t)}function ae(e,t,n,r){return e(t,n,r)}function ce(){}var ue=se,le=!1,de=!1;function he(){null===te&&null===ne||(ce(),ie())}new Map;var fe=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,pe=Object.prototype.hasOwnProperty,ge={},me={};function ye(e,t,n,r,o,i){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i}var ve={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){ve[e]=new ye(e,0,!1,e,null,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];ve[t]=new ye(t,1,!1,e[1],null,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){ve[e]=new ye(e,2,!1,e.toLowerCase(),null,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){ve[e]=new ye(e,2,!1,e,null,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){ve[e]=new ye(e,3,!1,e.toLowerCase(),null,!1)})),["checked","multiple","muted","selected"].forEach((function(e){ve[e]=new ye(e,3,!0,e,null,!1)})),["capture","download"].forEach((function(e){ve[e]=new ye(e,4,!1,e,null,!1)})),["cols","rows","size","span"].forEach((function(e){ve[e]=new ye(e,6,!1,e,null,!1)})),["rowSpan","start"].forEach((function(e){ve[e]=new ye(e,5,!1,e.toLowerCase(),null,!1)}));var _e=/[\-:]([a-z])/g;function be(e){return e[1].toUpperCase()}function Ee(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function Se(e,t,n,r){var o=ve.hasOwnProperty(t)?ve[t]:null;(null!==o?0===o.type:!r&&(2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1])))||(function(e,t,n,r){if(null==t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,o,r)&&(n=null),r||null===o?function(e){return!!pe.call(me,e)||!pe.call(ge,e)&&(fe.test(e)?me[e]=!0:(ge[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):o.mustUseProperty?e[o.propertyName]=null===n?3!==o.type&&"":n:(t=o.attributeName,r=o.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(o=o.type)||4===o&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}function we(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function ke(e){e._valueTracker||(e._valueTracker=function(e){var t=we(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var o=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(e){r=""+e,i.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Te(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=we(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function Ie(e,t){var n=t.checked;return o({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Re(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=Ee(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Oe(e,t){null!=(t=t.checked)&&Se(e,"checked",t,!1)}function Ce(e,t){Oe(e,t);var n=Ee(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?De(e,t.type,n):t.hasOwnProperty("defaultValue")&&De(e,t.type,Ee(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Pe(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!e.defaultChecked,e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function De(e,t,n){"number"===t&&e.ownerDocument.activeElement===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}function Ae(e,t){return e=o({children:void 0},t),(t=function(e){var t="";return r.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(t.children))&&(e.children=t),e}function xe(e,t,n,r){if(e=e.options,t){t={};for(var o=0;o<n.length;o++)t["$"+n[o]]=!0;for(n=0;n<e.length;n++)o=t.hasOwnProperty("$"+e[n].value),e[n].selected!==o&&(e[n].selected=o),o&&r&&(e[n].defaultSelected=!0)}else{for(n=""+Ee(n),t=null,o=0;o<e.length;o++){if(e[o].value===n)return e[o].selected=!0,void(r&&(e[o].defaultSelected=!0));null!==t||e[o].disabled||(t=e[o])}null!==t&&(t.selected=!0)}}function Me(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(s(91));return o({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Ne(e,t){var n=t.value;if(null==n){if(n=t.defaultValue,null!=(t=t.children)){if(null!=n)throw Error(s(92));if(Array.isArray(t)){if(!(1>=t.length))throw Error(s(93));t=t[0]}n=t}null==n&&(n="")}e._wrapperState={initialValue:Ee(n)}}function Ue(e,t){var n=Ee(t.value),r=Ee(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function Le(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(_e,be);ve[t]=new ye(t,1,!1,e,null,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(_e,be);ve[t]=new ye(t,1,!1,e,"http://www.w3.org/1999/xlink",!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(_e,be);ve[t]=new ye(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1)})),["tabIndex","crossOrigin"].forEach((function(e){ve[e]=new ye(e,1,!1,e.toLowerCase(),null,!1)})),ve.xlinkHref=new ye("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0),["src","href","action","formAction"].forEach((function(e){ve[e]=new ye(e,1,!1,e.toLowerCase(),null,!0)}));var Ke={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function je(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Be(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?je(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var Fe,qe=function(e){return"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,n,r,o){MSApp.execUnsafeLocalFunction((function(){return e(t,n)}))}:e}((function(e,t){if(e.namespaceURI!==Ke.svg||"innerHTML"in e)e.innerHTML=t;else{for((Fe=Fe||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Fe.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}}));function $e(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}function Ge(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Ve={animationend:Ge("Animation","AnimationEnd"),animationiteration:Ge("Animation","AnimationIteration"),animationstart:Ge("Animation","AnimationStart"),transitionend:Ge("Transition","TransitionEnd")},We={},ze={};function He(e){if(We[e])return We[e];if(!Ve[e])return e;var t,n=Ve[e];for(t in n)if(n.hasOwnProperty(t)&&t in ze)return We[e]=n[t];return e}Z&&(ze=document.createElement("div").style,"AnimationEvent"in window||(delete Ve.animationend.animation,delete Ve.animationiteration.animation,delete Ve.animationstart.animation),"TransitionEvent"in window||delete Ve.transitionend.transition);var Ye=He("animationend"),Qe=He("animationiteration"),Xe=He("animationstart"),Je=He("transitionend"),Ze="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" ");function et(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!=(1026&(t=e).effectTag)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function tt(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function nt(e){if(et(e)!==e)throw Error(s(188))}function rt(e){if(!(e=function(e){var t=e.alternate;if(!t){if(null===(t=et(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,r=t;;){var o=n.return;if(null===o)break;var i=o.alternate;if(null===i){if(null!==(r=o.return)){n=r;continue}break}if(o.child===i.child){for(i=o.child;i;){if(i===n)return nt(o),e;if(i===r)return nt(o),t;i=i.sibling}throw Error(s(188))}if(n.return!==r.return)n=o,r=i;else{for(var a=!1,c=o.child;c;){if(c===n){a=!0,n=o,r=i;break}if(c===r){a=!0,r=o,n=i;break}c=c.sibling}if(!a){for(c=i.child;c;){if(c===n){a=!0,n=i,r=o;break}if(c===r){a=!0,r=i,n=o;break}c=c.sibling}if(!a)throw Error(s(189))}}if(n.alternate!==r)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}var ot,it,st,at=!1,ct=[],ut=null,lt=null,dt=null,ht=new Map,ft=new Map,pt=[],gt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),mt="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" ");function yt(e,t,n,r){return{blockedOn:e,topLevelType:t,eventSystemFlags:32|n,nativeEvent:r}}function vt(e,t){switch(e){case"focus":case"blur":ut=null;break;case"dragenter":case"dragleave":lt=null;break;case"mouseover":case"mouseout":dt=null;break;case"pointerover":case"pointerout":ht.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ft.delete(t.pointerId)}}function _t(e,t,n,r,o){return null===e||e.nativeEvent!==o?(e=yt(t,n,r,o),null!==t&&(null!==(t=fr(t))&&it(t)),e):(e.eventSystemFlags|=r,e)}function bt(e){var t=hr(e.target);if(null!==t){var n=et(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=tt(n)))return e.blockedOn=t,void i.unstable_runWithPriority(e.priority,(function(){st(n)}))}else if(3===t&&n.stateNode.hydrate)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Et(e){if(null!==e.blockedOn)return!1;var t=Dn(e.topLevelType,e.eventSystemFlags,e.nativeEvent);if(null!==t){var n=fr(t);return null!==n&&it(n),e.blockedOn=t,!1}return!0}function St(e,t,n){Et(e)&&n.delete(t)}function wt(){for(at=!1;0<ct.length;){var e=ct[0];if(null!==e.blockedOn){null!==(e=fr(e.blockedOn))&&ot(e);break}var t=Dn(e.topLevelType,e.eventSystemFlags,e.nativeEvent);null!==t?e.blockedOn=t:ct.shift()}null!==ut&&Et(ut)&&(ut=null),null!==lt&&Et(lt)&&(lt=null),null!==dt&&Et(dt)&&(dt=null),ht.forEach(St),ft.forEach(St)}function kt(e,t){e.blockedOn===t&&(e.blockedOn=null,at||(at=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,wt)))}function Tt(e){function t(t){return kt(t,e)}if(0<ct.length){kt(ct[0],e);for(var n=1;n<ct.length;n++){var r=ct[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==ut&&kt(ut,e),null!==lt&&kt(lt,e),null!==dt&&kt(dt,e),ht.forEach(t),ft.forEach(t),n=0;n<pt.length;n++)(r=pt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<pt.length&&null===(n=pt[0]).blockedOn;)bt(n),null===n.blockedOn&&pt.shift()}function It(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}function Rt(e){do{e=e.return}while(e&&5!==e.tag);return e||null}function Ot(e,t,n){(t=A(e,n.dispatchConfig.phasedRegistrationNames[t]))&&(n._dispatchListeners=I(n._dispatchListeners,t),n._dispatchInstances=I(n._dispatchInstances,e))}function Ct(e){if(e&&e.dispatchConfig.phasedRegistrationNames){for(var t=e._targetInst,n=[];t;)n.push(t),t=Rt(t);for(t=n.length;0<t--;)Ot(n[t],"captured",e);for(t=0;t<n.length;t++)Ot(n[t],"bubbled",e)}}function Pt(e,t,n){e&&n&&n.dispatchConfig.registrationName&&(t=A(e,n.dispatchConfig.registrationName))&&(n._dispatchListeners=I(n._dispatchListeners,t),n._dispatchInstances=I(n._dispatchInstances,e))}function Dt(e){e&&e.dispatchConfig.registrationName&&Pt(e._targetInst,null,e)}function At(e){R(e,Ct)}function xt(){return!0}function Mt(){return!1}function Nt(e,t,n,r){for(var o in this.dispatchConfig=e,this._targetInst=t,this.nativeEvent=n,e=this.constructor.Interface)e.hasOwnProperty(o)&&((t=e[o])?this[o]=t(n):"target"===o?this.target=r:this[o]=n[o]);return this.isDefaultPrevented=(null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue)?xt:Mt,this.isPropagationStopped=Mt,this}function Ut(e,t,n,r){if(this.eventPool.length){var o=this.eventPool.pop();return this.call(o,e,t,n,r),o}return new this(e,t,n,r)}function Lt(e){if(!(e instanceof this))throw Error(s(279));e.destructor(),10>this.eventPool.length&&this.eventPool.push(e)}function Kt(e){e.eventPool=[],e.getPooled=Ut,e.release=Lt}o(Nt.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=xt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=xt)},persist:function(){this.isPersistent=xt},isPersistent:Mt,destructor:function(){var e,t=this.constructor.Interface;for(e in t)this[e]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=Mt,this._dispatchInstances=this._dispatchListeners=null}}),Nt.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null},Nt.extend=function(e){function t(){}function n(){return r.apply(this,arguments)}var r=this;t.prototype=r.prototype;var i=new t;return o(i,n.prototype),n.prototype=i,n.prototype.constructor=n,n.Interface=o({},r.Interface,e),n.extend=r.extend,Kt(n),n},Kt(Nt);var jt=Nt.extend({animationName:null,elapsedTime:null,pseudoElement:null}),Bt=Nt.extend({clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Ft=Nt.extend({view:null,detail:null}),qt=Ft.extend({relatedTarget:null});function $t(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}var Gt={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Vt={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Wt={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function zt(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Wt[e])&&!!t[e]}function Ht(){return zt}for(var Yt=Ft.extend({key:function(e){if(e.key){var t=Gt[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=$t(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Vt[e.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:Ht,charCode:function(e){return"keypress"===e.type?$t(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?$t(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Qt=0,Xt=0,Jt=!1,Zt=!1,en=Ft.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:Ht,button:null,buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},movementX:function(e){if("movementX"in e)return e.movementX;var t=Qt;return Qt=e.screenX,Jt?"mousemove"===e.type?e.screenX-t:0:(Jt=!0,0)},movementY:function(e){if("movementY"in e)return e.movementY;var t=Xt;return Xt=e.screenY,Zt?"mousemove"===e.type?e.screenY-t:0:(Zt=!0,0)}}),tn=en.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),nn=en.extend({dataTransfer:null}),rn=Ft.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:Ht}),on=Nt.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),sn=en.extend({deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null}),an=[["blur","blur",0],["cancel","cancel",0],["click","click",0],["close","close",0],["contextmenu","contextMenu",0],["copy","copy",0],["cut","cut",0],["auxclick","auxClick",0],["dblclick","doubleClick",0],["dragend","dragEnd",0],["dragstart","dragStart",0],["drop","drop",0],["focus","focus",0],["input","input",0],["invalid","invalid",0],["keydown","keyDown",0],["keypress","keyPress",0],["keyup","keyUp",0],["mousedown","mouseDown",0],["mouseup","mouseUp",0],["paste","paste",0],["pause","pause",0],["play","play",0],["pointercancel","pointerCancel",0],["pointerdown","pointerDown",0],["pointerup","pointerUp",0],["ratechange","rateChange",0],["reset","reset",0],["seeked","seeked",0],["submit","submit",0],["touchcancel","touchCancel",0],["touchend","touchEnd",0],["touchstart","touchStart",0],["volumechange","volumeChange",0],["drag","drag",1],["dragenter","dragEnter",1],["dragexit","dragExit",1],["dragleave","dragLeave",1],["dragover","dragOver",1],["mousemove","mouseMove",1],["mouseout","mouseOut",1],["mouseover","mouseOver",1],["pointermove","pointerMove",1],["pointerout","pointerOut",1],["pointerover","pointerOver",1],["scroll","scroll",1],["toggle","toggle",1],["touchmove","touchMove",1],["wheel","wheel",1],["abort","abort",2],[Ye,"animationEnd",2],[Qe,"animationIteration",2],[Xe,"animationStart",2],["canplay","canPlay",2],["canplaythrough","canPlayThrough",2],["durationchange","durationChange",2],["emptied","emptied",2],["encrypted","encrypted",2],["ended","ended",2],["error","error",2],["gotpointercapture","gotPointerCapture",2],["load","load",2],["loadeddata","loadedData",2],["loadedmetadata","loadedMetadata",2],["loadstart","loadStart",2],["lostpointercapture","lostPointerCapture",2],["playing","playing",2],["progress","progress",2],["seeking","seeking",2],["stalled","stalled",2],["suspend","suspend",2],["timeupdate","timeUpdate",2],[Je,"transitionEnd",2],["waiting","waiting",2]],cn={},un={},ln=0;ln<an.length;ln++){var dn=an[ln],hn=dn[0],fn=dn[1],pn=dn[2],gn="on"+(fn[0].toUpperCase()+fn.slice(1)),mn={phasedRegistrationNames:{bubbled:gn,captured:gn+"Capture"},dependencies:[hn],eventPriority:pn};cn[fn]=mn,un[hn]=mn}var yn={eventTypes:cn,getEventPriority:function(e){return void 0!==(e=un[e])?e.eventPriority:2},extractEvents:function(e,t,n,r){var o=un[e];if(!o)return null;switch(e){case"keypress":if(0===$t(n))return null;case"keydown":case"keyup":e=Yt;break;case"blur":case"focus":e=qt;break;case"click":if(2===n.button)return null;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":e=en;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":e=nn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":e=rn;break;case Ye:case Qe:case Xe:e=jt;break;case Je:e=on;break;case"scroll":e=Ft;break;case"wheel":e=sn;break;case"copy":case"cut":case"paste":e=Bt;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":e=tn;break;default:e=Nt}return At(t=e.getPooled(o,t,n,r)),t}},vn=i.unstable_UserBlockingPriority,_n=i.unstable_runWithPriority,bn=yn.getEventPriority,En=10,Sn=[];function wn(e){var t=e.targetInst,n=t;do{if(!n){e.ancestors.push(n);break}var r=n;if(3===r.tag)r=r.stateNode.containerInfo;else{for(;r.return;)r=r.return;r=3!==r.tag?null:r.stateNode.containerInfo}if(!r)break;5!==(t=n.tag)&&6!==t||e.ancestors.push(n),n=hr(r)}while(n);for(n=0;n<e.ancestors.length;n++){t=e.ancestors[n];var o=It(e.nativeEvent);r=e.topLevelType;for(var i=e.nativeEvent,s=e.eventSystemFlags,a=null,c=0;c<d.length;c++){var u=d[c];u&&(u=u.extractEvents(r,t,i,o,s))&&(a=I(a,u))}P(a)}}var kn=!0;function Tn(e,t){In(t,e,!1)}function In(e,t,n){switch(bn(t)){case 0:var r=Rn.bind(null,t,1);break;case 1:r=On.bind(null,t,1);break;default:r=Pn.bind(null,t,1)}n?e.addEventListener(t,r,!0):e.addEventListener(t,r,!1)}function Rn(e,t,n){le||ce();var r=Pn,o=le;le=!0;try{ae(r,e,t,n)}finally{(le=o)||he()}}function On(e,t,n){_n(vn,Pn.bind(null,e,t,n))}function Cn(e,t,n,r){if(Sn.length){var o=Sn.pop();o.topLevelType=e,o.eventSystemFlags=t,o.nativeEvent=n,o.targetInst=r,e=o}else e={topLevelType:e,eventSystemFlags:t,nativeEvent:n,targetInst:r,ancestors:[]};try{if(t=wn,n=e,de)t(n,void 0);else{de=!0;try{ue(t,n,void 0)}finally{de=!1,he()}}}finally{e.topLevelType=null,e.nativeEvent=null,e.targetInst=null,e.ancestors.length=0,Sn.length<En&&Sn.push(e)}}function Pn(e,t,n){if(kn)if(0<ct.length&&-1<gt.indexOf(e))e=yt(null,e,t,n),ct.push(e);else{var r=Dn(e,t,n);null===r?vt(e,n):-1<gt.indexOf(e)?(e=yt(r,e,t,n),ct.push(e)):function(e,t,n,r){switch(t){case"focus":return ut=_t(ut,e,t,n,r),!0;case"dragenter":return lt=_t(lt,e,t,n,r),!0;case"mouseover":return dt=_t(dt,e,t,n,r),!0;case"pointerover":var o=r.pointerId;return ht.set(o,_t(ht.get(o)||null,e,t,n,r)),!0;case"gotpointercapture":return o=r.pointerId,ft.set(o,_t(ft.get(o)||null,e,t,n,r)),!0}return!1}(r,e,t,n)||(vt(e,n),Cn(e,t,n,null))}}function Dn(e,t,n){var r=It(n);if(null!==(r=hr(r))){var o=et(r);if(null===o)r=null;else{var i=o.tag;if(13===i){if(null!==(r=tt(o)))return r;r=null}else if(3===i){if(o.stateNode.hydrate)return 3===o.tag?o.stateNode.containerInfo:null;r=null}else o!==r&&(r=null)}}return Cn(e,t,n,r),null}function An(e){if(!Z)return!1;var t=(e="on"+e)in document;return t||((t=document.createElement("div")).setAttribute(e,"return;"),t="function"==typeof t[e]),t}var xn=new("function"==typeof WeakMap?WeakMap:Map);function Mn(e){var t=xn.get(e);return void 0===t&&(t=new Set,xn.set(e,t)),t}function Nn(e,t,n){if(!n.has(e)){switch(e){case"scroll":In(t,"scroll",!0);break;case"focus":case"blur":In(t,"focus",!0),In(t,"blur",!0),n.add("blur"),n.add("focus");break;case"cancel":case"close":An(e)&&In(t,e,!0);break;case"invalid":case"submit":case"reset":break;default:-1===Ze.indexOf(e)&&Tn(e,t)}n.add(e)}}var Un={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ln=["Webkit","ms","Moz","O"];function Kn(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||Un.hasOwnProperty(e)&&Un[e]?(""+t).trim():t+"px"}function jn(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),o=Kn(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,o):e[n]=o}}Object.keys(Un).forEach((function(e){Ln.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Un[t]=Un[e]}))}));var Bn=o({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Fn(e,t){if(t){if(Bn[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(s(137,e,""));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(s(60));if(!("object"==typeof t.dangerouslySetInnerHTML&&"__html"in t.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(s(62,""))}}function qn(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function $n(e,t){var n=Mn(e=9===e.nodeType||11===e.nodeType?e:e.ownerDocument);t=p[t];for(var r=0;r<t.length;r++)Nn(t[r],e,n)}function Gn(){}function Vn(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Wn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function zn(e,t){var n,r=Wn(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=Wn(r)}}function Hn(){for(var e=window,t=Vn();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(e){n=!1}if(!n)break;t=Vn((e=t.contentWindow).document)}return t}function Yn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var Qn="$",Xn="/$",Jn="$?",Zn="$!",er=null,tr=null;function nr(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function rr(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var or="function"==typeof setTimeout?setTimeout:void 0,ir="function"==typeof clearTimeout?clearTimeout:void 0;function sr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function ar(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if(n===Qn||n===Zn||n===Jn){if(0===t)return e;t--}else n===Xn&&t++}e=e.previousSibling}return null}var cr=Math.random().toString(36).slice(2),ur="__reactInternalInstance$"+cr,lr="__reactEventHandlers$"+cr,dr="__reactContainere$"+cr;function hr(e){var t=e[ur];if(t)return t;for(var n=e.parentNode;n;){if(t=n[dr]||n[ur]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ar(e);null!==e;){if(n=e[ur])return n;e=ar(e)}return t}n=(e=n).parentNode}return null}function fr(e){return!(e=e[ur]||e[dr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function pr(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(s(33))}function gr(e){return e[lr]||null}var mr=null,yr=null,vr=null;function _r(){if(vr)return vr;var e,t,n=yr,r=n.length,o="value"in mr?mr.value:mr.textContent,i=o.length;for(e=0;e<r&&n[e]===o[e];e++);var s=r-e;for(t=1;t<=s&&n[r-t]===o[i-t];t++);return vr=o.slice(e,1<t?1-t:void 0)}var br=Nt.extend({data:null}),Er=Nt.extend({data:null}),Sr=[9,13,27,32],wr=Z&&"CompositionEvent"in window,kr=null;Z&&"documentMode"in document&&(kr=document.documentMode);var Tr=Z&&"TextEvent"in window&&!kr,Ir=Z&&(!wr||kr&&8<kr&&11>=kr),Rr=String.fromCharCode(32),Or={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},Cr=!1;function Pr(e,t){switch(e){case"keyup":return-1!==Sr.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"blur":return!0;default:return!1}}function Dr(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Ar=!1;var xr={eventTypes:Or,extractEvents:function(e,t,n,r){var o;if(wr)e:{switch(e){case"compositionstart":var i=Or.compositionStart;break e;case"compositionend":i=Or.compositionEnd;break e;case"compositionupdate":i=Or.compositionUpdate;break e}i=void 0}else Ar?Pr(e,n)&&(i=Or.compositionEnd):"keydown"===e&&229===n.keyCode&&(i=Or.compositionStart);return i?(Ir&&"ko"!==n.locale&&(Ar||i!==Or.compositionStart?i===Or.compositionEnd&&Ar&&(o=_r()):(yr="value"in(mr=r)?mr.value:mr.textContent,Ar=!0)),i=br.getPooled(i,t,n,r),o?i.data=o:null!==(o=Dr(n))&&(i.data=o),At(i),o=i):o=null,(e=Tr?function(e,t){switch(e){case"compositionend":return Dr(t);case"keypress":return 32!==t.which?null:(Cr=!0,Rr);case"textInput":return(e=t.data)===Rr&&Cr?null:e;default:return null}}(e,n):function(e,t){if(Ar)return"compositionend"===e||!wr&&Pr(e,t)?(e=_r(),vr=yr=mr=null,Ar=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Ir&&"ko"!==t.locale?null:t.data;default:return null}}(e,n))?((t=Er.getPooled(Or.beforeInput,t,n,r)).data=e,At(t)):t=null,null===o?t:null===t?o:[o,t]}},Mr={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Nr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Mr[e.type]:"textarea"===t}var Ur={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}};function Lr(e,t,n){return(e=Nt.getPooled(Ur.change,e,t,n)).type="change",oe(n),At(e),e}var Kr=null,jr=null;function Br(e){P(e)}function Fr(e){if(Te(pr(e)))return e}function qr(e,t){if("change"===e)return t}var $r=!1;function Gr(){Kr&&(Kr.detachEvent("onpropertychange",Vr),jr=Kr=null)}function Vr(e){if("value"===e.propertyName&&Fr(jr))if(e=Lr(jr,e,It(e)),le)P(e);else{le=!0;try{se(Br,e)}finally{le=!1,he()}}}function Wr(e,t,n){"focus"===e?(Gr(),jr=n,(Kr=t).attachEvent("onpropertychange",Vr)):"blur"===e&&Gr()}function zr(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Fr(jr)}function Hr(e,t){if("click"===e)return Fr(t)}function Yr(e,t){if("input"===e||"change"===e)return Fr(t)}Z&&($r=An("input")&&(!document.documentMode||9<document.documentMode));var Qr,Xr={eventTypes:Ur,_isInputEventSupported:$r,extractEvents:function(e,t,n,r){var o=t?pr(t):window,i=o.nodeName&&o.nodeName.toLowerCase();if("select"===i||"input"===i&&"file"===o.type)var s=qr;else if(Nr(o))if($r)s=Yr;else{s=zr;var a=Wr}else(i=o.nodeName)&&"input"===i.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(s=Hr);if(s&&(s=s(e,t)))return Lr(s,n,r);a&&a(e,o,t),"blur"===e&&(e=o._wrapperState)&&e.controlled&&"number"===o.type&&De(o,"number",o.value)}},Jr={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout","pointerover"]}},Zr={eventTypes:Jr,extractEvents:function(e,t,n,r,o){var i="mouseover"===e||"pointerover"===e,s="mouseout"===e||"pointerout"===e;if(i&&0==(32&o)&&(n.relatedTarget||n.fromElement)||!s&&!i)return null;if(o=r.window===r?r:(o=r.ownerDocument)?o.defaultView||o.parentWindow:window,s?(s=t,null!==(t=(t=n.relatedTarget||n.toElement)?hr(t):null)&&(t!==(i=et(t))||5!==t.tag&&6!==t.tag)&&(t=null)):s=null,s===t)return null;if("mouseout"===e||"mouseover"===e)var a=en,c=Jr.mouseLeave,u=Jr.mouseEnter,l="mouse";else"pointerout"!==e&&"pointerover"!==e||(a=tn,c=Jr.pointerLeave,u=Jr.pointerEnter,l="pointer");if(e=null==s?o:pr(s),o=null==t?o:pr(t),(c=a.getPooled(c,s,n,r)).type=l+"leave",c.target=e,c.relatedTarget=o,(r=a.getPooled(u,t,n,r)).type=l+"enter",r.target=o,r.relatedTarget=e,l=t,(a=s)&&l)e:{for(e=l,s=0,t=u=a;t;t=Rt(t))s++;for(t=0,o=e;o;o=Rt(o))t++;for(;0<s-t;)u=Rt(u),s--;for(;0<t-s;)e=Rt(e),t--;for(;s--;){if(u===e||u===e.alternate)break e;u=Rt(u),e=Rt(e)}u=null}else u=null;for(e=u,u=[];a&&a!==e&&(null===(s=a.alternate)||s!==e);)u.push(a),a=Rt(a);for(a=[];l&&l!==e&&(null===(s=l.alternate)||s!==e);)a.push(l),l=Rt(l);for(l=0;l<u.length;l++)Pt(u[l],"bubbled",c);for(l=a.length;0<l--;)Pt(a[l],"captured",r);return n===Qr?(Qr=null,[c]):(Qr=n,[c,r])}};var eo="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},to=Object.prototype.hasOwnProperty;function no(e,t){if(eo(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!to.call(t,n[r])||!eo(e[n[r]],t[n[r]]))return!1;return!0}var ro=Z&&"documentMode"in document&&11>=document.documentMode,oo={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},io=null,so=null,ao=null,co=!1;function uo(e,t){var n=t.window===t?t.document:9===t.nodeType?t:t.ownerDocument;return co||null==io||io!==Vn(n)?null:("selectionStart"in(n=io)&&Yn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},ao&&no(ao,n)?null:(ao=n,(e=Nt.getPooled(oo.select,so,e,t)).type="select",e.target=io,At(e),e))}var lo={eventTypes:oo,extractEvents:function(e,t,n,r){var o,i=r.window===r?r.document:9===r.nodeType?r:r.ownerDocument;if(!(o=!i)){e:{i=Mn(i),o=p.onSelect;for(var s=0;s<o.length;s++)if(!i.has(o[s])){i=!1;break e}i=!0}o=!i}if(o)return null;switch(i=t?pr(t):window,e){case"focus":(Nr(i)||"true"===i.contentEditable)&&(io=i,so=t,ao=null);break;case"blur":ao=so=io=null;break;case"mousedown":co=!0;break;case"contextmenu":case"mouseup":case"dragend":return co=!1,uo(n,r);case"selectionchange":if(ro)break;case"keydown":case"keyup":return uo(n,r)}return null}};D.injectEventPluginOrder("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" ")),S=gr,w=fr,k=pr,D.injectEventPluginsByName({SimpleEventPlugin:yn,EnterLeaveEventPlugin:Zr,ChangeEventPlugin:Xr,SelectEventPlugin:lo,BeforeInputEventPlugin:xr}),new Set;var ho=[],fo=-1;function po(e){0>fo||(e.current=ho[fo],ho[fo]=null,fo--)}function go(e,t){ho[++fo]=e.current,e.current=t}var mo={},yo={current:mo},vo={current:!1},_o=mo;function bo(e,t){var n=e.type.contextTypes;if(!n)return mo;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var o,i={};for(o in n)i[o]=t[o];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function Eo(e){return null!=(e=e.childContextTypes)}function So(e){po(vo),po(yo)}function wo(e){po(vo),po(yo)}function ko(e,t,n){if(yo.current!==mo)throw Error(s(168));go(yo,t),go(vo,n)}function To(e,t,n){var r=e.stateNode;if(e=t.childContextTypes,"function"!=typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in e))throw Error(s(108,X(t)||"Unknown",i));return o({},n,{},r)}function Io(e){var t=e.stateNode;return t=t&&t.__reactInternalMemoizedMergedChildContext||mo,_o=yo.current,go(yo,t),go(vo,vo.current),!0}function Ro(e,t,n){var r=e.stateNode;if(!r)throw Error(s(169));n?(t=To(e,t,_o),r.__reactInternalMemoizedMergedChildContext=t,po(vo),po(yo),go(yo,t)):po(vo),go(vo,n)}var Oo=i.unstable_runWithPriority,Co=i.unstable_scheduleCallback,Po=i.unstable_cancelCallback,Do=i.unstable_shouldYield,Ao=i.unstable_requestPaint,xo=i.unstable_now,Mo=i.unstable_getCurrentPriorityLevel,No=i.unstable_ImmediatePriority,Uo=i.unstable_UserBlockingPriority,Lo=i.unstable_NormalPriority,Ko=i.unstable_LowPriority,jo=i.unstable_IdlePriority,Bo={},Fo=void 0!==Ao?Ao:function(){},qo=null,$o=null,Go=!1,Vo=xo(),Wo=1e4>Vo?xo:function(){return xo()-Vo};function zo(){switch(Mo()){case No:return 99;case Uo:return 98;case Lo:return 97;case Ko:return 96;case jo:return 95;default:throw Error(s(332))}}function Ho(e){switch(e){case 99:return No;case 98:return Uo;case 97:return Lo;case 96:return Ko;case 95:return jo;default:throw Error(s(332))}}function Yo(e,t){return e=Ho(e),Oo(e,t)}function Qo(e,t,n){return e=Ho(e),Co(e,t,n)}function Xo(e){return null===qo?(qo=[e],$o=Co(No,Zo)):qo.push(e),Bo}function Jo(){if(null!==$o){var e=$o;$o=null,Po(e)}Zo()}function Zo(){if(!Go&&null!==qo){Go=!0;var e=0;try{var t=qo;Yo(99,(function(){for(;e<t.length;e++){var n=t[e];do{n=n(!0)}while(null!==n)}})),qo=null}catch(t){throw null!==qo&&(qo=qo.slice(e+1)),Co(No,Jo),t}finally{Go=!1}}}var ei=3;function ti(e,t,n){return 1073741821-(1+((1073741821-e+t/10)/(n/=10)|0))*n}function ni(e,t){if(e&&e.defaultProps)for(var n in t=o({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}var ri={current:null},oi=null,ii=null,si=null;function ai(){si=ii=oi=null}function ci(e,t){var n=e.type._context;go(ri,n._currentValue),n._currentValue=t}function ui(e){var t=ri.current;po(ri),e.type._context._currentValue=t}function li(e,t){for(;null!==e;){var n=e.alternate;if(e.childExpirationTime<t)e.childExpirationTime=t,null!==n&&n.childExpirationTime<t&&(n.childExpirationTime=t);else{if(!(null!==n&&n.childExpirationTime<t))break;n.childExpirationTime=t}e=e.return}}function di(e,t){oi=e,si=ii=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(e.expirationTime>=t&&(Vs=!0),e.firstContext=null)}function hi(e,t){if(si!==e&&!1!==t&&0!==t)if("number"==typeof t&&1073741823!==t||(si=e,t=1073741823),t={context:e,observedBits:t,next:null},null===ii){if(null===oi)throw Error(s(308));ii=t,oi.dependencies={expirationTime:0,firstContext:t,responders:null}}else ii=ii.next=t;return e._currentValue}var fi=!1;function pi(e){return{baseState:e,firstUpdate:null,lastUpdate:null,firstCapturedUpdate:null,lastCapturedUpdate:null,firstEffect:null,lastEffect:null,firstCapturedEffect:null,lastCapturedEffect:null}}function gi(e){return{baseState:e.baseState,firstUpdate:e.firstUpdate,lastUpdate:e.lastUpdate,firstCapturedUpdate:null,lastCapturedUpdate:null,firstEffect:null,lastEffect:null,firstCapturedEffect:null,lastCapturedEffect:null}}function mi(e,t){return{expirationTime:e,suspenseConfig:t,tag:0,payload:null,callback:null,next:null,nextEffect:null}}function yi(e,t){null===e.lastUpdate?e.firstUpdate=e.lastUpdate=t:(e.lastUpdate.next=t,e.lastUpdate=t)}function vi(e,t){var n=e.alternate;if(null===n){var r=e.updateQueue,o=null;null===r&&(r=e.updateQueue=pi(e.memoizedState))}else r=e.updateQueue,o=n.updateQueue,null===r?null===o?(r=e.updateQueue=pi(e.memoizedState),o=n.updateQueue=pi(n.memoizedState)):r=e.updateQueue=gi(o):null===o&&(o=n.updateQueue=gi(r));null===o||r===o?yi(r,t):null===r.lastUpdate||null===o.lastUpdate?(yi(r,t),yi(o,t)):(yi(r,t),o.lastUpdate=t)}function _i(e,t){var n=e.updateQueue;null===(n=null===n?e.updateQueue=pi(e.memoizedState):bi(e,n)).lastCapturedUpdate?n.firstCapturedUpdate=n.lastCapturedUpdate=t:(n.lastCapturedUpdate.next=t,n.lastCapturedUpdate=t)}function bi(e,t){var n=e.alternate;return null!==n&&t===n.updateQueue&&(t=e.updateQueue=gi(t)),t}function Ei(e,t,n,r,i,s){switch(n.tag){case 1:return"function"==typeof(e=n.payload)?e.call(s,r,i):e;case 3:e.effectTag=-4097&e.effectTag|64;case 0:if(null==(i="function"==typeof(e=n.payload)?e.call(s,r,i):e))break;return o({},r,i);case 2:fi=!0}return r}function Si(e,t,n,r,o){fi=!1;for(var i=(t=bi(e,t)).baseState,s=null,a=0,c=t.firstUpdate,u=i;null!==c;){var l=c.expirationTime;l<o?(null===s&&(s=c,i=u),a<l&&(a=l)):(Rc(l,c.suspenseConfig),u=Ei(e,0,c,u,n,r),null!==c.callback&&(e.effectTag|=32,c.nextEffect=null,null===t.lastEffect?t.firstEffect=t.lastEffect=c:(t.lastEffect.nextEffect=c,t.lastEffect=c))),c=c.next}for(l=null,c=t.firstCapturedUpdate;null!==c;){var d=c.expirationTime;d<o?(null===l&&(l=c,null===s&&(i=u)),a<d&&(a=d)):(u=Ei(e,0,c,u,n,r),null!==c.callback&&(e.effectTag|=32,c.nextEffect=null,null===t.lastCapturedEffect?t.firstCapturedEffect=t.lastCapturedEffect=c:(t.lastCapturedEffect.nextEffect=c,t.lastCapturedEffect=c))),c=c.next}null===s&&(t.lastUpdate=null),null===l?t.lastCapturedUpdate=null:e.effectTag|=32,null===s&&null===l&&(i=u),t.baseState=i,t.firstUpdate=s,t.firstCapturedUpdate=l,Oc(a),e.expirationTime=a,e.memoizedState=u}function wi(e,t,n){null!==t.firstCapturedUpdate&&(null!==t.lastUpdate&&(t.lastUpdate.next=t.firstCapturedUpdate,t.lastUpdate=t.lastCapturedUpdate),t.firstCapturedUpdate=t.lastCapturedUpdate=null),ki(t.firstEffect,n),t.firstEffect=t.lastEffect=null,ki(t.firstCapturedEffect,n),t.firstCapturedEffect=t.lastCapturedEffect=null}function ki(e,t){for(;null!==e;){var n=e.callback;if(null!==n){e.callback=null;var r=t;if("function"!=typeof n)throw Error(s(191,n));n.call(r)}e=e.nextEffect}}var Ti=x.ReactCurrentBatchConfig,Ii=(new r.Component).refs;function Ri(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:o({},t,n),e.memoizedState=n,null!==(r=e.updateQueue)&&0===e.expirationTime&&(r.baseState=n)}var Oi={isMounted:function(e){return!!(e=e._reactInternalFiber)&&et(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternalFiber;var r=pc(),o=Ti.suspense;(o=mi(r=gc(r,e,o),o)).payload=t,null!=n&&(o.callback=n),vi(e,o),mc(e,r)},enqueueReplaceState:function(e,t,n){e=e._reactInternalFiber;var r=pc(),o=Ti.suspense;(o=mi(r=gc(r,e,o),o)).tag=1,o.payload=t,null!=n&&(o.callback=n),vi(e,o),mc(e,r)},enqueueForceUpdate:function(e,t){e=e._reactInternalFiber;var n=pc(),r=Ti.suspense;(r=mi(n=gc(n,e,r),r)).tag=2,null!=t&&(r.callback=t),vi(e,r),mc(e,n)}};function Ci(e,t,n,r,o,i,s){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,i,s):!t.prototype||!t.prototype.isPureReactComponent||(!no(n,r)||!no(o,i))}function Pi(e,t,n){var r=!1,o=mo,i=t.contextType;return"object"==typeof i&&null!==i?i=hi(i):(o=Eo(t)?_o:yo.current,i=(r=null!=(r=t.contextTypes))?bo(e,o):mo),t=new t(n,i),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Oi,e.stateNode=t,t._reactInternalFiber=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=i),t}function Di(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Oi.enqueueReplaceState(t,t.state,null)}function Ai(e,t,n,r){var o=e.stateNode;o.props=n,o.state=e.memoizedState,o.refs=Ii;var i=t.contextType;"object"==typeof i&&null!==i?o.context=hi(i):(i=Eo(t)?_o:yo.current,o.context=bo(e,i)),null!==(i=e.updateQueue)&&(Si(e,i,n,o,r),o.state=e.memoizedState),"function"==typeof(i=t.getDerivedStateFromProps)&&(Ri(e,t,i,n),o.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof o.getSnapshotBeforeUpdate||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||(t=o.state,"function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount(),t!==o.state&&Oi.enqueueReplaceState(o,o.state,null),null!==(i=e.updateQueue)&&(Si(e,i,n,o,r),o.state=e.memoizedState)),"function"==typeof o.componentDidMount&&(e.effectTag|=4)}var xi=Array.isArray;function Mi(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(s(309));var r=n.stateNode}if(!r)throw Error(s(147,e));var o=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===o?t.ref:((t=function(e){var t=r.refs;t===Ii&&(t=r.refs={}),null===e?delete t[o]:t[o]=e})._stringRef=o,t)}if("string"!=typeof e)throw Error(s(284));if(!n._owner)throw Error(s(290,e))}return e}function Ni(e,t){if("textarea"!==e.type)throw Error(s(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t,""))}function Ui(e){function t(t,n){if(e){var r=t.lastEffect;null!==r?(r.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.effectTag=8}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function o(e,t,n){return(e=Hc(e,t)).index=0,e.sibling=null,e}function i(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.effectTag=2,n):r:(t.effectTag=2,n):n}function a(t){return e&&null===t.alternate&&(t.effectTag=2),t}function c(e,t,n,r){return null===t||6!==t.tag?((t=Xc(n,e.mode,r)).return=e,t):((t=o(t,n)).return=e,t)}function u(e,t,n,r){return null!==t&&t.elementType===n.type?((r=o(t,n.props)).ref=Mi(e,t,n),r.return=e,r):((r=Yc(n.type,n.key,n.props,null,e.mode,r)).ref=Mi(e,t,n),r.return=e,r)}function l(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Jc(n,e.mode,r)).return=e,t):((t=o(t,n.children||[])).return=e,t)}function d(e,t,n,r,i){return null===t||7!==t.tag?((t=Qc(n,e.mode,r,i)).return=e,t):((t=o(t,n)).return=e,t)}function h(e,t,n){if("string"==typeof t||"number"==typeof t)return(t=Xc(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case U:return(n=Yc(t.type,t.key,t.props,null,e.mode,n)).ref=Mi(e,null,t),n.return=e,n;case L:return(t=Jc(t,e.mode,n)).return=e,t}if(xi(t)||Q(t))return(t=Qc(t,e.mode,n,null)).return=e,t;Ni(e,t)}return null}function f(e,t,n,r){var o=null!==t?t.key:null;if("string"==typeof n||"number"==typeof n)return null!==o?null:c(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case U:return n.key===o?n.type===K?d(e,t,n.props.children,r,o):u(e,t,n,r):null;case L:return n.key===o?l(e,t,n,r):null}if(xi(n)||Q(n))return null!==o?null:d(e,t,n,r,null);Ni(e,n)}return null}function p(e,t,n,r,o){if("string"==typeof r||"number"==typeof r)return c(t,e=e.get(n)||null,""+r,o);if("object"==typeof r&&null!==r){switch(r.$$typeof){case U:return e=e.get(null===r.key?n:r.key)||null,r.type===K?d(t,e,r.props.children,o,r.key):u(t,e,r,o);case L:return l(t,e=e.get(null===r.key?n:r.key)||null,r,o)}if(xi(r)||Q(r))return d(t,e=e.get(n)||null,r,o,null);Ni(t,r)}return null}function g(o,s,a,c){for(var u=null,l=null,d=s,g=s=0,m=null;null!==d&&g<a.length;g++){d.index>g?(m=d,d=null):m=d.sibling;var y=f(o,d,a[g],c);if(null===y){null===d&&(d=m);break}e&&d&&null===y.alternate&&t(o,d),s=i(y,s,g),null===l?u=y:l.sibling=y,l=y,d=m}if(g===a.length)return n(o,d),u;if(null===d){for(;g<a.length;g++)null!==(d=h(o,a[g],c))&&(s=i(d,s,g),null===l?u=d:l.sibling=d,l=d);return u}for(d=r(o,d);g<a.length;g++)null!==(m=p(d,o,g,a[g],c))&&(e&&null!==m.alternate&&d.delete(null===m.key?g:m.key),s=i(m,s,g),null===l?u=m:l.sibling=m,l=m);return e&&d.forEach((function(e){return t(o,e)})),u}function m(o,a,c,u){var l=Q(c);if("function"!=typeof l)throw Error(s(150));if(null==(c=l.call(c)))throw Error(s(151));for(var d=l=null,g=a,m=a=0,y=null,v=c.next();null!==g&&!v.done;m++,v=c.next()){g.index>m?(y=g,g=null):y=g.sibling;var _=f(o,g,v.value,u);if(null===_){null===g&&(g=y);break}e&&g&&null===_.alternate&&t(o,g),a=i(_,a,m),null===d?l=_:d.sibling=_,d=_,g=y}if(v.done)return n(o,g),l;if(null===g){for(;!v.done;m++,v=c.next())null!==(v=h(o,v.value,u))&&(a=i(v,a,m),null===d?l=v:d.sibling=v,d=v);return l}for(g=r(o,g);!v.done;m++,v=c.next())null!==(v=p(g,o,m,v.value,u))&&(e&&null!==v.alternate&&g.delete(null===v.key?m:v.key),a=i(v,a,m),null===d?l=v:d.sibling=v,d=v);return e&&g.forEach((function(e){return t(o,e)})),l}return function(e,r,i,c){var u="object"==typeof i&&null!==i&&i.type===K&&null===i.key;u&&(i=i.props.children);var l="object"==typeof i&&null!==i;if(l)switch(i.$$typeof){case U:e:{for(l=i.key,u=r;null!==u;){if(u.key===l){if(7===u.tag?i.type===K:u.elementType===i.type){n(e,u.sibling),(r=o(u,i.type===K?i.props.children:i.props)).ref=Mi(e,u,i),r.return=e,e=r;break e}n(e,u);break}t(e,u),u=u.sibling}i.type===K?((r=Qc(i.props.children,e.mode,c,i.key)).return=e,e=r):((c=Yc(i.type,i.key,i.props,null,e.mode,c)).ref=Mi(e,r,i),c.return=e,e=c)}return a(e);case L:e:{for(u=i.key;null!==r;){if(r.key===u){if(4===r.tag&&r.stateNode.containerInfo===i.containerInfo&&r.stateNode.implementation===i.implementation){n(e,r.sibling),(r=o(r,i.children||[])).return=e,e=r;break e}n(e,r);break}t(e,r),r=r.sibling}(r=Jc(i,e.mode,c)).return=e,e=r}return a(e)}if("string"==typeof i||"number"==typeof i)return i=""+i,null!==r&&6===r.tag?(n(e,r.sibling),(r=o(r,i)).return=e,e=r):(n(e,r),(r=Xc(i,e.mode,c)).return=e,e=r),a(e);if(xi(i))return g(e,r,i,c);if(Q(i))return m(e,r,i,c);if(l&&Ni(e,i),void 0===i&&!u)switch(e.tag){case 1:case 0:throw e=e.type,Error(s(152,e.displayName||e.name||"Component"))}return n(e,r)}}var Li=Ui(!0),Ki=Ui(!1),ji={},Bi={current:ji},Fi={current:ji},qi={current:ji};function $i(e){if(e===ji)throw Error(s(174));return e}function Gi(e,t){go(qi,t),go(Fi,e),go(Bi,ji);var n=t.nodeType;switch(n){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Be(null,"");break;default:t=Be(t=(n=8===n?t.parentNode:t).namespaceURI||null,n=n.tagName)}po(Bi),go(Bi,t)}function Vi(e){po(Bi),po(Fi),po(qi)}function Wi(e){$i(qi.current);var t=$i(Bi.current),n=Be(t,e.type);t!==n&&(go(Fi,e),go(Bi,n))}function zi(e){Fi.current===e&&(po(Bi),po(Fi))}var Hi={current:0};function Yi(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||n.data===Jn||n.data===Zn))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!=(64&t.effectTag))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function Qi(e,t){return{responder:e,props:t}}var Xi=x.ReactCurrentDispatcher,Ji=x.ReactCurrentBatchConfig,Zi=0,es=null,ts=null,ns=null,rs=null,os=null,is=null,ss=0,as=null,cs=0,us=!1,ls=null,ds=0;function hs(){throw Error(s(321))}function fs(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!eo(e[n],t[n]))return!1;return!0}function ps(e,t,n,r,o,i){if(Zi=i,es=t,ns=null!==e?e.memoizedState:null,Xi.current=null===ns?xs:Ms,t=n(r,o),us){do{us=!1,ds+=1,ns=null!==e?e.memoizedState:null,is=rs,as=os=ts=null,Xi.current=Ms,t=n(r,o)}while(us);ls=null,ds=0}if(Xi.current=As,(e=es).memoizedState=rs,e.expirationTime=ss,e.updateQueue=as,e.effectTag|=cs,e=null!==ts&&null!==ts.next,Zi=0,is=os=rs=ns=ts=es=null,ss=0,as=null,cs=0,e)throw Error(s(300));return t}function gs(){Xi.current=As,Zi=0,is=os=rs=ns=ts=es=null,ss=0,as=null,cs=0,us=!1,ls=null,ds=0}function ms(){var e={memoizedState:null,baseState:null,queue:null,baseUpdate:null,next:null};return null===os?rs=os=e:os=os.next=e,os}function ys(){if(null!==is)is=(os=is).next,ns=null!==(ts=ns)?ts.next:null;else{if(null===ns)throw Error(s(310));var e={memoizedState:(ts=ns).memoizedState,baseState:ts.baseState,queue:ts.queue,baseUpdate:ts.baseUpdate,next:null};os=null===os?rs=e:os.next=e,ns=ts.next}return os}function vs(e,t){return"function"==typeof t?t(e):t}function _s(e){var t=ys(),n=t.queue;if(null===n)throw Error(s(311));if(n.lastRenderedReducer=e,0<ds){var r=n.dispatch;if(null!==ls){var o=ls.get(n);if(void 0!==o){ls.delete(n);var i=t.memoizedState;do{i=e(i,o.action),o=o.next}while(null!==o);return eo(i,t.memoizedState)||(Vs=!0),t.memoizedState=i,t.baseUpdate===n.last&&(t.baseState=i),n.lastRenderedState=i,[i,r]}}return[t.memoizedState,r]}r=n.last;var a=t.baseUpdate;if(i=t.baseState,null!==a?(null!==r&&(r.next=null),r=a.next):r=null!==r?r.next:null,null!==r){var c=o=null,u=r,l=!1;do{var d=u.expirationTime;d<Zi?(l||(l=!0,c=a,o=i),d>ss&&Oc(ss=d)):(Rc(d,u.suspenseConfig),i=u.eagerReducer===e?u.eagerState:e(i,u.action)),a=u,u=u.next}while(null!==u&&u!==r);l||(c=a,o=i),eo(i,t.memoizedState)||(Vs=!0),t.memoizedState=i,t.baseUpdate=c,t.baseState=o,n.lastRenderedState=i}return[t.memoizedState,n.dispatch]}function bs(e){var t=ms();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={last:null,dispatch:null,lastRenderedReducer:vs,lastRenderedState:e}).dispatch=Ds.bind(null,es,e),[t.memoizedState,e]}function Es(e){return _s(vs)}function Ss(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===as?(as={lastEffect:null}).lastEffect=e.next=e:null===(t=as.lastEffect)?as.lastEffect=e.next=e:(n=t.next,t.next=e,e.next=n,as.lastEffect=e),e}function ws(e,t,n,r){var o=ms();cs|=e,o.memoizedState=Ss(t,n,void 0,void 0===r?null:r)}function ks(e,t,n,r){var o=ys();r=void 0===r?null:r;var i=void 0;if(null!==ts){var s=ts.memoizedState;if(i=s.destroy,null!==r&&fs(r,s.deps))return void Ss(0,n,i,r)}cs|=e,o.memoizedState=Ss(t,n,i,r)}function Ts(e,t){return ws(516,192,e,t)}function Is(e,t){return ks(516,192,e,t)}function Rs(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Os(){}function Cs(e,t){return ms().memoizedState=[e,void 0===t?null:t],e}function Ps(e,t){var n=ys();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&fs(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Ds(e,t,n){if(!(25>ds))throw Error(s(301));var r=e.alternate;if(e===es||null!==r&&r===es)if(us=!0,e={expirationTime:Zi,suspenseConfig:null,action:n,eagerReducer:null,eagerState:null,next:null},null===ls&&(ls=new Map),void 0===(n=ls.get(t)))ls.set(t,e);else{for(t=n;null!==t.next;)t=t.next;t.next=e}else{var o=pc(),i=Ti.suspense;i={expirationTime:o=gc(o,e,i),suspenseConfig:i,action:n,eagerReducer:null,eagerState:null,next:null};var a=t.last;if(null===a)i.next=i;else{var c=a.next;null!==c&&(i.next=c),a.next=i}if(t.last=i,0===e.expirationTime&&(null===r||0===r.expirationTime)&&null!==(r=t.lastRenderedReducer))try{var u=t.lastRenderedState,l=r(u,n);if(i.eagerReducer=r,i.eagerState=l,eo(l,u))return}catch(e){}mc(e,o)}}var As={readContext:hi,useCallback:hs,useContext:hs,useEffect:hs,useImperativeHandle:hs,useLayoutEffect:hs,useMemo:hs,useReducer:hs,useRef:hs,useState:hs,useDebugValue:hs,useResponder:hs,useDeferredValue:hs,useTransition:hs},xs={readContext:hi,useCallback:Cs,useContext:hi,useEffect:Ts,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,ws(4,36,Rs.bind(null,t,e),n)},useLayoutEffect:function(e,t){return ws(4,36,e,t)},useMemo:function(e,t){var n=ms();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=ms();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e=(e=r.queue={last:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=Ds.bind(null,es,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},ms().memoizedState=e},useState:bs,useDebugValue:Os,useResponder:Qi,useDeferredValue:function(e,t){var n=bs(e),r=n[0],o=n[1];return Ts((function(){i.unstable_next((function(){var n=Ji.suspense;Ji.suspense=void 0===t?null:t;try{o(e)}finally{Ji.suspense=n}}))}),[e,t]),r},useTransition:function(e){var t=bs(!1),n=t[0],r=t[1];return[Cs((function(t){r(!0),i.unstable_next((function(){var n=Ji.suspense;Ji.suspense=void 0===e?null:e;try{r(!1),t()}finally{Ji.suspense=n}}))}),[e,n]),n]}},Ms={readContext:hi,useCallback:Ps,useContext:hi,useEffect:Is,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,ks(4,36,Rs.bind(null,t,e),n)},useLayoutEffect:function(e,t){return ks(4,36,e,t)},useMemo:function(e,t){var n=ys();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&fs(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)},useReducer:_s,useRef:function(){return ys().memoizedState},useState:Es,useDebugValue:Os,useResponder:Qi,useDeferredValue:function(e,t){var n=Es(),r=n[0],o=n[1];return Is((function(){i.unstable_next((function(){var n=Ji.suspense;Ji.suspense=void 0===t?null:t;try{o(e)}finally{Ji.suspense=n}}))}),[e,t]),r},useTransition:function(e){var t=Es(),n=t[0],r=t[1];return[Ps((function(t){r(!0),i.unstable_next((function(){var n=Ji.suspense;Ji.suspense=void 0===e?null:e;try{r(!1),t()}finally{Ji.suspense=n}}))}),[e,n]),n]}},Ns=null,Us=null,Ls=!1;function Ks(e,t){var n=Wc(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.effectTag=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function js(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);case 13:default:return!1}}function Bs(e){if(Ls){var t=Us;if(t){var n=t;if(!js(e,t)){if(!(t=sr(n.nextSibling))||!js(e,t))return e.effectTag=-1025&e.effectTag|2,Ls=!1,void(Ns=e);Ks(Ns,n)}Ns=e,Us=sr(t.firstChild)}else e.effectTag=-1025&e.effectTag|2,Ls=!1,Ns=e}}function Fs(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Ns=e}function qs(e){if(e!==Ns)return!1;if(!Ls)return Fs(e),Ls=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!rr(t,e.memoizedProps))for(t=Us;t;)Ks(e,t),t=sr(t.nextSibling);if(Fs(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if(n===Xn){if(0===t){Us=sr(e.nextSibling);break e}t--}else n!==Qn&&n!==Zn&&n!==Jn||t++}e=e.nextSibling}Us=null}}else Us=Ns?sr(e.stateNode.nextSibling):null;return!0}function $s(){Us=Ns=null,Ls=!1}var Gs=x.ReactCurrentOwner,Vs=!1;function Ws(e,t,n,r){t.child=null===e?Ki(t,null,n,r):Li(t,e.child,n,r)}function zs(e,t,n,r,o){n=n.render;var i=t.ref;return di(t,o),r=ps(e,t,n,r,i,o),null===e||Vs?(t.effectTag|=1,Ws(e,t,r,o),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=o&&(e.expirationTime=0),la(e,t,o))}function Hs(e,t,n,r,o,i){if(null===e){var s=n.type;return"function"!=typeof s||zc(s)||void 0!==s.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Yc(n.type,null,r,null,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,Ys(e,t,s,r,o,i))}return s=e.child,o<i&&(o=s.memoizedProps,(n=null!==(n=n.compare)?n:no)(o,r)&&e.ref===t.ref)?la(e,t,i):(t.effectTag|=1,(e=Hc(s,r)).ref=t.ref,e.return=t,t.child=e)}function Ys(e,t,n,r,o,i){return null!==e&&no(e.memoizedProps,r)&&e.ref===t.ref&&(Vs=!1,o<i)?la(e,t,i):Xs(e,t,n,r,i)}function Qs(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.effectTag|=128)}function Xs(e,t,n,r,o){var i=Eo(n)?_o:yo.current;return i=bo(t,i),di(t,o),n=ps(e,t,n,r,i,o),null===e||Vs?(t.effectTag|=1,Ws(e,t,n,o),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=o&&(e.expirationTime=0),la(e,t,o))}function Js(e,t,n,r,o){if(Eo(n)){var i=!0;Io(t)}else i=!1;if(di(t,o),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),Pi(t,n,r),Ai(t,n,r,o),r=!0;else if(null===e){var s=t.stateNode,a=t.memoizedProps;s.props=a;var c=s.context,u=n.contextType;"object"==typeof u&&null!==u?u=hi(u):u=bo(t,u=Eo(n)?_o:yo.current);var l=n.getDerivedStateFromProps,d="function"==typeof l||"function"==typeof s.getSnapshotBeforeUpdate;d||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(a!==r||c!==u)&&Di(t,s,r,u),fi=!1;var h=t.memoizedState;c=s.state=h;var f=t.updateQueue;null!==f&&(Si(t,f,r,s,o),c=t.memoizedState),a!==r||h!==c||vo.current||fi?("function"==typeof l&&(Ri(t,n,l,r),c=t.memoizedState),(a=fi||Ci(t,n,a,r,h,c,u))?(d||"function"!=typeof s.UNSAFE_componentWillMount&&"function"!=typeof s.componentWillMount||("function"==typeof s.componentWillMount&&s.componentWillMount(),"function"==typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"==typeof s.componentDidMount&&(t.effectTag|=4)):("function"==typeof s.componentDidMount&&(t.effectTag|=4),t.memoizedProps=r,t.memoizedState=c),s.props=r,s.state=c,s.context=u,r=a):("function"==typeof s.componentDidMount&&(t.effectTag|=4),r=!1)}else s=t.stateNode,a=t.memoizedProps,s.props=t.type===t.elementType?a:ni(t.type,a),c=s.context,"object"==typeof(u=n.contextType)&&null!==u?u=hi(u):u=bo(t,u=Eo(n)?_o:yo.current),(d="function"==typeof(l=n.getDerivedStateFromProps)||"function"==typeof s.getSnapshotBeforeUpdate)||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(a!==r||c!==u)&&Di(t,s,r,u),fi=!1,c=t.memoizedState,h=s.state=c,null!==(f=t.updateQueue)&&(Si(t,f,r,s,o),h=t.memoizedState),a!==r||c!==h||vo.current||fi?("function"==typeof l&&(Ri(t,n,l,r),h=t.memoizedState),(l=fi||Ci(t,n,a,r,c,h,u))?(d||"function"!=typeof s.UNSAFE_componentWillUpdate&&"function"!=typeof s.componentWillUpdate||("function"==typeof s.componentWillUpdate&&s.componentWillUpdate(r,h,u),"function"==typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(r,h,u)),"function"==typeof s.componentDidUpdate&&(t.effectTag|=4),"function"==typeof s.getSnapshotBeforeUpdate&&(t.effectTag|=256)):("function"!=typeof s.componentDidUpdate||a===e.memoizedProps&&c===e.memoizedState||(t.effectTag|=4),"function"!=typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&c===e.memoizedState||(t.effectTag|=256),t.memoizedProps=r,t.memoizedState=h),s.props=r,s.state=h,s.context=u,r=l):("function"!=typeof s.componentDidUpdate||a===e.memoizedProps&&c===e.memoizedState||(t.effectTag|=4),"function"!=typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&c===e.memoizedState||(t.effectTag|=256),r=!1);return Zs(e,t,n,r,i,o)}function Zs(e,t,n,r,o,i){Qs(e,t);var s=0!=(64&t.effectTag);if(!r&&!s)return o&&Ro(t,n,!1),la(e,t,i);r=t.stateNode,Gs.current=t;var a=s&&"function"!=typeof n.getDerivedStateFromError?null:r.render();return t.effectTag|=1,null!==e&&s?(t.child=Li(t,e.child,null,i),t.child=Li(t,null,a,i)):Ws(e,t,a,i),t.memoizedState=r.state,o&&Ro(t,n,!0),t.child}function ea(e){var t=e.stateNode;t.pendingContext?ko(0,t.pendingContext,t.pendingContext!==t.context):t.context&&ko(0,t.context,!1),Gi(e,t.containerInfo)}var ta,na,ra,oa,ia={dehydrated:null,retryTime:0};function sa(e,t,n){var r,o=t.mode,i=t.pendingProps,s=Hi.current,a=!1;if((r=0!=(64&t.effectTag))||(r=0!=(2&s)&&(null===e||null!==e.memoizedState)),r?(a=!0,t.effectTag&=-65):null!==e&&null===e.memoizedState||void 0===i.fallback||!0===i.unstable_avoidThisFallback||(s|=1),go(Hi,1&s),null===e){if(void 0!==i.fallback&&Bs(t),a){if(a=i.fallback,(i=Qc(null,o,0,null)).return=t,0==(2&t.mode))for(e=null!==t.memoizedState?t.child.child:t.child,i.child=e;null!==e;)e.return=i,e=e.sibling;return(n=Qc(a,o,n,null)).return=t,i.sibling=n,t.memoizedState=ia,t.child=i,n}return o=i.children,t.memoizedState=null,t.child=Ki(t,null,o,n)}if(null!==e.memoizedState){if(o=(e=e.child).sibling,a){if(i=i.fallback,(n=Hc(e,e.pendingProps)).return=t,0==(2&t.mode)&&(a=null!==t.memoizedState?t.child.child:t.child)!==e.child)for(n.child=a;null!==a;)a.return=n,a=a.sibling;return(o=Hc(o,i,o.expirationTime)).return=t,n.sibling=o,n.childExpirationTime=0,t.memoizedState=ia,t.child=n,o}return n=Li(t,e.child,i.children,n),t.memoizedState=null,t.child=n}if(e=e.child,a){if(a=i.fallback,(i=Qc(null,o,0,null)).return=t,i.child=e,null!==e&&(e.return=i),0==(2&t.mode))for(e=null!==t.memoizedState?t.child.child:t.child,i.child=e;null!==e;)e.return=i,e=e.sibling;return(n=Qc(a,o,n,null)).return=t,i.sibling=n,n.effectTag|=2,i.childExpirationTime=0,t.memoizedState=ia,t.child=i,n}return t.memoizedState=null,t.child=Li(t,e,i.children,n)}function aa(e,t){e.expirationTime<t&&(e.expirationTime=t);var n=e.alternate;null!==n&&n.expirationTime<t&&(n.expirationTime=t),li(e.return,t)}function ca(e,t,n,r,o,i){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,last:r,tail:n,tailExpiration:0,tailMode:o,lastEffect:i}:(s.isBackwards=t,s.rendering=null,s.last=r,s.tail=n,s.tailExpiration=0,s.tailMode=o,s.lastEffect=i)}function ua(e,t,n){var r=t.pendingProps,o=r.revealOrder,i=r.tail;if(Ws(e,t,r.children,n),0!=(2&(r=Hi.current)))r=1&r|2,t.effectTag|=64;else{if(null!==e&&0!=(64&e.effectTag))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&aa(e,n);else if(19===e.tag)aa(e,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(go(Hi,r),0==(2&t.mode))t.memoizedState=null;else switch(o){case"forwards":for(n=t.child,o=null;null!==n;)null!==(e=n.alternate)&&null===Yi(e)&&(o=n),n=n.sibling;null===(n=o)?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),ca(t,!1,o,n,i,t.lastEffect);break;case"backwards":for(n=null,o=t.child,t.child=null;null!==o;){if(null!==(e=o.alternate)&&null===Yi(e)){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}ca(t,!0,n,null,i,t.lastEffect);break;case"together":ca(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function la(e,t,n){null!==e&&(t.dependencies=e.dependencies);var r=t.expirationTime;if(0!==r&&Oc(r),t.childExpirationTime<n)return null;if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=Hc(e=t.child,e.pendingProps,e.expirationTime),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Hc(e,e.pendingProps,e.expirationTime)).return=t;n.sibling=null}return t.child}function da(e){e.effectTag|=4}function ha(e,t){switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function fa(e){switch(e.tag){case 1:Eo(e.type)&&So();var t=e.effectTag;return 4096&t?(e.effectTag=-4097&t|64,e):null;case 3:if(Vi(),wo(),0!=(64&(t=e.effectTag)))throw Error(s(285));return e.effectTag=-4097&t|64,e;case 5:return zi(e),null;case 13:return po(Hi),4096&(t=e.effectTag)?(e.effectTag=-4097&t|64,e):null;case 19:return po(Hi),null;case 4:return Vi(),null;case 10:return ui(e),null;default:return null}}function pa(e,t){return{value:e,source:t,stack:J(t)}}ta=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},na=function(){},ra=function(e,t,n,r,i){var s=e.memoizedProps;if(s!==r){var a,c,u=t.stateNode;switch($i(Bi.current),e=null,n){case"input":s=Ie(u,s),r=Ie(u,r),e=[];break;case"option":s=Ae(u,s),r=Ae(u,r),e=[];break;case"select":s=o({},s,{value:void 0}),r=o({},r,{value:void 0}),e=[];break;case"textarea":s=Me(u,s),r=Me(u,r),e=[];break;default:"function"!=typeof s.onClick&&"function"==typeof r.onClick&&(u.onclick=Gn)}for(a in Fn(n,r),n=null,s)if(!r.hasOwnProperty(a)&&s.hasOwnProperty(a)&&null!=s[a])if("style"===a)for(c in u=s[a])u.hasOwnProperty(c)&&(n||(n={}),n[c]="");else"dangerouslySetInnerHTML"!==a&&"children"!==a&&"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(f.hasOwnProperty(a)?e||(e=[]):(e=e||[]).push(a,null));for(a in r){var l=r[a];if(u=null!=s?s[a]:void 0,r.hasOwnProperty(a)&&l!==u&&(null!=l||null!=u))if("style"===a)if(u){for(c in u)!u.hasOwnProperty(c)||l&&l.hasOwnProperty(c)||(n||(n={}),n[c]="");for(c in l)l.hasOwnProperty(c)&&u[c]!==l[c]&&(n||(n={}),n[c]=l[c])}else n||(e||(e=[]),e.push(a,n)),n=l;else"dangerouslySetInnerHTML"===a?(l=l?l.__html:void 0,u=u?u.__html:void 0,null!=l&&u!==l&&(e=e||[]).push(a,""+l)):"children"===a?u===l||"string"!=typeof l&&"number"!=typeof l||(e=e||[]).push(a,""+l):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&(f.hasOwnProperty(a)?(null!=l&&$n(i,a),e||u===l||(e=[])):(e=e||[]).push(a,l))}n&&(e=e||[]).push("style",n),i=e,(t.updateQueue=i)&&da(t)}},oa=function(e,t,n,r){n!==r&&da(t)};var ga="function"==typeof WeakSet?WeakSet:Set;function ma(e,t){var n=t.source,r=t.stack;null===r&&null!==n&&(r=J(n)),null!==n&&X(n.type),t=t.value,null!==e&&1===e.tag&&X(e.type);try{console.error(t)}catch(e){setTimeout((function(){throw e}))}}function ya(e){var t=e.ref;if(null!==t)if("function"==typeof t)try{t(null)}catch(t){Bc(e,t)}else t.current=null}function va(e,t){switch(t.tag){case 0:case 11:case 15:_a(2,0,t);break;case 1:if(256&t.effectTag&&null!==e){var n=e.memoizedProps,r=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:ni(t.type,n),r),e.__reactInternalSnapshotBeforeUpdate=t}break;case 3:case 5:case 6:case 4:case 17:break;default:throw Error(s(163))}}function _a(e,t,n){if(null!==(n=null!==(n=n.updateQueue)?n.lastEffect:null)){var r=n=n.next;do{if(0!=(r.tag&e)){var o=r.destroy;r.destroy=void 0,void 0!==o&&o()}0!=(r.tag&t)&&(o=r.create,r.destroy=o()),r=r.next}while(r!==n)}}function ba(e,t,n){switch("function"==typeof Gc&&Gc(t),t.tag){case 0:case 11:case 14:case 15:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var r=e.next;Yo(97<n?97:n,(function(){var e=r;do{var n=e.destroy;if(void 0!==n){var o=t;try{n()}catch(e){Bc(o,e)}}e=e.next}while(e!==r)}))}break;case 1:ya(t),"function"==typeof(n=t.stateNode).componentWillUnmount&&function(e,t){try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(t){Bc(e,t)}}(t,n);break;case 5:ya(t);break;case 4:ka(e,t,n)}}function Ea(e){var t=e.alternate;e.return=null,e.child=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.alternate=null,e.firstEffect=null,e.lastEffect=null,e.pendingProps=null,e.memoizedProps=null,null!==t&&Ea(t)}function Sa(e){return 5===e.tag||3===e.tag||4===e.tag}function wa(e){e:{for(var t=e.return;null!==t;){if(Sa(t)){var n=t;break e}t=t.return}throw Error(s(160))}switch(t=n.stateNode,n.tag){case 5:var r=!1;break;case 3:case 4:t=t.containerInfo,r=!0;break;default:throw Error(s(161))}16&n.effectTag&&($e(t,""),n.effectTag&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||Sa(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.effectTag)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.effectTag)){n=n.stateNode;break e}}for(var o=e;;){var i=5===o.tag||6===o.tag;if(i){var a=i?o.stateNode:o.stateNode.instance;if(n)if(r){var c=a;a=n,8===(i=t).nodeType?i.parentNode.insertBefore(c,a):i.insertBefore(c,a)}else t.insertBefore(a,n);else r?(8===(c=t).nodeType?(i=c.parentNode).insertBefore(a,c):(i=c).appendChild(a),null!=(c=c._reactRootContainer)||null!==i.onclick||(i.onclick=Gn)):t.appendChild(a)}else if(4!==o.tag&&null!==o.child){o.child.return=o,o=o.child;continue}if(o===e)break;for(;null===o.sibling;){if(null===o.return||o.return===e)return;o=o.return}o.sibling.return=o.return,o=o.sibling}}function ka(e,t,n){for(var r,o,i=t,a=!1;;){if(!a){a=i.return;e:for(;;){if(null===a)throw Error(s(160));switch(r=a.stateNode,a.tag){case 5:o=!1;break e;case 3:case 4:r=r.containerInfo,o=!0;break e}a=a.return}a=!0}if(5===i.tag||6===i.tag){e:for(var c=e,u=i,l=n,d=u;;)if(ba(c,d,l),null!==d.child&&4!==d.tag)d.child.return=d,d=d.child;else{if(d===u)break;for(;null===d.sibling;){if(null===d.return||d.return===u)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}o?(c=r,u=i.stateNode,8===c.nodeType?c.parentNode.removeChild(u):c.removeChild(u)):r.removeChild(i.stateNode)}else if(4===i.tag){if(null!==i.child){r=i.stateNode.containerInfo,o=!0,i.child.return=i,i=i.child;continue}}else if(ba(e,i,n),null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;4===(i=i.return).tag&&(a=!1)}i.sibling.return=i.return,i=i.sibling}}function Ta(e,t){switch(t.tag){case 0:case 11:case 14:case 15:_a(4,8,t);break;case 1:break;case 5:var n=t.stateNode;if(null!=n){var r=t.memoizedProps,o=null!==e?e.memoizedProps:r;e=t.type;var i=t.updateQueue;if(t.updateQueue=null,null!==i){for(n[lr]=r,"input"===e&&"radio"===r.type&&null!=r.name&&Oe(n,r),qn(e,o),t=qn(e,r),o=0;o<i.length;o+=2){var a=i[o],c=i[o+1];"style"===a?jn(n,c):"dangerouslySetInnerHTML"===a?qe(n,c):"children"===a?$e(n,c):Se(n,a,c,t)}switch(e){case"input":Ce(n,r);break;case"textarea":Ue(n,r);break;case"select":t=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!r.multiple,null!=(e=r.value)?xe(n,!!r.multiple,e,!1):t!==!!r.multiple&&(null!=r.defaultValue?xe(n,!!r.multiple,r.defaultValue,!0):xe(n,!!r.multiple,r.multiple?[]:"",!1))}}}break;case 6:if(null===t.stateNode)throw Error(s(162));t.stateNode.nodeValue=t.memoizedProps;break;case 3:(t=t.stateNode).hydrate&&(t.hydrate=!1,Tt(t.containerInfo));break;case 12:break;case 13:if(n=t,null===t.memoizedState?r=!1:(r=!0,n=t.child,tc=Wo()),null!==n)e:for(e=n;;){if(5===e.tag)i=e.stateNode,r?"function"==typeof(i=i.style).setProperty?i.setProperty("display","none","important"):i.display="none":(i=e.stateNode,o=null!=(o=e.memoizedProps.style)&&o.hasOwnProperty("display")?o.display:null,i.style.display=Kn("display",o));else if(6===e.tag)e.stateNode.nodeValue=r?"":e.memoizedProps;else{if(13===e.tag&&null!==e.memoizedState&&null===e.memoizedState.dehydrated){(i=e.child.sibling).return=e,e=i;continue}if(null!==e.child){e.child.return=e,e=e.child;continue}}if(e===n)break e;for(;null===e.sibling;){if(null===e.return||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}Ia(t);break;case 19:Ia(t);break;case 17:case 20:case 21:break;default:throw Error(s(163))}}function Ia(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new ga),t.forEach((function(t){var r=qc.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}var Ra="function"==typeof WeakMap?WeakMap:Map;function Oa(e,t,n){(n=mi(n,null)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){oc||(oc=!0,ic=r),ma(e,t)},n}function Ca(e,t,n){(n=mi(n,null)).tag=3;var r=e.type.getDerivedStateFromError;if("function"==typeof r){var o=t.value;n.payload=function(){return ma(e,t),r(o)}}var i=e.stateNode;return null!==i&&"function"==typeof i.componentDidCatch&&(n.callback=function(){"function"!=typeof r&&(null===sc?sc=new Set([this]):sc.add(this),ma(e,t));var n=t.stack;this.componentDidCatch(t.value,{componentStack:null!==n?n:""})}),n}var Pa,Da=Math.ceil,Aa=x.ReactCurrentDispatcher,xa=x.ReactCurrentOwner,Ma=0,Na=8,Ua=16,La=32,Ka=0,ja=1,Ba=2,Fa=3,qa=4,$a=5,Ga=Ma,Va=null,Wa=null,za=0,Ha=Ka,Ya=null,Qa=1073741823,Xa=1073741823,Ja=null,Za=0,ec=!1,tc=0,nc=500,rc=null,oc=!1,ic=null,sc=null,ac=!1,cc=null,uc=90,lc=null,dc=0,hc=null,fc=0;function pc(){return(Ga&(Ua|La))!==Ma?1073741821-(Wo()/10|0):0!==fc?fc:fc=1073741821-(Wo()/10|0)}function gc(e,t,n){if(0==(2&(t=t.mode)))return 1073741823;var r=zo();if(0==(4&t))return 99===r?1073741823:1073741822;if((Ga&Ua)!==Ma)return za;if(null!==n)e=ti(e,0|n.timeoutMs||5e3,250);else switch(r){case 99:e=1073741823;break;case 98:e=ti(e,150,100);break;case 97:case 96:e=ti(e,5e3,250);break;case 95:e=2;break;default:throw Error(s(326))}return null!==Va&&e===za&&--e,e}function mc(e,t){if(50<dc)throw dc=0,hc=null,Error(s(185));if(null!==(e=yc(e,t))){var n=zo();1073741823===t?(Ga&Na)!==Ma&&(Ga&(Ua|La))===Ma?Ec(e):(_c(e),Ga===Ma&&Jo()):_c(e),(4&Ga)===Ma||98!==n&&99!==n||(null===lc?lc=new Map([[e,t]]):(void 0===(n=lc.get(e))||n>t)&&lc.set(e,t))}}function yc(e,t){e.expirationTime<t&&(e.expirationTime=t);var n=e.alternate;null!==n&&n.expirationTime<t&&(n.expirationTime=t);var r=e.return,o=null;if(null===r&&3===e.tag)o=e.stateNode;else for(;null!==r;){if(n=r.alternate,r.childExpirationTime<t&&(r.childExpirationTime=t),null!==n&&n.childExpirationTime<t&&(n.childExpirationTime=t),null===r.return&&3===r.tag){o=r.stateNode;break}r=r.return}return null!==o&&(Va===o&&(Oc(t),Ha===qa&&tu(o,za)),nu(o,t)),o}function vc(e){var t=e.lastExpiredTime;return 0!==t?t:eu(e,t=e.firstPendingTime)?(t=e.lastPingedTime)>(e=e.nextKnownPendingLevel)?t:e:t}function _c(e){if(0!==e.lastExpiredTime)e.callbackExpirationTime=1073741823,e.callbackPriority=99,e.callbackNode=Xo(Ec.bind(null,e));else{var t=vc(e),n=e.callbackNode;if(0===t)null!==n&&(e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90);else{var r=pc();if(1073741823===t?r=99:1===t||2===t?r=95:r=0>=(r=10*(1073741821-t)-10*(1073741821-r))?99:250>=r?98:5250>=r?97:95,null!==n){var o=e.callbackPriority;if(e.callbackExpirationTime===t&&o>=r)return;n!==Bo&&Po(n)}e.callbackExpirationTime=t,e.callbackPriority=r,t=1073741823===t?Xo(Ec.bind(null,e)):Qo(r,bc.bind(null,e),{timeout:10*(1073741821-t)-Wo()}),e.callbackNode=t}}}function bc(e,t){if(fc=0,t)return ru(e,t=pc()),_c(e),null;var n=vc(e);if(0!==n){if(t=e.callbackNode,(Ga&(Ua|La))!==Ma)throw Error(s(327));if(Lc(),e===Va&&n===za||kc(e,n),null!==Wa){var r=Ga;Ga|=Ua;for(var o=Ic();;)try{Pc();break}catch(t){Tc(e,t)}if(ai(),Ga=r,Aa.current=o,Ha===ja)throw t=Ya,kc(e,n),tu(e,n),_c(e),t;if(null===Wa)switch(o=e.finishedWork=e.current.alternate,e.finishedExpirationTime=n,r=Ha,Va=null,r){case Ka:case ja:throw Error(s(345));case Ba:ru(e,2<n?2:n);break;case Fa:if(tu(e,n),n===(r=e.lastSuspendedTime)&&(e.nextKnownPendingLevel=xc(o)),1073741823===Qa&&10<(o=tc+nc-Wo())){if(ec){var i=e.lastPingedTime;if(0===i||i>=n){e.lastPingedTime=n,kc(e,n);break}}if(0!==(i=vc(e))&&i!==n)break;if(0!==r&&r!==n){e.lastPingedTime=r;break}e.timeoutHandle=or(Mc.bind(null,e),o);break}Mc(e);break;case qa:if(tu(e,n),n===(r=e.lastSuspendedTime)&&(e.nextKnownPendingLevel=xc(o)),ec&&(0===(o=e.lastPingedTime)||o>=n)){e.lastPingedTime=n,kc(e,n);break}if(0!==(o=vc(e))&&o!==n)break;if(0!==r&&r!==n){e.lastPingedTime=r;break}if(1073741823!==Xa?r=10*(1073741821-Xa)-Wo():1073741823===Qa?r=0:(r=10*(1073741821-Qa)-5e3,0>(r=(o=Wo())-r)&&(r=0),(n=10*(1073741821-n)-o)<(r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Da(r/1960))-r)&&(r=n)),10<r){e.timeoutHandle=or(Mc.bind(null,e),r);break}Mc(e);break;case $a:if(1073741823!==Qa&&null!==Ja){i=Qa;var a=Ja;if(0>=(r=0|a.busyMinDurationMs)?r=0:(o=0|a.busyDelayMs,r=(i=Wo()-(10*(1073741821-i)-(0|a.timeoutMs||5e3)))<=o?0:o+r-i),10<r){tu(e,n),e.timeoutHandle=or(Mc.bind(null,e),r);break}}Mc(e);break;default:throw Error(s(329))}if(_c(e),e.callbackNode===t)return bc.bind(null,e)}}return null}function Ec(e){var t=e.lastExpiredTime;if(t=0!==t?t:1073741823,e.finishedExpirationTime===t)Mc(e);else{if((Ga&(Ua|La))!==Ma)throw Error(s(327));if(Lc(),e===Va&&t===za||kc(e,t),null!==Wa){var n=Ga;Ga|=Ua;for(var r=Ic();;)try{Cc();break}catch(t){Tc(e,t)}if(ai(),Ga=n,Aa.current=r,Ha===ja)throw n=Ya,kc(e,t),tu(e,t),_c(e),n;if(null!==Wa)throw Error(s(261));e.finishedWork=e.current.alternate,e.finishedExpirationTime=t,Va=null,Mc(e),_c(e)}}return null}function Sc(e,t){var n=Ga;Ga|=1;try{return e(t)}finally{(Ga=n)===Ma&&Jo()}}function wc(e,t){var n=Ga;Ga&=-2,Ga|=Na;try{return e(t)}finally{(Ga=n)===Ma&&Jo()}}function kc(e,t){e.finishedWork=null,e.finishedExpirationTime=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ir(n)),null!==Wa)for(n=Wa.return;null!==n;){var r=n;switch(r.tag){case 1:var o=r.type.childContextTypes;null!=o&&So();break;case 3:Vi(),wo();break;case 5:zi(r);break;case 4:Vi();break;case 13:case 19:po(Hi);break;case 10:ui(r)}n=n.return}Va=e,Wa=Hc(e.current,null),za=t,Ha=Ka,Ya=null,Xa=Qa=1073741823,Ja=null,Za=0,ec=!1}function Tc(e,t){for(;;){try{if(ai(),gs(),null===Wa||null===Wa.return)return Ha=ja,Ya=t,null;e:{var n=e,r=Wa.return,o=Wa,i=t;if(t=za,o.effectTag|=2048,o.firstEffect=o.lastEffect=null,null!==i&&"object"==typeof i&&"function"==typeof i.then){var s=i,a=0!=(1&Hi.current),c=r;do{var u;if(u=13===c.tag){var l=c.memoizedState;if(null!==l)u=null!==l.dehydrated;else{var d=c.memoizedProps;u=void 0!==d.fallback&&(!0!==d.unstable_avoidThisFallback||!a)}}if(u){var h=c.updateQueue;if(null===h){var f=new Set;f.add(s),c.updateQueue=f}else h.add(s);if(0==(2&c.mode)){if(c.effectTag|=64,o.effectTag&=-2981,1===o.tag)if(null===o.alternate)o.tag=17;else{var p=mi(1073741823,null);p.tag=2,vi(o,p)}o.expirationTime=1073741823;break e}i=void 0,o=t;var g=n.pingCache;if(null===g?(g=n.pingCache=new Ra,i=new Set,g.set(s,i)):void 0===(i=g.get(s))&&(i=new Set,g.set(s,i)),!i.has(o)){i.add(o);var m=Fc.bind(null,n,s,o);s.then(m,m)}c.effectTag|=4096,c.expirationTime=t;break e}c=c.return}while(null!==c);i=Error((X(o.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+J(o))}Ha!==$a&&(Ha=Ba),i=pa(i,o),c=r;do{switch(c.tag){case 3:s=i,c.effectTag|=4096,c.expirationTime=t,_i(c,Oa(c,s,t));break e;case 1:s=i;var y=c.type,v=c.stateNode;if(0==(64&c.effectTag)&&("function"==typeof y.getDerivedStateFromError||null!==v&&"function"==typeof v.componentDidCatch&&(null===sc||!sc.has(v)))){c.effectTag|=4096,c.expirationTime=t,_i(c,Ca(c,s,t));break e}}c=c.return}while(null!==c)}Wa=Ac(Wa)}catch(e){t=e;continue}break}}function Ic(){var e=Aa.current;return Aa.current=As,null===e?As:e}function Rc(e,t){e<Qa&&2<e&&(Qa=e),null!==t&&e<Xa&&2<e&&(Xa=e,Ja=t)}function Oc(e){e>Za&&(Za=e)}function Cc(){for(;null!==Wa;)Wa=Dc(Wa)}function Pc(){for(;null!==Wa&&!Do();)Wa=Dc(Wa)}function Dc(e){var t=Pa(e.alternate,e,za);return e.memoizedProps=e.pendingProps,null===t&&(t=Ac(e)),xa.current=null,t}function Ac(e){Wa=e;do{var t=Wa.alternate;if(e=Wa.return,0==(2048&Wa.effectTag)){e:{var n=t,r=za,i=(t=Wa).pendingProps;switch(t.tag){case 2:case 16:break;case 15:case 0:break;case 1:Eo(t.type)&&So();break;case 3:Vi(),wo(),(i=t.stateNode).pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(null===n||null===n.child)&&qs(t)&&da(t),na(t);break;case 5:zi(t),r=$i(qi.current);var a=t.type;if(null!==n&&null!=t.stateNode)ra(n,t,a,i,r),n.ref!==t.ref&&(t.effectTag|=128);else if(i){var c=$i(Bi.current);if(qs(t)){var u=(i=t).stateNode;n=i.type;var l=i.memoizedProps,d=r;switch(u[ur]=i,u[lr]=l,a=void 0,r=u,n){case"iframe":case"object":case"embed":Tn("load",r);break;case"video":case"audio":for(u=0;u<Ze.length;u++)Tn(Ze[u],r);break;case"source":Tn("error",r);break;case"img":case"image":case"link":Tn("error",r),Tn("load",r);break;case"form":Tn("reset",r),Tn("submit",r);break;case"details":Tn("toggle",r);break;case"input":Re(r,l),Tn("invalid",r),$n(d,"onChange");break;case"select":r._wrapperState={wasMultiple:!!l.multiple},Tn("invalid",r),$n(d,"onChange");break;case"textarea":Ne(r,l),Tn("invalid",r),$n(d,"onChange")}for(a in Fn(n,l),u=null,l)l.hasOwnProperty(a)&&(c=l[a],"children"===a?"string"==typeof c?r.textContent!==c&&(u=["children",c]):"number"==typeof c&&r.textContent!==""+c&&(u=["children",""+c]):f.hasOwnProperty(a)&&null!=c&&$n(d,a));switch(n){case"input":ke(r),Pe(r,l,!0);break;case"textarea":ke(r),Le(r);break;case"select":case"option":break;default:"function"==typeof l.onClick&&(r.onclick=Gn)}a=u,i.updateQueue=a,(i=null!==a)&&da(t)}else{n=t,d=a,l=i,u=9===r.nodeType?r:r.ownerDocument,c===Ke.html&&(c=je(d)),c===Ke.html?"script"===d?((l=u.createElement("div")).innerHTML="<script><\/script>",u=l.removeChild(l.firstChild)):"string"==typeof l.is?u=u.createElement(d,{is:l.is}):(u=u.createElement(d),"select"===d&&(d=u,l.multiple?d.multiple=!0:l.size&&(d.size=l.size))):u=u.createElementNS(c,d),(l=u)[ur]=n,l[lr]=i,ta(l,t,!1,!1),t.stateNode=l;var h=r,p=qn(d=a,n=i);switch(d){case"iframe":case"object":case"embed":Tn("load",l),r=n;break;case"video":case"audio":for(r=0;r<Ze.length;r++)Tn(Ze[r],l);r=n;break;case"source":Tn("error",l),r=n;break;case"img":case"image":case"link":Tn("error",l),Tn("load",l),r=n;break;case"form":Tn("reset",l),Tn("submit",l),r=n;break;case"details":Tn("toggle",l),r=n;break;case"input":Re(l,n),r=Ie(l,n),Tn("invalid",l),$n(h,"onChange");break;case"option":r=Ae(l,n);break;case"select":l._wrapperState={wasMultiple:!!n.multiple},r=o({},n,{value:void 0}),Tn("invalid",l),$n(h,"onChange");break;case"textarea":Ne(l,n),r=Me(l,n),Tn("invalid",l),$n(h,"onChange");break;default:r=n}Fn(d,r),u=void 0,c=d;var g=l,m=r;for(u in m)if(m.hasOwnProperty(u)){var y=m[u];"style"===u?jn(g,y):"dangerouslySetInnerHTML"===u?null!=(y=y?y.__html:void 0)&&qe(g,y):"children"===u?"string"==typeof y?("textarea"!==c||""!==y)&&$e(g,y):"number"==typeof y&&$e(g,""+y):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(f.hasOwnProperty(u)?null!=y&&$n(h,u):null!=y&&Se(g,u,y,p))}switch(d){case"input":ke(l),Pe(l,n,!1);break;case"textarea":ke(l),Le(l);break;case"option":null!=n.value&&l.setAttribute("value",""+Ee(n.value));break;case"select":(r=l).multiple=!!n.multiple,null!=(l=n.value)?xe(r,!!n.multiple,l,!1):null!=n.defaultValue&&xe(r,!!n.multiple,n.defaultValue,!0);break;default:"function"==typeof r.onClick&&(l.onclick=Gn)}(i=nr(a,i))&&da(t)}null!==t.ref&&(t.effectTag|=128)}else if(null===t.stateNode)throw Error(s(166));break;case 6:if(n&&null!=t.stateNode)oa(n,t,n.memoizedProps,i);else{if("string"!=typeof i&&null===t.stateNode)throw Error(s(166));r=$i(qi.current),$i(Bi.current),qs(t)?(a=(i=t).stateNode,r=i.memoizedProps,a[ur]=i,(i=a.nodeValue!==r)&&da(t)):(a=t,(i=(9===r.nodeType?r:r.ownerDocument).createTextNode(i))[ur]=a,t.stateNode=i)}break;case 11:break;case 13:if(po(Hi),i=t.memoizedState,0!=(64&t.effectTag)){t.expirationTime=r;break e}i=null!==i,a=!1,null===n?void 0!==t.memoizedProps.fallback&&qs(t):(a=null!==(r=n.memoizedState),i||null===r||null!==(r=n.child.sibling)&&(null!==(l=t.firstEffect)?(t.firstEffect=r,r.nextEffect=l):(t.firstEffect=t.lastEffect=r,r.nextEffect=null),r.effectTag=8)),i&&!a&&0!=(2&t.mode)&&(null===n&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!=(1&Hi.current)?Ha===Ka&&(Ha=Fa):(Ha!==Ka&&Ha!==Fa||(Ha=qa),0!==Za&&null!==Va&&(tu(Va,za),nu(Va,Za)))),(i||a)&&(t.effectTag|=4);break;case 7:case 8:case 12:break;case 4:Vi(),na(t);break;case 10:ui(t);break;case 9:case 14:break;case 17:Eo(t.type)&&So();break;case 19:if(po(Hi),null===(i=t.memoizedState))break;if(a=0!=(64&t.effectTag),null===(l=i.rendering)){if(a)ha(i,!1);else if(Ha!==Ka||null!==n&&0!=(64&n.effectTag))for(n=t.child;null!==n;){if(null!==(l=Yi(n))){for(t.effectTag|=64,ha(i,!1),null!==(a=l.updateQueue)&&(t.updateQueue=a,t.effectTag|=4),null===i.lastEffect&&(t.firstEffect=null),t.lastEffect=i.lastEffect,i=r,a=t.child;null!==a;)n=i,(r=a).effectTag&=2,r.nextEffect=null,r.firstEffect=null,r.lastEffect=null,null===(l=r.alternate)?(r.childExpirationTime=0,r.expirationTime=n,r.child=null,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null):(r.childExpirationTime=l.childExpirationTime,r.expirationTime=l.expirationTime,r.child=l.child,r.memoizedProps=l.memoizedProps,r.memoizedState=l.memoizedState,r.updateQueue=l.updateQueue,n=l.dependencies,r.dependencies=null===n?null:{expirationTime:n.expirationTime,firstContext:n.firstContext,responders:n.responders}),a=a.sibling;go(Hi,1&Hi.current|2),t=t.child;break e}n=n.sibling}}else{if(!a)if(null!==(n=Yi(l))){if(t.effectTag|=64,a=!0,null!==(r=n.updateQueue)&&(t.updateQueue=r,t.effectTag|=4),ha(i,!0),null===i.tail&&"hidden"===i.tailMode){null!==(t=t.lastEffect=i.lastEffect)&&(t.nextEffect=null);break}}else Wo()>i.tailExpiration&&1<r&&(t.effectTag|=64,a=!0,ha(i,!1),t.expirationTime=t.childExpirationTime=r-1);i.isBackwards?(l.sibling=t.child,t.child=l):(null!==(r=i.last)?r.sibling=l:t.child=l,i.last=l)}if(null!==i.tail){0===i.tailExpiration&&(i.tailExpiration=Wo()+500),r=i.tail,i.rendering=r,i.tail=r.sibling,i.lastEffect=t.lastEffect,r.sibling=null,i=Hi.current,go(Hi,i=a?1&i|2:1&i),t=r;break e}break;case 20:case 21:break;default:throw Error(s(156,t.tag))}t=null}if(i=Wa,1===za||1!==i.childExpirationTime){for(a=0,r=i.child;null!==r;)(n=r.expirationTime)>a&&(a=n),(l=r.childExpirationTime)>a&&(a=l),r=r.sibling;i.childExpirationTime=a}if(null!==t)return t;null!==e&&0==(2048&e.effectTag)&&(null===e.firstEffect&&(e.firstEffect=Wa.firstEffect),null!==Wa.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=Wa.firstEffect),e.lastEffect=Wa.lastEffect),1<Wa.effectTag&&(null!==e.lastEffect?e.lastEffect.nextEffect=Wa:e.firstEffect=Wa,e.lastEffect=Wa))}else{if(null!==(t=fa(Wa)))return t.effectTag&=2047,t;null!==e&&(e.firstEffect=e.lastEffect=null,e.effectTag|=2048)}if(null!==(t=Wa.sibling))return t;Wa=e}while(null!==Wa);return Ha===Ka&&(Ha=$a),null}function xc(e){var t=e.expirationTime;return t>(e=e.childExpirationTime)?t:e}function Mc(e){var t=zo();return Yo(99,Nc.bind(null,e,t)),null}function Nc(e,t){if(Lc(),(Ga&(Ua|La))!==Ma)throw Error(s(327));var n=e.finishedWork,r=e.finishedExpirationTime;if(null===n)return null;if(e.finishedWork=null,e.finishedExpirationTime=0,n===e.current)throw Error(s(177));e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90,e.nextKnownPendingLevel=0;var o=xc(n);if(e.firstPendingTime=o,r<=e.lastSuspendedTime?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:r<=e.firstSuspendedTime&&(e.firstSuspendedTime=r-1),r<=e.lastPingedTime&&(e.lastPingedTime=0),r<=e.lastExpiredTime&&(e.lastExpiredTime=0),e===Va&&(Wa=Va=null,za=0),1<n.effectTag?null!==n.lastEffect?(n.lastEffect.nextEffect=n,o=n.firstEffect):o=n:o=n.firstEffect,null!==o){var i=Ga;Ga|=La,xa.current=null,er=kn;var a=Hn();if(Yn(a)){if("selectionStart"in a)var c={start:a.selectionStart,end:a.selectionEnd};else e:{var u=(c=(c=a.ownerDocument)&&c.defaultView||window).getSelection&&c.getSelection();if(u&&0!==u.rangeCount){c=u.anchorNode;var l=u.anchorOffset,d=u.focusNode;u=u.focusOffset;try{c.nodeType,d.nodeType}catch(e){c=null;break e}var h=0,f=-1,p=-1,g=0,m=0,y=a,v=null;t:for(;;){for(var _;y!==c||0!==l&&3!==y.nodeType||(f=h+l),y!==d||0!==u&&3!==y.nodeType||(p=h+u),3===y.nodeType&&(h+=y.nodeValue.length),null!==(_=y.firstChild);)v=y,y=_;for(;;){if(y===a)break t;if(v===c&&++g===l&&(f=h),v===d&&++m===u&&(p=h),null!==(_=y.nextSibling))break;v=(y=v).parentNode}y=_}c=-1===f||-1===p?null:{start:f,end:p}}else c=null}c=c||{start:0,end:0}}else c=null;tr={focusedElem:a,selectionRange:c},kn=!1,rc=o;do{try{Uc()}catch(e){if(null===rc)throw Error(s(330));Bc(rc,e),rc=rc.nextEffect}}while(null!==rc);rc=o;do{try{for(a=e,c=t;null!==rc;){var b=rc.effectTag;if(16&b&&$e(rc.stateNode,""),128&b){var E=rc.alternate;if(null!==E){var S=E.ref;null!==S&&("function"==typeof S?S(null):S.current=null)}}switch(1038&b){case 2:wa(rc),rc.effectTag&=-3;break;case 6:wa(rc),rc.effectTag&=-3,Ta(rc.alternate,rc);break;case 1024:rc.effectTag&=-1025;break;case 1028:rc.effectTag&=-1025,Ta(rc.alternate,rc);break;case 4:Ta(rc.alternate,rc);break;case 8:ka(a,l=rc,c),Ea(l)}rc=rc.nextEffect}}catch(e){if(null===rc)throw Error(s(330));Bc(rc,e),rc=rc.nextEffect}}while(null!==rc);if(S=tr,E=Hn(),b=S.focusedElem,c=S.selectionRange,E!==b&&b&&b.ownerDocument&&function e(t,n){return!(!t||!n)&&(t===n||(!t||3!==t.nodeType)&&(n&&3===n.nodeType?e(t,n.parentNode):"contains"in t?t.contains(n):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(n))))}(b.ownerDocument.documentElement,b)){null!==c&&Yn(b)&&(E=c.start,void 0===(S=c.end)&&(S=E),"selectionStart"in b?(b.selectionStart=E,b.selectionEnd=Math.min(S,b.value.length)):(S=(E=b.ownerDocument||document)&&E.defaultView||window).getSelection&&(S=S.getSelection(),l=b.textContent.length,a=Math.min(c.start,l),c=void 0===c.end?a:Math.min(c.end,l),!S.extend&&a>c&&(l=c,c=a,a=l),l=zn(b,a),d=zn(b,c),l&&d&&(1!==S.rangeCount||S.anchorNode!==l.node||S.anchorOffset!==l.offset||S.focusNode!==d.node||S.focusOffset!==d.offset)&&((E=E.createRange()).setStart(l.node,l.offset),S.removeAllRanges(),a>c?(S.addRange(E),S.extend(d.node,d.offset)):(E.setEnd(d.node,d.offset),S.addRange(E))))),E=[];for(S=b;S=S.parentNode;)1===S.nodeType&&E.push({element:S,left:S.scrollLeft,top:S.scrollTop});for("function"==typeof b.focus&&b.focus(),b=0;b<E.length;b++)(S=E[b]).element.scrollLeft=S.left,S.element.scrollTop=S.top}tr=null,kn=!!er,er=null,e.current=n,rc=o;do{try{for(b=r;null!==rc;){var w=rc.effectTag;if(36&w){var k=rc.alternate;switch(S=b,(E=rc).tag){case 0:case 11:case 15:_a(16,32,E);break;case 1:var T=E.stateNode;if(4&E.effectTag)if(null===k)T.componentDidMount();else{var I=E.elementType===E.type?k.memoizedProps:ni(E.type,k.memoizedProps);T.componentDidUpdate(I,k.memoizedState,T.__reactInternalSnapshotBeforeUpdate)}var R=E.updateQueue;null!==R&&wi(0,R,T);break;case 3:var O=E.updateQueue;if(null!==O){if(a=null,null!==E.child)switch(E.child.tag){case 5:a=E.child.stateNode;break;case 1:a=E.child.stateNode}wi(0,O,a)}break;case 5:var C=E.stateNode;null===k&&4&E.effectTag&&nr(E.type,E.memoizedProps)&&C.focus();break;case 6:case 4:case 12:break;case 13:if(null===E.memoizedState){var P=E.alternate;if(null!==P){var D=P.memoizedState;if(null!==D){var A=D.dehydrated;null!==A&&Tt(A)}}}break;case 19:case 17:case 20:case 21:break;default:throw Error(s(163))}}if(128&w){E=void 0;var x=rc.ref;if(null!==x){var M=rc.stateNode;switch(rc.tag){case 5:E=M;break;default:E=M}"function"==typeof x?x(E):x.current=E}}rc=rc.nextEffect}}catch(e){if(null===rc)throw Error(s(330));Bc(rc,e),rc=rc.nextEffect}}while(null!==rc);rc=null,Fo(),Ga=i}else e.current=n;if(ac)ac=!1,cc=e,uc=t;else for(rc=o;null!==rc;)t=rc.nextEffect,rc.nextEffect=null,rc=t;if(0===(t=e.firstPendingTime)&&(sc=null),1073741823===t?e===hc?dc++:(dc=0,hc=e):dc=0,"function"==typeof $c&&$c(n.stateNode,r),_c(e),oc)throw oc=!1,e=ic,ic=null,e;return(Ga&Na)!==Ma?null:(Jo(),null)}function Uc(){for(;null!==rc;){var e=rc.effectTag;0!=(256&e)&&va(rc.alternate,rc),0==(512&e)||ac||(ac=!0,Qo(97,(function(){return Lc(),null}))),rc=rc.nextEffect}}function Lc(){if(90!==uc){var e=97<uc?97:uc;return uc=90,Yo(e,Kc)}}function Kc(){if(null===cc)return!1;var e=cc;if(cc=null,(Ga&(Ua|La))!==Ma)throw Error(s(331));var t=Ga;for(Ga|=La,e=e.current.firstEffect;null!==e;){try{var n=e;if(0!=(512&n.effectTag))switch(n.tag){case 0:case 11:case 15:_a(128,0,n),_a(0,64,n)}}catch(t){if(null===e)throw Error(s(330));Bc(e,t)}n=e.nextEffect,e.nextEffect=null,e=n}return Ga=t,Jo(),!0}function jc(e,t,n){vi(e,t=Oa(e,t=pa(n,t),1073741823)),null!==(e=yc(e,1073741823))&&_c(e)}function Bc(e,t){if(3===e.tag)jc(e,e,t);else for(var n=e.return;null!==n;){if(3===n.tag){jc(n,e,t);break}if(1===n.tag){var r=n.stateNode;if("function"==typeof n.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===sc||!sc.has(r))){vi(n,e=Ca(n,e=pa(t,e),1073741823)),null!==(n=yc(n,1073741823))&&_c(n);break}}n=n.return}}function Fc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),Va===e&&za===n?Ha===qa||Ha===Fa&&1073741823===Qa&&Wo()-tc<nc?kc(e,za):ec=!0:eu(e,n)&&(0!==(t=e.lastPingedTime)&&t<n||(e.lastPingedTime=n,e.finishedExpirationTime===n&&(e.finishedExpirationTime=0,e.finishedWork=null),_c(e)))}function qc(e,t){var n=e.stateNode;null!==n&&n.delete(t),0===(t=0)&&(t=gc(t=pc(),e,null)),null!==(e=yc(e,t))&&_c(e)}Pa=function(e,t,n){var r=t.expirationTime;if(null!==e){var o=t.pendingProps;if(e.memoizedProps!==o||vo.current)Vs=!0;else{if(r<n){switch(Vs=!1,t.tag){case 3:ea(t),$s();break;case 5:if(Wi(t),4&t.mode&&1!==n&&o.hidden)return t.expirationTime=t.childExpirationTime=1,null;break;case 1:Eo(t.type)&&Io(t);break;case 4:Gi(t,t.stateNode.containerInfo);break;case 10:ci(t,t.memoizedProps.value);break;case 13:if(null!==t.memoizedState)return 0!==(r=t.child.childExpirationTime)&&r>=n?sa(e,t,n):(go(Hi,1&Hi.current),null!==(t=la(e,t,n))?t.sibling:null);go(Hi,1&Hi.current);break;case 19:if(r=t.childExpirationTime>=n,0!=(64&e.effectTag)){if(r)return ua(e,t,n);t.effectTag|=64}if(null!==(o=t.memoizedState)&&(o.rendering=null,o.tail=null),go(Hi,Hi.current),!r)return null}return la(e,t,n)}Vs=!1}}else Vs=!1;switch(t.expirationTime=0,t.tag){case 2:if(r=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,o=bo(t,yo.current),di(t,n),o=ps(null,t,r,e,o,n),t.effectTag|=1,"object"==typeof o&&null!==o&&"function"==typeof o.render&&void 0===o.$$typeof){if(t.tag=1,gs(),Eo(r)){var i=!0;Io(t)}else i=!1;t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null;var a=r.getDerivedStateFromProps;"function"==typeof a&&Ri(t,r,a,e),o.updater=Oi,t.stateNode=o,o._reactInternalFiber=t,Ai(t,r,e,n),t=Zs(null,t,r,!0,i,n)}else t.tag=0,Ws(null,t,o,n),t=t.child;return t;case 16:if(o=t.elementType,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,function(e){if(-1===e._status){e._status=0;var t=e._ctor;t=t(),e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}}(o),1!==o._status)throw o._result;switch(o=o._result,t.type=o,i=t.tag=function(e){if("function"==typeof e)return zc(e)?1:0;if(null!=e){if((e=e.$$typeof)===G)return 11;if(e===z)return 14}return 2}(o),e=ni(o,e),i){case 0:t=Xs(null,t,o,e,n);break;case 1:t=Js(null,t,o,e,n);break;case 11:t=zs(null,t,o,e,n);break;case 14:t=Hs(null,t,o,ni(o.type,e),r,n);break;default:throw Error(s(306,o,""))}return t;case 0:return r=t.type,o=t.pendingProps,Xs(e,t,r,o=t.elementType===r?o:ni(r,o),n);case 1:return r=t.type,o=t.pendingProps,Js(e,t,r,o=t.elementType===r?o:ni(r,o),n);case 3:if(ea(t),null===(r=t.updateQueue))throw Error(s(282));if(o=null!==(o=t.memoizedState)?o.element:null,Si(t,r,t.pendingProps,null,n),(r=t.memoizedState.element)===o)$s(),t=la(e,t,n);else{if((o=t.stateNode.hydrate)&&(Us=sr(t.stateNode.containerInfo.firstChild),Ns=t,o=Ls=!0),o)for(n=Ki(t,null,r,n),t.child=n;n;)n.effectTag=-3&n.effectTag|1024,n=n.sibling;else Ws(e,t,r,n),$s();t=t.child}return t;case 5:return Wi(t),null===e&&Bs(t),r=t.type,o=t.pendingProps,i=null!==e?e.memoizedProps:null,a=o.children,rr(r,o)?a=null:null!==i&&rr(r,i)&&(t.effectTag|=16),Qs(e,t),4&t.mode&&1!==n&&o.hidden?(t.expirationTime=t.childExpirationTime=1,t=null):(Ws(e,t,a,n),t=t.child),t;case 6:return null===e&&Bs(t),null;case 13:return sa(e,t,n);case 4:return Gi(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Li(t,null,r,n):Ws(e,t,r,n),t.child;case 11:return r=t.type,o=t.pendingProps,zs(e,t,r,o=t.elementType===r?o:ni(r,o),n);case 7:return Ws(e,t,t.pendingProps,n),t.child;case 8:case 12:return Ws(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,o=t.pendingProps,a=t.memoizedProps,ci(t,i=o.value),null!==a){var c=a.value;if(0===(i=eo(c,i)?0:0|("function"==typeof r._calculateChangedBits?r._calculateChangedBits(c,i):1073741823))){if(a.children===o.children&&!vo.current){t=la(e,t,n);break e}}else for(null!==(c=t.child)&&(c.return=t);null!==c;){var u=c.dependencies;if(null!==u){a=c.child;for(var l=u.firstContext;null!==l;){if(l.context===r&&0!=(l.observedBits&i)){1===c.tag&&((l=mi(n,null)).tag=2,vi(c,l)),c.expirationTime<n&&(c.expirationTime=n),null!==(l=c.alternate)&&l.expirationTime<n&&(l.expirationTime=n),li(c.return,n),u.expirationTime<n&&(u.expirationTime=n);break}l=l.next}}else a=10===c.tag&&c.type===t.type?null:c.child;if(null!==a)a.return=c;else for(a=c;null!==a;){if(a===t){a=null;break}if(null!==(c=a.sibling)){c.return=a.return,a=c;break}a=a.return}c=a}}Ws(e,t,o.children,n),t=t.child}return t;case 9:return o=t.type,r=(i=t.pendingProps).children,di(t,n),r=r(o=hi(o,i.unstable_observedBits)),t.effectTag|=1,Ws(e,t,r,n),t.child;case 14:return i=ni(o=t.type,t.pendingProps),Hs(e,t,o,i=ni(o.type,i),r,n);case 15:return Ys(e,t,t.type,t.pendingProps,r,n);case 17:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:ni(r,o),null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),t.tag=1,Eo(r)?(e=!0,Io(t)):e=!1,di(t,n),Pi(t,r,o),Ai(t,r,o,n),Zs(null,t,r,!0,e,n);case 19:return ua(e,t,n)}throw Error(s(156,t.tag))};var $c=null,Gc=null;function Vc(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function Wc(e,t,n,r){return new Vc(e,t,n,r)}function zc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Hc(e,t){var n=e.alternate;return null===n?((n=Wc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.effectTag=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childExpirationTime=e.childExpirationTime,n.expirationTime=e.expirationTime,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{expirationTime:t.expirationTime,firstContext:t.firstContext,responders:t.responders},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Yc(e,t,n,r,o,i){var a=2;if(r=e,"function"==typeof e)zc(e)&&(a=1);else if("string"==typeof e)a=5;else e:switch(e){case K:return Qc(n.children,o,i,t);case $:a=8,o|=7;break;case j:a=8,o|=1;break;case B:return(e=Wc(12,n,t,8|o)).elementType=B,e.type=B,e.expirationTime=i,e;case V:return(e=Wc(13,n,t,o)).type=V,e.elementType=V,e.expirationTime=i,e;case W:return(e=Wc(19,n,t,o)).elementType=W,e.expirationTime=i,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case F:a=10;break e;case q:a=9;break e;case G:a=11;break e;case z:a=14;break e;case H:a=16,r=null;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=Wc(a,n,t,o)).elementType=e,t.type=r,t.expirationTime=i,t}function Qc(e,t,n,r){return(e=Wc(7,e,r,t)).expirationTime=n,e}function Xc(e,t,n){return(e=Wc(6,e,null,t)).expirationTime=n,e}function Jc(e,t,n){return(t=Wc(4,null!==e.children?e.children:[],e.key,t)).expirationTime=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Zc(e,t,n){this.tag=t,this.current=null,this.containerInfo=e,this.pingCache=this.pendingChildren=null,this.finishedExpirationTime=0,this.finishedWork=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=90,this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function eu(e,t){var n=e.firstSuspendedTime;return e=e.lastSuspendedTime,0!==n&&n>=t&&e<=t}function tu(e,t){var n=e.firstSuspendedTime,r=e.lastSuspendedTime;n<t&&(e.firstSuspendedTime=t),(r>t||0===n)&&(e.lastSuspendedTime=t),t<=e.lastPingedTime&&(e.lastPingedTime=0),t<=e.lastExpiredTime&&(e.lastExpiredTime=0)}function nu(e,t){t>e.firstPendingTime&&(e.firstPendingTime=t);var n=e.firstSuspendedTime;0!==n&&(t>=n?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:t>=e.lastSuspendedTime&&(e.lastSuspendedTime=t+1),t>e.nextKnownPendingLevel&&(e.nextKnownPendingLevel=t))}function ru(e,t){var n=e.lastExpiredTime;(0===n||n>t)&&(e.lastExpiredTime=t)}function ou(e,t,n,r){var o=t.current,i=pc(),a=Ti.suspense;i=gc(i,o,a);e:if(n){t:{if(et(n=n._reactInternalFiber)!==n||1!==n.tag)throw Error(s(170));var c=n;do{switch(c.tag){case 3:c=c.stateNode.context;break t;case 1:if(Eo(c.type)){c=c.stateNode.__reactInternalMemoizedMergedChildContext;break t}}c=c.return}while(null!==c);throw Error(s(171))}if(1===n.tag){var u=n.type;if(Eo(u)){n=To(n,u,c);break e}}n=c}else n=mo;return null===t.context?t.context=n:t.pendingContext=n,(t=mi(i,a)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),vi(o,t),mc(o,i),i}function iu(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 5:default:return e.child.stateNode}}function su(e,t){null!==(e=e.memoizedState)&&null!==e.dehydrated&&e.retryTime<t&&(e.retryTime=t)}function au(e,t){su(e,t),(e=e.alternate)&&su(e,t)}function cu(e,t,n){var r=new Zc(e,t,n=null!=n&&!0===n.hydrate),o=Wc(3,null,null,2===t?7:1===t?3:0);r.current=o,o.stateNode=r,e[dr]=r.current,n&&0!==t&&function(e){var t=Mn(e);gt.forEach((function(n){Nn(n,e,t)})),mt.forEach((function(n){Nn(n,e,t)}))}(9===e.nodeType?e:e.ownerDocument),this._internalRoot=r}function uu(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function lu(e,t,n,r,o){var i=n._reactRootContainer;if(i){var s=i._internalRoot;if("function"==typeof o){var a=o;o=function(){var e=iu(s);a.call(e)}}ou(t,s,e,o)}else{if(i=n._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new cu(e,0,t?{hydrate:!0}:void 0)}(n,r),s=i._internalRoot,"function"==typeof o){var c=o;o=function(){var e=iu(s);c.call(e)}}wc((function(){ou(t,s,e,o)}))}return iu(s)}function du(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!uu(t))throw Error(s(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:L,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)}ot=function(e){if(13===e.tag){var t=ti(pc(),150,100);mc(e,t),au(e,t)}},it=function(e){if(13===e.tag){pc();var t=ei++;mc(e,t),au(e,t)}},st=function(e){if(13===e.tag){var t=pc();mc(e,t=gc(t,e,null)),au(e,t)}},ee=function(e,t,n){switch(t){case"input":if(Ce(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var o=gr(r);if(!o)throw Error(s(90));Te(r),Ce(r,o)}}}break;case"textarea":Ue(e,n);break;case"select":null!=(t=n.value)&&xe(e,!!n.multiple,t,!1)}},cu.prototype.render=function(e,t){ou(e,this._internalRoot,null,void 0===t?null:t)},cu.prototype.unmount=function(e){ou(null,this._internalRoot,null,void 0===e?null:e)},se=Sc,ae=function(e,t,n,r){var o=Ga;Ga|=4;try{return Yo(98,e.bind(null,t,n,r))}finally{(Ga=o)===Ma&&Jo()}},ce=function(){(Ga&(1|Ua|La))===Ma&&(function(){if(null!==lc){var e=lc;lc=null,e.forEach((function(e,t){ru(t,e),_c(t)})),Jo()}}(),Lc())},ue=function(e,t){var n=Ga;Ga|=2;try{return e(t)}finally{(Ga=n)===Ma&&Jo()}};var hu,fu,pu={createPortal:du,findDOMNode:function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternalFiber;if(void 0===t){if("function"==typeof e.render)throw Error(s(188));throw Error(s(268,Object.keys(e)))}return e=null===(e=rt(t))?null:e.stateNode},hydrate:function(e,t,n){if(!uu(t))throw Error(s(200));return lu(null,e,t,!0,n)},render:function(e,t,n){if(!uu(t))throw Error(s(200));return lu(null,e,t,!1,n)},unstable_renderSubtreeIntoContainer:function(e,t,n,r){if(!uu(n))throw Error(s(200));if(null==e||void 0===e._reactInternalFiber)throw Error(s(38));return lu(e,t,n,!1,r)},unmountComponentAtNode:function(e){if(!uu(e))throw Error(s(40));return!!e._reactRootContainer&&(wc((function(){lu(null,null,e,!1,(function(){e._reactRootContainer=null}))})),!0)},unstable_createPortal:function(){return du.apply(void 0,arguments)},unstable_batchedUpdates:Sc,flushSync:function(e,t){if((Ga&(Ua|La))!==Ma)throw Error(s(187));var n=Ga;Ga|=1;try{return Yo(99,e.bind(null,t))}finally{Ga=n,Jo()}},__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{Events:[fr,pr,gr,D.injectEventPluginsByName,h,At,function(e){R(e,Dt)},oe,ie,Pn,P,Lc,{current:!1}]}};fu=(hu={findFiberByHostInstance:hr,bundleType:0,version:"16.11.0",rendererPackageName:"react-dom"}).findFiberByHostInstance,function(e){if("undefined"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)return!0;try{var n=t.inject(e);$c=function(e){try{t.onCommitFiberRoot(n,e,void 0,64==(64&e.current.effectTag))}catch(e){}},Gc=function(e){try{t.onCommitFiberUnmount(n,e)}catch(e){}}}catch(e){}}(o({},hu,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=rt(e))?null:e.stateNode},findFiberByHostInstance:function(e){return fu?fu(e):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}));var gu={default:pu},mu=gu&&pu||gu;e.exports=mu.default||mu},function(e,t,n){"use strict";e.exports=n(57)},function(e,t,n){"use strict";
/** @license React v0.17.0
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r,o,i,s,a;if(Object.defineProperty(t,"__esModule",{value:!0}),"undefined"==typeof window||"function"!=typeof MessageChannel){var c=null,u=null,l=function(){if(null!==c)try{var e=t.unstable_now();c(!0,e),c=null}catch(e){throw setTimeout(l,0),e}},d=Date.now();t.unstable_now=function(){return Date.now()-d},r=function(e){null!==c?setTimeout(r,0,e):(c=e,setTimeout(l,0))},o=function(e,t){u=setTimeout(e,t)},i=function(){clearTimeout(u)},s=function(){return!1},a=t.unstable_forceFrameRate=function(){}}else{var h=window.performance,f=window.Date,p=window.setTimeout,g=window.clearTimeout,m=window.requestAnimationFrame,y=window.cancelAnimationFrame;if("undefined"!=typeof console&&("function"!=typeof m&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),"function"!=typeof y&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills")),"object"==typeof h&&"function"==typeof h.now)t.unstable_now=function(){return h.now()};else{var v=f.now();t.unstable_now=function(){return f.now()-v}}var _=!1,b=null,E=-1,S=5,w=0;s=function(){return t.unstable_now()>=w},a=function(){},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):S=0<e?Math.floor(1e3/e):33.33};var k=new MessageChannel,T=k.port2;k.port1.onmessage=function(){if(null!==b){var e=t.unstable_now();w=e+S;try{b(!0,e)?T.postMessage(null):(_=!1,b=null)}catch(e){throw T.postMessage(null),e}}else _=!1},r=function(e){b=e,_||(_=!0,T.postMessage(null))},o=function(e,n){E=p((function(){e(t.unstable_now())}),n)},i=function(){g(E),E=-1}}function I(e,t){var n=e.length;e.push(t);e:for(;;){var r=Math.floor((n-1)/2),o=e[r];if(!(void 0!==o&&0<C(o,t)))break e;e[r]=t,e[n]=o,n=r}}function R(e){return void 0===(e=e[0])?null:e}function O(e){var t=e[0];if(void 0!==t){var n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,o=e.length;r<o;){var i=2*(r+1)-1,s=e[i],a=i+1,c=e[a];if(void 0!==s&&0>C(s,n))void 0!==c&&0>C(c,s)?(e[r]=c,e[a]=n,r=a):(e[r]=s,e[i]=n,r=i);else{if(!(void 0!==c&&0>C(c,n)))break e;e[r]=c,e[a]=n,r=a}}}return t}return null}function C(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}var P=[],D=[],A=1,x=null,M=3,N=!1,U=!1,L=!1;function K(e){for(var t=R(D);null!==t;){if(null===t.callback)O(D);else{if(!(t.startTime<=e))break;O(D),t.sortIndex=t.expirationTime,I(P,t)}t=R(D)}}function j(e){if(L=!1,K(e),!U)if(null!==R(P))U=!0,r(B);else{var t=R(D);null!==t&&o(j,t.startTime-e)}}function B(e,n){U=!1,L&&(L=!1,i()),N=!0;var r=M;try{for(K(n),x=R(P);null!==x&&(!(x.expirationTime>n)||e&&!s());){var a=x.callback;if(null!==a){x.callback=null,M=x.priorityLevel;var c=a(x.expirationTime<=n);n=t.unstable_now(),"function"==typeof c?x.callback=c:x===R(P)&&O(P),K(n)}else O(P);x=R(P)}if(null!==x)var u=!0;else{var l=R(D);null!==l&&o(j,l.startTime-n),u=!1}return u}finally{x=null,M=r,N=!1}}function F(e){switch(e){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1e4;default:return 5e3}}var q=a;t.unstable_ImmediatePriority=1,t.unstable_UserBlockingPriority=2,t.unstable_NormalPriority=3,t.unstable_IdlePriority=5,t.unstable_LowPriority=4,t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=M;M=e;try{return t()}finally{M=n}},t.unstable_next=function(e){switch(M){case 1:case 2:case 3:var t=3;break;default:t=M}var n=M;M=t;try{return e()}finally{M=n}},t.unstable_scheduleCallback=function(e,n,s){var a=t.unstable_now();if("object"==typeof s&&null!==s){var c=s.delay;c="number"==typeof c&&0<c?a+c:a,s="number"==typeof s.timeout?s.timeout:F(e)}else s=F(e),c=a;return e={id:A++,callback:n,priorityLevel:e,startTime:c,expirationTime:s=c+s,sortIndex:-1},c>a?(e.sortIndex=c,I(D,e),null===R(P)&&e===R(D)&&(L?i():L=!0,o(j,c-a))):(e.sortIndex=s,I(P,e),U||N||(U=!0,r(B))),e},t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_wrapCallback=function(e){var t=M;return function(){var n=M;M=t;try{return e.apply(this,arguments)}finally{M=n}}},t.unstable_getCurrentPriorityLevel=function(){return M},t.unstable_shouldYield=function(){var e=t.unstable_now();K(e);var n=R(P);return n!==x&&null!==x&&null!==n&&null!==n.callback&&n.startTime<=e&&n.expirationTime<x.expirationTime||s()},t.unstable_requestPaint=q,t.unstable_continueExecution=function(){U||N||(U=!0,r(B))},t.unstable_pauseExecution=function(){},t.unstable_getFirstCallbackNode=function(){return R(P)},t.unstable_Profiling=null},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=c(n(11)),i=(c(n(30)),function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(61))),s=n(116),a=c(n(122));function c(e){return e&&e.__esModule?e:{default:e}}n(123);var u="https://matrix.rhok.space",l="@anonymouscat:rhok.space",d="Support Chat",h=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n.leaveRoom=function(){n.state.room_id&&n.state.client.leave(n.state.room_id).then((function(e){console.log("Left room",e)}))},n.createRoom=function(){return n.state.client.createRoom({room_alias_name:"private-support-chat-"+(0,s.uuid)(),invite:[l],visibility:"private",name:d}).then((function(e){n.setState({room_id:e.room_id})}))},n.sendMessage=function(){var e={body:n.state.inputValue,msgtype:"m.text"};n.state.client.sendEvent(n.state.room_id,"m.room.message",e,"").then((function(e){n.setState({inputValue:""}),n.chatboxInput.current.focus()})).catch((function(e){console.log(e)}))},n.handleInputChange=function(e){n.setState({inputValue:e.currentTarget.value})},n.handleSubmit=function(e){return e.preventDefault(),Boolean(n.state.inputValue)?n.state.room_id?void n.sendMessage():n.createRoom().then(n.sendMessage):null};var r=i.createClient(u);return n.state={client:r,ready:!1,rooms:{chunk:[]},access_token:null,user_id:null,messages:[],inputValue:""},n.chatboxInput=o.default.createRef(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"componentDidMount",value:function(){var e=this;this.state.client.registerRequest({}).then((function(e){console.log("Empty registration request to get session",e)})).catch((function(t){var n=(0,s.uuid)(),r=(0,s.uuid)();e.state.client.registerRequest({auth:{session:t.data.session,type:"m.login.dummy"},inhibit_login:!1,password:r,username:n,x_show_msisdn:!0}).then((function(t){console.log("Registered user",t),e.setState({access_token:t.access_token,user_id:t.user_id,username:n,client:i.createClient({baseUrl:u,accessToken:t.access_token,userId:t.user_id})})})).catch((function(e){console.log("Registration error",e)}))}))}},{key:"componentDidUpdate",value:function(e,t){var n=this;t.client!==this.state.client&&(this.state.client.startClient(),this.state.client.once("sync",(function(e,t,r){"PREPARED"===e&&n.setState({ready:!0})})),this.state.client.on("Room.timeline",(function(e,t,r){if("m.room.message"===e.getType()){var o=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(n.state.messages));o.push(e),n.setState({messages:o})}})))}},{key:"componentWillUnmount",value:function(){this.leaveRoom()}},{key:"render",value:function(){var e=this.state,t=e.ready,n=e.messages,r=e.inputValue,i=e.user_id;return t?o.default.createElement("div",{id:"ocrcc-chatbox"},o.default.createElement("div",{className:"message-window"},n.map((function(e,t){return o.default.createElement(a.default,{key:e.event.event_id,message:e,user_id:i})}))),o.default.createElement("div",{className:"input-window"},o.default.createElement("form",{onSubmit:this.handleSubmit},o.default.createElement("input",{type:"text",onChange:this.handleInputChange,value:r,autoFocus:!0,ref:this.chatboxInput}),o.default.createElement("input",{type:"submit",value:"Send"})))):o.default.createElement("div",{className:"loader"},"loading...")}}]),t}(o.default.Component);h.propTypes={},h.defaultProps={},t.default=h},function(e,t,n){"use strict";var r=n(60);function o(){}function i(){}i.resetWarningCache=o,e.exports=function(){function e(e,t,n,o,i,s){if(s!==r){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:i,resetWarningCache:o};return n.PropTypes=n,n}},function(e,t,n){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(e,t,n){"use strict";(function(e){var r=n(5),o=n(1);Object.defineProperty(t,"__esModule",{value:!0});var i={};t.default=void 0;var s=o(n(31));Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}}))}));var a=r(n(112)),c=r(n(113));let u;s.request((function(e,t){return e.qs=c.default.stringify(e.qs||{},e.qsStringifyOptions),(0,a.default)(e,t)}));try{u=e.indexedDB}catch(e){}u&&s.setCryptoStoreFactory((function(){return new s.IndexedDBCryptoStore(u,"matrix-js-sdk:crypto")}));var l=s;t.default=l,e.matrixcs=s}).call(this,n(3))},function(e,t){function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=n=function(e){return typeof e}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(t)}e.exports=n},function(e,t,n){var r,o;!function(i,s){"use strict";void 0===(o="function"==typeof(r=function(){var e=function(){},t="undefined",n=typeof window!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"];function o(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function i(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function s(t,n){for(var o=0;o<r.length;o++){var i=r[o];this[i]=o<t?e:this.methodFactory(i,t,n)}this.log=this.debug}function a(e,n,r){return function(){typeof console!==t&&(s.call(this,n,r),this[e].apply(this,arguments))}}function c(r,s,c){return function(r){return"debug"===r&&(r="log"),typeof console!==t&&("trace"===r&&n?i:void 0!==console[r]?o(console,r):void 0!==console.log?o(console,"log"):e)}(r)||a.apply(this,arguments)}function u(e,n,o){var i,a=this,u="loglevel";function l(){var e;if(typeof window!==t){try{e=window.localStorage[u]}catch(e){}if(typeof e===t)try{var n=window.document.cookie,r=n.indexOf(encodeURIComponent(u)+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r))[1])}catch(e){}return void 0===a.levels[e]&&(e=void 0),e}}e&&(u+=":"+e),a.name=e,a.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},a.methodFactory=o||c,a.getLevel=function(){return i},a.setLevel=function(n,o){if("string"==typeof n&&void 0!==a.levels[n.toUpperCase()]&&(n=a.levels[n.toUpperCase()]),!("number"==typeof n&&n>=0&&n<=a.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(i=n,!1!==o&&function(e){var n=(r[e]||"silent").toUpperCase();if(typeof window!==t){try{return void(window.localStorage[u]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(u)+"="+n+";"}catch(e){}}}(n),s.call(a,n,e),typeof console===t&&n<a.levels.SILENT)return"No console available for logging"},a.setDefaultLevel=function(e){l()||a.setLevel(e,!1)},a.enableAll=function(e){a.setLevel(a.levels.TRACE,e)},a.disableAll=function(e){a.setLevel(a.levels.SILENT,e)};var d=l();null==d&&(d=null==n?"WARN":n),a.setLevel(d,!1)}var l=new u,d={};l.getLogger=function(e){if("string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=d[e];return t||(t=d[e]=new u(e,l.getLevel(),l.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return l.noConflict=function(){return typeof window!==t&&window.log===l&&(window.log=h),l},l.getLoggers=function(){return d},l})?r.call(t,n,t,e):r)||(e.exports=o)}()},function(e,t,n){"use strict";var r=n(65);var o=RegExp(Object.keys(r).map((function(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")})).join("|"),"g");function i(e){return r[e]}e.exports=function(e){return e.replace(o,i)}},function(e){e.exports=JSON.parse('{"0":"O","1":"l","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","\\u2028":" ","\\u2029":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":"_","":"_","":"_","":"_","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-.","":"","":",","":",","":",","":",","":",","":"","":"","":";","":"","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":"::=","":":","":"!","":"!","":"!","":"!!","":"!?","":"?","":"?","":"?","":"?","":"?","":"?!","":"??","":"","":".","":".","":".","":".","":".","":".","":".","":".","":".","":".,","":"..","":"..","":"...","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"<","":">","":">","":">","":"4","":"b","":"b","":"d","":"J","":"L","":"P","":"U","":"V","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","`":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'\'","\\"":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'\'","":"\'\'\'","":"\'\'\'\'","":"\'B","":"\'D","":"\'n","":"\'P","":"\'T","":"\'Y","":"(","":"(","":"(","":"(","":"(","":"((","":"()","":"(2)","":"(2O)","":"(3)","":"(4)","":"(5)","":"(6)","":"(7)","":"(8)","":"(9)","":"(a)","":"(A)","":"(b)","":"(B)","":"(c)","":"(C)","":"(d)","":"(D)","":"(e)","":"(E)","":"(f)","":"(F)","":"(g)","":"(G)","":"(h)","":"(H)","":"(i)","":"(j)","":"(J)","":"(k)","":"(K)","":"(l)","":"(l)","":"(l)","":"(L)","":"(l2)","":"(l3)","":"(l4)","":"(l5)","":"(l6)","":"(l7)","":"(l8)","":"(l9)","":"(ll)","":"(lO)","":"(M)","":"(n)","":"(N)","":"(o)","":"(O)","":"(p)","":"(P)","":"(q)","":"(Q)","":"(r)","":"(R)","":"(rn)","":"(s)","":"(S)","":"(S)","":"(t)","":"(T)","":"(u)","":"(U)","":"(v)","":"(V)","":"(w)","":"(W)","":"(x)","":"(X)","":"(y)","":"(Y)","":"(z)","":"(Z)","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":")","":")","":")","":")","":")","":"))","":"{","":"{","":"}","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"*","":"*","":"*","":"*","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"//","":"///","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\\\\\","":"\\\\\\\\","":"\\\\","":"&","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"^","":"^","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"b","":"bi","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"C","":"F","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"+","":"+","":"+","":"+","":"+","":"+","":"+","":"+","":"+","":"+","":"","":"<","":"<","":"<","":"<","":"<","":"<","":"<","":"<","":"<","":"<<","":"<<<","":"=","":"=","":"=","":"=","":"=","":"=","":"=","":"=","":"=","":"=","":"==","":"===","":"=","":">","":">","":">","":">","":">","":">","":">","":"><","":">>","":">>","":">>>","":"~","":"~","":"~","":"~","":"~","":"~","":"~","":"~","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"2","":"2","":"2","":"2","":"2","":"2","":"2","":"2","":"2","":"2","":"2","":"","":"","":"","":"","":"","":"","":"2","":"2,","":"2.","":"22","":"22","":"23","":"23","":"24","":"24","":"25","":"26","":"27","":"28","":"29","":"2l","":"2l","":"2O.","":"2O","":"2O","":"","":"","":"2","":"2","":"2","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"","":"","":"","":"","":"3","":"3,","":"3.","":"3l","":"3O","":"3","":"3","":"3","":"4","":"4","":"4","":"4","":"4","":"4","":"4","":"","":"","":"","":"4,","":"4.","":"4","":"4","":"4","":"4","":"5","":"5","":"5","":"5","":"5","":"5","":"5","":"","":"5,","":"5.","":"5","":"5","":"5","":"6","":"6","":"6","":"6","":"6","":"6","":"6","":"6","":"6","":"","":"","":"","":"6,","":"6.","":"6","":"6","":"6","":"7","":"7","":"7","":"7","":"7","":"7","":"7","":"7","":"","":"7,","":"7.","":"7","":"7","":"7","":"8","":"8","":"8","":"8","":"8","":"8","":"8","":"8","":"8","":"8","":"8","":"8","":"","":"","":"8,","":"8.","":"8","":"8","":"8","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"","":"","":"","":"","":"","":"9,","":"9.","":"9","":"9","":"9","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"","":"","":"","":"","":"","":"a/c","":"a/s","":"aa","":"AA","":"ae","":"ae","":"AE","":"AE","":"ao","":"AO","":"AR","":"au","":"AU","":"av","":"av","":"AV","":"AV","":"ay","":"AY","":"","":"","":"","":"","":"","":"","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b\'","":"bl","":"","":"","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"c","":"c","":"C","":"c","":"c","":"C","":"C","":"C\'","":"c/o","":"c/u","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"d","":"d","":"d","":"d","":"D","":"D","":"D","":"d","":"","":"d","":"d\'","":"d","":"dz","":"dz","":"Dz","":"DZ","":"d","":"D","":"D","":"d","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"","":"","":"e","":"E","":"e","":"","":"","":"","":"","":"","":"","":"","":"o","":"o","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"f","":"F","":"f","":"FAX","":"ff","":"ffi","":"ffl","":"fi","":"fl","":"f","":"","":"","":"","":"","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"","":"g","":"","":"","":"","":"g","":"G","":"G\'","":"","":"","":"","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"","":"h","":"h","":"h","":"H","":"H","":"h","":"h","":"h","":"H","":"H","":"H","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"","":"i","":"","":"","":"i","":"i","":"i","":"ii","":"iii","":"ij","":"iv","":"ix","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"j","":"J","":"J","":"","":"","":"","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"k","":"K","":"K","":"K","":"K","":"K","":"K\'","":"l","|":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","I":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"l","":"l","":"l","":"L","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l,","":"l.","":"l\'","":"l2.","":"l2","":"l2","":"l2","":"l3.","":"l3","":"l3","":"l4.","":"l4","":"l4","":"l5.","":"l5","":"l5","":"l6.","":"l6","":"l6","":"l7.","":"l7","":"l7","":"l8.","":"l8","":"l8","":"l9.","":"l9","":"l9","":"lj","":"lJ","":"Lj","":"LJ","":"ll","":"ll","":"ll","":"ll","":"ll","":"ll","":"ll.","":"lll","":"llS","":"ll","":"ll","":"ll","":"lO","":"lO.","":"lO","":"lO","":"lO","":"ls","":"lt","":"lV","":"lX","":"l","":"lz","":"l","":"l","":"l","":"l","":"l","":"l","":"lo","":"l","":"l","":"l","":"","":"","":"","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"MB","":"","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"N","":"n","":"nj","":"Nj","":"NJ","":"No","":"","":"","":"","":"","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"","":"","":"","":"","":"o","":"","":"o","":"o","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"O,","":"O.","":"o\'","":"O\'","":"O\'","%":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"oe","":"OE","":"o","":"oo","":"oo","":"oo","":"OO","":"OO","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"oo","":"o","":"O","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"e","":"","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"p","":"p","":"p","":"P\'","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"q","":"QE","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"r","":"r","":"r","":"r","":"r","":"r\'","":"rn","m":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"Rs","":"","":"","":"","":"","":"","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"s","":"s","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"sss","":"st","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"t","":"T","":"T","":"","":"T","":"T","":"T","":"t","":"T","":"t","":"","":"T3","":"t","":"TEL","":"tf","":"ts","":"t","":"t","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"","":"","":"u","":"u","":"U","":"U","":"U","":"U\'","":"ue","":"uo","":"","":"","":"","":"","":"","":"","":"","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"VB","":"vi","":"vii","":"viii","":"Vl","":"Vll","":"Vlll","":"V","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"w","":"w","":"W","":"w","":"","":"","":"","":"","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"x","":"X","":"X","":"xi","":"xii","":"Xl","":"Xll","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"y","":"y","":"y","":"Y","":"Y","":"Y","":"","":"","":"","":"","":"","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"z","":"z","":"Z","":"z","":"Z","":"z","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"i","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"\'","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"l","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"\'","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"o","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"o","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":" lo","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"l","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"o","":"o","":"o","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":" lo o ","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"l","":"l","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"l","":"l","":"l","":"l","":"l","":"l","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"l","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"o","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"o","":"o","":"o","":"","":"","":"","":"","":"","":"","":"l","":"l","":"o","":"o","":"o","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"\'","":"/","":"","":"","":"","":"","":"","":"\'","":"","":"","":"\'","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"<","":"b","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"b","":"b","":"d","":"P","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"J","":"","":"","":"","":"","":"","":"","":"","":"J","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""}')},function(e,t,n){"use strict";var r=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixScheduler=a;var o=r(n(2)),i=n(0);const s=!1;function a(e,t){this.retryAlgorithm=e||a.RETRY_BACKOFF_RATELIMIT,this.queueAlgorithm=t||a.QUEUE_MESSAGES,this._queues={},this._activeQueues=[],this._procFn=null}function c(e){e._procFn&&o.forEach(o.filter(o.keys(e._queues),(function(t){return-1===e._activeQueues.indexOf(t)&&e._queues[t].length>0})),(function(t){e._activeQueues.push(t),l("Spinning up queue: '%s'",t),function e(t,n){const r=function(e,t){const n=e._queues[t];if(!o.isArray(n))return null;return n[0]}(t,n);if(!r){const e=t._activeQueues.indexOf(n);return e>=0&&t._activeQueues.splice(e,1),void l("Stopping queue '%s' as it is now empty",n)}l("Queue '%s' has %s pending events",n,t._queues[n].length);Promise.resolve().then(()=>t._procFn(r.event)).then((function(o){u(t,n),l("Queue '%s' sent event %s",n,r.event.getId()),r.defer.resolve(o),e(t,n)}),(function(o){r.attempts+=1;const i=t.retryAlgorithm(r.event,r.attempts,o);l("retry(%s) err=%s event_id=%s waitTime=%s",r.attempts,o,r.event.getId(),i),-1===i?(l("Queue '%s' giving up on event %s",n,r.event.getId()),u(t,n),r.defer.reject(o),e(t,n)):setTimeout((function(){e(t,n)}),i)}))}(e,t)}))}function u(e,t){const n=e._queues[t];return o.isArray(n)?n.shift():null}function l(){s&&i.logger.log(...arguments)}a.prototype.getQueueForEvent=function(e){const t=this.queueAlgorithm(e);return t&&this._queues[t]?o.map(this._queues[t],(function(e){return e.event})):null},a.prototype.removeEventFromQueue=function(e){const t=this.queueAlgorithm(e);if(!t||!this._queues[t])return!1;let n=!1;return o.removeElement(this._queues[t],(function(t){if(t.event.getId()===e.getId())return n=!0,!0})),n},a.prototype.setProcessFunction=function(e){this._procFn=e,c(this)},a.prototype.queueEvent=function(e){const t=this.queueAlgorithm(e);if(!t)return null;this._queues[t]||(this._queues[t]=[]);const n=o.defer();return this._queues[t].push({event:e,defer:n,attempts:0}),l("Queue algorithm dumped event %s into queue '%s'",e.getId(),t),c(this),n.promise},a.RETRY_BACKOFF_RATELIMIT=function(e,t,n){if(400===n.httpStatus||403===n.httpStatus||401===n.httpStatus)return-1;if("rejected"===n.cors)return-1;if("M_TOO_LARGE"===n.name)return-1;if("M_LIMIT_EXCEEDED"===n.name){const e=n.data.retry_after_ms;if(e)return e}return t>4?-1:1e3*Math.pow(2,t)},a.QUEUE_MESSAGES=function(e){return"m.room.message"===e.getType()||e.hasAssocation()?"message":null}},function(e,t,n){"use strict";(function(e){var r=n(1),o=n(5);Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixClient=D,t.CRYPTO_ENABLED=void 0;var i=o(n(18)),s=n(4),a=n(74),c=n(20),u=n(78),l=n(6),d=n(8),h=n(82),f=n(84),p=n(38),g=r(n(2)),m=n(13),y=n(14),v=r(n(39)),_=r(n(7)),b=n(22),E=n(88),S=n(0),w=n(91),k=n(46),T=n(45),I=n(16),R=n(19);const O=(0,w.isCryptoAvailable)();t.CRYPTO_ENABLED=O;function C(e,t,n){const r=[];for(const[o,i]of Object.entries(e))try{const e=P(i,t);e.session_id=o,e.room_id=n,r.push(e)}catch(e){S.logger.log("Failed to decrypt megolm session from backup",e)}return r}function P(e,t){return JSON.parse(t.decrypt(e.session_data.ephemeral,e.session_data.mac,e.session_data.ciphertext))}function D(e){e.baseUrl=g.ensureNoTrailingSlash(e.baseUrl),e.idBaseUrl=g.ensureNoTrailingSlash(e.idBaseUrl),a.MatrixBaseApis.call(this,e),this.olmVersion=null,this.reEmitter=new b.ReEmitter(this),this.store=e.store||new f.StubStore,this.deviceId=e.deviceId||null;const t=e.userId||null;if(this.credentials={userId:t},this.scheduler=e.scheduler,this.scheduler){const e=this;this.scheduler.setProcessFunction((function(t){const n=e.getRoom(t.getRoomId());return t.status!==l.EventStatus.SENDING&&N(n,t,l.EventStatus.SENDING),U(e,t)}))}this.clientRunning=!1,this.callList={};const n=(0,p.createNewMatrixCall)(this);this._supportsVoip=!1,n&&(!function(e){const t={};let n=[];function r(){if("SYNCING"===e.getSyncState()){if(n.some(e=>e.isBeingDecrypted()))return;const e={};for(let t=n.length-1;t>=0;t--){const r=n[t];"m.call.answer"!==r.getType()&&"m.call.hangup"!==r.getType()||(e[r.getContent().call_id]="yep")}n.forEach((function(t){"m.call.invite"===t.getType()&&e[t.getContent().call_id]||o(t)})),n=[]}}function o(n){const r=n.getContent();let o,i=r.call_id?e.callList[r.call_id]:void 0;if("m.call.invite"===n.getType()){if(n.getSender()===e.credentials.userId)return;if(n.getAge()>r.lifetime)return;if(i&&"ended"===i.state)return;if(i&&S.logger.log("WARN: Already have a MatrixCall with id %s but got an invite. Clobbering.",r.call_id),!(i=(0,p.createNewMatrixCall)(e,n.getRoomId(),{forceTURN:e._forceTURN})))return void S.logger.log("Incoming call ID "+r.call_id+" but this client doesn't support WebRTC");if(i.callId=r.call_id,i._initWithInvite(n),e.callList[i.callId]=i,t[i.callId])for(o=0;o<t[i.callId].length;o++)i._gotRemoteIceCandidate(t[i.callId][o]);let s;const a=g.values(e.callList);for(o=0;o<a.length;++o){const e=a[o];if(i.roomId===e.roomId&&"outbound"===e.direction&&-1!==["wait_local_media","create_offer","invite_sent"].indexOf(e.state)){s=e;break}}s?"wait_local_media"===s.state||"create_offer"===s.state||s.callId>i.callId?(S.logger.log("Glare detected: answering incoming call "+i.callId+" and canceling outgoing call "+s.callId),s._replacedBy(i),i.answer()):(S.logger.log("Glare detected: rejecting incoming call "+i.callId+" and keeping outgoing call "+s.callId),i.hangup()):e.emit("Call.incoming",i)}else if("m.call.answer"===n.getType()){if(!i)return;n.getSender()===e.credentials.userId?"ringing"===i.state&&i._onAnsweredElsewhere(r):i._receivedAnswer(r)}else if("m.call.candidates"===n.getType()){if(n.getSender()===e.credentials.userId)return;if(i)for(o=0;o<r.candidates.length;o++)i._gotRemoteIceCandidate(r.candidates[o]);else t[r.call_id]||(t[r.call_id]=[]),t[r.call_id]=t[r.call_id].concat(r.candidates)}else"m.call.hangup"===n.getType()&&(i?"ended"!==i.state&&(i._onHangupReceived(r),delete e.callList[r.call_id]):(i=(0,p.createNewMatrixCall)(e,n.getRoomId()))&&(i.callId=r.call_id,i._initWithHangup(n),e.callList[r.call_id]=i))}e.on("sync",r),e.on("event",(function(e){(0===e.getType().indexOf("m.call.")||e.isBeingDecrypted())&&n.push(e),(e.isBeingDecrypted()||e.isDecryptionFailure())&&e.once("Event.decrypted",()=>{-1!==e.getType().indexOf("m.call.")&&(n.includes(e)?r():o(e))})}))}(this),this._supportsVoip=!0),this._syncingRetry=null,this._syncApi=null,this._peekSync=null,this._isGuest=!1,this._ongoingScrollbacks={},this.timelineSupport=Boolean(e.timelineSupport),this.urlPreviewCache={},this._notifTimelineSet=null,this.unstableClientRelationAggregation=!!e.unstableClientRelationAggregation,this._crypto=null,this._cryptoStore=e.cryptoStore,this._sessionStore=e.sessionStore,this._verificationMethods=e.verificationMethods,this._cryptoCallbacks=e.cryptoCallbacks||{},this._forceTURN=e.forceTURN||!1,this._fallbackICEServerAllowed=e.fallbackICEServerAllowed||!1,this._roomList=new E.RoomList(this._cryptoStore),this._pushProcessor=new R.PushProcessor(this),this._serverVersionsCache=null,this._cachedCapabilities=null,this.on("Event.decrypted",e=>{const t=e.getPushActions(),n=this._pushProcessor.actionsForEvent(e);e.setPushActions(n);const r=this.getRoom(e.getRoomId());if(!r)return;const o=r.getUnreadNotificationCount("highlight"),i=!(!t||!t.tweaks)&&!!t.tweaks.highlight,s=!(!n||!n.tweaks)&&!!n.tweaks.highlight;if((i!==s||o>0)&&!r.hasUserReadEvent(this.getUserId(),e.getId())){let e=o;s&&!i&&e++,!s&&i&&e--,r.setUnreadNotificationCount("highlight",e),r.getUnreadNotificationCount("total")<e&&r.setUnreadNotificationCount("total",e)}}),this.on("Room.receipt",(e,t)=>{if(t&&this.isRoomEncrypted(t.roomId)){const n=e.getContent();if(!(Object.keys(n).filter(e=>Object.keys(n[e]["m.read"]).includes(this.getUserId())).length>0))return;const r=20,o=t.getLiveTimeline().getEvents();let i=0;for(let e=o.length-1;e>=0;e--){if(e===o.length-r)return;const n=o[e];if(t.hasUserReadEvent(this.getUserId(),n.getId()))break;i+=this.getPushActionsForEvent(n).tweaks.highlight?1:0}t.setUnreadNotificationCount("highlight",i)}})}async function A(e,t,n,r,o,i){if(!e._crypto)throw new Error("End-to-End encryption disabled");await e._crypto.setDeviceVerification(t,n,r,o,i)}function x(e,t){for(const n of t)e.prototype[n]=function(...e){if(!this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto[n](...e)}}function M(e,t,n,r){return Promise.resolve().then((function(){const r=function(e,t,n){if(t.isEncrypted())return null;if(!e.isRoomEncrypted(t.getRoomId()))return null;if("m.reaction"===t.getType())return null;if(!e._crypto)throw new Error("This room is configured to use encryption, but your client does not support encryption.");return e._crypto.encryptEvent(t,n)}(e,n,t);return r?(N(t,n,l.EventStatus.ENCRYPTING),r.then(()=>{N(t,n,l.EventStatus.SENDING)})):null})).then((function(){let r;return e.scheduler&&(r=e.scheduler.queueEvent(n))&&e.scheduler.getQueueForEvent(n).length>1&&N(t,n,l.EventStatus.QUEUED),r||(r=U(e,n)),r})).then((function(e){return t&&t.updatePendingEvent(n,l.EventStatus.SENT,e.event_id),r&&r(null,e),e}),(function(e){S.logger.error("Error sending event",e.stack||e);try{n.error=e,N(t,n,l.EventStatus.NOT_SENT),e.event=n,r&&r(e)}catch(t){S.logger.error("Exception in error handler!",t.stack||e)}throw e}))}function N(e,t,n){e?e.updatePendingEvent(t,n):t.setStatus(n)}function U(e,t){const n=t._txnId?t._txnId:e.makeTxnId(),r={$roomId:t.getRoomId(),$eventType:t.getWireType(),$stateKey:t.getStateKey(),$txnId:n};let o;if(t.isState()){let e="/rooms/$roomId/state/$eventType";t.getStateKey()&&t.getStateKey().length>0&&(e="/rooms/$roomId/state/$eventType/$stateKey"),o=g.encodeUri(e,r)}else if(t.isRedaction()){const e="/rooms/$roomId/redact/$redactsEventId/$txnId";o=g.encodeUri(e,Object.assign({$redactsEventId:t.event.redacts},r))}else o=g.encodeUri("/rooms/$roomId/send/$eventType/$txnId",r);return e._http.authedRequest(void 0,"PUT",o,void 0,t.getWireContent()).then(e=>(S.logger.log(`Event sent to ${t.getRoomId()} with event id ${e.event_id}`),e))}function L(e,t,n,r,o,i){g.isFunction(o)&&(i=o,o=void 0);const s=g.encodeUri("/rooms/$room_id/$membership",{$room_id:t,$membership:r});return e._http.authedRequest(i,"POST",s,void 0,{user_id:n,reason:o})}function K(e,t,n,r){const o=g.encodeUri("/presence/list/$userId",{$userId:t.credentials.userId});return t._http.authedRequest(e,r,o,void 0,n)}function j(e,t,n){e&&e(n),t(n)}function B(e,t,n){e&&e(null,n),t(n)}function F(e){return function(t){const n=new l.MatrixEvent(t);n.isEncrypted()&&(e.reEmitter.reEmit(n,["Event.decrypted"]),n.attemptDecryption(e._crypto));const r=e.getRoom(n.getRoomId());return r&&r.reEmitter.reEmit(n,["Event.replaced"]),n}}g.inherits(D,s.EventEmitter),g.extend(D.prototype,a.MatrixBaseApis.prototype),D.prototype.clearStores=function(){if(this._clientRunning)throw new Error("Cannot clear stores while client is running");const e=[];return e.push(this.store.deleteAllData()),this._cryptoStore&&e.push(this._cryptoStore.deleteAllData()),Promise.all(e)},D.prototype.getUserId=function(){return this.credentials&&this.credentials.userId?this.credentials.userId:null},D.prototype.getDomain=function(){return this.credentials&&this.credentials.userId?this.credentials.userId.replace(/^.*?:/,""):null},D.prototype.getUserIdLocalpart=function(){return this.credentials&&this.credentials.userId?this.credentials.userId.split(":")[0].substring(1):null},D.prototype.getDeviceId=function(){return this.deviceId},D.prototype.supportsVoip=function(){return this._supportsVoip},D.prototype.setForceTURN=function(e){this._forceTURN=e},D.prototype.getSyncState=function(){return this._syncApi?this._syncApi.getSyncState():null},D.prototype.getSyncStateData=function(){return this._syncApi?this._syncApi.getSyncStateData():null},D.prototype.isInitialSyncComplete=function(){const e=this.getSyncState();return!!e&&("PREPAED"===e||"SYNCING"===e)},D.prototype.isGuest=function(){return this._isGuest},D.prototype.getScheduler=function(){return this.scheduler},D.prototype.setGuest=function(e){this._isGuest=e},D.prototype.retryImmediately=function(){return this._syncApi.retryImmediately()},D.prototype.getNotifTimelineSet=function(){return this._notifTimelineSet},D.prototype.setNotifTimelineSet=function(e){this._notifTimelineSet=e},D.prototype.getCapabilities=function(e=!1){const t=(new Date).getTime();return this._cachedCapabilities&&!e&&t<this._cachedCapabilities.expiration?(S.logger.log("Returning cached capabilities"),Promise.resolve(this._cachedCapabilities.capabilities)):this._http.authedRequest(void 0,"GET","/capabilities").catch(e=>(S.logger.error(e),null)).then(e=>{e||(e={});const n=e.capabilities||{},r=Object.keys(n).length?216e5:6e4+5e3*Math.random();return this._cachedCapabilities={capabilities:n,expiration:t+r},S.logger.log("Caching capabilities: ",n),n})},D.prototype.initCrypto=async function(){if(!(0,w.isCryptoAvailable)())throw new Error("End-to-end encryption not supported in this js-sdk build: did you remember to load the olm library?");if(this._crypto)return void S.logger.warn("Attempt to re-initialise e2e encryption on MatrixClient");if(!this._sessionStore)throw new Error("Cannot enable encryption: no sessionStore provided");if(!this._cryptoStore)throw new Error("Cannot enable encryption: no cryptoStore provided");S.logger.log("Crypto: initialising roomlist..."),await this._roomList.init();const e=this.getUserId();if(null===e)throw new Error("Cannot enable encryption on MatrixClient with unknown userId: ensure userId is passed in createClient().");if(null===this.deviceId)throw new Error("Cannot enable encryption on MatrixClient with unknown deviceId: ensure deviceId is passed in createClient().");const t=new w.Crypto(this,this._sessionStore,e,this.deviceId,this.store,this._cryptoStore,this._roomList,this._verificationMethods);this.reEmitter.reEmit(t,["crypto.keyBackupFailed","crypto.keyBackupSessionsRemaining","crypto.roomKeyRequest","crypto.roomKeyRequestCancellation","crypto.warning","crypto.devicesUpdated","deviceVerificationChanged","userTrustStatusChanged","crossSigning.keysChanged"]),S.logger.log("Crypto: initialising crypto object..."),await t.init(),this.olmVersion=w.Crypto.getOlmVersion(),t.registerEventHandlers(this),this._crypto=t},D.prototype.isCryptoEnabled=function(){return null!==this._crypto},D.prototype.getDeviceEd25519Key=function(){return this._crypto?this._crypto.getDeviceEd25519Key():null},D.prototype.uploadKeys=function(){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.uploadDeviceKeys()},D.prototype.downloadKeys=function(e,t){return null===this._crypto?Promise.reject(new Error("End-to-end encryption disabled")):this._crypto.downloadKeys(e,t)},D.prototype.getStoredDevicesForUser=async function(e){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.getStoredDevicesForUser(e)||[]},D.prototype.getStoredDevice=async function(e,t){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.getStoredDevice(e,t)||null},D.prototype.setDeviceVerified=function(e,t,n){void 0===n&&(n=!0);const r=A(this,e,t,n,null);return e==this.credentials.userId&&this._crypto.checkKeyBackup(),r},D.prototype.setDeviceBlocked=function(e,t,n){return void 0===n&&(n=!0),A(this,e,t,null,n)},D.prototype.setDeviceKnown=function(e,t,n){return void 0===n&&(n=!0),A(this,e,t,null,null,n)},D.prototype.requestVerificationDM=function(e,t,n){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.requestVerificationDM(e,t,n)},D.prototype.acceptVerificationDM=function(e,t){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.acceptVerificationDM(e,t)},D.prototype.requestVerification=function(e,t,n){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.requestVerification(e,t,n)},D.prototype.beginKeyVerification=function(e,t,n){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.beginKeyVerification(e,t,n)},D.prototype.setGlobalBlacklistUnverifiedDevices=function(e){if(null===this._crypto)throw new Error("End-to-end encryption disabled");this._crypto.setGlobalBlacklistUnverifiedDevices(e)},D.prototype.getGlobalBlacklistUnverifiedDevices=function(){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.getGlobalBlacklistUnverifiedDevices()},D.prototype.setGlobalErrorOnUnknownDevices=function(e){if(null===this._crypto)throw new Error("End-to-end encryption disabled");this._crypto.setGlobalErrorOnUnknownDevices(e)},D.prototype.getGlobalErrorOnUnknownDevices=function(){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.getGlobalErrorOnUnknownDevices()},x(D,["resetCrossSigningKeys","getCrossSigningId","getStoredCrossSigningForUser","checkUserTrust","checkDeviceTrust","checkOwnCrossSigningTrust","checkCrossSigningPrivateKey"]),D.prototype.checkEventSenderTrust=async function(e){const t=await this.getEventSenderDeviceInfo(e);return t?await this._crypto.checkDeviceTrust(e.getSender(),t.deviceId):0},x(D,["createRecoveryKeyFromPassphrase","bootstrapSecretStorage","addSecretStorageKey","hasSecretStorageKey","storeSecret","getSecret","isSecretStored","requestSecret","getDefaultSecretStorageKeyId","setDefaultSecretStorageKeyId","checkSecretStoragePrivateKey"]),D.prototype.getEventSenderDeviceInfo=async function(e){return this._crypto?this._crypto.getEventSenderDeviceInfo(e):null},D.prototype.isEventSenderVerified=async function(e){const t=await this.getEventSenderDeviceInfo(e);return!!t&&t.isVerified()},D.prototype.cancelAndResendEventRoomKeyRequest=function(e){return e.cancelAndResendKeyRequest(this._crypto,this.getUserId())},D.prototype.setRoomEncryption=function(e,t){if(!this._crypto)throw new Error("End-to-End encryption disabled");return this._crypto.setRoomEncryption(e,t)},D.prototype.isRoomEncrypted=function(e){const t=this.getRoom(e);return!!t&&(!!t.currentState.getStateEvents("m.room.encryption","")||this._roomList.isRoomEncrypted(e))},D.prototype.forceDiscardSession=function(e){if(!this._crypto)throw new Error("End-to-End encryption disabled");this._crypto.forceDiscardSession(e)},D.prototype.exportRoomKeys=function(){return this._crypto?this._crypto.exportRoomKeys():Promise.reject(new Error("End-to-end encryption disabled"))},D.prototype.importRoomKeys=function(e){if(!this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.importRoomKeys(e)},D.prototype.checkKeyBackup=function(){return this._crypto.checkKeyBackup()},D.prototype.getKeyBackupVersion=function(){return this._http.authedRequest(void 0,"GET","/room_keys/version",void 0,void 0,{prefix:m.PREFIX_UNSTABLE}).then(e=>{if(e.algorithm!==_.MEGOLM_BACKUP_ALGORITHM){const t="Unknown backup algorithm: "+e.algorithm;return Promise.reject(t)}if("object"==typeof e.auth_data&&e.auth_data.public_key)return e;{const e="Invalid backup data returned";return Promise.reject(e)}}).catch(e=>{if("M_NOT_FOUND"===e.errcode)return null;throw e})},D.prototype.isKeyBackupTrusted=function(e){return this._crypto.isKeyBackupTrusted(e)},D.prototype.getKeyBackupEnabled=function(){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return Boolean(this._crypto.backupKey)},D.prototype.enableKeyBackup=function(t){if(null===this._crypto)throw new Error("End-to-end encryption disabled");this._crypto.backupInfo=t,this._crypto.backupKey&&this._crypto.backupKey.free(),this._crypto.backupKey=new e.Olm.PkEncryption,this._crypto.backupKey.set_recipient_key(t.auth_data.public_key),this.emit("crypto.keyBackupStatus",!0),this._crypto.scheduleKeyBackupSend()},D.prototype.disableKeyBackup=function(){if(null===this._crypto)throw new Error("End-to-end encryption disabled");this._crypto.backupInfo=null,this._crypto.backupKey&&this._crypto.backupKey.free(),this._crypto.backupKey=null,this.emit("crypto.keyBackupStatus",!1)},D.prototype.prepareKeyBackupVersion=async function(e,{secureSecretStorage:t=!1}={}){if(null===this._crypto)throw new Error("End-to-end encryption disabled");const[n,r,o]=await this.createRecoveryKeyFromPassphrase(e);t&&(await this.storeSecret("m.megolm_backup.v1",(0,_.encodeBase64)(o)),S.logger.info("Key backup private key stored in secret storage"));const i={public_key:n.pubkey};return n.passphrase&&(i.private_key_salt=n.passphrase.salt,i.private_key_iterations=n.passphrase.iterations),{algorithm:_.MEGOLM_BACKUP_ALGORITHM,auth_data:i,recovery_key:r}},D.prototype.isKeyBackupKeyStored=async function(){return this.isSecretStored("m.megolm_backup.v1",!1)},D.prototype.createKeyBackupVersion=async function(e){if(null===this._crypto)throw new Error("End-to-end encryption disabled");const t={algorithm:e.algorithm,auth_data:e.auth_data};await this._crypto._signObject(t.auth_data),this._cryptoCallbacks.getCrossSigningKey&&this._crypto._crossSigningInfo.getId()&&await this._crypto._crossSigningInfo.signObject(t.auth_data,"master");const n=await this._http.authedRequest(void 0,"POST","/room_keys/version",void 0,t,{prefix:m.PREFIX_UNSTABLE});return await this.checkKeyBackup(),this.getKeyBackupEnabled()||S.logger.error("Key backup not usable even though we just created it"),n},D.prototype.deleteKeyBackupVersion=function(e){if(null===this._crypto)throw new Error("End-to-end encryption disabled");this._crypto.backupInfo&&this._crypto.backupInfo.version===e&&this.disableKeyBackup();const t=g.encodeUri("/room_keys/version/$version",{$version:e});return this._http.authedRequest(void 0,"DELETE",t,void 0,void 0,{prefix:m.PREFIX_UNSTABLE})},D.prototype._makeKeyBackupPath=function(e,t,n){let r;return{path:r=void 0!==t?g.encodeUri("/room_keys/keys/$roomId/$sessionId",{$roomId:e,$sessionId:t}):void 0!==e?g.encodeUri("/room_keys/keys/$roomId",{$roomId:e}):"/room_keys/keys",queryData:void 0===n?void 0:{version:n}}},D.prototype.sendKeyBackup=function(e,t,n,r){if(null===this._crypto)throw new Error("End-to-end encryption disabled");const o=this._makeKeyBackupPath(e,t,n);return this._http.authedRequest(void 0,"PUT",o.path,o.queryData,r,{prefix:m.PREFIX_UNSTABLE})},D.prototype.scheduleAllGroupSessionsForBackup=async function(){if(null===this._crypto)throw new Error("End-to-end encryption disabled");await this._crypto.scheduleAllGroupSessionsForBackup()},D.prototype.flagAllGroupSessionsForBackup=function(){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.flagAllGroupSessionsForBackup()},D.prototype.isValidRecoveryKey=function(e){try{return(0,k.decodeRecoveryKey)(e),!0}catch(e){return!1}},D.RESTORE_BACKUP_ERROR_BAD_KEY="RESTORE_BACKUP_ERROR_BAD_KEY",D.prototype.restoreKeyBackupWithPassword=async function(e,t,n,r){const o=await(0,T.keyFromAuthData)(r.auth_data,e);return this._restoreKeyBackup(o,t,n,r)},D.prototype.restoreKeyBackupWithSecretStorage=async function(e,t,n){const r=(0,_.decodeBase64)(await this.getSecret("m.megolm_backup.v1"));return this._restoreKeyBackup(r,t,n,e)},D.prototype.restoreKeyBackupWithRecoveryKey=function(e,t,n,r){const o=(0,k.decodeRecoveryKey)(e);return this._restoreKeyBackup(o,t,n,r)},D.prototype._restoreKeyBackup=function(t,n,r,o){if(null===this._crypto)throw new Error("End-to-end encryption disabled");let i=0,s=[];const a=this._makeKeyBackupPath(n,r,o.version),c=new e.Olm.PkDecryption;let u;try{u=c.init_with_private_key(t)}catch(e){throw c.free(),e}return u!==o.auth_data.public_key?Promise.reject({errcode:D.RESTORE_BACKUP_ERROR_BAD_KEY}):this._http.authedRequest(void 0,"GET",a.path,a.queryData,void 0,{prefix:m.PREFIX_UNSTABLE}).then(e=>{if(e.rooms)for(const[t,n]of Object.entries(e.rooms)){if(!n.sessions)continue;i+=Object.keys(n.sessions).length;const e=C(n.sessions,c,t);for(const n of e)n.room_id=t,s.push(n)}else if(e.sessions)i=Object.keys(e.sessions).length,s=C(e.sessions,c,n);else{i=1;try{const t=P(e,c);t.room_id=n,t.session_id=r,s.push(t)}catch(e){S.logger.log("Failed to decrypt megolm session from backup",e)}}return this.importRoomKeys(s)}).then(()=>this._crypto.setTrustedBackupPubKey(u)).then(()=>({total:i,imported:s.length})).finally(()=>{c.free()})},D.prototype.deleteKeysFromBackup=function(e,t,n){if(null===this._crypto)throw new Error("End-to-end encryption disabled");const r=this._makeKeyBackupPath(e,t,n);return this._http.authedRequest(void 0,"DELETE",r.path,r.queryData,void 0,{prefix:m.PREFIX_UNSTABLE})},D.prototype.getGroup=function(e){return this.store.getGroup(e)},D.prototype.getGroups=function(){return this.store.getGroups()},D.prototype.getMediaConfig=function(e){return this._http.authedRequest(e,"GET","/config",void 0,void 0,{prefix:m.PREFIX_MEDIA_R0})},D.prototype.getRoom=function(e){return this.store.getRoom(e)},D.prototype.getRooms=function(){return this.store.getRooms()},D.prototype.getVisibleRooms=function(){const e=this.store.getRooms(),t=new Set;for(const n of e){const e=n.currentState.getStateEvents("m.room.create","");if(e){const n=e.getContent().predecessor;n&&n.room_id&&t.add(n.room_id)}}return e.filter(e=>{return!e.currentState.getStateEvents("m.room.tombstone","")||!t.has(e.roomId)})},D.prototype.getUser=function(e){return this.store.getUser(e)},D.prototype.getUsers=function(){return this.store.getUsers()},D.prototype.setAccountData=function(e,t,n){const r=g.encodeUri("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:e});return this._http.authedRequest(n,"PUT",r,void 0,t)},D.prototype.getAccountData=function(e){return this.store.getAccountData(e)},D.prototype.getAccountDataFromServer=async function(e){if(this.isInitialSyncComplete()){const t=this.store.getAccountData(e);return t?t.getContent():null}const t=g.encodeUri("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:e});return this._http.authedRequest(void 0,"GET",t,void 0)},D.prototype.getIgnoredUsers=function(){const e=this.getAccountData("m.ignored_user_list");return e&&e.getContent()&&e.getContent().ignored_users?Object.keys(e.getContent().ignored_users):[]},D.prototype.setIgnoredUsers=function(e,t){const n={ignored_users:{}};return e.map(e=>n.ignored_users[e]={}),this.setAccountData("m.ignored_user_list",n,t)},D.prototype.isUserIgnored=function(e){return-1!==this.getIgnoredUsers().indexOf(e)},D.prototype.joinRoom=function(e,t,n){if(g.isFunction(t))throw new Error("Expected 'opts' object, got function.");void 0===(t=t||{}).syncRoom&&(t.syncRoom=!0);const r=this.getRoom(e);if(r&&r.hasMembershipState(this.credentials.userId,"join"))return Promise.resolve(r);let o=Promise.resolve();t.inviteSignUrl&&(o=this._http.requestOtherUrl(void 0,"POST",t.inviteSignUrl,{mxid:this.credentials.userId}));const i={};t.viaServers&&(i.server_name=t.viaServers);const s={qsStringifyOptions:{arrayFormat:"repeat"}},a=this;return new Promise((r,c)=>{o.then((function(t){const n={};t&&(n.third_party_signed=t);const r=g.encodeUri("/join/$roomid",{$roomid:e});return a._http.authedRequest(void 0,"POST",r,i,n,s)})).then((function(e){const n=e.room_id,r=new u.SyncApi(a,a._clientOpts).createRoom(n);return t.syncRoom,Promise.resolve(r)})).then((function(e){B(n,r,e)}),(function(e){j(n,c,e)}))})},D.prototype.resendEvent=function(e,t){return N(t,e,l.EventStatus.SENDING),M(this,t,e)},D.prototype.cancelPendingEvent=function(e){if([l.EventStatus.QUEUED,l.EventStatus.NOT_SENT].indexOf(e.status)<0)throw new Error("cannot cancel an event with status "+e.status);this.scheduler&&this.scheduler.removeEventFromQueue(e),N(this.getRoom(e.getRoomId()),e,l.EventStatus.CANCELLED)},D.prototype.setRoomName=function(e,t,n){return this.sendStateEvent(e,"m.room.name",{name:t},void 0,n)},D.prototype.setRoomTopic=function(e,t,n){return this.sendStateEvent(e,"m.room.topic",{topic:t},void 0,n)},D.prototype.getRoomTags=function(e,t){const n=g.encodeUri("/user/$userId/rooms/$roomId/tags/",{$userId:this.credentials.userId,$roomId:e});return this._http.authedRequest(t,"GET",n,void 0)},D.prototype.setRoomTag=function(e,t,n,r){const o=g.encodeUri("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:t});return this._http.authedRequest(r,"PUT",o,void 0,n)},D.prototype.deleteRoomTag=function(e,t,n){const r=g.encodeUri("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:t});return this._http.authedRequest(n,"DELETE",r,void 0,void 0)},D.prototype.setRoomAccountData=function(e,t,n,r){const o=g.encodeUri("/user/$userId/rooms/$roomId/account_data/$type",{$userId:this.credentials.userId,$roomId:e,$type:t});return this._http.authedRequest(r,"PUT",o,void 0,n)},D.prototype.setPowerLevel=function(e,t,n,r,o){let i={users:{}};r&&"m.room.power_levels"===r.getType()&&(i=g.deepCopy(r.getContent())),i.users[t]=n;const s=g.encodeUri("/rooms/$roomId/state/m.room.power_levels",{$roomId:e});return this._http.authedRequest(o,"PUT",s,void 0,i)},D.prototype.sendEvent=function(e,t,n,r,o){return this._sendCompleteEvent(e,{type:t,content:n},r,o)},D.prototype._sendCompleteEvent=function(e,t,n,r){g.isFunction(n)&&(r=n,n=void 0),n||(n=this.makeTxnId());const o=new l.MatrixEvent(Object.assign(t,{event_id:"~"+e+":"+n,user_id:this.credentials.userId,room_id:e,origin_server_ts:(new Date).getTime()})),i=this.getRoom(e),s=o.getAssociatedId();if(s&&s.startsWith("~")){const e=i.getPendingEvents().find(e=>e.getId()===s);e.once("Event.localEventIdReplaced",()=>{o.updateAssociatedId(e.getId())})}const a=o.getType();return S.logger.log(`sendEvent of type ${a} in ${e} with txnId ${n}`),o._txnId=n,o.setStatus(l.EventStatus.SENDING),i&&i.addPendingEvent(o,n),o.status===l.EventStatus.NOT_SENT?Promise.reject(new Error("Event blocked by other events not yet sent")):M(this,i,o,r)},D.prototype.redactEvent=function(e,t,n,r){return this._sendCompleteEvent(e,{type:"m.room.redaction",content:{},redacts:t},n,r)},D.prototype.sendMessage=function(e,t,n,r){return g.isFunction(n)&&(r=n,n=void 0),this.sendEvent(e,"m.room.message",t,n,r)},D.prototype.sendTextMessage=function(e,t,n,r){const o=v.makeTextMessage(t);return this.sendMessage(e,o,n,r)},D.prototype.sendNotice=function(e,t,n,r){const o=v.makeNotice(t);return this.sendMessage(e,o,n,r)},D.prototype.sendEmoteMessage=function(e,t,n,r){const o=v.makeEmoteMessage(t);return this.sendMessage(e,o,n,r)},D.prototype.sendImageMessage=function(e,t,n,r,o){g.isFunction(r)&&(o=r,r=void 0),r||(r="Image");const i={msgtype:"m.image",url:t,info:n,body:r};return this.sendMessage(e,i,o)},D.prototype.sendStickerMessage=function(e,t,n,r,o){g.isFunction(r)&&(o=r,r=void 0),r||(r="Sticker");const i={url:t,info:n,body:r};return this.sendEvent(e,"m.sticker",i,o,void 0)},D.prototype.sendHtmlMessage=function(e,t,n,r){const o=v.makeHtmlMessage(t,n);return this.sendMessage(e,o,r)},D.prototype.sendHtmlNotice=function(e,t,n,r){const o=v.makeHtmlNotice(t,n);return this.sendMessage(e,o,r)},D.prototype.sendHtmlEmote=function(e,t,n,r){const o=v.makeHtmlEmote(t,n);return this.sendMessage(e,o,r)},D.prototype.sendReceipt=function(e,t,n,r){if("function"==typeof n&&(r=n,n={}),this.isGuest())return Promise.resolve({});const o=g.encodeUri("/rooms/$roomId/receipt/$receiptType/$eventId",{$roomId:e.getRoomId(),$receiptType:t,$eventId:e.getId()}),i=this._http.authedRequest(r,"POST",o,void 0,n||{}),s=this.getRoom(e.getRoomId());return s&&s._addLocalEchoReceipt(this.credentials.userId,e,t),i},D.prototype.sendReadReceipt=async function(e,t,n){"function"==typeof t&&(n=t,t={}),t||(t={});const r=e.getId(),o=this.getRoom(e.getRoomId());if(o&&o.hasPendingEvent(r))throw new Error(`Cannot set read receipt to a pending event (${r})`);const i={"m.hidden":Boolean(t.hidden)};return this.sendReceipt(e,"m.read",i,n)},D.prototype.setRoomReadMarkers=async function(e,t,n,r){const o=this.getRoom(e);if(o&&o.hasPendingEvent(t))throw new Error(`Cannot set read marker to a pending event (${t})`);let i;if(n){if(i=n.getId(),o&&o.hasPendingEvent(i))throw new Error(`Cannot set read receipt to a pending event (${i})`);o&&o._addLocalEchoReceipt(this.credentials.userId,n,"m.read")}return this.setRoomReadMarkersHttpRequest(e,t,i,r)},D.prototype.getUrlPreview=function(e,t,n){const r=t+"_"+e,o=this.urlPreviewCache[r];if(o)return Promise.resolve(o);const i=this;return this._http.authedRequest(n,"GET","/preview_url",{url:e,ts:t},void 0,{prefix:m.PREFIX_MEDIA_R0}).then((function(e){return i.urlPreviewCache[r]=e,e}))},D.prototype.sendTyping=function(e,t,n,r){if(this.isGuest())return Promise.resolve({});const o=g.encodeUri("/rooms/$roomId/typing/$userId",{$roomId:e,$userId:this.credentials.userId}),i={typing:t};return t&&(i.timeout=n||2e4),this._http.authedRequest(r,"PUT",o,void 0,i)},D.prototype.getRoomUpgradeHistory=function(e,t=!1){let n=this.getRoom(e);if(!n)return[];const r=[n];let o=n.currentState.getStateEvents("m.room.create","");for(;o;){S.logger.log(`Looking at ${o.getId()}`);const e=o.getContent().predecessor;if(!e||!e.room_id)break;{S.logger.log(`Looking at predecessor ${e.room_id}`);const n=this.getRoom(e.room_id);if(!n)break;if(t){const e=n.currentState.getStateEvents("m.room.tombstone","");if(!e||e.getContent().replacement_room!==n.roomId)break}r.splice(0,0,n),o=n.currentState.getStateEvents("m.room.create","")}}let i=n.currentState.getStateEvents("m.room.tombstone","");for(;i;){const e=this.getRoom(i.getContent().replacement_room);if(!e)break;if(e.roomId===n.roomId)break;if(t){if(!(o=e.currentState.getStateEvents("m.room.create",""))||!o.getContent().predecessor)break;if(o.getContent().predecessor.room_id!==n.roomId)break}if(r.push(e),new Set(r.map(e=>e.roomId)).size<r.length)return r.slice(0,r.length-1);i=(n=e).currentState.getStateEvents("m.room.tombstone","")}return r},D.prototype.invite=function(e,t,n){return L(this,e,t,"invite",void 0,n)},D.prototype.inviteByEmail=function(e,t,n){return this.inviteByThreePid(e,"email",t,n)},D.prototype.inviteByThreePid=async function(e,t,n,r){const o=g.encodeUri("/rooms/$roomId/invite",{$roomId:e}),i=this.getIdentityServerUrl(!0);if(!i)return Promise.reject(new m.MatrixError({error:"No supplied identity server URL",errcode:"ORG.MATRIX.JSSDK_MISSING_PARAM"}));const s={id_server:i,medium:t,address:n};if(this.identityServer&&this.identityServer.getAccessToken&&await this.doesServerAcceptIdentityAccessToken()){const e=await this.identityServer.getAccessToken();e&&(s.id_access_token=e)}return this._http.authedRequest(r,"POST",o,void 0,s)},D.prototype.leave=function(e,t){return L(this,e,void 0,"leave",void 0,t)},D.prototype.leaveRoomChain=function(e,t=!0){const n=this.getRoomUpgradeHistory(e);let r=n;if(!t){r=[];for(const t of n)if(r.push(t),t.roomId===e)break}const o={},i=[],s=e=>this.leave(e).then(()=>{o[e]=null}).catch(t=>(o[e]=t,null));for(const e of r)i.push(s(e.roomId));return Promise.all(i).then(()=>o)},D.prototype.ban=function(e,t,n,r){return L(this,e,t,"ban",n,r)},D.prototype.forget=function(e,t,n){void 0===t&&(t=!0);const r=L(this,e,void 0,"forget",void 0,n);if(!t)return r;const o=this;return r.then((function(t){return o.store.removeRoom(e),o.emit("deleteRoom",e),t}))},D.prototype.unban=function(e,t,n){const r=g.encodeUri("/rooms/$roomId/unban",{$roomId:e}),o={user_id:t};return this._http.authedRequest(n,"POST",r,void 0,o)},D.prototype.kick=function(e,t,n,r){return function(e,t,n,r,o,i){g.isFunction(o)&&(i=o,o=void 0);const s=g.encodeUri("/rooms/$roomId/state/m.room.member/$userId",{$roomId:t,$userId:n});return e._http.authedRequest(i,"PUT",s,void 0,{membership:r,reason:o})}(this,e,t,"leave",n,r)},D.prototype.getPushActionsForEvent=function(e){return e.getPushActions()||e.setPushActions(this._pushProcessor.actionsForEvent(e)),e.getPushActions()},D.prototype.setProfileInfo=function(e,t,n){const r=g.encodeUri("/profile/$userId/$info",{$userId:this.credentials.userId,$info:e});return this._http.authedRequest(n,"PUT",r,void 0,t)},D.prototype.setDisplayName=function(e,t){return this.setProfileInfo("displayname",{displayname:e},t)},D.prototype.setAvatarUrl=function(e,t){return this.setProfileInfo("avatar_url",{avatar_url:e},t)},D.prototype.mxcUrlToHttp=function(e,t,n,r,o){return(0,y.getHttpUriForMxc)(this.baseUrl,e,t,n,r,o)},D.prototype._unstable_setStatusMessage=function(e){const t="im.vector.user_status";return Promise.all(this.getRooms().map(n=>{const r="join"===n.getMyMembership(),o=2===n.getInvitedAndJoinedMemberCount();return r&&o&&n.currentState.mayClientSendStateEvent(t,this)?this.sendStateEvent(n.roomId,t,{status:e},this.getUserId()):Promise.resolve()}))},D.prototype.setPresence=function(e,t){const n=g.encodeUri("/presence/$userId/status",{$userId:this.credentials.userId});"string"==typeof e&&(e={presence:e});if(-1==["offline","online","unavailable"].indexOf(e.presence))throw new Error("Bad presence value: "+e.presence);return this._http.authedRequest(t,"PUT",n,void 0,e)},D.prototype.getPresenceList=function(e){return K(e,this,void 0,"GET")},D.prototype.inviteToPresenceList=function(e,t){return K(e,this,{invite:t},"POST")},D.prototype.dropFromPresenceList=function(e,t){return K(e,this,{drop:t},"POST")},D.prototype.scrollback=function(e,t,n){g.isFunction(t)&&(n=t,t=void 0),t=t||30;let r=0,o=this._ongoingScrollbacks[e.roomId]||{};if(o.promise)return o.promise;if(o.errorTs){const e=Date.now()-o.errorTs;r=Math.max(3e3-e,0)}if(null===e.oldState.paginationToken)return Promise.resolve(e);const i=this.store.scrollback(e,t).length;if(i===t)return Promise.resolve(e);t-=i;const s=this,a=new Promise((o,i)=>{(0,g.sleep)(r).then((function(){return s._createMessagesRequest(e.roomId,e.oldState.paginationToken,t,"b")})).then((function(t){const r=g.map(t.chunk,F(s));if(t.state){const n=g.map(t.state,F(s));e.currentState.setUnknownStateEvents(n)}e.addEventsToTimeline(r,!0,e.getLiveTimeline()),e.oldState.paginationToken=t.end,0===t.chunk.length&&(e.oldState.paginationToken=null),s.store.storeEvents(e,r,t.end,!0),s._ongoingScrollbacks[e.roomId]=null,B(n,o,e)}),(function(t){s._ongoingScrollbacks[e.roomId]={errorTs:Date.now()},j(n,i,t)}))});return o={promise:a,errorTs:null},this._ongoingScrollbacks[e.roomId]=o,a},D.prototype.getEventTimeline=function(e,t){if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(e.getTimelineForEvent(t))return Promise.resolve(e.getTimelineForEvent(t));const n=g.encodeUri("/rooms/$roomId/context/$eventId",{$roomId:e.room.roomId,$eventId:t});let r=void 0;this._clientOpts.lazyLoadMembers&&(r={filter:JSON.stringify(c.Filter.LAZY_LOADING_MESSAGES_FILTER)});const o=this;return o._http.authedRequest(void 0,"GET",n,r).then((function(n){if(!n.event)throw new Error("'event' not in '/context' result - homeserver too old?");if(e.getTimelineForEvent(t))return e.getTimelineForEvent(t);n.events_after.reverse();const r=n.events_after.concat([n.event]).concat(n.events_before),i=g.map(r,o.getEventMapper());let s=e.getTimelineForEvent(i[0].getId());if(s){const e=g.map(n.state,o.getEventMapper());s.getState(d.EventTimeline.BACKWARDS).setUnknownStateEvents(e)}else(s=e.addTimeline()).initialiseState(g.map(n.state,o.getEventMapper())),s.getState(d.EventTimeline.FORWARDS).paginationToken=n.end;return e.addEventsToTimeline(i,!0,s,n.start),e.getTimelineForEvent(t)||s}))},D.prototype._createMessagesRequest=function(e,t,n,r,o){const i=g.encodeUri("/rooms/$roomId/messages",{$roomId:e});void 0===n&&(n=30);const s={from:t,limit:n,dir:r};let a=null;return this._clientOpts.lazyLoadMembers&&(a=Object.assign({},c.Filter.LAZY_LOADING_MESSAGES_FILTER)),o&&(a=a||{},Object.assign(a,o.getRoomTimelineFilterComponent())),a&&(s.filter=JSON.stringify(a)),this._http.authedRequest(void 0,"GET",i,s)},D.prototype.paginateEventTimeline=function(e,t){const n=e.getTimelineSet()===this._notifTimelineSet,r=(t=t||{}).backwards||!1;if(n&&!r)throw new Error("paginateNotifTimeline can only paginate backwards");const o=r?d.EventTimeline.BACKWARDS:d.EventTimeline.FORWARDS,i=e.getPaginationToken(o);if(!i)return Promise.resolve(!1);const s=e._paginationRequests[o];if(s)return s;let a,c,u;const l=this;if(n)a="/notifications",c={limit:"limit"in t?t.limit:30,only:"highlight"},i&&"end"!==i&&(c.from=i),u=this._http.authedRequest(void 0,"GET","/notifications",c,void 0).then((function(t){const n=t.next_token,i=[];for(let e=0;e<t.notifications.length;e++){const n=t.notifications[e],r=l.getEventMapper()(n.event);r.setPushActions(R.PushProcessor.actionListToActionsObject(n.actions)),r.event.room_id=n.room_id,i[e]=r}return e.getTimelineSet().addEventsToTimeline(i,r,e,n),r&&!t.next_token&&e.setPaginationToken(null,o),!!t.next_token})).finally((function(){e._paginationRequests[o]=null})),e._paginationRequests[o]=u;else{if(!this.getRoom(e.getRoomId()))throw new Error("Unknown room "+e.getRoomId());(u=this._createMessagesRequest(e.getRoomId(),i,t.limit,o,e.getFilter())).then((function(t){if(t.state){const n=e.getState(o),r=g.map(t.state,l.getEventMapper());n.setUnknownStateEvents(r)}const n=t.end,i=g.map(t.chunk,l.getEventMapper());return e.getTimelineSet().addEventsToTimeline(i,r,e,n),r&&t.end==t.start&&e.setPaginationToken(null,o),t.end!=t.start})).finally((function(){e._paginationRequests[o]=null})),e._paginationRequests[o]=u}return u},D.prototype.resetNotifTimelineSet=function(){this._notifTimelineSet&&this._notifTimelineSet.resetLiveTimeline("end",null)},D.prototype.peekInRoom=function(e){return this._peekSync&&this._peekSync.stopPeeking(),this._peekSync=new u.SyncApi(this,this._clientOpts),this._peekSync.peek(e)},D.prototype.stopPeeking=function(){this._peekSync&&(this._peekSync.stopPeeking(),this._peekSync=null)},D.prototype.setGuestAccess=function(e,t){const n=this.sendStateEvent(e,"m.room.guest_access",{guest_access:t.allowJoin?"can_join":"forbidden"});let r=Promise.resolve();return t.allowRead&&(r=this.sendStateEvent(e,"m.room.history_visibility",{history_visibility:"world_readable"})),Promise.all([r,n])},D.prototype.requestRegisterEmailToken=function(e,t,n,r){return this._requestTokenFromEndpoint("/register/email/requestToken",{email:e,client_secret:t,send_attempt:n,next_link:r})},D.prototype.requestRegisterMsisdnToken=function(e,t,n,r,o){return this._requestTokenFromEndpoint("/register/msisdn/requestToken",{country:e,phone_number:t,client_secret:n,send_attempt:r,next_link:o})},D.prototype.requestAdd3pidEmailToken=function(e,t,n,r){return this._requestTokenFromEndpoint("/account/3pid/email/requestToken",{email:e,client_secret:t,send_attempt:n,next_link:r})},D.prototype.requestAdd3pidMsisdnToken=function(e,t,n,r,o){return this._requestTokenFromEndpoint("/account/3pid/msisdn/requestToken",{country:e,phone_number:t,client_secret:n,send_attempt:r,next_link:o})},D.prototype.requestPasswordEmailToken=function(e,t,n,r){return this._requestTokenFromEndpoint("/account/password/email/requestToken",{email:e,client_secret:t,send_attempt:n,next_link:r})},D.prototype.requestPasswordMsisdnToken=function(e,t,n,r,o){return this._requestTokenFromEndpoint("/account/password/msisdn/requestToken",{country:e,phone_number:t,client_secret:n,send_attempt:r,next_link:o})},D.prototype._requestTokenFromEndpoint=async function(e,t){const n=Object.assign({},t);if(!await this.doesServerSupportSeparateAddAndBind()&&this.idBaseUrl){const e=i.default.parse(this.idBaseUrl);if(!e.host)throw new Error("Invalid ID server URL: "+this.idBaseUrl);if(n.id_server=e.host,this.identityServer&&this.identityServer.getAccessToken&&await this.doesServerAcceptIdentityAccessToken()){const e=await this.identityServer.getAccessToken();e&&(n.id_access_token=e)}}return this._http.request(void 0,"POST",e,void 0,n)},D.prototype.getRoomPushRule=function(e,t){if(!this.pushRules)throw new Error("SyncApi.sync() must be done before accessing to push rules.");for(let n=0;n<this.pushRules[e].room.length;n++){const r=this.pushRules[e].room[n];if(r.rule_id===t)return r}},D.prototype.setRoomMutePushRule=function(e,t,n){const r=this;let o,i;const s=this.getRoomPushRule(e,t);if(s&&0<=s.actions.indexOf("dont_notify")&&(i=!0),n?s?i||(o=g.defer(),this.deletePushRule(e,"room",s.rule_id).then((function(){r.addPushRule(e,"room",t,{actions:["dont_notify"]}).then((function(){o.resolve()}),(function(e){o.reject(e)}))}),(function(e){o.reject(e)})),o=o.promise):o=this.addPushRule(e,"room",t,{actions:["dont_notify"]}):i&&(o=this.deletePushRule(e,"room",s.rule_id)),o)return new Promise((e,t)=>{o.then((function(){r.getPushRules().then((function(t){r.pushRules=t,e()}),(function(e){t(e)}))}),(function(e){r.getPushRules().then((function(n){r.pushRules=n,t(e)}),(function(n){t(e)}))}))})},D.prototype.searchMessageText=function(e,t){const n={search_term:e.query};return"keys"in e&&(n.keys=e.keys),this.search({body:{search_categories:{room_events:n}}},t)},D.prototype.searchRoomEvents=function(e){const t={search_categories:{room_events:{search_term:e.term,filter:e.filter,order_by:"recent",event_context:{before_limit:1,after_limit:1,include_profile:!0}}}},n={_query:t,results:[],highlights:[]};return this.search({body:t}).then(this._processRoomEventsSearch.bind(this,n))},D.prototype.backPaginateRoomEventsSearch=function(e){if(!e.next_batch)return Promise.reject(new Error("Cannot backpaginate event search any further"));if(e.pendingRequest)return e.pendingRequest;const t={body:e._query,next_batch:e.next_batch},n=this.search(t).then(this._processRoomEventsSearch.bind(this,e)).finally((function(){e.pendingRequest=null}));return e.pendingRequest=n,n},D.prototype._processRoomEventsSearch=function(e,t){const n=t.search_categories.room_events;e.count=n.count,e.next_batch=n.next_batch;const r={};n.highlights.forEach((function(e){r[e]=1})),e.highlights.forEach((function(e){r[e]=1})),e.highlights=Object.keys(r);for(let t=0;t<n.results.length;t++){const r=h.SearchResult.fromJson(n.results[t],this.getEventMapper());e.results.push(r)}return e},D.prototype.syncLeftRooms=function(){if(this._syncedLeftRooms)return Promise.resolve([]);if(this._syncLeftRoomsPromise)return this._syncLeftRoomsPromise;const e=this,t=new u.SyncApi(this,this._clientOpts);return this._syncLeftRoomsPromise=t.syncLeftRooms(),this._syncLeftRoomsPromise.then((function(t){S.logger.log("Marking success of sync left room request"),e._syncedLeftRooms=!0})).finally((function(){e._syncLeftRoomsPromise=null})),this._syncLeftRoomsPromise},D.prototype.createFilter=function(e){const t=this,n=g.encodeUri("/user/$userId/filter",{$userId:this.credentials.userId});return this._http.authedRequest(void 0,"POST",n,void 0,e).then((function(n){const r=c.Filter.fromJson(t.credentials.userId,n.filter_id,e);return t.store.storeFilter(r),r}))},D.prototype.getFilter=function(e,t,n){if(n){const n=this.store.getFilter(e,t);if(n)return Promise.resolve(n)}const r=this,o=g.encodeUri("/user/$userId/filter/$filterId",{$userId:e,$filterId:t});return this._http.authedRequest(void 0,"GET",o,void 0,void 0).then((function(n){const o=c.Filter.fromJson(e,t,n);return r.store.storeFilter(o),o}))},D.prototype.getOrCreateFilter=function(e,t){const n=this.store.getFilterIdByName(e);let r=Promise.resolve();const o=this;return n&&(r=o.getFilter(o.credentials.userId,n,!0).then((function(r){const i=r.getDefinition(),s=t.getDefinition();if(g.deepCompare(i,s))return Promise.resolve(n);o.store.setFilterIdByName(e,void 0)}),(function(t){if(404!==t.httpStatus||"M_UNKNOWN"!==t.errcode&&"M_NOT_FOUND"!==t.errcode)throw t;o.store.setFilterIdByName(e,void 0)}))),r.then((function(n){return n||o.createFilter(t.getDefinition()).then((function(t){return o.store.setFilterIdByName(e,t.filterId),t.filterId}))}))},D.prototype.getOpenIdToken=function(){const e=g.encodeUri("/user/$userId/openid/request_token",{$userId:this.credentials.userId});return this._http.authedRequest(void 0,"POST",e,void 0,{})},D.prototype.turnServer=function(e){return this._http.authedRequest(e,"GET","/voip/turnServer")},D.prototype.getTurnServers=function(){return this._turnServers||[]},D.prototype.setFallbackICEServerAllowed=function(e){this._fallbackICEServerAllowed=e},D.prototype.isFallbackICEServerAllowed=function(){return this._fallbackICEServerAllowed},D.prototype.isSynapseAdministrator=function(){const e=g.encodeUri("/_synapse/admin/v1/users/$userId/admin",{$userId:this.getUserId()});return this._http.authedRequest(void 0,"GET",e,void 0,void 0,{prefix:""}).then(e=>e.admin)},D.prototype.whoisSynapseUser=function(e){const t=g.encodeUri("/_synapse/admin/v1/whois/$userId",{$userId:e});return this._http.authedRequest(void 0,"GET",t,void 0,void 0,{prefix:""})},D.prototype.deactivateSynapseUser=function(e){const t=g.encodeUri("/_synapse/admin/v1/deactivate/$userId",{$userId:e});return this._http.authedRequest(void 0,"POST",t,void 0,void 0,{prefix:""})},D.prototype.startClient=async function(e){this.clientRunning||(this.clientRunning=!0,"number"==typeof e&&(e={initialSyncLimit:e}),this._crypto&&(this._crypto.uploadDeviceKeys(),this._crypto.start()),function e(t){if(!t._supportsVoip)return;if(t.isGuest())return;t.turnServer().then((function(n){if(n.uris){S.logger.log("Got TURN URIs: "+n.uris+" refresh in "+n.ttl+" secs");const r={urls:n.uris,username:n.username,credential:n.password};t._turnServers=[r],t._checkTurnServersTimeoutID=setTimeout(()=>{e(t)},1e3*(n.ttl||3600)*.9)}}),(function(n){S.logger.error("Failed to get TURN URIs"),t._checkTurnServersTimeoutID=setTimeout((function(){e(t)}),6e4)}))}(this),this._syncApi&&(S.logger.error("Still have sync object whilst not running: stopping old one"),this._syncApi.stop()),(e=Object.assign({},e)).crypto=this._crypto,e.canResetEntireTimeline=e=>!!this._canResetTimelineCallback&&this._canResetTimelineCallback(e),this._clientOpts=e,this._syncApi=new u.SyncApi(this,e),this._syncApi.sync())},D.prototype._storeClientOptions=function(){const e=["boolean","string","number"],t=Object.entries(this._clientOpts).filter(([t,n])=>e.includes(typeof n)).reduce((e,[t,n])=>(e[t]=n,e),{});return this.store.storeClientOptions(t)},D.prototype.stopClient=function(){S.logger.log("stopping MatrixClient"),this.clientRunning=!1,this._syncApi&&(this._syncApi.stop(),this._syncApi=null),this._crypto&&this._crypto.stop(),this._peekSync&&this._peekSync.stopPeeking(),e.clearTimeout(this._checkTurnServersTimeoutID)},D.prototype.getVersions=async function(){return null===this._serverVersionsCache&&(this._serverVersionsCache=await this._http.request(void 0,"GET","/_matrix/client/versions",void 0,void 0,{prefix:""})),this._serverVersionsCache},D.prototype.isVersionSupported=async function(e){const{versions:t}=await this.getVersions();return t&&t.includes(e)},D.prototype.doesServerSupportLazyLoading=async function(){const e=await this.getVersions(),t=e.versions,n=e.unstable_features;return t&&t.includes("r0.5.0")||n&&n["m.lazy_load_members"]},D.prototype.doesServerRequireIdServerParam=async function(){const e=await this.getVersions(),t=e.versions;if(t&&t.includes("r0.6.0"))return!1;const n=e.unstable_features;return void 0===n["m.require_identity_server"]||n["m.require_identity_server"]},D.prototype.doesServerAcceptIdentityAccessToken=async function(){const e=await this.getVersions(),t=e.versions,n=e.unstable_features;return t&&t.includes("r0.6.0")||n&&n["m.id_access_token"]},D.prototype.doesServerSupportSeparateAddAndBind=async function(){const e=await this.getVersions(),t=e.versions,n=e.unstable_features;return t&&t.includes("r0.6.0")||n&&n["m.separate_add_and_bind"]},D.prototype.hasLazyLoadMembersEnabled=function(){return!!this._clientOpts.lazyLoadMembers},D.prototype.setCanResetTimelineCallback=function(e){this._canResetTimelineCallback=e},D.prototype.getCanResetTimelineCallback=function(){return this._canResetTimelineCallback},D.prototype.relations=async function(e,t,n,r,o={}){const i=function(e,t,n){return"m.reaction"===n?n:e.isRoomEncrypted(t)?"m.room.encrypted":n}(this,e,r),s=await this.fetchRelations(e,t,n,i,o),a=this.getEventMapper();let c;s.original_event&&(c=a(s.original_event));let u=s.chunk.map(a);if("m.room.encrypted"===i){const e=c?u.concat(c):u;await Promise.all(e.map(e=>new Promise(t=>e.once("Event.decrypted",t)))),u=u.filter(e=>e.getType()===r)}return{originalEvent:c,events:u,nextBatch:s.next_batch}},D.prototype.getEventMapper=function(){return F(this)},D.prototype.generateClientSecret=function(){return(0,I.randomString)(32)}}).call(this,n(3))},function(e,t,n){(function(e,r){var o;/*! https://mths.be/punycode v1.4.1 by @mathias */!function(i){t&&t.nodeType,e&&e.nodeType;var s="object"==typeof r&&r;s.global!==s&&s.window!==s&&s.self;var a,c=2147483647,u=36,l=1,d=26,h=38,f=700,p=72,g=128,m="-",y=/^xn--/,v=/[^\x20-\x7E]/,_=/[\x2E\u3002\uFF0E\uFF61]/g,b={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},E=u-l,S=Math.floor,w=String.fromCharCode;function k(e){throw new RangeError(b[e])}function T(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function I(e,t){var n=e.split("@"),r="";return n.length>1&&(r=n[0]+"@",e=n[1]),r+T((e=e.replace(_,".")).split("."),t).join(".")}function R(e){for(var t,n,r=[],o=0,i=e.length;o<i;)(t=e.charCodeAt(o++))>=55296&&t<=56319&&o<i?56320==(64512&(n=e.charCodeAt(o++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),o--):r.push(t);return r}function O(e){return T(e,(function(e){var t="";return e>65535&&(t+=w((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=w(e)})).join("")}function C(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function P(e,t,n){var r=0;for(e=n?S(e/f):e>>1,e+=S(e/t);e>E*d>>1;r+=u)e=S(e/E);return S(r+(E+1)*e/(e+h))}function D(e){var t,n,r,o,i,s,a,h,f,y,v,_=[],b=e.length,E=0,w=g,T=p;for((n=e.lastIndexOf(m))<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&k("not-basic"),_.push(e.charCodeAt(r));for(o=n>0?n+1:0;o<b;){for(i=E,s=1,a=u;o>=b&&k("invalid-input"),((h=(v=e.charCodeAt(o++))-48<10?v-22:v-65<26?v-65:v-97<26?v-97:u)>=u||h>S((c-E)/s))&&k("overflow"),E+=h*s,!(h<(f=a<=T?l:a>=T+d?d:a-T));a+=u)s>S(c/(y=u-f))&&k("overflow"),s*=y;T=P(E-i,t=_.length+1,0==i),S(E/t)>c-w&&k("overflow"),w+=S(E/t),E%=t,_.splice(E++,0,w)}return O(_)}function A(e){var t,n,r,o,i,s,a,h,f,y,v,_,b,E,T,I=[];for(_=(e=R(e)).length,t=g,n=0,i=p,s=0;s<_;++s)(v=e[s])<128&&I.push(w(v));for(r=o=I.length,o&&I.push(m);r<_;){for(a=c,s=0;s<_;++s)(v=e[s])>=t&&v<a&&(a=v);for(a-t>S((c-n)/(b=r+1))&&k("overflow"),n+=(a-t)*b,t=a,s=0;s<_;++s)if((v=e[s])<t&&++n>c&&k("overflow"),v==t){for(h=n,f=u;!(h<(y=f<=i?l:f>=i+d?d:f-i));f+=u)T=h-y,E=u-y,I.push(w(C(y+T%E,0))),h=S(T/E);I.push(w(C(h,0))),i=P(n,b,r==o),n=0,++r}++n,++t}return I.join("")}a={version:"1.4.1",ucs2:{decode:R,encode:O},decode:D,encode:A,toASCII:function(e){return I(e,(function(e){return v.test(e)?"xn--"+A(e):e}))},toUnicode:function(e){return I(e,(function(e){return y.test(e)?D(e.slice(4).toLowerCase()):e}))}},void 0===(o=function(){return a}.call(t,n,t,e))||(e.exports=o)}()}).call(this,n(69)(e),n(3))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(e,t,n){"use strict";t.decode=t.parse=n(72),t.encode=t.stringify=n(73)},function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,n,i){t=t||"&",n=n||"=";var s={};if("string"!=typeof e||0===e.length)return s;var a=/\+/g;e=e.split(t);var c=1e3;i&&"number"==typeof i.maxKeys&&(c=i.maxKeys);var u=e.length;c>0&&u>c&&(u=c);for(var l=0;l<u;++l){var d,h,f,p,g=e[l].replace(a,"%20"),m=g.indexOf(n);m>=0?(d=g.substr(0,m),h=g.substr(m+1)):(d=g,h=""),f=decodeURIComponent(d),p=decodeURIComponent(h),r(s,f)?o(s[f])?s[f].push(p):s[f]=[s[f],p]:s[f]=p}return s};var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,n){"use strict";var r=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,n,a){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?i(s(e),(function(s){var a=encodeURIComponent(r(s))+n;return o(e[s])?i(e[s],(function(e){return a+encodeURIComponent(r(e))})).join(t):a+encodeURIComponent(r(e[s]))})).join(t):a?encodeURIComponent(r(a))+n+encodeURIComponent(r(e)):""};var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function i(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n}var s=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},function(e,t,n){"use strict";(function(e){var r=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixBaseApis=l;var o=n(33),i=n(0),s=n(19),a=r(n(2)),c=n(13);function u(e,t){switch(e){case o.SERVICE_TYPES.IS:return t+c.PREFIX_IDENTITY_V2+"/terms";case o.SERVICE_TYPES.IM:return t+"/_matrix/integrations/v1/terms";default:throw new Error("Unsupported service type")}}function l(e){a.checkObjectHasKeys(e,["baseUrl","request"]),this.baseUrl=e.baseUrl,this.idBaseUrl=e.idBaseUrl,this.identityServer=e.identityServer;const t={baseUrl:e.baseUrl,idBaseUrl:e.idBaseUrl,accessToken:e.accessToken,request:e.request,prefix:c.PREFIX_R0,onlyData:!0,extraParams:e.queryParams,localTimeoutMs:e.localTimeoutMs,useAuthorizationHeader:e.useAuthorizationHeader};this._http=new c.MatrixHttpApi(this,t),this._txnCtr=0}l.prototype.getHomeserverUrl=function(){return this.baseUrl},l.prototype.getIdentityServerUrl=function(e=!1){return e&&(this.idBaseUrl.startsWith("http://")||this.idBaseUrl.startsWith("https://"))?this.idBaseUrl.split("://")[1]:this.idBaseUrl},l.prototype.setIdentityServerUrl=function(e){this.idBaseUrl=a.ensureNoTrailingSlash(e),this._http.setIdBaseUrl(this.idBaseUrl)},l.prototype.getAccessToken=function(){return this._http.opts.accessToken||null},l.prototype.isLoggedIn=function(){return void 0!==this._http.opts.accessToken},l.prototype.makeTxnId=function(){return"m"+(new Date).getTime()+"."+this._txnCtr++},l.prototype.isUsernameAvailable=function(e){return this._http.authedRequest(void 0,"GET","/register/available",{username:e}).then(e=>e.available)},l.prototype.register=function(e,t,n,r,o,i,s,a){!0===o?o={email:!0}:null==o&&(o={}),"function"==typeof s&&(a=s,s=void 0),null==r&&(r={}),n&&(r.session=n);const c={auth:r};return null!=e&&(c.username=e),null!=t&&(c.password=t),o.email&&(c.bind_email=!0),o.msisdn&&(c.bind_msisdn=!0),null!=i&&(c.guest_access_token=i),null!=s&&(c.inhibit_login=s),null!=t&&(c.x_show_msisdn=!0),this.registerRequest(c,void 0,a)},l.prototype.registerGuest=function(e,t){return(e=e||{}).body=e.body||{},this.registerRequest(e.body,"guest",t)},l.prototype.registerRequest=function(e,t,n){const r={};return t&&(r.kind=t),this._http.request(n,"POST","/register",r,e)},l.prototype.loginFlows=function(e){return this._http.request(e,"GET","/login")},l.prototype.login=function(e,t,n){const r={type:e};return a.extend(r,t),this._http.authedRequest((e,t)=>{t&&t.access_token&&t.user_id&&(this._http.opts.accessToken=t.access_token,this.credentials={userId:t.user_id}),n&&n(e,t)},"POST","/login",void 0,r)},l.prototype.loginWithPassword=function(e,t,n){return this.login("m.login.password",{user:e,password:t},n)},l.prototype.loginWithSAML2=function(e,t){return this.login("m.login.saml2",{relay_state:e},t)},l.prototype.getCasLoginUrl=function(e){return this.getSsoLoginUrl(e,"cas")},l.prototype.getSsoLoginUrl=function(e,t){return void 0===t&&(t="sso"),this._http.getUrl("/login/"+t+"/redirect",{redirectUrl:e},c.PREFIX_R0)},l.prototype.loginWithToken=function(e,t){return this.login("m.login.token",{token:e},t)},l.prototype.logout=function(e){return this._http.authedRequest(e,"POST","/logout")},l.prototype.deactivateAccount=function(e,t){if("function"==typeof t)throw new Error("deactivateAccount no longer accepts a callback parameter");const n={};return e&&(n.auth=e),void 0!==t&&(n.erase=t),this._http.authedRequest(void 0,"POST","/account/deactivate",void 0,n)},l.prototype.getFallbackAuthUrl=function(e,t){const n=a.encodeUri("/auth/$loginType/fallback/web",{$loginType:e});return this._http.getUrl(n,{session:t},c.PREFIX_R0)},l.prototype.createRoom=function(e,t){return this._http.authedRequest(t,"POST","/createRoom",void 0,e)},l.prototype.fetchRelations=async function(e,t,n,r,o){const i={};o.from&&(i.from=o.from);const s=a.encodeParams(i),u=a.encodeUri("/rooms/$roomId/relations/$eventId/$relationType/$eventType?"+s,{$roomId:e,$eventId:t,$relationType:n,$eventType:r});return await this._http.authedRequest(void 0,"GET",u,null,null,{prefix:c.PREFIX_UNSTABLE})},l.prototype.roomState=function(e,t){const n=a.encodeUri("/rooms/$roomId/state",{$roomId:e});return this._http.authedRequest(t,"GET",n)},l.prototype.fetchRoomEvent=function(e,t,n){const r=a.encodeUri("/rooms/$roomId/event/$eventId",{$roomId:e,$eventId:t});return this._http.authedRequest(n,"GET",r)},l.prototype.members=function(e,t,n,r,o){const i={};t&&(i.membership=t),n&&(i.not_membership=n),r&&(i.at=r);const s=a.encodeParams(i),c=a.encodeUri("/rooms/$roomId/members?"+s,{$roomId:e});return this._http.authedRequest(o,"GET",c)},l.prototype.upgradeRoom=function(e,t){const n=a.encodeUri("/rooms/$roomId/upgrade",{$roomId:e});return this._http.authedRequest(void 0,"POST",n,void 0,{new_version:t})},l.prototype.getGroupSummary=function(e){const t=a.encodeUri("/groups/$groupId/summary",{$groupId:e});return this._http.authedRequest(void 0,"GET",t)},l.prototype.getGroupProfile=function(e){const t=a.encodeUri("/groups/$groupId/profile",{$groupId:e});return this._http.authedRequest(void 0,"GET",t)},l.prototype.setGroupProfile=function(e,t){const n=a.encodeUri("/groups/$groupId/profile",{$groupId:e});return this._http.authedRequest(void 0,"POST",n,void 0,t)},l.prototype.setGroupJoinPolicy=function(e,t){const n=a.encodeUri("/groups/$groupId/settings/m.join_policy",{$groupId:e});return this._http.authedRequest(void 0,"PUT",n,void 0,{"m.join_policy":t})},l.prototype.getGroupUsers=function(e){const t=a.encodeUri("/groups/$groupId/users",{$groupId:e});return this._http.authedRequest(void 0,"GET",t)},l.prototype.getGroupInvitedUsers=function(e){const t=a.encodeUri("/groups/$groupId/invited_users",{$groupId:e});return this._http.authedRequest(void 0,"GET",t)},l.prototype.getGroupRooms=function(e){const t=a.encodeUri("/groups/$groupId/rooms",{$groupId:e});return this._http.authedRequest(void 0,"GET",t)},l.prototype.inviteUserToGroup=function(e,t){const n=a.encodeUri("/groups/$groupId/admin/users/invite/$userId",{$groupId:e,$userId:t});return this._http.authedRequest(void 0,"PUT",n,void 0,{})},l.prototype.removeUserFromGroup=function(e,t){const n=a.encodeUri("/groups/$groupId/admin/users/remove/$userId",{$groupId:e,$userId:t});return this._http.authedRequest(void 0,"PUT",n,void 0,{})},l.prototype.addUserToGroupSummary=function(e,t,n){const r=a.encodeUri(n?"/groups/$groupId/summary/$roleId/users/$userId":"/groups/$groupId/summary/users/$userId",{$groupId:e,$roleId:n,$userId:t});return this._http.authedRequest(void 0,"PUT",r,void 0,{})},l.prototype.removeUserFromGroupSummary=function(e,t){const n=a.encodeUri("/groups/$groupId/summary/users/$userId",{$groupId:e,$userId:t});return this._http.authedRequest(void 0,"DELETE",n,void 0,{})},l.prototype.addRoomToGroupSummary=function(e,t,n){const r=a.encodeUri(n?"/groups/$groupId/summary/$categoryId/rooms/$roomId":"/groups/$groupId/summary/rooms/$roomId",{$groupId:e,$categoryId:n,$roomId:t});return this._http.authedRequest(void 0,"PUT",r,void 0,{})},l.prototype.removeRoomFromGroupSummary=function(e,t){const n=a.encodeUri("/groups/$groupId/summary/rooms/$roomId",{$groupId:e,$roomId:t});return this._http.authedRequest(void 0,"DELETE",n,void 0,{})},l.prototype.addRoomToGroup=function(e,t,n){void 0===n&&(n=!0);const r=a.encodeUri("/groups/$groupId/admin/rooms/$roomId",{$groupId:e,$roomId:t});return this._http.authedRequest(void 0,"PUT",r,void 0,{"m.visibility":{type:n?"public":"private"}})},l.prototype.updateGroupRoomVisibility=function(e,t,n){const r=a.encodeUri("/groups/$groupId/admin/rooms/$roomId/config/m.visibility",{$groupId:e,$roomId:t});return this._http.authedRequest(void 0,"PUT",r,void 0,{type:n?"public":"private"})},l.prototype.removeRoomFromGroup=function(e,t){const n=a.encodeUri("/groups/$groupId/admin/rooms/$roomId",{$groupId:e,$roomId:t});return this._http.authedRequest(void 0,"DELETE",n,void 0,{})},l.prototype.acceptGroupInvite=function(e,t=null){const n=a.encodeUri("/groups/$groupId/self/accept_invite",{$groupId:e});return this._http.authedRequest(void 0,"PUT",n,void 0,t||{})},l.prototype.joinGroup=function(e){const t=a.encodeUri("/groups/$groupId/self/join",{$groupId:e});return this._http.authedRequest(void 0,"PUT",t,void 0,{})},l.prototype.leaveGroup=function(e){const t=a.encodeUri("/groups/$groupId/self/leave",{$groupId:e});return this._http.authedRequest(void 0,"PUT",t,void 0,{})},l.prototype.getJoinedGroups=function(){const e=a.encodeUri("/joined_groups");return this._http.authedRequest(void 0,"GET",e)},l.prototype.createGroup=function(e){const t=a.encodeUri("/create_group");return this._http.authedRequest(void 0,"POST",t,void 0,e)},l.prototype.getPublicisedGroups=function(e){const t=a.encodeUri("/publicised_groups");return this._http.authedRequest(void 0,"POST",t,void 0,{user_ids:e})},l.prototype.setGroupPublicity=function(e,t){const n=a.encodeUri("/groups/$groupId/self/update_publicity",{$groupId:e});return this._http.authedRequest(void 0,"PUT",n,void 0,{publicise:t})},l.prototype.getStateEvent=function(e,t,n,r){const o={$roomId:e,$eventType:t,$stateKey:n};let i=a.encodeUri("/rooms/$roomId/state/$eventType",o);return void 0!==n&&(i=a.encodeUri(i+"/$stateKey",o)),this._http.authedRequest(r,"GET",i)},l.prototype.sendStateEvent=function(e,t,n,r,o){const i={$roomId:e,$eventType:t,$stateKey:r};let s=a.encodeUri("/rooms/$roomId/state/$eventType",i);return void 0!==r&&(s=a.encodeUri(s+"/$stateKey",i)),this._http.authedRequest(o,"PUT",s,void 0,n)},l.prototype.roomInitialSync=function(e,t,n){a.isFunction(t)&&(n=t,t=void 0);const r=a.encodeUri("/rooms/$roomId/initialSync",{$roomId:e});return t||(t=30),this._http.authedRequest(n,"GET",r,{limit:t})},l.prototype.setRoomReadMarkersHttpRequest=function(e,t,n,r){const o=a.encodeUri("/rooms/$roomId/read_markers",{$roomId:e}),i={"m.fully_read":t,"m.read":n,"m.hidden":Boolean(!!r&&r.hidden)};return this._http.authedRequest(void 0,"POST",o,void 0,i)},l.prototype.getJoinedRooms=function(){const e=a.encodeUri("/joined_rooms");return this._http.authedRequest(void 0,"GET",e)},l.prototype.getJoinedRoomMembers=function(e){const t=a.encodeUri("/rooms/$roomId/joined_members",{$roomId:e});return this._http.authedRequest(void 0,"GET",t)},l.prototype.publicRooms=function(e,t){"function"==typeof e&&(t=e,e={}),void 0===e&&(e={});const n={};return e.server&&(n.server=e.server,delete e.server),0===Object.keys(e).length&&0===Object.keys(n).length?this._http.authedRequest(t,"GET","/publicRooms"):this._http.authedRequest(t,"POST","/publicRooms",n,e)},l.prototype.createAlias=function(e,t,n){const r=a.encodeUri("/directory/room/$alias",{$alias:e}),o={room_id:t};return this._http.authedRequest(n,"PUT",r,void 0,o)},l.prototype.deleteAlias=function(e,t){const n=a.encodeUri("/directory/room/$alias",{$alias:e});return this._http.authedRequest(t,"DELETE",n,void 0,void 0)},l.prototype.getRoomIdForAlias=function(e,t){const n=a.encodeUri("/directory/room/$alias",{$alias:e});return this._http.authedRequest(t,"GET",n)},l.prototype.resolveRoomAlias=function(e,t){const n=a.encodeUri("/directory/room/$alias",{$alias:e});return this._http.request(t,"GET",n)},l.prototype.getRoomDirectoryVisibility=function(e,t){const n=a.encodeUri("/directory/list/room/$roomId",{$roomId:e});return this._http.authedRequest(t,"GET",n)},l.prototype.setRoomDirectoryVisibility=function(e,t,n){const r=a.encodeUri("/directory/list/room/$roomId",{$roomId:e});return this._http.authedRequest(n,"PUT",r,void 0,{visibility:t})},l.prototype.setRoomDirectoryVisibilityAppService=function(e,t,n,r){const o=a.encodeUri("/directory/list/appservice/$networkId/$roomId",{$networkId:e,$roomId:t});return this._http.authedRequest(r,"PUT",o,void 0,{visibility:n})},l.prototype.searchUserDirectory=function(e){const t={search_term:e.term};return void 0!==e.limit&&(t.limit=e.limit),this._http.authedRequest(void 0,"POST","/user_directory/search",void 0,t)},l.prototype.uploadContent=function(e,t){return this._http.uploadContent(e,t)},l.prototype.cancelUpload=function(e){return this._http.cancelUpload(e)},l.prototype.getCurrentUploads=function(){return this._http.getCurrentUploads()},l.prototype.getProfileInfo=function(e,t,n){a.isFunction(t)&&(n=t,t=void 0);const r=t?a.encodeUri("/profile/$userId/$info",{$userId:e,$info:t}):a.encodeUri("/profile/$userId",{$userId:e});return this._http.authedRequest(n,"GET",r)},l.prototype.getThreePids=function(e){return this._http.authedRequest(e,"GET","/account/3pid",void 0,void 0)},l.prototype.addThreePid=function(e,t,n){const r={threePidCreds:e,bind:t};return this._http.authedRequest(n,"POST","/account/3pid",null,r)},l.prototype.addThreePidOnly=async function(e){const t=await this.isVersionSupported("r0.6.0")?c.PREFIX_R0:c.PREFIX_UNSTABLE;return this._http.authedRequest(void 0,"POST","/account/3pid/add",null,e,{prefix:t})},l.prototype.bindThreePid=async function(e){const t=await this.isVersionSupported("r0.6.0")?c.PREFIX_R0:c.PREFIX_UNSTABLE;return this._http.authedRequest(void 0,"POST","/account/3pid/bind",null,e,{prefix:t})},l.prototype.unbindThreePid=async function(e,t){const n={medium:e,address:t,id_server:this.getIdentityServerUrl(!0)},r=await this.isVersionSupported("r0.6.0")?c.PREFIX_R0:c.PREFIX_UNSTABLE;return this._http.authedRequest(void 0,"POST","/account/3pid/unbind",null,n,{prefix:r})},l.prototype.deleteThreePid=function(e,t){const n={medium:e,address:t};return this._http.authedRequest(void 0,"POST","/account/3pid/delete",null,n)},l.prototype.setPassword=function(e,t,n){const r={auth:e,new_password:t};return this._http.authedRequest(n,"POST","/account/password",null,r)},l.prototype.getDevices=function(){return this._http.authedRequest(void 0,"GET","/devices",void 0,void 0)},l.prototype.setDeviceDetails=function(e,t){const n=a.encodeUri("/devices/$device_id",{$device_id:e});return this._http.authedRequest(void 0,"PUT",n,void 0,t)},l.prototype.deleteDevice=function(e,t){const n=a.encodeUri("/devices/$device_id",{$device_id:e}),r={};return t&&(r.auth=t),this._http.authedRequest(void 0,"DELETE",n,void 0,r)},l.prototype.deleteMultipleDevices=function(e,t){const n={devices:e};t&&(n.auth=t);return this._http.authedRequest(void 0,"POST","/delete_devices",void 0,n)},l.prototype.getPushers=function(e){return this._http.authedRequest(e,"GET","/pushers",void 0,void 0)},l.prototype.setPusher=function(e,t){return this._http.authedRequest(t,"POST","/pushers/set",null,e)},l.prototype.getPushRules=function(e){return this._http.authedRequest(e,"GET","/pushrules/").then(e=>s.PushProcessor.rewriteDefaultRules(e))},l.prototype.addPushRule=function(e,t,n,r,o){const i=a.encodeUri("/pushrules/"+e+"/$kind/$ruleId",{$kind:t,$ruleId:n});return this._http.authedRequest(o,"PUT",i,void 0,r)},l.prototype.deletePushRule=function(e,t,n,r){const o=a.encodeUri("/pushrules/"+e+"/$kind/$ruleId",{$kind:t,$ruleId:n});return this._http.authedRequest(r,"DELETE",o)},l.prototype.setPushRuleEnabled=function(e,t,n,r,o){const i=a.encodeUri("/pushrules/"+e+"/$kind/$ruleId/enabled",{$kind:t,$ruleId:n});return this._http.authedRequest(o,"PUT",i,void 0,{enabled:r})},l.prototype.setPushRuleActions=function(e,t,n,r,o){const i=a.encodeUri("/pushrules/"+e+"/$kind/$ruleId/actions",{$kind:t,$ruleId:n});return this._http.authedRequest(o,"PUT",i,void 0,{actions:r})},l.prototype.search=function(e,t){const n={};return e.next_batch&&(n.next_batch=e.next_batch),this._http.authedRequest(t,"POST","/search",n,e.body)},l.prototype.uploadKeysRequest=function(e,t,n){const r=(t=t||{}).device_id;let o;return o=r?a.encodeUri("/keys/upload/$deviceId",{$deviceId:r}):"/keys/upload",this._http.authedRequest(n,"POST",o,void 0,e)},l.prototype.uploadKeySignatures=function(e){return this._http.authedRequest(void 0,"POST","/keys/signatures/upload",void 0,e,{prefix:c.PREFIX_UNSTABLE})},l.prototype.downloadKeysForUsers=function(e,t){if(a.isFunction(t))throw new Error("downloadKeysForUsers no longer accepts a callback parameter");const n={device_keys:{}};return"token"in(t=t||{})&&(n.token=t.token),e.forEach(e=>{n.device_keys[e]={}}),this._http.authedRequest(void 0,"POST","/keys/query",void 0,n)},l.prototype.claimOneTimeKeys=function(e,t){const n={};void 0===t&&(t="signed_curve25519");for(let r=0;r<e.length;++r){const o=e[r][0],i=e[r][1],s=n[o]||{};n[o]=s,s[i]=t}const r={one_time_keys:n};return this._http.authedRequest(void 0,"POST","/keys/claim",void 0,r)},l.prototype.getKeyChanges=function(e,t){const n={from:e,to:t};return this._http.authedRequest(void 0,"GET","/keys/changes",n,void 0)},l.prototype.uploadDeviceSigningKeys=function(e,t){const n=Object.assign({},t,{auth:e});return this._http.authedRequest(void 0,"POST","/keys/device_signing/upload",void 0,n,{prefix:c.PREFIX_UNSTABLE})},l.prototype.registerWithIdentityServer=function(e){if(!this.idBaseUrl)throw new Error("No Identity Server base URL set");const t=this.idBaseUrl+c.PREFIX_IDENTITY_V2+"/account/register";return this._http.requestOtherUrl(void 0,"POST",t,null,e)},l.prototype.requestEmailToken=async function(e,t,n,r,o,s){const a={client_secret:t,email:e,send_attempt:n,next_link:r};try{const e=await this._http.idServerRequest(void 0,"POST","/validate/email/requestToken",a,c.PREFIX_IDENTITY_V2,s);return o&&o(null,e),e}catch(e){if("rejected"===e.cors||404===e.httpStatus)return i.logger.warn("IS doesn't support v2, falling back to deprecated v1"),await this._http.idServerRequest(o,"POST","/validate/email/requestToken",a,c.PREFIX_IDENTITY_V1);throw o&&o(e),e}},l.prototype.requestMsisdnToken=async function(e,t,n,r,o,s,a){const u={client_secret:n,country:e,phone_number:t,send_attempt:r,next_link:o};try{const e=await this._http.idServerRequest(void 0,"POST","/validate/msisdn/requestToken",u,c.PREFIX_IDENTITY_V2,a);return s&&s(null,e),e}catch(e){if("rejected"===e.cors||404===e.httpStatus)return i.logger.warn("IS doesn't support v2, falling back to deprecated v1"),await this._http.idServerRequest(s,"POST","/validate/msisdn/requestToken",u,c.PREFIX_IDENTITY_V1);throw s&&s(e),e}},l.prototype.submitMsisdnToken=async function(e,t,n,r){const o={sid:e,client_secret:t,token:n};try{return await this._http.idServerRequest(void 0,"POST","/validate/msisdn/submitToken",o,c.PREFIX_IDENTITY_V2,r)}catch(e){if("rejected"===e.cors||404===e.httpStatus)return i.logger.warn("IS doesn't support v2, falling back to deprecated v1"),await this._http.idServerRequest(void 0,"POST","/validate/msisdn/submitToken",o,c.PREFIX_IDENTITY_V1);throw e}},l.prototype.submitMsisdnTokenOtherUrl=function(e,t,n,r){const o={sid:t,client_secret:n,token:r};return this._http.requestOtherUrl(void 0,"POST",e,void 0,o)},l.prototype.getIdentityHashDetails=function(e){return this._http.idServerRequest(void 0,"GET","/hash_details",null,c.PREFIX_IDENTITY_V2,e)},l.prototype.identityHashedLookup=async function(t,n){const r={},o=await this.getIdentityHashDetails(n);if(!o||!o.lookup_pepper||!o.algorithms)throw new Error("Unsupported identity server: bad response");r.pepper=o.lookup_pepper;const i={};if(o.algorithms.includes("sha256")){const n=new e.Olm.Utility;r.addresses=t.map(e=>{const t=e[0].toLowerCase(),o=e[1].toLowerCase(),s=n.sha256(`${t} ${o} ${r.pepper}`).replace(/\+/g,"-").replace(/\//g,"_");return i[s]=e[0],s}),r.algorithm="sha256"}else{if(!o.algorithms.includes("none"))throw new Error("Unsupported identity server: unknown hash algorithm");r.addresses=t.map(e=>{const t=`${e[0].toLowerCase()} ${e[1].toLowerCase()}`;return i[t]=e[0],t}),r.algorithm="none"}const s=await this._http.idServerRequest(void 0,"POST","/lookup",r,c.PREFIX_IDENTITY_V2,n);if(!s||!s.mappings)return[];const a=[];for(const e of Object.keys(s.mappings)){const t=s.mappings[e],n=i[e];if(!n)throw new Error("Identity server returned more results than expected");a.push({address:n,mxid:t})}return a},l.prototype.lookupThreePid=async function(e,t,n,r){try{const o=(await this.identityHashedLookup([[t,e]],r)).find(e=>e.address===t);if(!o)return n&&n(null,{}),{};const i={address:t,medium:e,mxid:o.mxid};return n&&n(null,i),i}catch(r){if("rejected"===r.cors||404===r.httpStatus){const r={medium:e,address:t};return i.logger.warn("IS doesn't support v2, falling back to deprecated v1"),await this._http.idServerRequest(n,"GET","/lookup",r,c.PREFIX_IDENTITY_V1)}throw n&&n(r,void 0),r}},l.prototype.bulkLookupThreePids=async function(e,t){try{const n=await this.identityHashedLookup(e.map(e=>[e[1],e[0]]),t),r=[];for(const t of n){const n=e.find(e=>e[1]===t.address);if(!n)throw new Error("Identity sever returned unexpected results");r.push([n[0],t.address,t.mxid])}return{threepids:r}}catch(n){if("rejected"===n.cors||404===n.httpStatus){const n={threepids:e};return i.logger.warn("IS doesn't support v2, falling back to deprecated v1"),await this._http.idServerRequest(void 0,"POST","/bulk_lookup",n,c.PREFIX_IDENTITY_V1,t)}throw n}},l.prototype.getIdentityAccount=function(e){return this._http.idServerRequest(void 0,"GET","/account",void 0,c.PREFIX_IDENTITY_V2,e)},l.prototype.sendToDevice=function(e,t,n){const r=a.encodeUri("/sendToDevice/$eventType/$txnId",{$eventType:e,$txnId:n||this.makeTxnId()}),o={messages:t},s=Object.keys(t).reduce((e,n)=>(e[n]=Object.keys(t[n]),e),{});return i.logger.log(`PUT ${r}`,s),this._http.authedRequest(void 0,"PUT",r,void 0,o)},l.prototype.getThirdpartyProtocols=function(){return this._http.authedRequest(void 0,"GET","/thirdparty/protocols",void 0,void 0).then(e=>{if(!e||"object"!=typeof e)throw new Error(`/thirdparty/protocols did not return an object: ${e}`);return e})},l.prototype.getThirdpartyLocation=function(e,t){const n=a.encodeUri("/thirdparty/location/$protocol",{$protocol:e});return this._http.authedRequest(void 0,"GET",n,t,void 0)},l.prototype.getThirdpartyUser=function(e,t){const n=a.encodeUri("/thirdparty/user/$protocol",{$protocol:e});return this._http.authedRequest(void 0,"GET",n,t,void 0)},l.prototype.getTerms=function(e,t){const n=u(e,t);return this._http.requestOtherUrl(void 0,"GET",n)},l.prototype.agreeToTerms=function(e,t,n,r){const o=u(e,t),i={Authorization:"Bearer "+n};return this._http.requestOtherUrl(void 0,"POST",o,null,{user_accepts:r},{headers:i})},l.prototype.reportEvent=function(e,t,n,r){const o=a.encodeUri("/rooms/$roomId/report/$eventId",{$roomId:e,$eventId:t});return this._http.authedRequest(void 0,"POST",o,null,{score:n,reason:r})}}).call(this,n(3))},function(e,t,n){"use strict";
/*!
 * content-type
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var r=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,o=/^[\u000b\u0020-\u007e\u0080-\u00ff]+$/,i=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+$/,s=/\\([\u000b\u0020-\u00ff])/g,a=/([\\"])/g,c=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/;function u(e){var t=String(e);if(i.test(t))return t;if(t.length>0&&!o.test(t))throw new TypeError("invalid parameter value");return'"'+t.replace(a,"\\$1")+'"'}function l(e){this.parameters=Object.create(null),this.type=e}t.format=function(e){if(!e||"object"!=typeof e)throw new TypeError("argument obj is required");var t=e.parameters,n=e.type;if(!n||!c.test(n))throw new TypeError("invalid type");var r=n;if(t&&"object"==typeof t)for(var o,s=Object.keys(t).sort(),a=0;a<s.length;a++){if(o=s[a],!i.test(o))throw new TypeError("invalid parameter name");r+="; "+o+"="+u(t[o])}return r},t.parse=function(e){if(!e)throw new TypeError("argument string is required");var t="object"==typeof e?function(e){var t;"function"==typeof e.getHeader?t=e.getHeader("content-type"):"object"==typeof e.headers&&(t=e.headers&&e.headers["content-type"]);if("string"!=typeof t)throw new TypeError("content-type header is missing from object");return t}(e):e;if("string"!=typeof t)throw new TypeError("argument string is required to be a string");var n=t.indexOf(";"),o=-1!==n?t.substr(0,n).trim():t.trim();if(!c.test(o))throw new TypeError("invalid media type");var i=new l(o.toLowerCase());if(-1!==n){var a,u,d;for(r.lastIndex=n;u=r.exec(t);){if(u.index!==n)throw new TypeError("invalid parameter format");n+=u[0].length,a=u[1].toLowerCase(),'"'===(d=u[2])[0]&&(d=d.substr(1,d.length-2).replace(s,"$1")),i.parameters[a]=d}if(n!==t.length)throw new TypeError("invalid parameter format")}return i}},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.setNow=function(e){u=e||Date.now},t.setTimeout=function(e,t){(t=t||0)<0&&(t=0);const n=Array.prototype.slice.call(arguments,2),r=u()+t,o=s++;c("setTimeout: scheduling cb",o,"at",r,"(delay",t,")");const i={runAt:r,func:e,params:n,key:o},d=function(e,t){let n=0,r=e.length;for(;n<r;){const o=n+r>>1;t(e[o])>0?r=o:n=o+1}return n}(a,(function(e){return e.runAt-r}));return a.splice(d,0,i),l(),o},t.clearTimeout=function(e){if(0===a.length)return;let t;for(t=0;t<a.length;t++){if(a[t].key==e){a.splice(t,1);break}}0===t&&l()};var r=n(0);const o=1e3;let i,s=0;const a=[],c=function(){};let u=Date.now;function l(){i&&e.clearTimeout(i);const t=a[0];if(!t)return void c("_scheduleRealCallback: no more callbacks, not rescheduling");const n=u(),r=Math.min(t.runAt-n,o);c("_scheduleRealCallback: now:",n,"delay:",r),i=e.setTimeout(d,r)}function d(){let t;const n=u();c("_runCallbacks: now:",n);const o=[];for(;;){const e=a[0];if(!e||e.runAt>n)break;t=a.shift(),c("_runCallbacks: popping",t.key),o.push(t)}l();for(let n=0;n<o.length;n++){t=o[n];try{t.func.apply(e,t.params)}catch(e){r.logger.error("Uncaught exception in callback function",e.stack||e)}}}}).call(this,n(3))},function(e,t,n){"use strict";function r(e){this.filter_json=e,this.types=e.types||null,this.not_types=e.not_types||[],this.rooms=e.rooms||null,this.not_rooms=e.not_rooms||[],this.senders=e.senders||null,this.not_senders=e.not_senders||[],this.contains_url=e.contains_url||null}Object.defineProperty(t,"__esModule",{value:!0}),t.FilterComponent=r,r.prototype.check=function(e){return this._checkFields(e.getRoomId(),e.getSender(),e.getType(),!!e.getContent()&&void 0!==e.getContent().url)},r.prototype._checkFields=function(e,t,n,r){const o={rooms:function(t){return e===t},senders:function(e){return t===e},types:function(e){return function(e,t){if(t.endsWith("*")){const n=t.slice(0,-1);return e.substr(0,n.length)===n}return e===t}(n,e)}},i=this;for(let e=0;e<Object.keys(o).length;e++){const t=Object.keys(o)[e],n=o[t];if(i["not_"+t].filter(n).length>0)return!1;const r=i[t];if(r&&!r.map(n))return!1}const s=this.filter_json.contains_url;return void 0===s||s===r},r.prototype.filter=function(e){return e.filter(this.check,this)},r.prototype.limit=function(){return void 0!==this.filter_json.limit?this.filter_json.limit:10}},function(e,t,n){"use strict";(function(e){var r=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.SyncApi=m;var o=n(12),i=n(34),s=n(37),a=r(n(2)),c=n(20),u=n(8),l=n(19),d=n(0),h=n(23);const f=!0;function p(e,t){return"FILTER_SYNC_"+e+(t?"_"+t:"")}function g(...e){f&&d.logger.log(...e)}function m(e,t){this.client=e,(t=t||{}).initialSyncLimit=void 0===t.initialSyncLimit?8:t.initialSyncLimit,t.resolveInvitesToProfiles=t.resolveInvitesToProfiles||!1,t.pollTimeout=t.pollTimeout||3e4,t.pendingEventOrdering=t.pendingEventOrdering||"chronological",t.canResetEntireTimeline||(t.canResetEntireTimeline=function(e){return!1}),this.opts=t,this._peekRoomId=null,this._currentSyncRequest=null,this._syncState=null,this._syncStateData=null,this._catchingUp=!1,this._running=!1,this._keepAliveTimer=null,this._connectionReturnedDefer=null,this._notifEvents=[],this._failedSyncCount=0,this._storeIsInvalid=!1,e.getNotifTimelineSet()&&e.reEmitter.reEmit(e.getNotifTimelineSet(),["Room.timeline","Room.timelineReset"])}function y(e,t){const n=new o.User(t);return e.reEmitter.reEmit(n,["User.avatarUrl","User.displayName","User.presence","User.currentlyActive","User.lastPresenceTs"]),n}m.prototype.createRoom=function(e){const t=this.client,{timelineSupport:n,unstableClientRelationAggregation:r}=t,o=new i.Room(e,t,t.getUserId(),{lazyLoadMembers:this.opts.lazyLoadMembers,pendingEventOrdering:this.opts.pendingEventOrdering,timelineSupport:n,unstableClientRelationAggregation:r});return t.reEmitter.reEmit(o,["Room.name","Room.timeline","Room.redaction","Room.redactionCancelled","Room.receipt","Room.tags","Room.timelineReset","Room.localEchoUpdated","Room.accountData","Room.myMembership","Room.replaceEvent"]),this._registerStateListeners(o),o},m.prototype.createGroup=function(e){const t=this.client,n=new s.Group(e);return t.reEmitter.reEmit(n,["Group.profile","Group.myMembership"]),t.store.storeGroup(n),n},m.prototype._registerStateListeners=function(e){const t=this.client;t.reEmitter.reEmit(e.currentState,["RoomState.events","RoomState.members","RoomState.newMember"]),e.currentState.on("RoomState.newMember",(function(e,n,r){r.user=t.getUser(r.userId),t.reEmitter.reEmit(r,["RoomMember.name","RoomMember.typing","RoomMember.powerLevel","RoomMember.membership"])}))},m.prototype._deregisterStateListeners=function(e){e.currentState.removeAllListeners("RoomState.events"),e.currentState.removeAllListeners("RoomState.members"),e.currentState.removeAllListeners("RoomState.newMember")},m.prototype.syncLeftRooms=function(){const e=this.client,t=this,n=new c.Filter(this.client.credentials.userId);n.setTimelineLimit(1),n.setIncludeLeaveRooms(!0);const r=this.opts.pollTimeout+8e4,o={timeout:0};return e.getOrCreateFilter(p(e.credentials.userId,"LEFT_ROOMS"),n).then((function(t){return o.filter=t,e._http.authedRequest(void 0,"GET","/sync",o,void 0,r)})).then((function(n){let r=[];n.rooms&&n.rooms.leave&&(r=t._mapSyncResponseToRoomArray(n.rooms.leave));const o=[];return r.forEach((function(n){const r=n.room;if(o.push(r),!n.isBrandNewRoom)return;n.timeline=n.timeline||{};const i=t._mapSyncEventsFormat(n.timeline,r),s=t._mapSyncEventsFormat(n.state,r);r.getLiveTimeline().setPaginationToken(n.timeline.prev_batch,u.EventTimeline.BACKWARDS),t._processRoomEvents(r,s,i),r.recalculate(),e.store.storeRoom(r),e.emit("Room",r),t._processEventsForNotifs(r,i)})),o}))},m.prototype.peek=function(e){const t=this,n=this.client;return this._peekRoomId=e,this.client.roomInitialSync(e,20).then((function(r){r.messages=r.messages||{},r.messages.chunk=r.messages.chunk||[],r.state=r.state||[];const o=t.createRoom(e),i=a.map(a.deepCopy(r.state),n.getEventMapper()),s=a.map(r.state,n.getEventMapper()),c=a.map(r.messages.chunk,n.getEventMapper());return r.presence&&a.isArray(r.presence)&&r.presence.map(n.getEventMapper()).forEach((function(e){let t=n.store.getUser(e.getContent().user_id);t?t.setPresenceEvent(e):((t=y(n,e.getContent().user_id)).setPresenceEvent(e),n.store.storeUser(t)),n.emit("event",e)})),r.messages.start&&(o.oldState.paginationToken=r.messages.start),o.oldState.setStateEvents(i),o.currentState.setStateEvents(s),t._resolveInvites(o),o.recalculate(),o.addEventsToTimeline(c.reverse(),!0,o.getLiveTimeline(),r.messages.start),n.store.storeRoom(o),n.emit("Room",o),t._peekPoll(o),o}))},m.prototype.stopPeeking=function(){this._peekRoomId=null},m.prototype._peekPoll=function(e,t){if(this._peekRoomId!==e.roomId)return void g("Stopped peeking in room %s",e.roomId);const n=this;this.client._http.authedRequest(void 0,"GET","/events",{room_id:e.roomId,timeout:3e4,from:t},void 0,5e4).then((function(t){if(n._peekRoomId!==e.roomId)return void g("Stopped peeking in room %s",e.roomId);t.chunk.filter((function(e){return"m.presence"===e.type})).map(n.client.getEventMapper()).forEach((function(e){let t=n.client.store.getUser(e.getContent().user_id);t?t.setPresenceEvent(e):((t=y(n.client,e.getContent().user_id)).setPresenceEvent(e),n.client.store.storeUser(t)),n.client.emit("event",e)}));const r=t.chunk.filter((function(t){return t.room_id===e.roomId})).map(n.client.getEventMapper());e.addLiveEvents(r),n._peekPoll(e,t.end)}),(function(r){d.logger.error("[%s] Peek poll failed: %s",e.roomId,r),setTimeout((function(){n._peekPoll(e,t)}),3e4)}))},m.prototype.getSyncState=function(){return this._syncState},m.prototype.getSyncStateData=function(){return this._syncStateData},m.prototype.recoverFromSyncStartupError=async function(e,t){await e;const n=this._startKeepAlives();this._updateSyncState("ERROR",{error:t}),await n},m.prototype._wasLazyLoadingToggled=async function(e){e=!!e;let t=!1;if(!await this.client.store.isNewlyCreated()){const n=await this.client.store.getClientOptions();return n&&(t=!!n.lazyLoadMembers),t!==e}return!1},m.prototype._shouldAbortSync=function(e){return"M_UNKNOWN_TOKEN"===e.errcode&&(d.logger.warn("Token no longer valid - assuming logout"),this.stop(),!0)},m.prototype.sync=function(){const t=this.client,n=this;this._running=!0,e.document&&(this._onOnlineBound=this._onOnline.bind(this),e.document.addEventListener("online",this._onOnlineBound,!1));let r=Promise.resolve(),o=null;const i=async()=>{if(g("Checking lazy load status..."),this.opts.lazyLoadMembers&&t.isGuest()&&(this.opts.lazyLoadMembers=!1),this.opts.lazyLoadMembers){if(g("Checking server lazy load support..."),await t.doesServerSupportLazyLoading())try{g("Creating and storing lazy load sync filter..."),this.opts.filter=await t.createFilter(c.Filter.LAZY_LOADING_SYNC_FILTER),g("Created and stored lazy load sync filter")}catch(e){throw d.logger.error("Creating and storing lazy load sync filter failed",e),e}else g("LL: lazy loading requested but not supported by server, so disabling"),this.opts.lazyLoadMembers=!1}if(g("Checking whether lazy loading has changed in store..."),await this._wasLazyLoadingToggled(this.opts.lazyLoadMembers)){this._storeIsInvalid=!0;const e=h.InvalidStoreError.TOGGLED_LAZY_LOADING,t=new h.InvalidStoreError(e,!!this.opts.lazyLoadMembers);return this._updateSyncState("ERROR",{error:t}),void d.logger.warn("InvalidStoreError: store is not usable: stopping sync.")}this.opts.lazyLoadMembers&&this.opts.crypto&&this.opts.crypto.enableLazyLoading();try{g("Storing client options..."),await this.client._storeClientOptions(),g("Stored client options")}catch(e){throw d.logger.error("Storing client options failed",e),e}!async function e(){g("Getting filter...");let i;n.opts.filter?i=n.opts.filter:(i=new c.Filter(t.credentials.userId)).setTimelineLimit(n.opts.initialSyncLimit);let s;try{s=await t.getOrCreateFilter(p(t.credentials.userId),i)}catch(t){if(d.logger.error("Getting filter failed",t),n._shouldAbortSync(t))return;return g("Waiting for saved sync before retrying filter..."),await n.recoverFromSyncStartupError(r,t),void e()}t.resetNotifTimelineSet();null===n._currentSyncRequest&&(g("Sending first sync request..."),n._currentSyncRequest=n._doSyncRequest({filterId:s},o));g("Waiting for saved sync before starting sync processing...");await r;n._sync({filterId:s})}()};t.isGuest()?n._sync({}):(g("Getting saved sync token..."),r=t.store.getSavedSyncToken().then(e=>(g("Got saved sync token"),o=e,g("Getting saved sync..."),t.store.getSavedSync())).then(e=>{if(g(`Got reply from saved sync, exists? ${!!e}`),e)return n._syncFromCache(e)}).catch(e=>{d.logger.error("Getting saved sync failed",e)}),async function e(){try{g("Getting push rules...");const e=await t.getPushRules();g("Got push rules"),t.pushRules=e}catch(t){if(d.logger.error("Getting push rules failed",t),n._shouldAbortSync(t))return;return g("Waiting for saved sync before retrying push rules..."),await n.recoverFromSyncStartupError(r,t),void e()}i()}())},m.prototype.stop=function(){g("SyncApi.stop"),e.document&&(e.document.removeEventListener("online",this._onOnlineBound,!1),this._onOnlineBound=void 0),this._running=!1,this._currentSyncRequest&&this._currentSyncRequest.abort(),this._keepAliveTimer&&(clearTimeout(this._keepAliveTimer),this._keepAliveTimer=null)},m.prototype.retryImmediately=function(){return!!this._connectionReturnedDefer&&(this._startKeepAlives(0),!0)},m.prototype._syncFromCache=async function(e){g("sync(): not doing HTTP hit, instead returning stored /sync data");const t=e.nextBatch;this.client.store.setSyncToken(t);const n={oldSyncToken:null,nextSyncToken:t,catchingUp:!1},r={next_batch:t,rooms:e.roomsData,groups:e.groupsData,account_data:{events:e.accountData}};try{await this._processSyncResponse(n,r)}catch(e){d.logger.error("Error processing cached sync",e.stack||e)}this._storeIsInvalid||this._updateSyncState("PREPARED",n)},m.prototype._sync=async function(e){const t=this.client;if(!this._running)return g("Sync no longer running: exiting."),this._connectionReturnedDefer&&(this._connectionReturnedDefer.reject(),this._connectionReturnedDefer=null),void this._updateSyncState("STOPPED");const n=t.store.getSyncToken();let r;try{null===this._currentSyncRequest&&(this._currentSyncRequest=this._doSyncRequest(e,n)),r=await this._currentSyncRequest}catch(t){return void this._onSyncError(t,e)}finally{this._currentSyncRequest=null}t.store.setSyncToken(r.next_batch),this._failedSyncCount=0,await t.store.setSyncData(r);const o={oldSyncToken:n,nextSyncToken:r.next_batch,catchingUp:this._catchingUp};this.opts.crypto&&await this.opts.crypto.onSyncWillProcess(o);try{await this._processSyncResponse(o,r)}catch(e){d.logger.error("Caught /sync error",e.stack||e),this.client.emit("sync.unexpectedError",e)}o.catchingUp=this._catchingUp,e.hasSyncedBefore||(this._updateSyncState("PREPARED",o),e.hasSyncedBefore=!0),this.opts.crypto&&await this.opts.crypto.onSyncCompleted(o),this._updateSyncState("SYNCING",o),t.store.wantsSave()&&(this.opts.crypto&&await this.opts.crypto.saveDeviceList(0),t.store.save()),this._sync(e)},m.prototype._doSyncRequest=function(e,t){const n=this._getSyncParams(e,t);return this.client._http.authedRequest(void 0,"GET","/sync",n,void 0,n.timeout+8e4)},m.prototype._getSyncParams=function(e,t){let n=this.opts.pollTimeout;("SYNCING"!==this.getSyncState()||this._catchingUp)&&(this._catchingUp=!0,n=0);let r=e.filterId;this.client.isGuest()&&!r&&(r=this._getGuestFilter());const o={filter:r,timeout:n};return this.opts.disablePresence&&(o.set_presence="offline"),t?o.since=t:o._cacheBuster=Date.now(),"ERROR"!=this.getSyncState()&&"RECONNECTING"!=this.getSyncState()||(o.timeout=0),o},m.prototype._onSyncError=function(e,t){if(!this._running)return g("Sync no longer running: exiting"),this._connectionReturnedDefer&&(this._connectionReturnedDefer.reject(),this._connectionReturnedDefer=null),void this._updateSyncState("STOPPED");d.logger.error("/sync error %s",e),d.logger.error(e),this._shouldAbortSync(e)||(this._failedSyncCount++,d.logger.log("Number of consecutive failed sync requests:",this._failedSyncCount),g("Starting keep-alive"),this._startKeepAlives().then(e=>{e&&"ERROR"===this.getSyncState()&&this._updateSyncState("CATCHUP",{oldSyncToken:null,nextSyncToken:null,catchingUp:!0}),this._sync(t)}),this._currentSyncRequest=null,this._updateSyncState(this._failedSyncCount>=3?"ERROR":"RECONNECTING",{error:e}))},m.prototype._processSyncResponse=async function(e,t){const n=this.client,r=this;if(t.presence&&a.isArray(t.presence.events)&&t.presence.events.map(n.getEventMapper()).forEach((function(e){let t=n.store.getUser(e.getSender());t?t.setPresenceEvent(e):((t=y(n,e.getSender())).setPresenceEvent(e),n.store.storeUser(t)),n.emit("event",e)})),t.account_data&&a.isArray(t.account_data.events)){const e=t.account_data.events.map(n.getEventMapper());n.store.storeAccountDataEvents(e),e.forEach((function(e){if("m.push_rules"===e.getType()){const t=e.getContent();n.pushRules=l.PushProcessor.rewriteDefaultRules(t)}return n.emit("accountData",e),e}))}if(t.to_device&&a.isArray(t.to_device.events)&&t.to_device.events.length>0){const e=[];t.to_device.events.map(n.getEventMapper()).map(t=>{if("m.key.verification.cancel"===t.getType()){const n=t.getContent().transaction_id;n&&e.push(n)}return t}).forEach((function(t){const r=t.getContent();if("m.room.message"!=t.getType()||"m.bad.encrypted"!=r.msgtype){if("m.key.verification.start"===t.getType()||"m.key.verification.request"===t.getType()){const n=r.transaction_id;e.includes(n)&&t.flagCancelled()}n.emit("toDeviceEvent",t)}else d.logger.log("Ignoring undecryptable to-device event from "+t.getSender())}))}else this._catchingUp=!1;t.groups&&(t.groups.invite&&this._processGroupSyncEntry(t.groups.invite,"invite"),t.groups.join&&this._processGroupSyncEntry(t.groups.join,"join"),t.groups.leave&&this._processGroupSyncEntry(t.groups.leave,"leave"));let o=[],i=[],s=[];if(t.rooms&&(t.rooms.invite&&(o=this._mapSyncResponseToRoomArray(t.rooms.invite)),t.rooms.join&&(i=this._mapSyncResponseToRoomArray(t.rooms.join)),t.rooms.leave&&(s=this._mapSyncResponseToRoomArray(t.rooms.leave))),this._notifEvents=[],o.forEach((function(e){const t=e.room,o=r._mapSyncEventsFormat(e.invite_state,t);r._processRoomEvents(t,o),e.isBrandNewRoom&&(t.recalculate(),n.store.storeRoom(t),n.emit("Room",t)),o.forEach((function(e){n.emit("event",e)})),t.updateMyMembership("invite")})),await a.promiseMapSeries(i,(async function(t){const o=t.room,i=r._mapSyncEventsFormat(t.state,o),s=r._mapSyncEventsFormat(t.timeline,o),c=r._mapSyncEventsFormat(t.ephemeral),l=r._mapSyncEventsFormat(t.account_data);if(t.unread_notifications){o.setUnreadNotificationCount("total",t.unread_notifications.notification_count);const e=n.isRoomEncrypted(o.roomId);(!e||e&&o.getUnreadNotificationCount("highlight")<=0)&&o.setUnreadNotificationCount("highlight",t.unread_notifications.highlight_count)}if(t.timeline=t.timeline||{},t.isBrandNewRoom)o.getLiveTimeline().setPaginationToken(t.timeline.prev_batch,u.EventTimeline.BACKWARDS);else if(t.timeline.limited){let i=!0;for(let e=s.length-1;e>=0;e--){const t=s[e].getId();if(o.getTimelineForEvent(t)){g("Already have event "+t+" in limited sync - not resetting"),i=!1,s.splice(0,e);break}}i&&(r._deregisterStateListeners(o),o.resetLiveTimeline(t.timeline.prev_batch,r.opts.canResetEntireTimeline(o.roomId)?null:e.oldSyncToken),n.resetNotifTimelineSet(),r._registerStateListeners(o))}async function d(e){if(n.emit("event",e),e.isState()&&"m.room.encryption"==e.getType()&&r.opts.crypto&&await r.opts.crypto.onCryptoEvent(e),e.isState()&&"im.vector.user_status"===e.getType()){let t=n.store.getUser(e.getStateKey());t?t._unstable_updateStatusMessage(e):((t=y(n,e.getStateKey()))._unstable_updateStatusMessage(e),n.store.storeUser(t))}}r._processRoomEvents(o,i,s),t.summary&&o.setSummary(t.summary),o.addEphemeralEvents(c),o.addAccountData(l),o.recalculate(),t.isBrandNewRoom&&(n.store.storeRoom(o),n.emit("Room",o)),r._processEventsForNotifs(o,s),await a.promiseMapSeries(i,d),await a.promiseMapSeries(s,d),c.forEach((function(e){n.emit("event",e)})),l.forEach((function(e){n.emit("event",e)})),o.updateMyMembership("join")})),s.forEach((function(e){const t=e.room,o=r._mapSyncEventsFormat(e.state,t),i=r._mapSyncEventsFormat(e.timeline,t),s=r._mapSyncEventsFormat(e.account_data);r._processRoomEvents(t,o,i),t.addAccountData(s),t.recalculate(),e.isBrandNewRoom&&(n.store.storeRoom(t),n.emit("Room",t)),r._processEventsForNotifs(t,i),o.forEach((function(e){n.emit("event",e)})),i.forEach((function(e){n.emit("event",e)})),s.forEach((function(e){n.emit("event",e)})),t.updateMyMembership("leave")})),e.oldSyncToken&&this._notifEvents.length&&(this._notifEvents.sort((function(e,t){return e.getTs()-t.getTs()})),this._notifEvents.forEach((function(e){n.getNotifTimelineSet().addLiveEvent(e)}))),t.device_lists&&this.opts.crypto&&await this.opts.crypto.handleDeviceListChanges(e,t.device_lists),this.opts.crypto&&t.device_one_time_keys_count){const e=t.device_one_time_keys_count.signed_curve25519||0;this.opts.crypto.updateOneTimeKeyCount(e)}},m.prototype._startKeepAlives=function(e){void 0===e&&(e=2e3+Math.floor(5e3*Math.random())),null!==this._keepAliveTimer&&clearTimeout(this._keepAliveTimer);const t=this;return e>0?t._keepAliveTimer=setTimeout(t._pokeKeepAlive.bind(t),e):t._pokeKeepAlive(),this._connectionReturnedDefer||(this._connectionReturnedDefer=a.defer()),this._connectionReturnedDefer.promise},m.prototype._pokeKeepAlive=function(e){void 0===e&&(e=!1);const t=this;function n(){clearTimeout(t._keepAliveTimer),t._connectionReturnedDefer&&(t._connectionReturnedDefer.resolve(e),t._connectionReturnedDefer=null)}this.client._http.request(void 0,"GET","/_matrix/client/versions",void 0,void 0,{prefix:"",localTimeoutMs:15e3}).then((function(){n()}),(function(r){400==r.httpStatus||404==r.httpStatus?t._keepAliveTimer=setTimeout(n,2e3):(e=!0,t._keepAliveTimer=setTimeout(t._pokeKeepAlive.bind(t,e),5e3+Math.floor(5e3*Math.random())),t._updateSyncState("ERROR",{error:r}))}))},m.prototype._processGroupSyncEntry=function(e,t){for(const n of Object.keys(e)){const r=e[n];let o=this.client.store.getGroup(n);const i=null===o;null===o&&(o=this.createGroup(n)),r.profile&&o.setProfile(r.profile.name,r.profile.avatar_url),r.inviter&&o.setInviter({userId:r.inviter}),o.setMyMembership(t),i&&this.client.emit("Group",o)}},m.prototype._mapSyncResponseToRoomArray=function(e){const t=this.client,n=this;return a.keys(e).map((function(r){const o=e[r];let i=t.store.getRoom(r),s=!1;return i||(i=n.createRoom(r),s=!0),o.room=i,o.isBrandNewRoom=s,o}))},m.prototype._mapSyncEventsFormat=function(e,t){if(!e||!a.isArray(e.events))return[];const n=this.client.getEventMapper();return e.events.map((function(e){return t&&(e.room_id=t.roomId),n(e)}))},m.prototype._resolveInvites=function(e){if(!e||!this.opts.resolveInvitesToProfiles)return;const t=this.client;e.getMembersWithMembership("invite").forEach((function(n){if(n._requestedProfileInfo)return;n._requestedProfileInfo=!0;const r=t.getUser(n.userId);let o;(o=r?Promise.resolve({avatar_url:r.avatarUrl,displayname:r.displayName}):t.getProfileInfo(n.userId)).then((function(t){const r=n.events.member;"invite"===r.getContent().membership&&(r.getContent().avatar_url=t.avatar_url,r.getContent().displayname=t.displayname,n.setMembershipEvent(r,e.currentState))}),(function(e){}))}))},m.prototype._processRoomEvents=function(e,t,n){const r=e.getLiveTimeline(),o=0==r.getEvents().length;if(o){for(const e of t)this.client.getPushActionsForEvent(e);r.initialiseState(t)}this._resolveInvites(e),e.recalculate(),o||(e.oldState.setStateEvents(t||[]),e.currentState.setStateEvents(t||[])),e.addLiveEvents(n||[])},m.prototype._processEventsForNotifs=function(e,t){if(this.client.getNotifTimelineSet())for(let e=0;e<t.length;e++){const n=this.client.getPushActionsForEvent(t[e]);n&&n.notify&&n.tweaks&&n.tweaks.highlight&&this._notifEvents.push(t[e])}},m.prototype._getGuestFilter=function(){return this.client._guestRooms?JSON.stringify({room:{timeline:{limit:20}}}):"{}"},m.prototype._updateSyncState=function(e,t){const n=this._syncState;this._syncState=e,this._syncStateData=t,this.client.emit("sync",this._syncState,n,t)},m.prototype._onOnline=function(){g("Browser thinks we are back online"),this._startKeepAlives(0)}}).call(this,n(3))},function(e,t,n){"use strict";var r=n(5);Object.defineProperty(t,"__esModule",{value:!0}),t.Relations=void 0;var o=r(n(80)),i=n(4),s=n(6);class a extends i.EventEmitter{constructor(e,t,n){super(),(0,o.default)(this,"_onEventStatus",(e,t)=>{e.isSending()?t===s.EventStatus.CANCELLED&&(e.removeListener("Event.status",this._onEventStatus),this._removeEvent(e)):e.removeListener("Event.status",this._onEventStatus)}),(0,o.default)(this,"_onBeforeRedaction",e=>{this._relations.has(e)&&(this._relations.delete(e),"m.annotation"===this.relationType?this._removeAnnotationFromAggregation(e):"m.replace"===this.relationType&&this._targetEvent&&this._targetEvent.makeReplaced(this.getLastReplacement()),e.removeListener("Event.beforeRedaction",this._onBeforeRedaction),this.emit("Relations.redaction",e))}),this.relationType=e,this.eventType=t,this._relations=new Set,this._annotationsByKey={},this._annotationsBySender={},this._sortedAnnotationsByKey=[],this._targetEvent=null}addEvent(e){if(this._relations.has(e))return;const t=e.getRelation();if(!t)return void console.error("Event must have relation info");const n=t.rel_type,r=e.getType();this.relationType===n&&this.eventType===r?(e.isSending()&&e.on("Event.status",this._onEventStatus),this._relations.add(e),"m.annotation"===this.relationType?this._addAnnotationToAggregation(e):"m.replace"===this.relationType&&this._targetEvent&&this._targetEvent.makeReplaced(this.getLastReplacement()),e.on("Event.beforeRedaction",this._onBeforeRedaction),this.emit("Relations.add",e)):console.error("Event relation info doesn't match this container")}_removeEvent(e){if(!this._relations.has(e))return;const t=e.getRelation();if(!t)return void console.error("Event must have relation info");const n=t.rel_type,r=e.getType();this.relationType===n&&this.eventType===r?(this._relations.delete(e),"m.annotation"===this.relationType?this._removeAnnotationFromAggregation(e):"m.replace"===this.relationType&&this._targetEvent&&this._targetEvent.makeReplaced(this.getLastReplacement()),this.emit("Relations.remove",e)):console.error("Event relation info doesn't match this container")}getRelations(){return[...this._relations]}_addAnnotationToAggregation(e){const{key:t}=e.getRelation();if(!t)return;let n=this._annotationsByKey[t];n||(n=this._annotationsByKey[t]=new Set,this._sortedAnnotationsByKey.push([t,n])),n.add(e),this._sortedAnnotationsByKey.sort((e,t)=>{const n=e[1];return t[1].size-n.size});const r=e.getSender();let o=this._annotationsBySender[r];o||(o=this._annotationsBySender[r]=new Set),o.add(e)}_removeAnnotationFromAggregation(e){const{key:t}=e.getRelation();if(!t)return;const n=this._annotationsByKey[t];n&&(n.delete(e),this._sortedAnnotationsByKey.sort((e,t)=>{const n=e[1];return t[1].size-n.size}));const r=e.getSender(),o=this._annotationsBySender[r];o&&o.delete(e)}getSortedAnnotationsByKey(){return"m.annotation"!==this.relationType?null:this._sortedAnnotationsByKey}getAnnotationsBySender(){return"m.annotation"!==this.relationType?null:this._annotationsBySender}getLastReplacement(){if("m.replace"!==this.relationType)return null;if(!this._targetEvent)return null;const e=this._targetEvent.getServerAggregatedRelation("m.replace"),t=e&&e.origin_server_ts;return this.getRelations().reduce((e,n)=>n.getSender()!==this._targetEvent.getSender()?e:t&&t>n.getTs()?e:e&&e.getTs()>n.getTs()?e:n,null)}setTargetEvent(e){if(!this._targetEvent&&(this._targetEvent=e,"m.replace"===this.relationType)){const e=this.getLastReplacement();e&&this._targetEvent.makeReplaced(e)}}}t.Relations=a},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RoomSummary=function(e,t){this.roomId=e,this.info=t}},function(e,t,n){"use strict";var r=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.SearchResult=s;var o=r(n(2)),i=n(83);function s(e,t){this.rank=e,this.context=t}s.fromJson=function(e,t){const n=e.context||{},r=n.events_before||[],a=n.events_after||[],c=new i.EventContext(t(e.result));return c.setPaginateToken(n.start,!0),c.addEvents(o.map(r,t),!0),c.addEvents(o.map(a,t),!1),c.setPaginateToken(n.end,!1),new s(e.rank,c)}},function(e,t,n){"use strict";function r(e){this._timeline=[e],this._ourEventIndex=0,this._paginateTokens={b:null,f:null},this._paginateRequests={b:null,f:null}}Object.defineProperty(t,"__esModule",{value:!0}),t.EventContext=r,r.prototype.getEvent=function(){return this._timeline[this._ourEventIndex]},r.prototype.getTimeline=function(){return this._timeline},r.prototype.getOurEventIndex=function(){return this._ourEventIndex},r.prototype.getPaginateToken=function(e){return this._paginateTokens[e?"b":"f"]},r.prototype.setPaginateToken=function(e,t){this._paginateTokens[t?"b":"f"]=e},r.prototype.addEvents=function(e,t){t?(this._timeline=e.concat(this._timeline),this._ourEventIndex+=e.length):this._timeline=this._timeline.concat(e)}},function(e,t,n){"use strict";function r(){this.fromToken=null}Object.defineProperty(t,"__esModule",{value:!0}),t.StubStore=r,r.prototype={isNewlyCreated:function(){return Promise.resolve(!0)},getSyncToken:function(){return this.fromToken},setSyncToken:function(e){this.fromToken=e},storeGroup:function(e){},getGroup:function(e){return null},getGroups:function(){return[]},storeRoom:function(e){},getRoom:function(e){return null},getRooms:function(){return[]},removeRoom:function(e){},getRoomSummaries:function(){return[]},storeUser:function(e){},getUser:function(e){return null},getUsers:function(){return[]},scrollback:function(e,t){return[]},storeEvents:function(e,t,n,r){},storeFilter:function(e){},getFilter:function(e,t){return null},getFilterIdByName:function(e){return null},setFilterIdByName:function(e,t){},storeAccountDataEvents:function(e){},getAccountData:function(e){},setSyncData:function(e){return Promise.resolve()},wantsSave:function(){return!1},save:function(){},startup:function(){return Promise.resolve()},getSavedSync:function(){return Promise.resolve(null)},getSavedSyncToken:function(){return Promise.resolve(null)},deleteAllData:function(){return Promise.resolve()},getOutOfBandMembers:function(){return Promise.resolve(null)},setOutOfBandMembers:function(){return Promise.resolve()},clearOutOfBandMembers:function(){return Promise.resolve()},getClientOptions:function(){return Promise.resolve()},storeClientOptions:function(){return Promise.resolve()}}},function(e,t,n){"use strict";t.byteLength=function(e){var t=u(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,r=u(e),s=r[0],a=r[1],c=new i(function(e,t,n){return 3*(t+n)/4-n}(0,s,a)),l=0,d=a>0?s-4:s;for(n=0;n<d;n+=4)t=o[e.charCodeAt(n)]<<18|o[e.charCodeAt(n+1)]<<12|o[e.charCodeAt(n+2)]<<6|o[e.charCodeAt(n+3)],c[l++]=t>>16&255,c[l++]=t>>8&255,c[l++]=255&t;2===a&&(t=o[e.charCodeAt(n)]<<2|o[e.charCodeAt(n+1)]>>4,c[l++]=255&t);1===a&&(t=o[e.charCodeAt(n)]<<10|o[e.charCodeAt(n+1)]<<4|o[e.charCodeAt(n+2)]>>2,c[l++]=t>>8&255,c[l++]=255&t);return c},t.fromByteArray=function(e){for(var t,n=e.length,o=n%3,i=[],s=0,a=n-o;s<a;s+=16383)i.push(l(e,s,s+16383>a?a:s+16383));1===o?(t=e[n-1],i.push(r[t>>2]+r[t<<4&63]+"==")):2===o&&(t=(e[n-2]<<8)+e[n-1],i.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return i.join("")};for(var r=[],o=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=s.length;a<c;++a)r[a]=s[a],o[s.charCodeAt(a)]=a;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var o,i,s=[],a=t;a<n;a+=3)o=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(r[(i=o)>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return s.join("")}o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,o){var i,s,a=8*o-r-1,c=(1<<a)-1,u=c>>1,l=-7,d=n?o-1:0,h=n?-1:1,f=e[t+d];for(d+=h,i=f&(1<<-l)-1,f>>=-l,l+=a;l>0;i=256*i+e[t+d],d+=h,l-=8);for(s=i&(1<<-l)-1,i>>=-l,l+=r;l>0;s=256*s+e[t+d],d+=h,l-=8);if(0===i)i=1-u;else{if(i===c)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,r),i-=u}return(f?-1:1)*s*Math.pow(2,i-r)},t.write=function(e,t,n,r,o,i){var s,a,c,u=8*i-o-1,l=(1<<u)-1,d=l>>1,h=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:i-1,p=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+d>=1?h/c:h*Math.pow(2,1-d))*c>=2&&(s++,c/=2),s+d>=l?(a=0,s=l):s+d>=1?(a=(t*c-1)*Math.pow(2,o),s+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,o),s=0));o>=8;e[n+f]=255&a,f+=p,a/=256,o-=8);for(s=s<<o|a,u+=o;u>0;e[n+f]=255&s,f+=p,s/=256,u-=8);e[n+f-p]|=128*g}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RoomList=void 0;var r=n(9);t.RoomList=class{constructor(e){this._cryptoStore=e,this._roomEncryption={}}async init(){await this._cryptoStore.doTxn("readwrite",[r.IndexedDBCryptoStore.STORE_ROOMS],e=>{this._cryptoStore.getEndToEndRooms(e,e=>{this._roomEncryption=e})})}getRoomEncryption(e){return this._roomEncryption[e]||null}isRoomEncrypted(e){return Boolean(this.getRoomEncryption(e))}async setRoomEncryption(e,t){this._roomEncryption[e]=t,await this._cryptoStore.doTxn("readwrite",[r.IndexedDBCryptoStore.STORE_ROOMS],n=>{this._cryptoStore.storeEndToEndRoom(e,t,n)})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStorageCryptoStore=void 0;var r=n(0),o=n(17);const i="crypto.",s=i+"account",a=i+"cross_signing_keys",c=i+"notified_error_devices",u=i+"device_data",l=i+"inboundgroupsessions/",d=i+"inboundgroupsessions.withheld/",h=i+"rooms/",f=i+"sessionsneedingbackup";function p(e){return i+"sessions/"+e}function g(e){return i+"session.problems/"+e}function m(e,t){return l+e+"/"+t}function y(e,t){return d+e+"/"+t}function v(e){return h+e}class _ extends o.MemoryCryptoStore{constructor(e){super(),this.store=e}static exists(e){const t=e.length;for(let n=0;n<t;n++)if(e.key(n).startsWith(i))return!0;return!1}countEndToEndSessions(e,t){let n=0;for(let e=0;e<this.store.length;++e)this.store.key(e).startsWith(p(""))&&++n;t(n)}_getEndToEndSessions(e,t,n){const r=b(this.store,p(e)),o={};for(const[e,t]of Object.entries(r||{}))o[e]="string"==typeof t?{session:t}:t;return o}getEndToEndSession(e,t,n,r){r(this._getEndToEndSessions(e)[t]||{})}getEndToEndSessions(e,t,n){n(this._getEndToEndSessions(e)||{})}getAllEndToEndSessions(e,t){for(let e=0;e<this.store.length;++e)if(this.store.key(e).startsWith(p(""))){const n=this.store.key(e).split("/")[1];for(const e of Object.values(this._getEndToEndSessions(n)))t(e)}}storeEndToEndSession(e,t,n,r){const o=this._getEndToEndSessions(e)||{};o[t]=n,E(this.store,p(e),o)}async storeEndToEndSessionProblem(e,t,n){const r=g(e),o=b(this.store,r)||[];o.push({type:t,fixed:n,time:Date.now()}),o.sort((e,t)=>e.time-t.time),E(this.store,r,o)}async getEndToEndSessionProblem(e,t){const n=g(e),r=b(this.store,n)||[];if(!r.length)return null;const o=r[r.length-1];for(const e of r)if(e.time>t)return Object.assign({},e,{fixed:o.fixed});return o.fixed?null:o}async filterOutNotifiedErrorDevices(e){const t=b(this.store,c)||{},n=[];for(const r of e){const{userId:e,deviceInfo:o}=r;e in t?o.deviceId in t[e]||(n.push(r),t[e][o.deviceId]=!0):(n.push(r),t[e]={[o.deviceId]:!0})}return E(this.store,c,t),n}getEndToEndInboundGroupSession(e,t,n,r){r(b(this.store,m(e,t)),b(this.store,y(e,t)))}getAllEndToEndInboundGroupSessions(e,t){for(let e=0;e<this.store.length;++e){const n=this.store.key(e);n.startsWith(l)&&t({senderKey:n.substr(l.length,43),sessionId:n.substr(l.length+44),sessionData:b(this.store,n)})}t(null)}addEndToEndInboundGroupSession(e,t,n,r){b(this.store,m(e,t))||this.storeEndToEndInboundGroupSession(e,t,n,r)}storeEndToEndInboundGroupSession(e,t,n,r){E(this.store,m(e,t),n)}storeEndToEndInboundGroupSessionWithheld(e,t,n,r){E(this.store,y(e,t),n)}getEndToEndDeviceData(e,t){t(b(this.store,u))}storeEndToEndDeviceData(e,t){E(this.store,u,e)}storeEndToEndRoom(e,t,n){E(this.store,v(e),t)}getEndToEndRooms(e,t){const n={},r=v("");for(let e=0;e<this.store.length;++e){const t=this.store.key(e);if(t.startsWith(r)){n[t.substr(r.length)]=b(this.store,t)}}t(n)}getSessionsNeedingBackup(e){const t=b(this.store,f)||{},n=[];for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)){const t=r.substr(0,43),o=r.substr(44);if(this.getEndToEndInboundGroupSession(t,o,null,e=>{n.push({senderKey:t,sessionId:o,sessionData:e})}),e&&r.length>=e)break}return Promise.resolve(n)}countSessionsNeedingBackup(){const e=b(this.store,f)||{};return Promise.resolve(Object.keys(e).length)}unmarkSessionsNeedingBackup(e){const t=b(this.store,f)||{};for(const n of e)delete t[n.senderKey+"/"+n.sessionId];return E(this.store,f,t),Promise.resolve()}markSessionsNeedingBackup(e){const t=b(this.store,f)||{};for(const n of e)t[n.senderKey+"/"+n.sessionId]=!0;return E(this.store,f,t),Promise.resolve()}deleteAllData(){return this.store.removeItem(s),Promise.resolve()}getAccount(e,t){t(b(this.store,s))}storeAccount(e,t){E(this.store,s,t)}getCrossSigningKeys(e,t){t(b(this.store,a))}storeCrossSigningKeys(e,t){E(this.store,a,t)}doTxn(e,t,n){return Promise.resolve(n(null))}}function b(e,t){try{return JSON.parse(e.getItem(t))}catch(e){r.logger.log("Error: Failed to get key %s: %s",t,e.stack||e),r.logger.log(e.stack)}return null}function E(e,t,n){e.setItem(t,JSON.stringify(n))}t.LocalStorageCryptoStore=_},function(e,t,n){"use strict";var r=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.upgradeDatabase=function(e,t){o.logger.log(`Upgrading IndexedDBCryptoStore from version ${t}`+` to ${s}`),t<1&&function(e){const t=e.createObjectStore("outgoingRoomKeyRequests",{keyPath:"requestId"});t.createIndex("session",["requestBody.room_id","requestBody.session_id"]),t.createIndex("state","state")}(e);t<2&&e.createObjectStore("account");if(t<3){e.createObjectStore("sessions",{keyPath:["deviceKey","sessionId"]}).createIndex("deviceKey","deviceKey")}t<4&&e.createObjectStore("inbound_group_sessions",{keyPath:["senderCurve25519Key","sessionId"]});t<5&&e.createObjectStore("device_data");t<6&&e.createObjectStore("rooms");t<7&&e.createObjectStore("sessions_needing_backup",{keyPath:["senderCurve25519Key","sessionId"]});t<8&&e.createObjectStore("inbound_group_sessions_withheld",{keyPath:["senderCurve25519Key","sessionId"]});if(t<9){e.createObjectStore("session_problems",{keyPath:["deviceKey","time"]}).createIndex("deviceKey","deviceKey"),e.createObjectStore("notified_error_devices",{keyPath:["userId","deviceId"]})}},t.Backend=t.VERSION=void 0;var o=n(0),i=r(n(2));const s=9;t.VERSION=s;function a(e,t){e._mx_abortexception=t;try{e.abort()}catch(t){}}function c(e){return new Promise((t,n)=>{e.oncomplete=()=>{void 0!==e._mx_abortexception&&n(e._mx_abortexception),t()},e.onerror=t=>{void 0!==e._mx_abortexception?n(e._mx_abortexception):(o.logger.log("Error performing indexeddb txn",t),n(t.target.error))},e.onabort=t=>{void 0!==e._mx_abortexception?n(e._mx_abortexception):(o.logger.log("Error performing indexeddb txn",t),n(t.target.error))}})}t.Backend=class{constructor(e){this._db=e,e.onversionchange=t=>{o.logger.log(`versionchange for indexeddb ${this._dbName}: closing`),e.close()}}getOrAddOutgoingRoomKeyRequest(e){const t=e.requestBody;return new Promise((n,r)=>{const i=this._db.transaction("outgoingRoomKeyRequests","readwrite");i.onerror=r,this._getOutgoingRoomKeyRequest(i,t,r=>{if(r)return o.logger.log("already have key request outstanding for "+`${t.room_id} / ${t.session_id}: `+"not sending another"),void n(r);o.logger.log(`enqueueing key request for ${t.room_id} / `+t.session_id),i.oncomplete=()=>{n(e)},i.objectStore("outgoingRoomKeyRequests").add(e)})})}getOutgoingRoomKeyRequest(e){return new Promise((t,n)=>{const r=this._db.transaction("outgoingRoomKeyRequests","readonly");r.onerror=n,this._getOutgoingRoomKeyRequest(r,e,e=>{t(e)})})}_getOutgoingRoomKeyRequest(e,t,n){e.objectStore("outgoingRoomKeyRequests").index("session").openCursor([t.room_id,t.session_id]).onsuccess=e=>{const r=e.target.result;if(!r)return void n(null);const o=r.value;i.deepCompare(o.requestBody,t)?n(o):r.continue()}}getOutgoingRoomKeyRequestByState(e){if(0===e.length)return Promise.resolve(null);let t,n=0;const r=this._db.transaction("outgoingRoomKeyRequests","readonly"),o=r.objectStore("outgoingRoomKeyRequests"),i=e[n];return o.index("state").openCursor(i).onsuccess=function r(o){const i=o.target.result;if(i)return void(t=i.value);if(++n>=e.length)return;const s=e[n];o.target.source.openCursor(s).onsuccess=r},c(r).then(()=>t)}getOutgoingRoomKeyRequestsByTarget(e,t,n){let r=0;const o=[];const i=this._db.transaction("outgoingRoomKeyRequests","readonly"),s=i.objectStore("outgoingRoomKeyRequests"),a=n[r];return s.index("state").openCursor(a).onsuccess=function i(s){const a=s.target.result;if(a){const n=a.value;n.recipients.includes({userId:e,deviceId:t})&&o.push(n),a.continue()}else{if(++r>=n.length)return;const e=n[r];s.target.source.openCursor(e).onsuccess=i}},c(i).then(()=>o)}updateOutgoingRoomKeyRequest(e,t,n){let r=null;const i=this._db.transaction("outgoingRoomKeyRequests","readwrite");return i.objectStore("outgoingRoomKeyRequests").openCursor(e).onsuccess=function(e){const i=e.target.result;if(!i)return;const s=i.value;s.state==t?(Object.assign(s,n),i.update(s),r=s):o.logger.warn(`Cannot update room key request from ${t} `+`as it was already updated to ${s.state}`)},c(i).then(()=>r)}deleteOutgoingRoomKeyRequest(e,t){const n=this._db.transaction("outgoingRoomKeyRequests","readwrite");return n.objectStore("outgoingRoomKeyRequests").openCursor(e).onsuccess=e=>{const n=e.target.result;if(!n)return;const r=n.value;r.state==t?n.delete():o.logger.warn(`Cannot delete room key request in state ${r.state} `+`(expected ${t})`)},c(n)}getAccount(e,t){const n=e.objectStore("account").get("-");n.onsuccess=function(){try{t(n.result||null)}catch(t){a(e,t)}}}storeAccount(e,t){e.objectStore("account").put(t,"-")}getCrossSigningKeys(e,t){const n=e.objectStore("account").get("crossSigningKeys");n.onsuccess=function(){try{t(n.result||null)}catch(t){a(e,t)}}}storeCrossSigningKeys(e,t){e.objectStore("account").put(t,"crossSigningKeys")}countEndToEndSessions(e,t){const n=e.objectStore("sessions").count();n.onsuccess=function(){t(n.result)}}getEndToEndSessions(e,t,n){const r=t.objectStore("sessions").index("deviceKey").openCursor(e),o={};r.onsuccess=function(){const e=r.result;if(e)o[e.value.sessionId]={session:e.value.session,lastReceivedMessageTs:e.value.lastReceivedMessageTs},e.continue();else try{n(o)}catch(e){a(t,e)}}}getEndToEndSession(e,t,n,r){const o=n.objectStore("sessions").get([e,t]);o.onsuccess=function(){try{o.result?r({session:o.result.session,lastReceivedMessageTs:o.result.lastReceivedMessageTs}):r(null)}catch(e){a(n,e)}}}getAllEndToEndSessions(e,t){const n=e.objectStore("sessions").openCursor();n.onsuccess=function(){const r=n.result;if(r)t(r.value),r.continue();else try{t(null)}catch(t){a(e,t)}}}storeEndToEndSession(e,t,n,r){r.objectStore("sessions").put({deviceKey:e,sessionId:t,session:n.session,lastReceivedMessageTs:n.lastReceivedMessageTs})}async storeEndToEndSessionProblem(e,t,n){const r=this._db.transaction("session_problems","readwrite");return r.objectStore("session_problems").put({deviceKey:e,type:t,fixed:n,time:Date.now()}),c(r)}async getEndToEndSessionProblem(e,t){let n;const r=this._db.transaction("session_problems","readwrite"),o=r.objectStore("session_problems").index("deviceKey").getAll(e);return o.onsuccess=e=>{const r=o.result;if(!r.length)return void(n=null);r.sort((e,t)=>e.time-t.time);const i=r[r.length-1];for(const e of r)if(e.time>t)return void(n=Object.assign({},e,{fixed:i.fixed}));n=i.fixed?null:i},await c(r),n}async filterOutNotifiedErrorDevices(e){const t=this._db.transaction("notified_error_devices","readwrite").objectStore("notified_error_devices"),n=[];return await Promise.all(e.map(e=>new Promise(r=>{const{userId:o,deviceInfo:i}=e,s=t.get([o,i.deviceId]);s.onsuccess=function(){s.result||(t.put({userId:o,deviceId:i.deviceId}),n.push(e)),r()}}))),n}getEndToEndInboundGroupSession(e,t,n,r){let o=!1,i=!1;const s=n.objectStore("inbound_group_sessions").get([e,t]);s.onsuccess=function(){try{o=s.result?s.result.session:null,!1!==i&&r(o,i)}catch(e){a(n,e)}};const c=n.objectStore("inbound_group_sessions_withheld").get([e,t]);c.onsuccess=function(){try{i=c.result?c.result.session:null,!1!==o&&r(o,i)}catch(e){a(n,e)}}}getAllEndToEndInboundGroupSessions(e,t){const n=e.objectStore("inbound_group_sessions").openCursor();n.onsuccess=function(){const r=n.result;if(r){try{t({senderKey:r.value.senderCurve25519Key,sessionId:r.value.sessionId,sessionData:r.value.session})}catch(t){a(e,t)}r.continue()}else try{t(null)}catch(t){a(e,t)}}}addEndToEndInboundGroupSession(e,t,n,r){const i=r.objectStore("inbound_group_sessions").add({senderCurve25519Key:e,sessionId:t,session:n});i.onerror=n=>{"ConstraintError"===i.error.name?(n.stopPropagation(),n.preventDefault(),o.logger.log("Ignoring duplicate inbound group session: "+e+" / "+t)):a(r,new Error("Failed to add inbound group session: "+i.error))}}storeEndToEndInboundGroupSession(e,t,n,r){r.objectStore("inbound_group_sessions").put({senderCurve25519Key:e,sessionId:t,session:n})}storeEndToEndInboundGroupSessionWithheld(e,t,n,r){r.objectStore("inbound_group_sessions_withheld").put({senderCurve25519Key:e,sessionId:t,session:n})}getEndToEndDeviceData(e,t){const n=e.objectStore("device_data").get("-");n.onsuccess=function(){try{t(n.result||null)}catch(t){a(e,t)}}}storeEndToEndDeviceData(e,t){t.objectStore("device_data").put(e,"-")}storeEndToEndRoom(e,t,n){n.objectStore("rooms").put(t,e)}getEndToEndRooms(e,t){const n={},r=e.objectStore("rooms").openCursor();r.onsuccess=function(){const o=r.result;if(o)n[o.key]=o.value,o.continue();else try{t(n)}catch(t){a(e,t)}}}getSessionsNeedingBackup(e){return new Promise((t,n)=>{const r=[],o=this._db.transaction(["sessions_needing_backup","inbound_group_sessions"],"readonly");o.onerror=n,o.oncomplete=function(){t(r)};const i=o.objectStore("sessions_needing_backup"),s=o.objectStore("inbound_group_sessions"),a=i.openCursor();a.onsuccess=function(){const t=a.result;if(t){const n=s.get(t.key);n.onsuccess=function(){r.push({senderKey:n.result.senderCurve25519Key,sessionId:n.result.sessionId,sessionData:n.result.session})},(!e||r.length<e)&&t.continue()}}})}countSessionsNeedingBackup(e){e||(e=this._db.transaction("sessions_needing_backup","readonly"));const t=e.objectStore("sessions_needing_backup");return new Promise((e,n)=>{const r=t.count();r.onerror=n,r.onsuccess=()=>e(r.result)})}unmarkSessionsNeedingBackup(e,t){t||(t=this._db.transaction("sessions_needing_backup","readwrite"));const n=t.objectStore("sessions_needing_backup");return Promise.all(e.map(e=>new Promise((t,r)=>{const o=n.delete([e.senderKey,e.sessionId]);o.onsuccess=t,o.onerror=r})))}markSessionsNeedingBackup(e,t){t||(t=this._db.transaction("sessions_needing_backup","readwrite"));const n=t.objectStore("sessions_needing_backup");return Promise.all(e.map(e=>new Promise((t,r)=>{const o=n.put({senderCurve25519Key:e.senderKey,sessionId:e.sessionId});o.onsuccess=t,o.onerror=r})))}doTxn(e,t,n){const r=this._db.transaction(t,e),o=c(r),i=n(r);return o.then(()=>i)}}},function(e,t,n){"use strict";(function(e){var r=n(1),o=n(5);Object.defineProperty(t,"__esModule",{value:!0}),t.isCryptoAvailable=function(){return Boolean(e.Olm)},t.Crypto=P,t.verificationMethods=void 0;var i=o(n(25)),s=n(4),a=n(22),c=n(0),u=r(n(2)),l=n(41),d=r(n(7)),h=n(94),f=n(15),p=r(n(42)),g=n(43),m=n(95),y=n(96),v=n(9),_=n(97),b=n(98),E=n(45),S=n(46),w=n(27),k=n(103),T=n(104),I=r(n(13));const R=f.DeviceInfo.DeviceVerification,O={[_.ScanQRCode.NAME]:_.ScanQRCode,[_.ShowQRCode.NAME]:_.ShowQRCode,[b.SAS.NAME]:b.SAS},C={QR_CODE_SCAN:_.ScanQRCode.NAME,QR_CODE_SHOW:_.ShowQRCode.NAME,SAS:b.SAS.NAME};t.verificationMethods=C;function P(e,t,n,r,o,i,s,c){if(this._onDeviceListUserCrossSigningUpdated=this._onDeviceListUserCrossSigningUpdated.bind(this),this._reEmitter=new a.ReEmitter(this),this._baseApis=e,this._sessionStore=t,this._userId=n,this._deviceId=r,this._clientStore=o,this._cryptoStore=i,this._roomList=s,this._verificationMethods=new Map,c)for(const e of c)"string"==typeof e?O[e]&&this._verificationMethods.set(e,O[e]):e.NAME&&this._verificationMethods.set(e.NAME,e);this.backupInfo=null,this.backupKey=null,this._checkedForBackup=!1,this._sendingBackups=!1,this._olmDevice=new l.OlmDevice(i),this._deviceList=new h.DeviceList(e,i,this._olmDevice),this._deviceList.on("userCrossSigningUpdated",this._onDeviceListUserCrossSigningUpdated),this._reEmitter.reEmit(this._deviceList,["crypto.devicesUpdated"]),this._lastOneTimeKeyCheck=null,this._oneTimeKeyCheckInProgress=!1,this._roomEncryptors={},this._roomDecryptors={},this._supportedAlgorithms=u.keys(p.DECRYPTION_CLASSES),this._deviceKeys={},this._globalBlacklistUnverifiedDevices=!1,this._globalErrorOnUnknownDevices=!0,this._outgoingRoomKeyRequestManager=new y.OutgoingRoomKeyRequestManager(e,this._deviceId,this._cryptoStore),this._receivedRoomKeyRequests=[],this._receivedRoomKeyRequestCancellations=[],this._processingRoomKeyRequests=!1,this._lazyLoadMembers=!1,this._roomDeviceTrackingState={},this._lastNewSessionForced={},this._toDeviceVerificationRequests=new Map,this._inRoomVerificationRequests=new Map;const d=this._baseApis._cryptoCallbacks||{};this._crossSigningInfo=new g.CrossSigningInfo(n,d),this._secretStorage=new m.SecretStorage(e,d,this._crossSigningInfo),!d.getCrossSigningKey&&d.getSecretStorageKey&&(d.getCrossSigningKey=async e=>g.CrossSigningInfo.getFromSecretStorage(e,this._secretStorage))}function D(e){const t=5;if(e._oneTimeKeyCheckInProgress)return;const n=Date.now();if(null!==e._lastOneTimeKeyCheck&&n-e._lastOneTimeKeyCheck<6e4)return;e._lastOneTimeKeyCheck=n;const r=e._olmDevice.maxNumberOfOneTimeKeys(),o=Math.floor(r/2);function i(n){if(o<=n)return Promise.resolve();const r=Math.min(o-n,t);return e._olmDevice.generateOneTimeKeys(r).then(()=>(async function(e){const t=await e._olmDevice.getOneTimeKeys(),n={},r=[];for(const o in t.curve25519)if(t.curve25519.hasOwnProperty(o)){const i={key:t.curve25519[o]};n["signed_curve25519:"+o]=i,r.push(e._signObject(i))}await Promise.all(r);const o=await e._baseApis.uploadKeysRequest({one_time_keys:n},{device_id:e._deviceId});return await e._olmDevice.markKeysAsPublished(),o})(e)).then(e=>{if(e.one_time_key_counts&&e.one_time_key_counts.signed_curve25519)return i(e.one_time_key_counts.signed_curve25519);throw new Error("response for uploading keys does not contain one_time_key_counts.signed_curve25519")})}e._oneTimeKeyCheckInProgress=!0,Promise.resolve().then(()=>void 0!==e._oneTimeKeyCount?Promise.resolve(e._oneTimeKeyCount):e._baseApis.uploadKeysRequest({},{device_id:e._deviceId}).then(e=>e.one_time_key_counts.signed_curve25519||0)).then(e=>i(e)).catch(e=>{c.logger.error("Error uploading one-time keys",e.stack||e)}).finally(()=>{e._oneTimeKeyCount=void 0,e._oneTimeKeyCheckInProgress=!1})}u.inherits(P,s.EventEmitter),P.prototype.init=async function(){c.logger.log("Crypto: initialising Olm..."),await e.Olm.init(),c.logger.log("Crypto: initialising Olm device..."),await this._olmDevice.init(),c.logger.log("Crypto: loading device list..."),await this._deviceList.load(),this._deviceKeys["ed25519:"+this._deviceId]=this._olmDevice.deviceEd25519Key,this._deviceKeys["curve25519:"+this._deviceId]=this._olmDevice.deviceCurve25519Key,c.logger.log("Crypto: fetching own devices...");let t=this._deviceList.getRawStoredDevicesForUser(this._userId);if(t||(t={}),!t[this._deviceId]){c.logger.log("Crypto: adding this device to the store...");const e={keys:this._deviceKeys,algorithms:this._supportedAlgorithms,verified:R.VERIFIED,known:!0};t[this._deviceId]=e,this._deviceList.storeDevicesForUser(this._userId,t),this._deviceList.saveIfDirty()}await this._cryptoStore.doTxn("readonly",[v.IndexedDBCryptoStore.STORE_ACCOUNT],e=>{this._cryptoStore.getCrossSigningKeys(e,e=>{e&&(c.logger.log("Loaded cross-signing public keys from crypto store"),this._crossSigningInfo.setKeys(e))})}),this._deviceList.startTrackingDeviceList(this._userId),c.logger.log("Crypto: checking for key backup..."),this._checkAndStartKeyBackup()},P.prototype.createRecoveryKeyFromPassphrase=async function(t){const n=new e.Olm.PkDecryption;try{const e={};if(t){const r=await(0,E.keyFromPassphrase)(t);e.passphrase={algorithm:"m.pbkdf2",iterations:r.iterations,salt:r.salt},e.pubkey=n.init_with_private_key(r.key)}else e.pubkey=n.generate_key();const r=n.get_private_key();return[e,(0,S.encodeRecoveryKey)(r),r]}finally{n&&n.free()}},P.prototype.bootstrapSecretStorage=async function({authUploadDeviceSigningKeys:e,createSecretStorageKey:t=(async()=>{}),keyBackupInfo:n}={}){c.logger.log("Bootstrapping Secure Secret Storage");let r={};const o=Object.assign({},this._baseApis._cryptoCallbacks);try{const i=await this._crossSigningInfo.isStoredInSecretStorage(this._secretStorage);if(this._crossSigningInfo.getId()&&i?c.logger.log("Cross signing keys are present in secret storage"):(c.logger.log("Cross-signing public and/or private keys not found, checking secret storage for private keys"),i?(c.logger.log("Cross-signing private keys found in secret storage"),await this.checkOwnCrossSigningTrust()):(c.logger.log("Cross-signing private keys not found in secret storage, creating new keys"),this._baseApis._cryptoCallbacks.saveCrossSigningKeys=e=>r=e,this._baseApis._cryptoCallbacks.getCrossSigningKey=e=>r[e],await this.resetCrossSigningKeys(g.CrossSigningLevel.MASTER,{authUploadDeviceSigningKeys:e}))),await this.hasSecretStorageKey())c.logger.log("Have secret storage key");else{let e;if(n){c.logger.log("Secret storage default key not found, using key backup key");const t={pubkey:n.auth_data.public_key};n.auth_data.private_key_salt&&n.auth_data.private_key_iterations&&(t.passphrase={algorithm:"m.pbkdf2",iterations:n.auth_data.private_key_iterations,salt:n.auth_data.private_key_salt}),e=await this.addSecretStorageKey(m.SECRET_STORAGE_ALGORITHM_V1,t),this._secretStorage.storePassthrough("m.megolm_backup.v1",e),(await this.checkKeyBackup(n)).trustInfo.usable?(console.log("Adding cross signing signature to key backup"),await this._crossSigningInfo.signObject(n.auth_data,"master"),await this._baseApis._http.authedRequest(void 0,"PUT","/room_keys/version/"+n.version,void 0,n,{prefix:I.PREFIX_UNSTABLE})):console.log("Key backup is NOT TRUSTED: NOT adding cross signing signature")}else{c.logger.log("Secret storage default key not found, creating new key");const n=await t();e=await this.addSecretStorageKey(m.SECRET_STORAGE_ALGORITHM_V1,n)}await this.setDefaultSecretStorageKeyId(e)}Object.keys(r).length&&(c.logger.log("Storing cross-signing private keys in secret storage"),await this._secretStorage.signKey(),o.saveCrossSigningKeys||await g.CrossSigningInfo.storeInSecretStorage(r,this._secretStorage))}finally{this._baseApis._cryptoCallbacks=o}c.logger.log("Secure Secret Storage ready")},P.prototype.addSecretStorageKey=function(e,t,n){return this._secretStorage.addKey(e,t,n)},P.prototype.hasSecretStorageKey=function(e){return this._secretStorage.hasKey(e)},P.prototype.storeSecret=function(e,t,n){return this._secretStorage.store(e,t,n)},P.prototype.getSecret=function(e){return this._secretStorage.get(e)},P.prototype.isSecretStored=function(e,t){return this._secretStorage.isStored(e,t)},P.prototype.requestSecret=function(e,t){return t||(t=Object.keys(this._deviceList.getRawStoredDevicesForUser(this._userId))),this._secretStorage.request(e,t)},P.prototype.getDefaultSecretStorageKeyId=function(){return this._secretStorage.getDefaultKeyId()},P.prototype.setDefaultSecretStorageKeyId=function(e){return this._secretStorage.setDefaultKeyId(e)},P.prototype.checkSecretStoragePrivateKey=function(t,n){let r=null;try{return(r=new e.Olm.PkDecryption).init_with_private_key(t)===n}finally{r&&r.free()}},P.prototype.checkCrossSigningPrivateKey=function(t,n){let r=null;try{return(r=new e.Olm.PkSigning).init_with_seed(t)===n}finally{r&&r.free()}},P.prototype.resetCrossSigningKeys=async function(e,{authUploadDeviceSigningKeys:t=(async e=>await e())}={}){c.logger.info(`Resetting cross-signing keys at level ${e}`);const n=Object.assign({},this._crossSigningInfo.keys);try{await this._crossSigningInfo.resetKeys(e),await this._signObject(this._crossSigningInfo.keys.master);const n={};for(const[e,t]of Object.entries(this._crossSigningInfo.keys))n[e+"_key"]=t;await t(async e=>{await this._baseApis.uploadDeviceSigningKeys(e,n)}),await this._cryptoStore.doTxn("readwrite",[v.IndexedDBCryptoStore.STORE_ACCOUNT],e=>{this._cryptoStore.storeCrossSigningKeys(e,this._crossSigningInfo.keys)})}catch(e){throw c.logger.error("Resetting cross-signing keys failed, revert to previous keys",e),this._crossSigningInfo.keys=n,e}this._baseApis.emit("crossSigning.keysChanged",{}),await this._afterCrossSigningLocalKeyChange(),c.logger.info("Cross-signing key reset complete")},P.prototype._afterCrossSigningLocalKeyChange=async function(){const e=this._deviceList.getStoredDevice(this._userId,this._deviceId),t=await this._crossSigningInfo.signDevice(this._userId,e);await this._baseApis.uploadKeySignatures({[this._userId]:{[this._deviceId]:t}});const n={};for(const[e,t]of Object.entries(this._deviceList._crossSigningInfo)){const r=await this._checkForDeviceVerificationUpgrade(e,g.CrossSigningInfo.fromStorage(t,e));r&&(n[e]=r)}const r=this._baseApis._cryptoCallbacks.shouldUpgradeDeviceVerifications;if(Object.keys(n).length>0&&r)try{const e=await r({users:n});if(e)for(const t of e)t in n&&await this._baseApis.setDeviceVerified(t,n[t].crossSigningInfo.getId())}catch(e){c.logger.log("shouldUpgradeDeviceVerifications threw an error: not upgrading",e)}},P.prototype._checkForDeviceVerificationUpgrade=async function(e,t){const n=this._crossSigningInfo.checkUserTrust(t);if(t.firstUse&&!n.verified){const n=this._deviceList.getRawStoredDevicesForUser(e),r=await this._checkForValidDeviceSignature(e,t.keys.master,n);if(r.length)return{devices:r.map(e=>f.DeviceInfo.fromStorage(n[e],e)),crossSigningInfo:t}}},P.prototype._checkForValidDeviceSignature=async function(e,t,n){const r=[];if(n&&t.signatures&&t.signatures[e])for(const o of Object.keys(t.signatures[e])){const[,i]=o.split(":",2);if(i in n&&n[i].verified===R.VERIFIED)try{await d.verifySignature(this._olmDevice,t,e,i,n[i].keys[o]),r.push(i)}catch(e){}}return r},P.prototype.getCrossSigningId=function(e){return this._crossSigningInfo.getId(e)},P.prototype.getStoredCrossSigningForUser=function(e){return this._deviceList.getStoredCrossSigningForUser(e)},P.prototype.checkUserTrust=function(e){const t=this._deviceList.getStoredCrossSigningForUser(e);return t?this._crossSigningInfo.checkUserTrust(t):new g.UserTrustLevel(!1,!1)},P.prototype.checkDeviceTrust=function(e,t){const n=this._deviceList.getStoredDevice(e,t),r=n&&n.isVerified(),o=this._deviceList.getStoredCrossSigningForUser(e);return n&&o?this._crossSigningInfo.checkDeviceTrust(o,n,r):new g.DeviceTrustLevel(!1,!1,r)},P.prototype._onDeviceListUserCrossSigningUpdated=async function(e){if(e===this._userId){const t=this._deviceList.getStoredCrossSigningForUser(e),n=t?t.getId():null,r=this._crossSigningInfo.getId(),o=r!==n;r&&n&&!o?await this.checkOwnCrossSigningTrust():this.emit("crossSigning.keysChanged",{})}else await this._checkDeviceVerifications(e),this.emit("userTrustStatusChanged",e,this.checkUserTrust(e))},P.prototype.checkOwnCrossSigningTrust=async function(){const e=this._userId,t=this._deviceList.getStoredCrossSigningForUser(e);if(!t)return void c.logger.error("Got cross-signing update event for user "+e+" but no new cross-signing information found!");const n=t.getId(),r=this._crossSigningInfo.getId()!==n;if(r){c.logger.info("Got new master public key",n);let e=null;try{if(!(e=(await this._crossSigningInfo.getCrossSigningKey("master",n))[1]))throw new Error("Cross-signing master private key not available")}finally{e&&e.free()}c.logger.info("Got matching private key from callback for new public master key")}const o=this._crossSigningInfo.getId("self_signing"),i=this._crossSigningInfo.getId("user_signing");this._crossSigningInfo.setKeys(t.keys),await this._cryptoStore.doTxn("readwrite",[v.IndexedDBCryptoStore.STORE_ACCOUNT],e=>{this._cryptoStore.storeCrossSigningKeys(e,this._crossSigningInfo.keys)});const s={};if(o!==t.getId("self_signing")){c.logger.info("Got new self-signing key",t.getId("self_signing"));const e=this._deviceList.getStoredDevice(this._userId,this._deviceId),n=await this._crossSigningInfo.signDevice(this._userId,e);s[this._deviceId]=n}i!==t.getId("user_signing")&&c.logger.info("Got new user-signing key",t.getId("user_signing")),r&&(await this._signObject(this._crossSigningInfo.keys.master),s[this._crossSigningInfo.getId()]=this._crossSigningInfo.keys.master),Object.keys(s).length&&await this._baseApis.uploadKeySignatures({[this._userId]:s}),this.emit("userTrustStatusChanged",e,this.checkUserTrust(e)),r&&(this._baseApis.emit("crossSigning.keysChanged",{}),await this._afterCrossSigningLocalKeyChange()),await this.checkKeyBackup()},P.prototype._checkDeviceVerifications=async function(e){if(this._crossSigningInfo.keys.user_signing){const t=this._deviceList.getStoredCrossSigningForUser(e);if(t){const n=await this._checkForDeviceVerificationUpgrade(e,t),r=this._baseApis._cryptoCallbacks.shouldUpgradeDeviceVerifications;if(n&&r){(await r({users:{[e]:n}})).includes(e)&&await this._baseApis.setDeviceVerified(e,t.getId())}}}},P.prototype._checkAndStartKeyBackup=async function(){if(c.logger.log("Checking key backup status..."),this._baseApis.isGuest())return c.logger.log("Skipping key backup check since user is guest"),this._checkedForBackup=!0,null;let e;try{e=await this._baseApis.getKeyBackupVersion()}catch(e){return c.logger.log("Error checking for active key backup",e),e.httpStatus/100==4&&(this._checkedForBackup=!0),null}this._checkedForBackup=!0;const t=await this.isKeyBackupTrusted(e);return t.usable&&!this.backupInfo?(c.logger.log("Found usable key backup v"+e.version+": enabling key backups"),this._baseApis.enableKeyBackup(e)):!t.usable&&this.backupInfo?(c.logger.log("No usable key backup: disabling key backup"),this._baseApis.disableKeyBackup()):t.usable||this.backupInfo?t.usable&&this.backupInfo&&(e.version!==this.backupInfo.version?(c.logger.log("On backup version "+this.backupInfo.version+" but found version "+e.version+": switching."),this._baseApis.disableKeyBackup(),this._baseApis.enableKeyBackup(e)):c.logger.log("Backup version "+e.version+" still current")):c.logger.log("No usable key backup: not enabling key backup"),{backupInfo:e,trustInfo:t}},P.prototype.setTrustedBackupPubKey=async function(e){this._sessionStore.setLocalTrustedBackupPubKey(e),await this.checkKeyBackup()},P.prototype.checkKeyBackup=async function(){return this._checkedForBackup=!1,this._checkAndStartKeyBackup()},P.prototype.isKeyBackupTrusted=async function(e){const t={usable:!1,trusted_locally:!1,sigs:[]};if(!(e&&e.algorithm&&e.auth_data&&e.auth_data.public_key&&e.auth_data.signatures))return c.logger.info("Key backup is absent or missing required data"),t;const n=this._sessionStore.getLocalTrustedBackupPubKey();e.auth_data.public_key===n&&(c.logger.info("Backup public key "+n+" is trusted locally"),t.trusted_locally=!0);const r=e.auth_data.signatures[this._userId]||[];for(const n of Object.keys(r)){const r=n.split(":");if("ed25519"!==r[0]){c.logger.log("Ignoring unknown signature type: "+r[0]);continue}const o={deviceId:r[1]},i=this._crossSigningInfo.getId();if(i===o.deviceId){o.crossSigningId=!0;try{await d.verifySignature(this._olmDevice,e.auth_data,this._userId,o.deviceId,i),o.valid=!0}catch(e){c.logger.warning("Bad signature from cross signing key "+i,e),o.valid=!1}t.sigs.push(o);continue}const s=this._deviceList.getStoredDevice(this._userId,o.deviceId);if(s){o.device=s,o.deviceTrust=await this.checkDeviceTrust(this._userId,o.deviceId);try{await d.verifySignature(this._olmDevice,e.auth_data,this._userId,s.deviceId,s.getFingerprint()),o.valid=!0}catch(t){c.logger.info("Bad signature from key ID "+n+" userID "+this._userId+" device ID "+s.deviceId+" fingerprint: "+s.getFingerprint(),e.auth_data,t),o.valid=!1}}else o.valid=null,c.logger.info("Ignoring signature from unknown key "+n);t.sigs.push(o)}return t.usable=t.sigs.some(e=>e.valid&&(e.device&&e.deviceTrust.isVerified()||e.crossSigningId)),t.usable|=t.trusted_locally,t},P.prototype.enableLazyLoading=function(){this._lazyLoadMembers=!0},P.prototype.registerEventHandlers=function(e){const t=this;e.on("RoomMember.membership",(function(e,n,r){try{t._onRoomMembership(e,n,r)}catch(e){c.logger.error("Error handling membership change:",e)}})),e.on("toDeviceEvent",(function(e){t._onToDeviceEvent(e)})),e.on("Room.timeline",(function(e){t._onTimelineEvent(e)})),e.on("Event.decrypted",(function(e){t._onTimelineEvent(e)}))},P.prototype.start=function(){this._outgoingRoomKeyRequestManager.start()},P.prototype.stop=function(){this._outgoingRoomKeyRequestManager.stop(),this._deviceList.stop()},P.getOlmVersion=function(){return l.OlmDevice.getOlmVersion()},P.prototype.getDeviceEd25519Key=function(){return this._olmDevice.deviceEd25519Key},P.prototype.setGlobalBlacklistUnverifiedDevices=function(e){this._globalBlacklistUnverifiedDevices=e},P.prototype.getGlobalBlacklistUnverifiedDevices=function(){return this._globalBlacklistUnverifiedDevices},P.prototype.setGlobalErrorOnUnknownDevices=function(e){this._globalErrorOnUnknownDevices=e},P.prototype.getGlobalErrorOnUnknownDevices=function(){return this._globalErrorOnUnknownDevices},P.prototype.uploadDeviceKeys=function(){const e=this,t=e._userId,n=e._deviceId,r={algorithms:e._supportedAlgorithms,device_id:n,keys:e._deviceKeys,user_id:t};return e._signObject(r).then(()=>e._baseApis.uploadKeysRequest({device_keys:r},{device_id:n}))},P.prototype.updateOneTimeKeyCount=function(e){if(!isFinite(e))throw new TypeError("Parameter for updateOneTimeKeyCount has to be a number");this._oneTimeKeyCount=e},P.prototype.downloadKeys=function(e,t){return this._deviceList.downloadKeys(e,t)},P.prototype.getStoredDevicesForUser=function(e){return this._deviceList.getStoredDevicesForUser(e)},P.prototype.getStoredDevice=function(e,t){return this._deviceList.getStoredDevice(e,t)},P.prototype.saveDeviceList=function(e){return this._deviceList.saveIfDirty(e)},P.prototype.setDeviceVerification=async function(e,t,n,r,o){void 0===n&&(n=null),void 0===r&&(r=null),void 0===o&&(o=null);const i=this._deviceList.getStoredCrossSigningForUser(e);if(i&&i.getId()===t){if(null!==r||null!==o)throw new Error("Cannot set blocked or known for a cross-signing key");if(!n)throw new Error("Cannot set a cross-signing key as unverified");const s=await this._crossSigningInfo.signUser(i);return s&&await this._baseApis.uploadKeySignatures({[e]:{[t]:s}}),s}const s=this._deviceList.getRawStoredDevicesForUser(e);if(!s||!s[t])throw new Error("Unknown device "+e+":"+t);const a=s[t];let c=a.verified;n?c=R.VERIFIED:null!==n&&c==R.VERIFIED&&(c=R.UNVERIFIED),r?c=R.BLOCKED:null!==r&&c==R.BLOCKED&&(c=R.UNVERIFIED);let u=a.known;if(null!==o&&(u=o),a.verified===c&&a.known===u||(a.verified=c,a.known=u,this._deviceList.storeDevicesForUser(e,s),this._deviceList.saveIfDirty()),n&&e===this._userId){const n=await this._crossSigningInfo.signDevice(e,f.DeviceInfo.fromStorage(a,t));n&&await this._baseApis.uploadKeySignatures({[e]:{[t]:n}})}const l=f.DeviceInfo.fromStorage(a,t);return this.emit("deviceVerificationChanged",e,t,l),l},P.prototype.requestVerificationDM=async function(e,t,n){const r=new k.InRoomChannel(this._baseApis,t,e),o=await this._requestVerificationWithChannel(e,n,r,this._inRoomVerificationRequests);return await o.waitForVerifier()},P.prototype.acceptVerificationDM=function(e,t){if(!k.InRoomChannel.validateEvent(e,this._baseApis))return;const n=e.getSender(),r=this._inRoomVerificationRequests.get(n);if(!r)return;const o=k.InRoomChannel.getTransactionId(e),i=r.get(o);return i?i.beginKeyVerification(t):void 0},P.prototype.requestVerification=async function(e,t,n){n||(n=Object.keys(this._deviceList.getRawStoredDevicesForUser(e)));const r=new T.ToDeviceChannel(this._baseApis,e,n),o=await this._requestVerificationWithChannel(e,t,r,this._toDeviceVerificationRequests);return await o.waitForVerifier()},P.prototype._requestVerificationWithChannel=async function(e,t,n,r){t||(t=[...this._verificationMethods.keys()]);const o=new w.VerificationRequest(n,this._verificationMethods,e,this._baseApis);await o.sendRequest();let i=r.get(e);return i||(i=new Map,r.set(e,i)),i.set(n.transactionId,o),o},P.prototype.beginKeyVerification=function(e,t,n,r=null){let o,i=this._toDeviceVerificationRequests.get(t);if(i||(i=new Map,this._toDeviceVerificationRequests.set(t,i)),r)o=i.get(r);else{r=T.ToDeviceChannel.makeTransactionId();const e=new T.ToDeviceChannel(this._baseApis,t,[n],r,n);o=new w.VerificationRequest(e,this._verificationMethods,t,this._baseApis),i.set(r,o)}if(!o)throw new Error(`No request found for user ${t} with transactionId ${r}`);return o.beginKeyVerification(e,{userId:t,deviceId:n})},P.prototype.getOlmSessionsForUser=async function(e){const t=this.getStoredDevicesForUser(e)||[],n={};for(let e=0;e<t.length;++e){const r=t[e],o=r.getIdentityKey(),i=await this._olmDevice.getSessionInfoForDevice(o);n[r.deviceId]={deviceIdKey:o,sessions:i}}return n},P.prototype.getEventSenderDeviceInfo=function(e){const t=e.getSenderKey(),n=e.getWireContent().algorithm;if(!t||!n)return null;if(e.getForwardingCurve25519KeyChain().length>0)return null;const r=this._deviceList.getDeviceByIdentityKey(n,t);if(null===r)return null;const o=e.getClaimedEd25519Key();return o?o!==r.getFingerprint()?(c.logger.warn("Event "+e.getId()+" claims ed25519 key "+o+"but sender device has key "+r.getFingerprint()),null):r:(c.logger.warn("Event "+e.getId()+" claims no ed25519 key: cannot verify sending device"),null)},P.prototype.forceDiscardSession=function(e){const t=this._roomEncryptors[e];if(void 0===t)throw new Error("Room not encrypted");if(void 0===t.forceDiscardSession)throw new Error("Room encryption algorithm doesn't support session discarding");t.forceDiscardSession()},P.prototype.setRoomEncryption=async function(e,t,n){if(!t.algorithm)return void c.logger.log("Ignoring setRoomEncryption with no algorithm");const r=this._roomList.getRoomEncryption(e);if(r&&JSON.stringify(r)!=JSON.stringify(t))return void c.logger.error("Ignoring m.room.encryption event which requests a change of config in "+e);if(this._roomEncryptors[e])return;let o=null;r||(o=this._roomList.setRoomEncryption(e,t));const i=p.ENCRYPTION_CLASSES[t.algorithm];if(!i)throw new Error("Unable to encrypt with "+t.algorithm);const s=new i({userId:this._userId,deviceId:this._deviceId,crypto:this,olmDevice:this._olmDevice,baseApis:this._baseApis,roomId:e,config:t});this._roomEncryptors[e]=s,o&&await o,this._lazyLoadMembers?c.logger.log("Enabling encryption in "+e):(c.logger.log("Enabling encryption in "+e+"; starting to track device lists for all users therein"),await this.trackRoomDevices(e),this.inhibitDeviceQuery||this._deviceList.refreshOutdatedDeviceLists())},P.prototype.trackRoomDevices=function(e){const t=async()=>{if(!this._roomEncryptors[e])return;const t=this._clientStore.getRoom(e);if(!t)throw new Error(`Unable to start tracking devices in unknown room ${e}`);c.logger.log(`Starting to track devices for room ${e} ...`),(await t.getEncryptionTargetMembers()).forEach(e=>{this._deviceList.startTrackingDeviceList(e.userId)})};let n=this._roomDeviceTrackingState[e];return n||(n=t(),this._roomDeviceTrackingState[e]=n),n},P.prototype.ensureOlmSessionsForUsers=function(e){const t={};for(let n=0;n<e.length;++n){const r=e[n];t[r]=[];const o=this.getStoredDevicesForUser(r)||[];for(let e=0;e<o.length;++e){const n=o[e];n.getIdentityKey()!=this._olmDevice.deviceCurve25519Key&&(n.verified!=R.BLOCKED&&t[r].push(n))}}return d.ensureOlmSessionsForDevices(this._olmDevice,this._baseApis,t)},P.prototype.exportRoomKeys=async function(){const e=[];return await this._cryptoStore.doTxn("readonly",[v.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS],t=>{this._cryptoStore.getAllEndToEndInboundGroupSessions(t,t=>{if(null===t)return;const n=this._olmDevice.exportInboundGroupSession(t.senderKey,t.sessionId,t.sessionData);delete n.first_known_index,n.algorithm=d.MEGOLM_ALGORITHM,e.push(n)})}),e},P.prototype.importRoomKeys=function(e){return Promise.all(e.map(e=>{if(!e.room_id||!e.algorithm)return c.logger.warn("ignoring room key entry with missing fields",e),null;return this._getRoomDecryptor(e.room_id,e.algorithm).importRoomKey(e)}))},P.prototype.scheduleKeyBackupSend=async function(e=1e4){if(!this._sendingBackups){this._sendingBackups=!0;try{const t=Math.random()*e;await(0,u.sleep)(t);let n=0;for(;;){if(!this.backupKey)return;try{if(0===await this._backupPendingKeys(200))return;n=0}catch(e){if(n++,c.logger.log("Key backup request failed",e),e.data&&("M_NOT_FOUND"==e.data.errcode||"M_WRONG_ROOM_KEYS_VERSION"==e.data.errcode))throw await this.checkKeyBackup(),this.emit("crypto.keyBackupFailed",e.data.errcode),e}n&&await(0,u.sleep)(1e3*Math.pow(2,Math.min(n-1,4)))}}finally{this._sendingBackups=!1}}},P.prototype._backupPendingKeys=async function(e){const t=await this._cryptoStore.getSessionsNeedingBackup(e);if(!t.length)return 0;let n=await this._cryptoStore.countSessionsNeedingBackup();this.emit("crypto.keyBackupSessionsRemaining",n);const r={};for(const e of t){const t=e.sessionData.room_id;void 0===r[t]&&(r[t]={sessions:{}});const n=await this._olmDevice.exportInboundGroupSession(e.senderKey,e.sessionId,e.sessionData);n.algorithm=d.MEGOLM_ALGORITHM,delete n.session_id,delete n.room_id;const o=n.first_known_index;delete n.first_known_index;const i=this.backupKey.encrypt(JSON.stringify(n)),s=(n.forwarding_curve25519_key_chain||[]).length,a=this._deviceList.getDeviceByIdentityKey(d.MEGOLM_ALGORITHM,e.senderKey);r[t].sessions[e.sessionId]={first_message_index:o,forwarded_count:s,is_verified:!(!a||!a.isVerified()),session_data:i}}return await this._baseApis.sendKeyBackup(void 0,void 0,this.backupInfo.version,{rooms:r}),await this._cryptoStore.unmarkSessionsNeedingBackup(t),n=await this._cryptoStore.countSessionsNeedingBackup(),this.emit("crypto.keyBackupSessionsRemaining",n),t.length},P.prototype.backupGroupSession=async function(e,t,n,r,o,i,s){if(!this.backupInfo)throw new Error("Key backups are not enabled");await this._cryptoStore.markSessionsNeedingBackup([{senderKey:t,sessionId:r}]),this.scheduleKeyBackupSend()},P.prototype.scheduleAllGroupSessionsForBackup=async function(){await this.flagAllGroupSessionsForBackup(),this.scheduleKeyBackupSend(0)},P.prototype.flagAllGroupSessionsForBackup=async function(){await this._cryptoStore.doTxn("readwrite",[v.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,v.IndexedDBCryptoStore.STORE_BACKUP],e=>{this._cryptoStore.getAllEndToEndInboundGroupSessions(e,t=>{null!==t&&this._cryptoStore.markSessionsNeedingBackup([t],e)})});const e=await this._cryptoStore.countSessionsNeedingBackup();return this.emit("crypto.keyBackupSessionsRemaining",e),e},P.prototype.encryptEvent=async function(e,t){if(!t)throw new Error("Cannot send encrypted messages in unknown rooms");const n=e.getRoomId(),r=this._roomEncryptors[n];if(!r)throw new Error("Room was previously configured to use encryption, but is no longer. Perhaps the homeserver is hiding the configuration event.");this._roomDeviceTrackingState[n]||this.trackRoomDevices(n),await this._roomDeviceTrackingState[n];let o=e.getContent();const i=o["m.relates_to"];i&&delete(o=Object.assign({},o))["m.relates_to"];const s=await r.encryptMessage(t,e.getType(),o);i&&(s["m.relates_to"]=i),e.makeEncrypted("m.room.encrypted",s,this._olmDevice.deviceCurve25519Key,this._olmDevice.deviceEd25519Key)},P.prototype.decryptEvent=function(e){if(e.isRedacted())return Promise.resolve({clearEvent:{room_id:e.getRoomId(),type:"m.room.message",content:{}}});const t=e.getWireContent();return this._getRoomDecryptor(e.getRoomId(),t.algorithm).decryptEvent(e)},P.prototype.handleDeviceListChanges=async function(e,t){e.oldSyncToken&&await this._evalDeviceListChanges(t)},P.prototype.requestRoomKey=function(e,t,n=!1){return this._outgoingRoomKeyRequestManager.sendRoomKeyRequest(e,t,n).catch(e=>{c.logger.error("Error requesting key for event",e)})},P.prototype.cancelRoomKeyRequest=function(e){this._outgoingRoomKeyRequestManager.cancelRoomKeyRequest(e).catch(e=>{c.logger.warn("Error clearing pending room key requests",e)})},P.prototype.onCryptoEvent=async function(e){const t=e.getRoomId(),n=e.getContent();try{await this.setRoomEncryption(t,n,!0)}catch(e){c.logger.error("Error configuring encryption in room "+t+":",e)}},P.prototype.onSyncWillProcess=async function(e){e.oldSyncToken||(c.logger.log("Initial sync performed - resetting device tracking state"),this._deviceList.stopTrackingAllDeviceLists(),this._deviceList.startTrackingDeviceList(this._userId),this._roomDeviceTrackingState={})},P.prototype.onSyncCompleted=async function(e){const t=e.nextSyncToken;this._deviceList.setSyncToken(e.nextSyncToken),this._deviceList.saveIfDirty(),this._deviceList.lastKnownSyncToken=t,this._deviceList.startTrackingDeviceList(this._userId),this._deviceList.refreshOutdatedDeviceLists(),e.catchingUp||(D(this),this._processReceivedRoomKeyRequests())},P.prototype._evalDeviceListChanges=async function(e){if(e.changed&&Array.isArray(e.changed)&&e.changed.forEach(e=>{this._deviceList.invalidateUserDeviceList(e)}),e.left&&Array.isArray(e.left)&&e.left.length){const t=new Set(await this._getTrackedE2eUsers());e.left.forEach(e=>{t.has(e)||this._deviceList.stopTrackingDeviceList(e)})}},P.prototype._getTrackedE2eUsers=async function(){const e=[];for(const t of this._getTrackedE2eRooms()){const n=await t.getEncryptionTargetMembers();for(const t of n)e.push(t.userId)}return e},P.prototype._getTrackedE2eRooms=function(){return this._clientStore.getRooms().filter(e=>{if(!this._roomEncryptors[e.roomId])return!1;if(!this._roomDeviceTrackingState[e.roomId])return!1;const t=e.getMyMembership();return"join"===t||"invite"===t})},P.prototype._onToDeviceEvent=function(e){try{c.logger.log(`received to_device ${e.getType()} from: `+`${e.getSender()} id: ${e.getId()}`),"m.room_key"==e.getType()||"m.forwarded_room_key"==e.getType()?this._onRoomKeyEvent(e):"m.room_key_request"==e.getType()?this._onRoomKeyRequestEvent(e):"m.secret.request"===e.getType()?this._secretStorage._onRequestReceived(e):"m.secret.send"===e.getType()?this._secretStorage._onSecretReceived(e):"org.matrix.room_key.withheld"===e.getType()?this._onRoomKeyWithheldEvent(e):e.getContent().transaction_id?this._onKeyVerificationMessage(e):"m.bad.encrypted"===e.getContent().msgtype?this._onToDeviceBadEncrypted(e):e.isBeingDecrypted()&&e.once("Event.decrypted",e=>{this._onToDeviceEvent(e)})}catch(e){c.logger.error("Error handling toDeviceEvent:",e)}},P.prototype._onRoomKeyEvent=function(e){const t=e.getContent();t.room_id&&t.algorithm?(this._checkedForBackup||this._checkAndStartKeyBackup(),this._getRoomDecryptor(t.room_id,t.algorithm).onRoomKeyEvent(e)):c.logger.error("key event is missing fields")},P.prototype._onRoomKeyWithheldEvent=function(e){const t=e.getContent();if(!(("m.no_olm"===t.code||t.room_id&&t.session_id)&&t.algorithm&&t.sender_key))return void c.logger.error("key withheld event is missing fields");c.logger.info(`Got room key withheld event from ${e.getSender()} (${t.sender_key}) `+`for ${t.algorithm}/${t.room_id}/${t.session_id} `+`with reason ${t.code} (${t.reason})`);const n=this._getRoomDecryptor(t.room_id,t.algorithm);if(n.onRoomKeyWithheldEvent&&n.onRoomKeyWithheldEvent(e),!t.room_id){const e=this._getRoomDecryptors(t.algorithm);for(const n of e)n.retryDecryptionFromSender(t.sender_key)}},P.prototype._onKeyVerificationMessage=function(e){if(!T.ToDeviceChannel.validateEvent(e,this._baseApis))return;const t=T.ToDeviceChannel.getTransactionId(e);this._handleVerificationEvent(e,t,this._toDeviceVerificationRequests,e=>{if(!T.ToDeviceChannel.canCreateRequest(T.ToDeviceChannel.getEventType(e)))return;const t=e.getContent(),n=t&&t.from_device;if(!n)return;const r=e.getSender(),o=new T.ToDeviceChannel(this._baseApis,r,[n]);return new w.VerificationRequest(o,this._verificationMethods,r,this._baseApis)})},P.prototype._onTimelineEvent=function(e){if(!k.InRoomChannel.validateEvent(e,this._baseApis))return;const t=k.InRoomChannel.getTransactionId(e);this._handleVerificationEvent(e,t,this._inRoomVerificationRequests,e=>{if(!k.InRoomChannel.canCreateRequest(k.InRoomChannel.getEventType(e)))return;const t=e.getSender(),n=new k.InRoomChannel(this._baseApis,e.getRoomId(),t);return new w.VerificationRequest(n,this._verificationMethods,t,this._baseApis)})},P.prototype._handleVerificationEvent=async function(e,t,n,r){const o=e.getSender();let i=n.get(o),s=!1,a=i&&i.get(t);if(!a){if(!(a=r(e)))return;s=!0,i||(i=new Map,n.set(o,i)),i.set(t,a)}try{const t=!!a.verifier;await a.channel.handleEvent(e,a),!t&&a.verifier&&this._baseApis.emit("crypto.verification.start",a.verifier)}catch(t){console.error("error while handling verification event",e,t)}a.pending?s&&!a.initiatedByMe&&this._baseApis.emit("crypto.verification.request",a):(i.delete(t),0===i.size&&n.delete(o))},P.prototype._onToDeviceBadEncrypted=async function(e){const t=e.getWireContent(),n=e.getSender(),r=t.algorithm,o=t.sender_key,i=()=>{const e=this._getRoomDecryptors(d.MEGOLM_ALGORITHM);for(const t of e)t.retryDecryptionFromSender(o)};if(void 0===n||void 0===o||void 0===o)return;this._lastNewSessionForced[n]=this._lastNewSessionForced[n]||{};const s=this._lastNewSessionForced[n][o]||0;if(s+36e5>Date.now())return c.logger.debug("New session already forced with device "+n+":"+o+" at "+s+": not forcing another"),await this._olmDevice.recordSessionProblem(o,"wedged",!0),void i();const a=this._deviceList.getDeviceByIdentityKey(r,o);if(!a)return c.logger.info("Couldn't find device for identity key "+o+": not re-establishing session"),await this._olmDevice.recordSessionProblem(o,"wedged",!1),void i();const u={};u[n]=[a],await d.ensureOlmSessionsForDevices(this._olmDevice,this._baseApis,u,!0),this._lastNewSessionForced[n][o]=Date.now();const l={algorithm:d.OLM_ALGORITHM,sender_key:this._olmDevice.deviceCurve25519Key,ciphertext:{}};await d.encryptMessageForDevice(l.ciphertext,this._userId,this._deviceId,this._olmDevice,n,a,{type:"m.dummy"}),await this._olmDevice.recordSessionProblem(o,"wedged",!0),i(),await this._baseApis.sendToDevice("m.room.encrypted",{[n]:{[a.deviceId]:l}});const h=await this._outgoingRoomKeyRequestManager.getOutgoingSentRoomKeyRequest(n,a.deviceId);for(const e of h)this.requestRoomKey(e.requestBody,e.recipients,!0)},P.prototype._onRoomMembership=function(e,t,n){const r=t.roomId,o=this._roomEncryptors[r];o&&(this._roomDeviceTrackingState[r]&&("join"==t.membership?(c.logger.log("Join event for "+t.userId+" in "+r),this._deviceList.startTrackingDeviceList(t.userId)):"invite"==t.membership&&this._clientStore.getRoom(r).shouldEncryptForInvitedMembers()&&(c.logger.log("Invite event for "+t.userId+" in "+r),this._deviceList.startTrackingDeviceList(t.userId))),o.onRoomMembership(e,t,n))},P.prototype._onRoomKeyRequestEvent=function(e){const t=e.getContent();if("request"===t.action){const t=new A(e);this._receivedRoomKeyRequests.push(t)}else if("request_cancellation"===t.action){const t=new x(e);this._receivedRoomKeyRequestCancellations.push(t)}},P.prototype._processReceivedRoomKeyRequests=async function(){if(!this._processingRoomKeyRequests){this._processingRoomKeyRequests=!0;try{const e=this._receivedRoomKeyRequests;this._receivedRoomKeyRequests=[];const t=this._receivedRoomKeyRequestCancellations;this._receivedRoomKeyRequestCancellations=[],await Promise.all(e.map(e=>this._processReceivedRoomKeyRequest(e))),await Promise.all(t.map(e=>this._processReceivedRoomKeyRequestCancellation(e)))}catch(e){c.logger.error(`Error processing room key requsts: ${e}`)}finally{this._processingRoomKeyRequests=!1}}},P.prototype._processReceivedRoomKeyRequest=async function(e){const t=e.userId,n=e.deviceId,r=e.requestBody,o=r.room_id,i=r.algorithm;if(c.logger.log(`m.room_key_request from ${t}:${n}`+` for ${o} / ${r.session_id} (id ${e.requestId})`),t!==this._userId){if(!this._roomEncryptors[o])return void c.logger.debug(`room key request for unencrypted room ${o}`);const e=this._roomEncryptors[o],i=this._deviceList.getStoredDevice(t,n);if(!i)return void c.logger.debug(`Ignoring keyshare for unknown device ${t}:${n}`);try{await e.reshareKeyWithDevice(r.sender_key,r.session_id,t,i)}catch(e){c.logger.warn("Failed to re-share keys for session "+r.session_id+" with device "+t+":"+i.deviceId,e)}return}if(!this._roomDecryptors[o])return void c.logger.log(`room key request for unencrypted room ${o}`);const s=this._roomDecryptors[o][i];if(!s)return void c.logger.log(`room key request for unknown alg ${i} in room ${o}`);if(!await s.hasKeysForKeyRequest(e))return void c.logger.log(`room key request for unknown session ${o} / `+r.session_id);e.share=()=>{s.shareKeysWithDevice(e)};const a=this._deviceList.getStoredDevice(t,n);if(a&&a.isVerified())return c.logger.log("device is already verified: sharing keys"),void e.share();this.emit("crypto.roomKeyRequest",e)},P.prototype._processReceivedRoomKeyRequestCancellation=async function(e){c.logger.log(`m.room_key_request cancellation for ${e.userId}:`+`${e.deviceId} (id ${e.requestId})`),this.emit("crypto.roomKeyRequestCancellation",e)},P.prototype._getRoomDecryptor=function(e,t){let n,r;if((e=e||null)&&((n=this._roomDecryptors[e])||(this._roomDecryptors[e]=n={}),r=n[t]))return r;const o=p.DECRYPTION_CLASSES[t];if(!o)throw new p.DecryptionError("UNKNOWN_ENCRYPTION_ALGORITHM",'Unknown encryption algorithm "'+t+'".');return r=new o({userId:this._userId,crypto:this,olmDevice:this._olmDevice,baseApis:this._baseApis,roomId:e}),n&&(n[t]=r),r},P.prototype._getRoomDecryptors=function(e){const t=[];for(const n of Object.values(this._roomDecryptors))e in n&&t.push(n[e]);return t},P.prototype._signObject=async function(e){const t=e.signatures||{},n=e.unsigned;delete e.signatures,delete e.unsigned,t[this._userId]=t[this._userId]||{},t[this._userId]["ed25519:"+this._deviceId]=await this._olmDevice.sign(i.default.stringify(e)),e.signatures=t,void 0!==n&&(e.unsigned=n)};class A{constructor(e){const t=e.getContent();this.userId=e.getSender(),this.deviceId=t.requesting_device_id,this.requestId=t.request_id,this.requestBody=t.body||{},this.share=()=>{throw new Error("don't know how to share keys for this request yet")}}}class x{constructor(e){const t=e.getContent();this.userId=e.getSender(),this.deviceId=t.requesting_device_id,this.requestId=t.request_id}}}).call(this,n(3))},function(e,t,n){"use strict";var r=n(1),o=n(0),i=r(n(2)),s=r(n(7)),a=n(15),c=n(26);const u=a.DeviceInfo.DeviceVerification;function l(e){(0,i.polyfillSuper)(this,c.EncryptionAlgorithm,e),this._sessionPrepared=!1,this._prepPromise=null}function d(e){(0,i.polyfillSuper)(this,c.DecryptionAlgorithm,e)}i.inherits(l,c.EncryptionAlgorithm),l.prototype._ensureSession=function(e){if(this._prepPromise)return this._prepPromise;if(this._sessionPrepared)return Promise.resolve();const t=this;return this._prepPromise=t._crypto.downloadKeys(e).then((function(n){return t._crypto.ensureOlmSessionsForUsers(e)})).then((function(){t._sessionPrepared=!0})).finally((function(){t._prepPromise=null})),this._prepPromise},l.prototype.encryptMessage=async function(e,t,n){const r=await e.getEncryptionTargetMembers(),o=i.map(r,(function(e){return e.userId})),a=this;await this._ensureSession(o);const c={room_id:e.roomId,type:t,content:n},l={algorithm:s.OLM_ALGORITHM,sender_key:a._olmDevice.deviceCurve25519Key,ciphertext:{}},d=[];for(let e=0;e<o.length;++e){const t=o[e],n=a._crypto.getStoredDevicesForUser(t);for(let e=0;e<n.length;++e){const r=n[e];r.getIdentityKey()!=a._olmDevice.deviceCurve25519Key&&(r.verified!=u.BLOCKED&&d.push(s.encryptMessageForDevice(l.ciphertext,a._userId,a._deviceId,a._olmDevice,t,r,c)))}}return await Promise.all(d).then(()=>l)},i.inherits(d,c.DecryptionAlgorithm),d.prototype.decryptEvent=async function(e){const t=e.getWireContent(),n=t.sender_key,r=t.ciphertext;if(!r)throw new c.DecryptionError("OLM_MISSING_CIPHERTEXT","Missing ciphertext");if(!(this._olmDevice.deviceCurve25519Key in r))throw new c.DecryptionError("OLM_NOT_INCLUDED_IN_RECIPIENTS","Not included in recipients");const o=r[this._olmDevice.deviceCurve25519Key];let i;try{i=await this._decryptMessage(n,o)}catch(e){throw new c.DecryptionError("OLM_BAD_ENCRYPTED_MESSAGE","Bad Encrypted Message",{sender:n,err:e})}const s=JSON.parse(i);if(s.recipient!=this._userId)throw new c.DecryptionError("OLM_BAD_RECIPIENT","Message was intented for "+s.recipient);if(s.recipient_keys.ed25519!=this._olmDevice.deviceEd25519Key)throw new c.DecryptionError("OLM_BAD_RECIPIENT_KEY","Message not intended for this device",{intended:s.recipient_keys.ed25519,our_key:this._olmDevice.deviceEd25519Key});if(s.sender!=e.getSender())throw new c.DecryptionError("OLM_FORWARDED_MESSAGE","Message forwarded from "+s.sender,{reported_sender:e.getSender()});if(s.room_id!==e.getRoomId())throw new c.DecryptionError("OLM_BAD_ROOM","Message intended for room "+s.room_id,{reported_room:e.room_id});return{clearEvent:s,senderCurve25519Key:n,claimedEd25519Key:(s.keys||{}).ed25519||null}},d.prototype._decryptMessage=async function(e,t){const n=await this._olmDevice.getSessionIdsForDevice(e),r={};for(let i=0;i<n.length;i++){const s=n[i];try{const n=await this._olmDevice.decryptMessage(e,s,t.type,t.body);return o.logger.log("Decrypted Olm message from "+e+" with session "+s),n}catch(n){if(await this._olmDevice.matchesSession(e,s,t.type,t.body))throw new Error("Error decrypting prekey message with existing session id "+s+": "+n.message);r[s]=n.message}}if(0!==t.type){if(0===n.length)throw new Error("No existing sessions");throw new Error("Error decrypting non-prekey message with existing sessions: "+JSON.stringify(r))}let i;try{i=await this._olmDevice.createInboundSession(e,t.type,t.body)}catch(e){throw r["(new)"]=e.message,new Error("Error decrypting prekey message: "+JSON.stringify(r))}return o.logger.log("created new inbound Olm session ID "+i.session_id+" with "+e),i.payload},(0,c.registerAlgorithm)(s.OLM_ALGORITHM,l,d)},function(e,t,n){"use strict";var r=n(1),o=n(0),i=r(n(2)),s=r(n(7)),a=n(26),c=n(41);function u(e){this.sessionId=e,this.useCount=0,this.creationTime=(new Date).getTime(),this.sharedWithDevices={},this.blockedDevicesNotified={}}function l(e){(0,i.polyfillSuper)(this,a.EncryptionAlgorithm,e),this._setupPromise=Promise.resolve(),this._outboundSessions={},this._sessionRotationPeriodMsgs=100,this._sessionRotationPeriodMs=6048e5,void 0!==e.config.rotation_period_ms&&(this._sessionRotationPeriodMs=e.config.rotation_period_ms),void 0!==e.config.rotation_period_msgs&&(this._sessionRotationPeriodMsgs=e.config.rotation_period_msgs)}function d(e){(0,i.polyfillSuper)(this,a.DecryptionAlgorithm,e),this._pendingEvents={},this.olmlib=s}u.prototype.needsRotation=function(e,t){const n=(new Date).getTime()-this.creationTime;return(this.useCount>=e||n>=t)&&(o.logger.log("Rotating megolm session after "+this.useCount+" messages, "+n+"ms"),!0)},u.prototype.markSharedWithDevice=function(e,t,n){this.sharedWithDevices[e]||(this.sharedWithDevices[e]={}),this.sharedWithDevices[e][t]=n},u.prototype.markNotifiedBlockedDevice=function(e,t){this.blockedDevicesNotified[e]||(this.blockedDevicesNotified[e]={}),this.blockedDevicesNotified[e][t]=!0},u.prototype.sharedWithTooManyDevices=function(e){for(const t in this.sharedWithDevices)if(this.sharedWithDevices.hasOwnProperty(t)){if(!e.hasOwnProperty(t))return o.logger.log("Starting new megolm session because we shared with "+t),!0;for(const n in this.sharedWithDevices[t])if(this.sharedWithDevices[t].hasOwnProperty(n)&&!e[t].hasOwnProperty(n))return o.logger.log("Starting new megolm session because we shared with "+t+":"+n),!0}},i.inherits(l,a.EncryptionAlgorithm),l.prototype._ensureOutboundSession=async function(e,t){const n=this;let r;function i(){return r}const s=this._setupPromise.then((async function(i){(r=i)&&r.needsRotation(n._sessionRotationPeriodMsgs,n._sessionRotationPeriodMs)&&(o.logger.log("Starting new megolm session because we need to rotate."),r=null),r&&r.sharedWithTooManyDevices(e)&&(r=null),r||(o.logger.log(`Starting new megolm session for room ${n._roomId}`),r=await n._prepareNewSession(),o.logger.log(`Started new megolm session ${r.sessionId} `+`for room ${n._roomId}`),n._outboundSessions[r.sessionId]=r);const s={};for(const t in e){if(!e.hasOwnProperty(t))continue;const o=e[t];for(const e in o){if(!o.hasOwnProperty(e))continue;const i=o[e];i.getIdentityKey()!=n._olmDevice.deviceCurve25519Key&&(r.sharedWithDevices[t]&&void 0!==r.sharedWithDevices[t][e]||(s[t]=s[t]||[],s[t].push(i)))}}const a=[];await n._shareKeyWithDevices(r,s,a);const u={};for(const e in t){if(!t.hasOwnProperty(e))continue;const n=t[e];for(const t in n)n.hasOwnProperty(t)&&(r.blockedDevicesNotified[e]&&void 0!==r.blockedDevicesNotified[e][t]||(u[e]=u[e]||[],u[e].push(n[t])))}const l=await n._olmDevice.filterOutNotifiedErrorDevices(a);for(const{userId:e,deviceInfo:t}of l)u[e]=u[e]||[],u[e].push({code:"m.no_olm",reason:c.WITHHELD_MESSAGES["m.no_olm"],deviceInfo:t});await n._notifyBlockedDevices(r,u)}));return this._setupPromise=s.then(i,i),s.then(i)},l.prototype._prepareNewSession=async function(){const e=this._olmDevice.createOutboundGroupSession(),t=this._olmDevice.getOutboundGroupSessionKey(e);return await this._olmDevice.addInboundGroupSession(this._roomId,this._olmDevice.deviceCurve25519Key,[],e,t.key,{ed25519:this._olmDevice.deviceEd25519Key}),this._crypto.backupInfo&&this._crypto.backupGroupSession(this._roomId,this._olmDevice.deviceCurve25519Key,[],e,t.key).catch(e=>{o.logger.log("Failed to back up megolm session",e)}),new u(e)},l.prototype._splitUserDeviceMap=function(e,t,n,r,i){const s=[];let a=0,c=0;for(const u of Object.keys(r)){const l=r[u],d=n[u];for(let n=0;n<l.length;n++){const r=l[n],h=r.deviceId;d[h].sessionId?(o.logger.log("share keys with device "+u+":"+h),s[a]||(s[a]=[]),s[a].push({userId:u,deviceInfo:r}),c++):(e.markSharedWithDevice(u,h,t),i.push({userId:u,deviceInfo:r}))}c>20&&(c=0,a++)}return s},l.prototype._splitBlockedDevices=function(e){let t=[];const n=[t];for(const r of Object.keys(e)){const o=e[r];for(const e of o)t.push({userId:r,blockedInfo:e});t.length>20&&(t=[],n.push(t))}return 0===t.length&&n.pop(),n},l.prototype._encryptAndSendKeysToDevices=function(e,t,n,r){const o={},i=[];for(let e=0;e<n.length;e++){const t={algorithm:s.OLM_ALGORITHM,sender_key:this._olmDevice.deviceCurve25519Key,ciphertext:{}},a=n[e],c=a.userId,u=a.deviceInfo,l=u.deviceId;o[c]||(o[c]={}),o[c][l]=t,i.push(s.encryptMessageForDevice(t.ciphertext,this._userId,this._deviceId,this._olmDevice,c,u,r))}return Promise.all(i).then(()=>this._baseApis.sendToDevice("m.room.encrypted",o).then(()=>{for(const n of Object.keys(o))for(const r of Object.keys(o[n]))e.markSharedWithDevice(n,r,t)}))},l.prototype._sendBlockedNotificationsToDevices=async function(e,t,n){const r={};for(const e of t){const t=e.userId,o=e.blockedInfo,i=o.deviceInfo.deviceId,s=Object.assign({},n);s.code=o.code,s.reason=o.reason,"m.no_olm"===s.code&&(delete s.room_id,delete s.session_id),r[t]||(r[t]={}),r[t][i]=s}await this._baseApis.sendToDevice("org.matrix.room_key.withheld",r);for(const t of Object.keys(r))for(const n of Object.keys(r[t]))e.markNotifiedBlockedDevice(t,n)},l.prototype.reshareKeyWithDevice=async function(e,t,n,r){const i=this._outboundSessions[t];if(!i)return void o.logger.debug(`megolm session ${t} not found: not re-sharing keys`);if(void 0===i.sharedWithDevices[n])return void o.logger.debug(`megolm session ${t} never shared with user ${n}`);const a=i.sharedWithDevices[n][r.deviceId];if(void 0===a)return void o.logger.debug("megolm session ID "+t+" never shared with device "+n+":"+r.deviceId);const c=await this._olmDevice.getInboundGroupSessionKey(this._roomId,e,t,a);if(!c)return void o.logger.warn(`No inbound session key found for megolm ${t}: not re-sharing keys`);await s.ensureOlmSessionsForDevices(this._olmDevice,this._baseApis,{[n]:{[r.deviceId]:r}});const u={type:"m.forwarded_room_key",content:{algorithm:s.MEGOLM_ALGORITHM,room_id:this._roomId,session_id:t,session_key:c.key,chain_index:c.chain_index,sender_key:e,sender_claimed_ed25519_key:c.sender_claimed_ed25519_key,forwarding_curve25519_key_chain:c.forwarding_curve25519_key_chain}},l={algorithm:s.OLM_ALGORITHM,sender_key:this._olmDevice.deviceCurve25519Key,ciphertext:{}};await s.encryptMessageForDevice(l.ciphertext,this._userId,this._deviceId,this._olmDevice,n,r,u),await this._baseApis.sendToDevice("m.room.encrypted",{[n]:{[r.deviceId]:l}}),o.logger.debug(`Re-shared key for megolm session ${t} `+`with ${n}:${r.deviceId}`)},l.prototype._shareKeyWithDevices=async function(e,t,n){const r=this._olmDevice.getOutboundGroupSessionKey(e.sessionId),i={type:"m.room_key",content:{algorithm:s.MEGOLM_ALGORITHM,room_id:this._roomId,session_id:e.sessionId,session_key:r.key,chain_index:r.chain_index}},a=await s.ensureOlmSessionsForDevices(this._olmDevice,this._baseApis,t),c=this._splitUserDeviceMap(e,r.chain_index,a,t,n);for(let t=0;t<c.length;t++)try{await this._encryptAndSendKeysToDevices(e,r.chain_index,c[t],i),o.logger.log(`Completed megolm keyshare for ${e.sessionId} `+`in ${this._roomId} (slice ${t+1}/${c.length})`)}catch(n){throw o.logger.log(`megolm keyshare for ${e.sessionId} in ${this._roomId} `+`(slice ${t+1}/${c.length}) failed`),n}},l.prototype._notifyBlockedDevices=async function(e,t){const n={room_id:this._roomId,session_id:e.sessionId,algorithm:s.MEGOLM_ALGORITHM,sender_key:this._olmDevice.deviceCurve25519Key},r=this._splitBlockedDevices(t);for(let t=0;t<r.length;t++)try{await this._sendBlockedNotificationsToDevices(e,r[t],n),o.logger.log(`Completed blacklist notification for ${e.sessionId} `+`in ${this._roomId} (slice ${t+1}/${r.length})`)}catch(n){throw o.logger.log(`blacklist notification for ${e.sessionId} in `+`${this._roomId} (slice ${t+1}/${r.length}) failed`),n}},l.prototype.encryptMessage=async function(e,t,n){const r=this;o.logger.log(`Starting to encrypt event for ${this._roomId}`);const[i,a]=await this._getDevicesInRoom(e);this._crypto.getGlobalErrorOnUnknownDevices()&&r._checkForUnknownDevices(i);const c=await r._ensureOutboundSession(i,a),u={room_id:r._roomId,type:t,content:n},l=r._olmDevice.encryptGroupMessage(c.sessionId,JSON.stringify(u)),d={algorithm:s.MEGOLM_ALGORITHM,sender_key:r._olmDevice.deviceCurve25519Key,ciphertext:l,session_id:c.sessionId,device_id:r._deviceId};return c.useCount++,d},l.prototype.forceDiscardSession=function(){this._setupPromise=this._setupPromise.then(()=>null)},l.prototype._checkForUnknownDevices=function(e){const t={};if(Object.keys(e).forEach(n=>{Object.keys(e[n]).forEach(r=>{const o=e[n][r];o.isUnverified()&&!o.isKnown()&&(t[n]||(t[n]={}),t[n][r]=o)})}),Object.keys(t).length)throw new a.UnknownDeviceError("This room contains unknown devices which have not been verified. We strongly recommend you verify them before continuing.",t)},l.prototype._getDevicesInRoom=async function(e){const t=await e.getEncryptionTargetMembers(),n=i.map(t,(function(e){return e.userId}));let r=this._crypto.getGlobalBlacklistUnverifiedDevices();"boolean"==typeof e.getBlacklistUnverifiedDevices()&&(r=e.getBlacklistUnverifiedDevices());const o=await this._crypto.downloadKeys(n,!1),s={};for(const e in o){if(!o.hasOwnProperty(e))continue;const t=o[e];for(const n in t)if(t.hasOwnProperty(n)&&(t[n].isBlocked()||t[n].isUnverified()&&r)){s[e]||(s[e]={});const r=t[n].isBlocked()?{code:"m.blacklisted",reason:c.WITHHELD_MESSAGES["m.blacklisted"]}:{code:"m.unverified",reason:c.WITHHELD_MESSAGES["m.unverified"]};r.deviceInfo=t[n],s[e][n]=r,delete t[n]}}return[o,s]},i.inherits(d,a.DecryptionAlgorithm);const h={no_olm:"The sender was unable to establish a secure channel.",unknown:"The secure channel with the sender was corrupted."};d.prototype.decryptEvent=async function(e){const t=e.getWireContent();if(!t.sender_key||!t.session_id||!t.ciphertext)throw new a.DecryptionError("MEGOLM_MISSING_FIELDS","Missing fields in input");let n;this._addEventToPendingList(e);try{n=await this._olmDevice.decryptGroupMessage(e.getRoomId(),t.sender_key,t.session_id,t.ciphertext,e.getId(),e.getTs())}catch(n){if("DecryptionError"===n.name)throw n;let r="OLM_DECRYPT_GROUP_MESSAGE_ERROR";throw n&&"OLM.UNKNOWN_MESSAGE_INDEX"===n.message&&(this._requestKeysForEvent(e),r="OLM_UNKNOWN_MESSAGE_INDEX"),new a.DecryptionError(r,n?n.toString():"Unknown Error: Error is undefined",{session:t.sender_key+"|"+t.session_id})}if(null===n){this._requestKeysForEvent(e);const n=await this._olmDevice.sessionMayHaveProblems(t.sender_key,e.getTs()-12e4);if(n){let e=h[n.type]||h.unknown;throw n.fixed&&(e+=" Trying to create a new secure channel and re-requesting the keys."),new a.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",e,{session:t.sender_key+"|"+t.session_id})}throw new a.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID","The sender's device has not sent us the keys for this message.",{session:t.sender_key+"|"+t.session_id})}this._removeEventFromPendingList(e);const r=JSON.parse(n.result);if(r.room_id!==e.getRoomId())throw new a.DecryptionError("MEGOLM_BAD_ROOM","Message intended for room "+r.room_id);return{clearEvent:r,senderCurve25519Key:n.senderKey,claimedEd25519Key:n.keysClaimed.ed25519,forwardingCurve25519KeyChain:n.forwardingCurve25519KeyChain}},d.prototype._requestKeysForEvent=function(e){const t=e.getWireContent(),n=e.getKeyRequestRecipients(this._userId);this._crypto.requestRoomKey({room_id:e.getRoomId(),algorithm:t.algorithm,sender_key:t.sender_key,session_id:t.session_id},n)},d.prototype._addEventToPendingList=function(e){const t=e.getWireContent(),n=t.sender_key,r=t.session_id;this._pendingEvents[n]||(this._pendingEvents[n]=new Map);const o=this._pendingEvents[n];o.has(r)||o.set(r,new Set),o.get(r).add(e)},d.prototype._removeEventFromPendingList=function(e){const t=e.getWireContent(),n=t.sender_key,r=t.session_id,o=this._pendingEvents[n],i=o&&o.get(r);i&&(i.delete(e),0===i.size&&o.delete(n),0===o.size&&delete this._pendingEvents[n])},d.prototype.onRoomKeyEvent=function(e){const t=e.getContent(),n=t.session_id;let r,s=e.getSenderKey(),a=[],c=!1;if(t.room_id&&n&&t.session_key){if(s){if("m.forwarded_room_key"==e.getType()){if(c=!0,a=t.forwarding_curve25519_key_chain,i.isArray(a)||(a=[]),(a=a.slice()).push(s),!(s=t.sender_key))return void o.logger.error("forwarded_room_key event is missing sender_key field");const e=t.sender_claimed_ed25519_key;if(!e)return void o.logger.error("forwarded_room_key_event is missing sender_claimed_ed25519_key field");r={ed25519:e}}else r=e.getKeysClaimed();return o.logger.log(`Received and adding key for megolm session ${s}|${n}`),this._olmDevice.addInboundGroupSession(t.room_id,s,a,n,t.session_key,r,c).then(()=>{this._retryDecryption(s,n).then(e=>{e&&this._crypto.cancelRoomKeyRequest({algorithm:t.algorithm,room_id:t.room_id,session_id:t.session_id,sender_key:s})})}).then(()=>{this._crypto.backupInfo&&this._crypto.backupGroupSession(t.room_id,s,a,t.session_id,t.session_key,r,c).catch(e=>{o.logger.log("Failed to back up megolm session",e)})}).catch(e=>{o.logger.error(`Error handling m.room_key_event: ${e}`)})}o.logger.error("key event has no sender key (not encrypted?)")}else o.logger.error("key event is missing fields")},d.prototype.onRoomKeyWithheldEvent=async function(e){const t=e.getContent(),n=t.sender_key;if("m.no_olm"===t.code){const r=e.getSender();if(await this._olmDevice.getSessionIdForDevice(n))return await this._olmDevice.recordSessionProblem(n,"no_olm",!0),void this.retryDecryptionFromSender(n);const i=this._crypto._deviceList.getDeviceByIdentityKey(t.algorithm,n);if(!i)return o.logger.info("Couldn't find device for identity key "+n+": not establishing session"),await this._olmDevice.recordSessionProblem(n,"no_olm",!1),void this.retryDecryptionFromSender(n);await s.ensureOlmSessionsForDevices(this._olmDevice,this._baseApis,{[r]:[i]},!1);const a={algorithm:s.OLM_ALGORITHM,sender_key:this._olmDevice.deviceCurve25519Key,ciphertext:{}};await s.encryptMessageForDevice(a.ciphertext,this._userId,this._deviceId,this._olmDevice,r,i,{type:"m.dummy"}),await this._olmDevice.recordSessionProblem(n,"no_olm",!0),this.retryDecryptionFromSender(n),await this._baseApis.sendToDevice("m.room.encrypted",{[r]:{[i.deviceId]:a}})}else await this._olmDevice.addInboundGroupSessionWithheld(t.room_id,n,t.session_id,t.code,t.reason)},d.prototype.hasKeysForKeyRequest=function(e){const t=e.requestBody;return this._olmDevice.hasInboundSessionKeys(t.room_id,t.sender_key,t.session_id)},d.prototype.shareKeysWithDevice=function(e){const t=e.userId,n=e.deviceId,r=this._crypto.getStoredDevice(t,n),i=e.requestBody;this.olmlib.ensureOlmSessionsForDevices(this._olmDevice,this._baseApis,{[t]:[r]}).then(e=>{return e[t][n].sessionId?(o.logger.log("sharing keys for session "+i.sender_key+"|"+i.session_id+" with device "+t+":"+n),this._buildKeyForwardingMessage(i.room_id,i.sender_key,i.session_id)):null}).then(e=>{const o={algorithm:s.OLM_ALGORITHM,sender_key:this._olmDevice.deviceCurve25519Key,ciphertext:{}};return this.olmlib.encryptMessageForDevice(o.ciphertext,this._userId,this._deviceId,this._olmDevice,t,r,e).then(()=>{const e={[t]:{[n]:o}};return this._baseApis.sendToDevice("m.room.encrypted",e)})})},d.prototype._buildKeyForwardingMessage=async function(e,t,n){const r=await this._olmDevice.getInboundGroupSessionKey(e,t,n);return{type:"m.forwarded_room_key",content:{algorithm:s.MEGOLM_ALGORITHM,room_id:e,sender_key:t,sender_claimed_ed25519_key:r.sender_claimed_ed25519_key,session_id:n,session_key:r.key,chain_index:r.chain_index,forwarding_curve25519_key_chain:r.forwarding_curve25519_key_chain}}},d.prototype.importRoomKey=function(e){return this._olmDevice.addInboundGroupSession(e.room_id,e.sender_key,e.forwarding_curve25519_key_chain,e.session_id,e.session_key,e.sender_claimed_keys,!0).then(()=>{this._crypto.backupInfo&&this._crypto.backupGroupSession(e.room_id,e.sender_key,e.forwarding_curve25519_key_chain,e.session_id,e.session_key,e.sender_claimed_keys,!0).catch(e=>{o.logger.log("Failed to back up megolm session",e)}),this._retryDecryption(e.sender_key,e.session_id)})},d.prototype._retryDecryption=async function(e,t){const n=this._pendingEvents[e];if(!n)return!0;const r=n.get(t);return!r||(r.delete(t),0===r.size&&this._pendingEvents[e],await Promise.all([...r].map(async e=>{try{await e.attemptDecryption(this._crypto)}catch(e){}})),!(this._pendingEvents[e]||{})[t])},d.prototype.retryDecryptionFromSender=async function(e){const t=this._pendingEvents[e];return o.logger.warn(t),!t||(delete this._pendingEvents[e],await Promise.all([...t].map(async([e,t])=>{await Promise.all([...t].map(async e=>{try{o.logger.warn(e.getId()),await e.attemptDecryption(this._crypto)}catch(e){}}))})),!this._pendingEvents[e])},(0,a.registerAlgorithm)(s.MEGOLM_ALGORITHM,l,d)},function(e,t,n){"use strict";var r=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.DeviceList=void 0;var o=n(4),i=n(0),s=n(15),a=n(43),c=r(n(7)),u=n(9),l=n(2);const d=0,h=1,f=2,p=3;class g extends o.EventEmitter{constructor(e,t,n){super(),this._cryptoStore=t,this._devices={},this._crossSigningInfo={},this._userByIdentityKey={},this._deviceTrackingStatus={},this._syncToken=null,this._serialiser=new m(e,n,this),this._keyDownloadsInProgressByUser={},this._dirty=!1,this._savePromise=null,this._resolveSavePromise=null,this._savePromiseTime=null,this._saveTimer=null}async load(){await this._cryptoStore.doTxn("readonly",[u.IndexedDBCryptoStore.STORE_DEVICE_DATA],e=>{this._cryptoStore.getEndToEndDeviceData(e,e=>{this._devices=e?e.devices:{},this._crossSigningInfo=e&&e.crossSigningInfo||{},this._deviceTrackingStatus=e?e.trackingStatus:{},this._syncToken=e?e.syncToken:null,this._userByIdentityKey={};for(const e of Object.keys(this._devices)){const t=this._devices[e];for(const n of Object.keys(t)){const r=t[n].keys["curve25519:"+n];void 0!==r&&(this._userByIdentityKey[r]=e)}}})});for(const e of Object.keys(this._deviceTrackingStatus))this._deviceTrackingStatus[e]==f&&(this._deviceTrackingStatus[e]=h)}stop(){null!==this._saveTimer&&clearTimeout(this._saveTimer)}async saveIfDirty(e){if(!this._dirty)return Promise.resolve(!1);void 0===e&&(e=500);const t=Date.now+e;this._savePromiseTime&&t<this._savePromiseTime&&(clearTimeout(this._saveTimer),this._saveTimer=null,this._savePromiseTime=null);let n=this._savePromise;if(null===n&&(n=new Promise((e,t)=>{this._resolveSavePromise=e}),this._savePromise=n),null===this._saveTimer){const n=this._resolveSavePromise;this._savePromiseTime=t,this._saveTimer=setTimeout(()=>{i.logger.log("Saving device tracking data at token "+this._syncToken),this._savePromiseTime=null,this._saveTimer=null,this._savePromise=null,this._resolveSavePromise=null,this._dirty=!1,this._cryptoStore.doTxn("readwrite",[u.IndexedDBCryptoStore.STORE_DEVICE_DATA],e=>{this._cryptoStore.storeEndToEndDeviceData({devices:this._devices,crossSigningInfo:this._crossSigningInfo,trackingStatus:this._deviceTrackingStatus,syncToken:this._syncToken},e)}).then(()=>{n()})},e)}return n}getSyncToken(){return this._syncToken}setSyncToken(e){this._syncToken=e}downloadKeys(e,t){const n=[],r=[];if(e.forEach(e=>{const o=this._deviceTrackingStatus[e];this._keyDownloadsInProgressByUser[e]?(i.logger.log("downloadKeys: already have a download in progress for "+`${e}: awaiting its result`),r.push(this._keyDownloadsInProgressByUser[e])):(t||o!=p)&&n.push(e)}),0!=n.length){i.logger.log("downloadKeys: downloading for",n);const e=this._doKeyDownload(n);r.push(e)}return 0===r.length&&i.logger.log("downloadKeys: already have all necessary keys"),Promise.all(r).then(()=>this._getDevicesFromStore(e))}_getDevicesFromStore(e){const t={},n=this;return e.map((function(e){t[e]={},(n.getStoredDevicesForUser(e)||[]).map((function(n){t[e][n.deviceId]=n}))})),t}getStoredDevicesForUser(e){const t=this._devices[e];if(!t)return null;const n=[];for(const e in t)t.hasOwnProperty(e)&&n.push(s.DeviceInfo.fromStorage(t[e],e));return n}getRawStoredDevicesForUser(e){return this._devices[e]}getStoredCrossSigningForUser(e){return this._crossSigningInfo[e]?a.CrossSigningInfo.fromStorage(this._crossSigningInfo[e],e):null}storeCrossSigningForUser(e,t){this._crossSigningInfo[e]=t,this._dirty=!0}getStoredDevice(e,t){const n=this._devices[e];if(n&&n[t])return s.DeviceInfo.fromStorage(n[t],t)}getDeviceByIdentityKey(e,t){const n=this._userByIdentityKey[t];if(!n)return null;if(e!==c.OLM_ALGORITHM&&e!==c.MEGOLM_ALGORITHM)return null;const r=this._devices[n];if(!r)return null;for(const e in r){if(!r.hasOwnProperty(e))continue;const n=r[e];for(const r in n.keys){if(!n.keys.hasOwnProperty(r))continue;if(0!==r.indexOf("curve25519:"))continue;if(n.keys[r]==t)return s.DeviceInfo.fromStorage(n,e)}}return null}storeDevicesForUser(e,t){if(void 0!==this._devices[e])for(const[t,n]of Object.entries(this._devices[e])){const e=n.keys["curve25519:"+t];delete this._userByIdentityKey[e]}this._devices[e]=t;for(const[n,r]of Object.entries(t)){const t=r.keys["curve25519:"+n];this._userByIdentityKey[t]=e}this._dirty=!0}startTrackingDeviceList(e){if("string"!=typeof e)throw new Error("userId must be a string; was "+e);this._deviceTrackingStatus[e]||(i.logger.log("Now tracking device list for "+e),this._deviceTrackingStatus[e]=h,this._dirty=!0)}stopTrackingDeviceList(e){this._deviceTrackingStatus[e]&&(i.logger.log("No longer tracking device list for "+e),this._deviceTrackingStatus[e]=d,this._dirty=!0)}stopTrackingAllDeviceLists(){for(const e of Object.keys(this._deviceTrackingStatus))this._deviceTrackingStatus[e]=d;this._dirty=!0}invalidateUserDeviceList(e){this._deviceTrackingStatus[e]&&(i.logger.log("Marking device list outdated for",e),this._deviceTrackingStatus[e]=h,this._dirty=!0)}refreshOutdatedDeviceLists(){this.saveIfDirty();const e=[];for(const t of Object.keys(this._deviceTrackingStatus)){this._deviceTrackingStatus[t]==h&&e.push(t)}return this._doKeyDownload(e)}_setRawStoredDevicesForUser(e,t){if(void 0!==this._devices[e])for(const[t,n]of Object.entries(this._devices[e])){const e=n.keys["curve25519:"+t];delete this._userByIdentityKey[e]}this._devices[e]=t;for(const[n,r]of Object.entries(t)){const t=r.keys["curve25519:"+n];this._userByIdentityKey[t]=e}}setRawStoredCrossSigningForUser(e,t){this._crossSigningInfo[e]=t}_doKeyDownload(e){if(0===e.length)return Promise.resolve();const t=this._serialiser.updateDevicesForUsers(e,this._syncToken).then(()=>{n(!0)},t=>{throw i.logger.error("Error downloading keys for "+e+":",t),n(!1),t});e.forEach(e=>{this._keyDownloadsInProgressByUser[e]=t,this._deviceTrackingStatus[e]==h&&(this._deviceTrackingStatus[e]=f)});const n=n=>{e.forEach(e=>{if(this._dirty=!0,this._keyDownloadsInProgressByUser[e]!==t)return void i.logger.log("Another update in the queue for",e,"- not marking up-to-date");delete this._keyDownloadsInProgressByUser[e],this._deviceTrackingStatus[e]==f&&(n?(this._deviceTrackingStatus[e]=p,i.logger.log("Device list for",e,"now up to date")):this._deviceTrackingStatus[e]=h)}),this.saveIfDirty(),this.emit("crypto.devicesUpdated",e)};return t}}t.DeviceList=g;class m{constructor(e,t,n){this._baseApis=e,this._olmDevice=t,this._deviceList=n,this._downloadInProgress=!1,this._keyDownloadsQueuedByUser={},this._queuedQueryDeferred=null,this._syncToken=null}updateDevicesForUsers(e,t){return e.forEach(e=>{this._keyDownloadsQueuedByUser[e]=!0}),this._queuedQueryDeferred||(this._queuedQueryDeferred=(0,l.defer)()),this._syncToken=t,this._downloadInProgress?(i.logger.log("Queued key download for",e),this._queuedQueryDeferred.promise):this._doQueuedQueries()}_doQueuedQueries(){if(this._downloadInProgress)throw new Error("DeviceListUpdateSerialiser._doQueuedQueries called with request active");const e=Object.keys(this._keyDownloadsQueuedByUser);this._keyDownloadsQueuedByUser={};const t=this._queuedQueryDeferred;this._queuedQueryDeferred=null,i.logger.log("Starting key download for",e),this._downloadInProgress=!0;const n={};return this._syncToken&&(n.token=this._syncToken),this._baseApis.downloadKeysForUsers(e,n).then(t=>{const n=t.device_keys||{},r=t.master_keys||{},o=t.self_signing_keys||{},i=t.user_signing_keys||{};let s=Promise.resolve();for(const t of e)s=s.then((0,l.sleep)(5)).then(()=>this._processQueryResponseForUser(t,n[t],{master:r[t],self_signing:o[t],user_signing:i[t]}));return s}).then(()=>{i.logger.log("Completed key download for "+e),this._downloadInProgress=!1,t.resolve(),this._queuedQueryDeferred&&this._doQueuedQueries()},n=>{i.logger.warn("Error downloading keys for "+e+":",n),this._downloadInProgress=!1,t.reject(n)}),t.promise}async _processQueryResponseForUser(e,t,n,r){i.logger.log("got device keys for "+e+":",t),i.logger.log("got cross-signing keys for "+e+":",n);{const n={},r=this._deviceList.getRawStoredDevicesForUser(e);r&&Object.keys(r).forEach(e=>{const t=s.DeviceInfo.fromStorage(r[e],e);n[e]=t}),await async function(e,t,n,r){let o=!1;for(const e in n)n.hasOwnProperty(e)&&(e in r||(i.logger.log("Device "+t+":"+e+" has been removed"),delete n[e],o=!0));for(const s in r){if(!r.hasOwnProperty(s))continue;const a=r[s];a.user_id===t?a.device_id===s?await y(e,n,a)&&(o=!0):i.logger.warn("Mismatched device_id "+a.device_id+" in keys from "+t+":"+s):i.logger.warn("Mismatched user_id "+a.user_id+" in keys from "+t+":"+s)}return o}(this._olmDevice,e,n,t||{});const o={};Object.keys(n).forEach(e=>{o[e]=n[e].toStorage()}),this._deviceList._setRawStoredDevicesForUser(e,o)}if(n&&(n.master||n.self_signing||n.user_signing)){const t=this._deviceList.getStoredCrossSigningForUser(e)||new a.CrossSigningInfo(e);t.setKeys(n),this._deviceList.setRawStoredCrossSigningForUser(e,t.toStorage()),this._deviceList.emit("userCrossSigningUpdated",e)}}}async function y(e,t,n){if(!n.keys)return!1;const r=n.device_id,o=n.user_id,a="ed25519:"+r,u=n.keys[a];if(!u)return i.logger.warn("Device "+o+":"+r+" has no ed25519 key"),!1;const l=n.unsigned||{},d=n.signatures||{};try{await c.verifySignature(e,n,o,r,u)}catch(e){return i.logger.warn("Unable to verify signature on device "+o+":"+r+":"+e),!1}let h;if(r in t){if((h=t[r]).getFingerprint()!=u)return i.logger.warn("Ed25519 key for device "+o+":"+r+" has changed"),!1}else t[r]=h=new s.DeviceInfo(r);return h.keys=n.keys||{},h.algorithms=n.algorithms||[],h.unsigned=l,h.signatures=d,!0}},function(e,t,n){"use strict";(function(e){var r=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.SecretStorage=t.SECRET_STORAGE_ALGORITHM_V1=void 0;var o=n(4),i=n(0),s=r(n(7)),a=n(16);const c="m.secret_storage.v1.curve25519-aes-sha2";t.SECRET_STORAGE_ALGORITHM_V1=c;class u extends o.EventEmitter{constructor(e,t,n){super(),this._baseApis=e,this._cryptoCallbacks=t,this._crossSigningInfo=n,this._requests={},this._incomingRequests={}}async getDefaultKeyId(){const e=await this._baseApis.getAccountDataFromServer("m.secret_storage.default_key");return e?e.key:null}setDefaultKeyId(e){return new Promise(t=>{const n=r=>{"m.secret_storage.default_key"===r.getType()&&r.getContent().key===e&&(this._baseApis.removeListener("accountData",n),t())};this._baseApis.on("accountData",n),this._baseApis.setAccountData("m.secret_storage.default_key",{key:e})})}async addKey(t,n,r){const o={algorithm:t};switch(n||(n={}),n.name&&(o.name=n.name),t){case c:{const t=new e.Olm.PkDecryption;try{const{passphrase:e,pubkey:r}=n;e&&r?(o.passphrase=e,o.pubkey=r):o.pubkey=r||t.generate_key()}finally{t.free()}break}default:throw new Error(`Unknown key algorithm ${n.algorithm}`)}if(!r)do{r=(0,a.randomString)(32)}while(await this._baseApis.getAccountDataFromServer(`m.secret_storage.key.${r}`));return await this._crossSigningInfo.signObject(o,"master"),await this._baseApis.setAccountData(`m.secret_storage.key.${r}`,o),r}async signKey(e){if(e||(e=await this.getDefaultKeyId()),!e)throw new Error("signKey requires a key ID");const t=await this._baseApis.getAccountDataFromServer(`m.secret_storage.key.${e}`);if(!t)throw new Error(`Key ${e} does not exist in account data`);await this._crossSigningInfo.signObject(t,"master"),await this._baseApis.setAccountData(`m.secret_storage.key.${e}`,t)}async hasKey(e){return e||(e=await this.getDefaultKeyId()),!!e&&!!this._baseApis.getAccountDataFromServer("m.secret_storage.key."+e)}async store(t,n,r){const o={};if(!r){const e=await this.getDefaultKeyId();if(!e)throw new Error("No keys specified and no default key present");r=[e]}if(0===r.length)throw new Error("Zero keys given to encrypt with!");for(const t of r){const r=await this._baseApis.getAccountDataFromServer("m.secret_storage.key."+t);if(!r)throw new Error("Unknown key: "+t);switch((0,s.pkVerify)(r,this._crossSigningInfo.getId("master"),this._crossSigningInfo.userId),r.algorithm){case c:{const i=new e.Olm.PkEncryption;try{i.set_recipient_key(r.pubkey),o[t]=i.encrypt(n)}finally{i.free()}break}default:i.logger.warn("unknown algorithm for secret storage key "+t+": "+r.algorithm)}}await this._baseApis.setAccountData(t,{encrypted:o})}storePassthrough(e,t){return this._baseApis.setAccountData(e,{[t]:{passthrough:!0}})}async get(e){const t=await this._baseApis.getAccountDataFromServer(e);if(!t)return;if(!t.encrypted)throw new Error("Content is not encrypted!");const n={};for(const e of Object.keys(t.encrypted)){const r=await this._baseApis.getAccountDataFromServer("m.secret_storage.key."+e),o=t.encrypted[e];switch(r.algorithm){case c:r.pubkey&&o.ciphertext&&o.mac&&o.ephemeral&&(n[e]=r)}}let r,o;try{[r,o]=await this._getSecretStorageKey(n);const e=t.encrypted[r];if(e.passthrough)return o.get_private_key();switch(n[r].algorithm){case c:return o.decrypt(e.ephemeral,e.mac,e.ciphertext)}}finally{o&&o.free()}}async isStored(e,t){const n=await this._baseApis.getAccountDataFromServer(e);if(!n||!n.encrypted)return!1;void 0===t&&(t=!0);for(const e of Object.keys(n.encrypted)){const r=await this._baseApis.getAccountDataFromServer("m.secret_storage.key."+e);if(!r)return!1;const o=n.encrypted[e];switch(t&&(0,s.pkVerify)(r,this._crossSigningInfo.getId("master"),this._crossSigningInfo.userId),r.algorithm){case c:if(r.pubkey&&o.ciphertext&&o.mac&&o.ephemeral)return!0}}return!1}request(e,t){const n=this._baseApis.makeTxnId(),r=this._requests[n]={devices:t},o=new Promise((e,t)=>{r.resolve=e,r.reject=t}),i={name:e,action:"request",requesting_device_id:this._baseApis.deviceId,request_id:n},s={};for(const e of t)s[e]=i;return this._baseApis.sendToDevice("m.secret.request",{[this._baseApis.getUserId()]:s}),{request_id:n,promise:o,cancel:e=>{const o={action:"request_cancellation",requesting_device_id:this._baseApis.deviceId,request_id:n},i={};for(const e of t)i[e]=o;this._baseApis.sendToDevice("m.secret.request",{[this._baseApis.getUserId()]:i}),r.reject(new Error(e||"Cancelled"))}}}async _onRequestReceived(e){const t=e.getSender(),n=e.getContent();if(t!==this._baseApis.getUserId()||!(n.name&&n.action&&n.requesting_device_id&&n.request_id))return;const r=n.requesting_device_id;if("request_cancellation"===n.action)this._incomingRequests[r]&&this._incomingRequests[r][n.request_id]&&(i.logger.info("received request cancellation for secret ("+t+", "+r+", "+n.request_id+")"),this.baseApis.emit("crypto.secrets.requestCancelled",{user_id:t,device_id:r,request_id:n.request_id}));else if("request"===n.action){if(r===this._baseApis.deviceId)return;if(i.logger.info("received request for secret ("+t+", "+r+", "+n.request_id+")"),!this._cryptoCallbacks.onSecretRequested)return;const e=await this._cryptoCallbacks.onSecretRequested({user_id:t,device_id:r,request_id:n.request_id,name:n.name,device_trust:this._baseApis.checkDeviceTrust(t,r)});if(e){const o={type:"m.secret.send",content:{request_id:n.request_id,secret:e}},i={algorithm:s.OLM_ALGORITHM,sender_key:this._baseApis._crypto._olmDevice.deviceCurve25519Key,ciphertext:{}};await s.ensureOlmSessionsForDevices(this._baseApis._crypto._olmDevice,this._baseApis,{[t]:[await this._baseApis.getStoredDevice(t,r)]}),await s.encryptMessageForDevice(i.ciphertext,this._baseApis.getUserId(),this._baseApis.deviceId,this._baseApis._crypto._olmDevice,t,this._baseApis._crypto.getStoredDevice(t,r),o);const a={[t]:{[r]:i}};this._baseApis.sendToDevice("m.room.encrypted",a)}}}_onSecretReceived(e){if(e.getSender()!==this._baseApis.getUserId())return;const t=e.getContent();i.logger.log("got secret share for request ",t.request_id);const n=this._requests[t.request_id];if(n){const r=this._baseApis._crypto._deviceList.getDeviceByIdentityKey(s.OLM_ALGORITHM,e.getSenderKey());if(!r)return void i.logger.log("secret share from unknown device with key",e.getSenderKey());if(!n.devices.includes(r.deviceId))return void i.logger.log("unsolicited secret share from device",r.deviceId);n.resolve(t.secret)}}async _getSecretStorageKey(t){if(!this._cryptoCallbacks.getSecretStorageKey)throw new Error("No getSecretStorageKey callback supplied");const n=await this._cryptoCallbacks.getSecretStorageKey({keys:t});if(!n)throw new Error("getSecretStorageKey callback returned falsey");if(n.length<2)throw new Error("getSecretStorageKey callback returned invalid data");const[r,o]=n;if(!t[r])throw new Error("App returned unknown key from getSecretStorageKey!");switch(t[r].algorithm){case c:{const n=new e.Olm.PkDecryption;let i;try{i=n.init_with_private_key(o)}catch(e){throw n.free(),new Error("getSecretStorageKey callback returned invalid key")}if(i!==t[r].pubkey)throw n.free(),new Error("getSecretStorageKey callback returned incorrect key");return[r,n]}default:throw new Error("Unknown key type: "+t[r].algorithm)}}}t.SecretStorage=u}).call(this,n(3))},function(e,t,n){"use strict";(function(e){var r=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.OutgoingRoomKeyRequestManager=void 0;var o=n(0),i=r(n(2));const s=500,a={UNSENT:0,SENT:1,CANCELLATION_PENDING:2,CANCELLATION_PENDING_AND_WILL_RESEND:3};function c(e){return e.room_id+" / "+e.session_id}function u(e){return"["+i.map(e,e=>`${e.userId}:${e.deviceId}`).join(",")+"]"}t.OutgoingRoomKeyRequestManager=class{constructor(e,t,n){this._baseApis=e,this._deviceId=t,this._cryptoStore=n,this._sendOutgoingRoomKeyRequestsTimer=null,this._sendOutgoingRoomKeyRequestsRunning=!1,this._clientRunning=!1}start(){this._clientRunning=!0,this._startTimer()}stop(){o.logger.log("stopping OutgoingRoomKeyRequestManager"),this._clientRunning=!1}async sendRoomKeyRequest(e,t,n=!1){const r=await this._cryptoStore.getOutgoingRoomKeyRequest(e);if(r)switch(r.state){case a.CANCELLATION_PENDING_AND_WILL_RESEND:case a.UNSENT:return;case a.CANCELLATION_PENDING:{const e=n?a.CANCELLATION_PENDING_AND_WILL_RESEND:a.SENT;await this._cryptoStore.updateOutgoingRoomKeyRequest(r.requestId,a.CANCELLATION_PENDING,{state:e,cancellationTxnId:this._baseApis.makeTxnId()});break}case a.SENT:if(n){const i=a.CANCELLATION_PENDING_AND_WILL_RESEND,s=await this._cryptoStore.updateOutgoingRoomKeyRequest(r.requestId,a.SENT,{state:i,cancellationTxnId:this._baseApis.makeTxnId(),requestTxnId:this._baseApis.makeTxnId()});if(!s)return await this.sendRoomKeyRequest(e,t,n);try{await this._sendOutgoingRoomKeyRequestCancellation(s,!0)}catch(e){o.logger.error("Error sending room key request cancellation; will retry later.",e)}}break;default:throw new Error("unhandled state: "+r.state)}else await this._cryptoStore.getOrAddOutgoingRoomKeyRequest({requestBody:e,recipients:t,requestId:this._baseApis.makeTxnId(),state:a.UNSENT});this._startTimer()}cancelRoomKeyRequest(e){return this._cryptoStore.getOutgoingRoomKeyRequest(e).then(t=>{if(t)switch(t.state){case a.CANCELLATION_PENDING:case a.CANCELLATION_PENDING_AND_WILL_RESEND:return;case a.UNSENT:return o.logger.log("deleting unnecessary room key request for "+c(e)),this._cryptoStore.deleteOutgoingRoomKeyRequest(t.requestId,a.UNSENT);case a.SENT:return this._cryptoStore.updateOutgoingRoomKeyRequest(t.requestId,a.SENT,{state:a.CANCELLATION_PENDING,cancellationTxnId:this._baseApis.makeTxnId()}).then(t=>{t?this._sendOutgoingRoomKeyRequestCancellation(t).catch(e=>{o.logger.error("Error sending room key request cancellation; will retry later.",e),this._startTimer()}):o.logger.log("Tried to cancel room key request for "+c(e)+" but it was already cancelled in another tab")});default:throw new Error("unhandled state: "+t.state)}})}getOutgoingSentRoomKeyRequest(e,t){return this._cryptoStore.getOutgoingRoomKeyRequestsByTarget(e,t,[a.SENT])}_startTimer(){if(this._sendOutgoingRoomKeyRequestsTimer)return;this._sendOutgoingRoomKeyRequestsTimer=e.setTimeout(()=>{if(this._sendOutgoingRoomKeyRequestsRunning)throw new Error("RoomKeyRequestSend already in progress!");this._sendOutgoingRoomKeyRequestsRunning=!0,this._sendOutgoingRoomKeyRequests().finally(()=>{this._sendOutgoingRoomKeyRequestsRunning=!1}).catch(e=>{o.logger.warn(`error in OutgoingRoomKeyRequestManager: ${e}`)})},s)}_sendOutgoingRoomKeyRequests(){return this._clientRunning?(o.logger.log("Looking for queued outgoing room key requests"),this._cryptoStore.getOutgoingRoomKeyRequestByState([a.CANCELLATION_PENDING,a.CANCELLATION_PENDING_AND_WILL_RESEND,a.UNSENT]).then(e=>{if(!e)return o.logger.log("No more outgoing room key requests"),void(this._sendOutgoingRoomKeyRequestsTimer=null);let t;switch(e.state){case a.UNSENT:t=this._sendOutgoingRoomKeyRequest(e);break;case a.CANCELLATION_PENDING:t=this._sendOutgoingRoomKeyRequestCancellation(e);break;case a.CANCELLATION_PENDING_AND_WILL_RESEND:t=this._sendOutgoingRoomKeyRequestCancellation(e,!0)}return t.then(()=>this._sendOutgoingRoomKeyRequests()).catch(e=>{o.logger.error("Error sending room key request; will retry later.",e),this._sendOutgoingRoomKeyRequestsTimer=null,this._startTimer()})})):(this._sendOutgoingRoomKeyRequestsTimer=null,Promise.resolve())}_sendOutgoingRoomKeyRequest(e){o.logger.log(`Requesting keys for ${c(e.requestBody)}`+` from ${u(e.recipients)}`+`(id ${e.requestId})`);const t={action:"request",requesting_device_id:this._deviceId,request_id:e.requestId,body:e.requestBody};return this._sendMessageToDevices(t,e.recipients,e.requestTxnId||e.requestId).then(()=>this._cryptoStore.updateOutgoingRoomKeyRequest(e.requestId,a.UNSENT,{state:a.SENT}))}_sendOutgoingRoomKeyRequestCancellation(e,t){o.logger.log("Sending cancellation for key request for "+`${c(e.requestBody)} to `+`${u(e.recipients)} `+`(cancellation id ${e.cancellationTxnId})`);const n={action:"request_cancellation",requesting_device_id:this._deviceId,request_id:e.requestId};return this._sendMessageToDevices(n,e.recipients,e.cancellationTxnId).then(()=>t?this._cryptoStore.updateOutgoingRoomKeyRequest(e.requestId,a.CANCELLATION_PENDING_AND_WILL_RESEND,{state:a.UNSENT}):this._cryptoStore.deleteOutgoingRoomKeyRequest(e.requestId,a.CANCELLATION_PENDING))}_sendMessageToDevices(e,t,n){const r={};for(const n of t)r[n.userId]||(r[n.userId]={}),r[n.userId][n.deviceId]=e;return this._baseApis.sendToDevice("m.room_key_request",r,n)}}}).call(this,n(3))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScanQRCode=t.ShowQRCode=void 0;var r=n(44),o=n(10);const i=/^(?:https?:\/\/)?(?:www\.)?matrix\.to\/#\/([#@!+][^?]+)\?(.+)$/,s=/^key_([^:]+:.+)$/,a=(0,o.errorFactory)("m.qr_code.invalid","Invalid QR code");class c extends r.VerificationBase{_doVerification(){if(!this._done){const e="https://matrix.to/#/"+this._baseApis.getUserId()+"?device="+encodeURIComponent(this._baseApis.deviceId)+"&action=verify&key_ed25519%3A"+encodeURIComponent(this._baseApis.deviceId)+"="+encodeURIComponent(this._baseApis.getDeviceEd25519Key());this.emit("show_qr_code",{url:e})}}}t.ShowQRCode=c,c.NAME="m.qr_code.show.v1";class u extends r.VerificationBase{static factory(...e){return new u(...e)}async _doVerification(){const e=(await new Promise((e,t)=>{this.emit("scan",{done:e,cancel:()=>t((0,o.newUserCancelledError)())})})).match(i);let t;const n={};if(!e)throw a();const r=e[1],c=e[2].split("&").map(e=>e.split("=",2).map(decodeURIComponent));let u;for(const[e,r]of c)if("device"===e)t=r;else if("action"===e)u=r;else{const t=e.match(s);t&&(n[t[1]]=r)}if(!t||"verify"!==u||0===Object.keys(n).length)throw a();if(this.userId){if(this.userId!==r)throw(0,o.newUserMismatchError)({expected:this.userId,actual:r})}else await new Promise((e,t)=>{this.emit("confirm_user_id",{userId:r,confirm:e,cancel:()=>t((0,o.newUserMismatchError)())})});await this._verifyKeys(r,n,(e,t,n)=>{if(t.keys[e]!==n)throw(0,o.newKeyMismatchError)()})}}t.ScanQRCode=u,u.NAME="m.qr_code.scan.v1"},function(e,t,n){"use strict";(function(e){var r=n(5);Object.defineProperty(t,"__esModule",{value:!0}),t.SAS=void 0;var o=n(44),i=r(n(25)),s=n(10);const a=["m.key.verification.accept","m.key.verification.key","m.key.verification.mac"];let c;const u=(0,s.errorFactory)("m.mismatched_sas","Mismatched short authentication string"),l=(0,s.errorFactory)("m.mismatched_commitment","Mismatched commitment");const d=[["","dog"],["","cat"],["","lion"],["","horse"],["","unicorn"],["","pig"],["","elephant"],["","rabbit"],["","panda"],["","rooster"],["","penguin"],["","turtle"],["","fish"],["","octopus"],["","butterfly"],["","flower"],["","tree"],["","cactus"],["","mushroom"],["","globe"],["","moon"],["","cloud"],["","fire"],["","banana"],["","apple"],["","strawberry"],["","corn"],["","pizza"],["","cake"],["","heart"],["","smiley"],["","robot"],["","hat"],["","glasses"],["","spanner"],["","santa"],["","thumbs up"],["","umbrella"],["","hourglass"],["","clock"],["","gift"],["","light bulb"],["","book"],["","pencil"],["","paperclip"],["","scissors"],["","lock"],["","key"],["","hammer"],["","telephone"],["","flag"],["","train"],["","bicycle"],["","aeroplane"],["","rocket"],["","trophy"],["","ball"],["","guitar"],["","trumpet"],["","bell"],["","anchor"],["","headphones"],["","folder"],["","pin"]];const h={decimal:function(e){return[1e3+(e[0]<<5|e[1]>>3),1e3+((7&e[1])<<10|e[2]<<2|e[3]>>6),1e3+((63&e[3])<<7|e[4]>>1)]},emoji:function(e){return[e[0]>>2,(3&e[0])<<4|e[1]>>4,(15&e[1])<<2|e[2]>>6,63&e[2],e[3]>>2,(3&e[3])<<4|e[4]>>4,(15&e[4])<<2|e[5]>>6].map(e=>d[e])}};function f(e,t){const n={};for(const r of t)r in h&&(n[r]=h[r](e));return n}const p={"hkdf-hmac-sha256":"calculate_mac","hmac-sha256":"calculate_mac_long_kdf"},g=["curve25519"],m=["sha256"],y=["hkdf-hmac-sha256","hmac-sha256"],v=Object.keys(h),_=new Set(g),b=new Set(m),E=new Set(y),S=new Set(v);function w(e,t){return e instanceof Array?e.filter(e=>t.has(e)):[]}class k extends o.VerificationBase{static get NAME(){return"m.sas.v1"}get events(){return a}async _doVerification(){return await e.Olm.init(),c=c||new e.Olm.Utility,await this._baseApis.downloadKeys([this.userId]),this.startEvent?await this._doRespondVerification():await this._doSendVerification()}async _doSendVerification(){const t="m.key.verification.start",n=this._channel.completeContent(t,{method:k.NAME,from_device:this._baseApis.deviceId,key_agreement_protocols:g,hashes:m,message_authentication_codes:y,short_authentication_string:v});this._channel.sendCompleted(t,n);let r=await this._waitForEvent("m.key.verification.accept"),o=r.getContent();const a=w(o.short_authentication_string,S);if(!(_.has(o.key_agreement_protocol)&&b.has(o.hash)&&E.has(o.message_authentication_code)&&a.length))throw(0,s.newUnknownMethodError)();if("string"!=typeof o.commitment)throw(0,s.newInvalidMessageError)();const d=o.message_authentication_code,h=o.commitment,p=new e.Olm.SAS;try{this._send("m.key.verification.key",{key:p.get_pubkey()});const e=(o=(r=await this._waitForEvent("m.key.verification.key")).getContent()).key+i.default.stringify(n);if(c.sha256(e)!==h)throw l();p.set_their_key(o.key);const t="MATRIX_KEY_VERIFICATION_SAS"+this._baseApis.getUserId()+this._baseApis.deviceId+this.userId+this.deviceId+this._channel.transactionId,g=p.generate_bytes(t,6),m=new Promise((e,t)=>{this.emit("show_sas",{sas:f(g,a),confirm:()=>{this._sendMAC(p,d),e()},cancel:()=>t((0,s.newUserCancelledError)()),mismatch:()=>t(u())})});[r]=await Promise.all([this._waitForEvent("m.key.verification.mac").then(e=>(this._expectedEvent="m.key.verification.done",e)),m]),o=r.getContent(),await this._checkMAC(p,o,d)}finally{p.free()}}async _doRespondVerification(){let t=this._channel.completedContentFromEvent(this.startEvent);const n=w(g,new Set(t.key_agreement_protocols))[0],r=w(m,new Set(t.hashes))[0],o=w(y,new Set(t.message_authentication_codes))[0],a=w(t.short_authentication_string,S);if(void 0===n||void 0===r||void 0===o||!a.length)throw(0,s.newUnknownMethodError)();const l=new e.Olm.SAS;try{const e=l.get_pubkey()+i.default.stringify(t);this._send("m.key.verification.accept",{key_agreement_protocol:n,hash:r,message_authentication_code:o,short_authentication_string:a,commitment:c.sha256(e)});let d=await this._waitForEvent("m.key.verification.key");t=d.getContent(),l.set_their_key(t.key),this._send("m.key.verification.key",{key:l.get_pubkey()});const h="MATRIX_KEY_VERIFICATION_SAS"+this.userId+this.deviceId+this._baseApis.getUserId()+this._baseApis.deviceId+this._channel.transactionId,p=l.generate_bytes(h,6),g=new Promise((e,t)=>{this.emit("show_sas",{sas:f(p,a),confirm:()=>{this._sendMAC(l,o),e()},cancel:()=>t((0,s.newUserCancelledError)()),mismatch:()=>t(u())})});[d]=await Promise.all([this._waitForEvent("m.key.verification.mac").then(e=>(this._expectedEvent="m.key.verification.done",e)),g]),t=d.getContent(),await this._checkMAC(l,t,o)}finally{l.free()}}_sendMAC(e,t){const n={},r=[],o="MATRIX_KEY_VERIFICATION_MAC"+this._baseApis.getUserId()+this._baseApis.deviceId+this.userId+this.deviceId+this._channel.transactionId,i=`ed25519:${this._baseApis.deviceId}`;n[i]=e[p[t]](this._baseApis.getDeviceEd25519Key(),o+i),r.push(i);const s=this._baseApis.getCrossSigningId();if(s){const i=`ed25519:${s}`;n[i]=e[p[t]](s,o+i),r.push(i)}const a=e[p[t]](r.sort().join(","),o+"KEY_IDS");this._send("m.key.verification.mac",{mac:n,keys:a})}async _checkMAC(e,t,n){const r="MATRIX_KEY_VERIFICATION_MAC"+this.userId+this.deviceId+this._baseApis.getUserId()+this._baseApis.deviceId+this._channel.transactionId;if(t.keys!==e[p[n]](Object.keys(t.mac).sort().join(","),r+"KEY_IDS"))throw(0,s.newKeyMismatchError)();await this._verifyKeys(this.userId,t.mac,(t,o,i)=>{if(i!==e[p[n]](o.keys[t],r+t))throw(0,s.newKeyMismatchError)()})}}t.SAS=k}).call(this,n(3))},function(e,t,n){var r=n(100);e.exports=r("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")},function(e,t,n){"use strict";var r=n(101).Buffer;e.exports=function(e){if(e.length>=255)throw new TypeError("Alphabet too long");var t=new Uint8Array(256);t.fill(255);for(var n=0;n<e.length;n++){var o=e.charAt(n),i=o.charCodeAt(0);if(255!==t[i])throw new TypeError(o+" is ambiguous");t[i]=n}var s=e.length,a=e.charAt(0),c=Math.log(s)/Math.log(256),u=Math.log(256)/Math.log(s);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return r.alloc(0);var n=0;if(" "!==e[n]){for(var o=0,i=0;e[n]===a;)o++,n++;for(var u=(e.length-n)*c+1>>>0,l=new Uint8Array(u);e[n];){var d=t[e.charCodeAt(n)];if(255===d)return;for(var h=0,f=u-1;(0!==d||h<i)&&-1!==f;f--,h++)d+=s*l[f]>>>0,l[f]=d%256>>>0,d=d/256>>>0;if(0!==d)throw new Error("Non-zero carry");i=h,n++}if(" "!==e[n]){for(var p=u-i;p!==u&&0===l[p];)p++;var g=r.allocUnsafe(o+(u-p));g.fill(0,0,o);for(var m=o;p!==u;)g[m++]=l[p++];return g}}}return{encode:function(t){if(!r.isBuffer(t))throw new TypeError("Expected Buffer");if(0===t.length)return"";for(var n=0,o=0,i=0,c=t.length;i!==c&&0===t[i];)i++,n++;for(var l=(c-i)*u+1>>>0,d=new Uint8Array(l);i!==c;){for(var h=t[i],f=0,p=l-1;(0!==h||f<o)&&-1!==p;p--,f++)h+=256*d[p]>>>0,d[p]=h%s>>>0,h=h/s>>>0;if(0!==h)throw new Error("Non-zero carry");o=f,i++}for(var g=l-o;g!==l&&0===d[g];)g++;for(var m=a.repeat(n);g<l;++g)m+=e.charAt(d[g]);return m},decodeUnsafe:l,decode:function(e){var t=l(e);if(t)return t;throw new Error("Non-base"+s+" character")}}}},function(e,t,n){var r=n(24),o=r.Buffer;function i(e,t){for(var n in e)t[n]=e[n]}function s(e,t,n){return o(e,t,n)}o.from&&o.alloc&&o.allocUnsafe&&o.allocUnsafeSlow?e.exports=r:(i(r,t),t.Buffer=s),s.prototype=Object.create(o.prototype),i(o,s),s.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return o(e,t,n)},s.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=o(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return o(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RequestCallbackChannel=void 0;t.RequestCallbackChannel=class{constructor(e,t){this._request=e,this._channel=t}get transactionId(){return this._channel.transactionId}get needsDoneMessage(){return this._channel.needsDoneMessage}handleEvent(e,t){return this._channel.handleEvent(e,t)}completedContentFromEvent(e){return this._channel.completedContentFromEvent(e)}completeContent(e,t){return this._channel.completeContent(e,t)}async send(e,t){return this._request.handleVerifierSend(e,t),await this._channel.send(e,t)}async sendCompleted(e,t){return this._request.handleVerifierSend(e,t),await this._channel.sendCompleted(e,t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InRoomChannel=void 0;var r=n(27);const o="m.room.message",i="m.reference",s="m.relates_to";class a{constructor(e,t,n){this._client=e,this._roomId=t,this._userId=n,this._requestEventId=null}get needsDoneMessage(){return!0}get transactionId(){return this._requestEventId}static getTimestamp(e){return e.getTs()}static canCreateRequest(e){return e===r.REQUEST_TYPE}static getTransactionId(e){if(a.getEventType(e)===r.REQUEST_TYPE)return e.getId();{const t=e.getRelation();if(t&&t.rel_type===i)return t.event_id}}static validateEvent(e,t){const n=a.getTransactionId(e);if("string"!=typeof n||0===n.length)return!1;const o=a.getEventType(e),i=e.getContent();if(o===r.REQUEST_TYPE){if("string"!=typeof i.to||!i.to.length)return!1;const n=t.getUserId();if(e.getSender()!==n&&i.to!==n)return!1}return r.VerificationRequest.validateEvent(o,e,a.getTimestamp(e),t)}static getEventType(e){const t=e.getType();if(t===o){const t=e.getContent();if(t){const{msgtype:e}=t;if(e===r.REQUEST_TYPE)return r.REQUEST_TYPE}}return t}async handleEvent(e,t){const n=a.getEventType(e);if(e.getRoomId()===this._roomId&&e.getSender()===this._userId)return this._requestEventId||n!==r.REQUEST_TYPE||(this._requestEventId=e.getId()),await t.handleEvent(n,e,a.getTimestamp(e))}completedContentFromEvent(e){const t=Object.assign({},e.getContent());return t[s]=e.getRelation(),t}completeContent(e,t){return t=Object.assign({},t),e!==r.REQUEST_TYPE&&e!==r.START_TYPE||(t.from_device=this._client.getDeviceId()),e===r.REQUEST_TYPE?t={body:this._client.getUserId()+" is requesting to verify your key, but your client does not support in-chat key verification.  You will need to use legacy key verification to verify keys.",msgtype:r.REQUEST_TYPE,to:this._userId,from_device:t.from_device,methods:t.methods}:t[s]={rel_type:i,event_id:this.transactionId},t}send(e,t){const n=this.completeContent(e,t);return this.sendCompleted(e,n)}async sendCompleted(e,t){let n=e;e===r.REQUEST_TYPE&&(n=o);const i=await this._client.sendEvent(this._roomId,n,t);e===r.REQUEST_TYPE&&(this._requestEventId=i.event_id)}}t.InRoomChannel=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ToDeviceChannel=void 0;var r=n(16),o=n(0),i=n(27),s=n(10);class a{constructor(e,t,n,r=null,o=null){this._client=e,this._userId=t,this._devices=n,this.transactionId=r,this._deviceId=o}static getEventType(e){return e.getType()}static getTransactionId(e){const t=e.getContent();return t&&t.transaction_id}static canCreateRequest(e){return e===i.REQUEST_TYPE||e===i.START_TYPE}static validateEvent(e,t){if(e.isCancelled())return o.logger.warn("Ignoring flagged verification request from "+e.getSender()),!1;const n=e.getContent();if(!n)return!1;if(!n.transaction_id)return!1;const r=e.getType();if(r===i.REQUEST_TYPE){if(!Number.isFinite(n.timestamp))return!1;if(e.getSender()===t.getUserId()&&n.from_device==t.getDeviceId())return!1}return i.VerificationRequest.validateEvent(r,e,a.getTimestamp(e),t)}static getTimestamp(e){const t=e.getContent();return t&&t.timestamp}async handleEvent(e,t){const n=e.getType(),r=e.getContent();if(n===i.REQUEST_TYPE||n===i.START_TYPE){this.transactionId||(this.transactionId=r.transaction_id);const e=r.from_device;if(!this._deviceId&&this._devices.includes(e)&&(this._deviceId=e),!this._deviceId||this._deviceId!==e){const t=this.completeContent((0,s.errorFromEvent)((0,s.newUnexpectedMessageError)()));return this._sendToDevices(i.CANCEL_TYPE,t,[e])}}const o=t.phase===i.PHASE_STARTED;await t.handleEvent(e.getType(),e,a.getTimestamp(e));const c=t.phase===i.PHASE_STARTED;if(n===i.START_TYPE&&!o&&c&&this._deviceId){const e=this._devices.filter(e=>e!==this._deviceId);if(e.length){const t=this.completeContent({code:"m.accepted",reason:"Verification request accepted by another device"});await this._sendToDevices(i.CANCEL_TYPE,t,e)}}}completedContentFromEvent(e){return e.getContent()}completeContent(e,t){return t=Object.assign({},t),this.transactionId&&(t.transaction_id=this.transactionId),e!==i.REQUEST_TYPE&&e!==i.START_TYPE||(t.from_device=this._client.getDeviceId()),e===i.REQUEST_TYPE&&(t.timestamp=Date.now()),t}send(e,t={}){e!==i.REQUEST_TYPE&&e!==i.START_TYPE||this.transactionId||(this.transactionId=a.makeTransactionId());const n=this.completeContent(e,t);return this.sendCompleted(e,n)}sendCompleted(e,t){return e===i.REQUEST_TYPE?this._sendToDevices(e,t,this._devices):this._sendToDevices(e,t,[this._deviceId])}_sendToDevices(e,t,n){if(n.length){const r={};for(const e of n)r[e]=t;return this._client.sendToDevice(e,{[this._userId]:r})}return Promise.resolve()}static makeTransactionId(){return(0,r.randomString)(32)}}t.ToDeviceChannel=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AutoDiscovery=void 0;var r=n(0),o=n(18);class i{static get ERROR_INVALID(){return"Invalid homeserver discovery response"}static get ERROR_GENERIC_FAILURE(){return"Failed to get autodiscovery configuration from server"}static get ERROR_INVALID_HS_BASE_URL(){return"Invalid base_url for m.homeserver"}static get ERROR_INVALID_HOMESERVER(){return"Homeserver URL does not appear to be a valid Matrix homeserver"}static get ERROR_INVALID_IS_BASE_URL(){return"Invalid base_url for m.identity_server"}static get ERROR_INVALID_IDENTITY_SERVER(){return"Identity server URL does not appear to be a valid identity server"}static get ERROR_INVALID_IS(){return"Invalid identity server discovery response"}static get ERROR_MISSING_WELLKNOWN(){return"No .well-known JSON file found"}static get ERROR_INVALID_JSON(){return"Invalid JSON"}static get ALL_ERRORS(){return[i.ERROR_INVALID,i.ERROR_GENERIC_FAILURE,i.ERROR_INVALID_HS_BASE_URL,i.ERROR_INVALID_HOMESERVER,i.ERROR_INVALID_IS_BASE_URL,i.ERROR_INVALID_IDENTITY_SERVER,i.ERROR_INVALID_IS,i.ERROR_MISSING_WELLKNOWN,i.ERROR_INVALID_JSON]}static get FAIL_ERROR(){return"FAIL_ERROR"}static get FAIL_PROMPT(){return"FAIL_PROMPT"}static get PROMPT(){return"PROMPT"}static get SUCCESS(){return"SUCCESS"}static async fromDiscoveryConfig(e){const t={"m.homeserver":{state:i.FAIL_ERROR,error:i.ERROR_INVALID,base_url:null},"m.identity_server":{state:i.PROMPT,error:null,base_url:null}};if(!e||!e["m.homeserver"])return r.logger.error("No m.homeserver key in config"),t["m.homeserver"].state=i.FAIL_PROMPT,t["m.homeserver"].error=i.ERROR_INVALID,Promise.resolve(t);if(!e["m.homeserver"].base_url)return r.logger.error("No m.homeserver base_url in config"),t["m.homeserver"].state=i.FAIL_PROMPT,t["m.homeserver"].error=i.ERROR_INVALID_HS_BASE_URL,Promise.resolve(t);const n=this._sanitizeWellKnownUrl(e["m.homeserver"].base_url);if(!n)return r.logger.error("Invalid base_url for m.homeserver"),t["m.homeserver"].error=i.ERROR_INVALID_HS_BASE_URL,Promise.resolve(t);const o=await this._fetchWellKnownObject(`${n}/_matrix/client/versions`);if(!o||!o.raw.versions)return r.logger.error("Invalid /versions response"),t["m.homeserver"].error=i.ERROR_INVALID_HOMESERVER,t["m.homeserver"].base_url=n,Promise.resolve(t);t["m.homeserver"]={state:i.SUCCESS,error:null,base_url:n};let s="";if(e["m.identity_server"]){const n={"m.homeserver":t["m.homeserver"],"m.identity_server":{state:i.FAIL_PROMPT,error:i.ERROR_INVALID_IS,base_url:null}};if(!(s=this._sanitizeWellKnownUrl(e["m.identity_server"].base_url)))return r.logger.error("Invalid base_url for m.identity_server"),n["m.identity_server"].error=i.ERROR_INVALID_IS_BASE_URL,Promise.resolve(n);const o=await this._fetchWellKnownObject(`${s}/_matrix/identity/api/v1`);if(!o||!o.raw||"SUCCESS"!==o.action)return r.logger.error("Invalid /api/v1 response"),n["m.identity_server"].error=i.ERROR_INVALID_IDENTITY_SERVER,n["m.identity_server"].base_url=s,Promise.resolve(n)}return s&&s.length>0&&(t["m.identity_server"]={state:i.SUCCESS,error:null,base_url:s}),Object.keys(e).map(n=>{if("m.homeserver"===n||"m.identity_server"===n){const r=["error","state","base_url"];for(const o of Object.keys(e[n]))r.includes(o)||(t[n][o]=e[n][o])}else t[n]=e[n]}),Promise.resolve(t)}static async findClientConfig(e){if(!e||"string"!=typeof e||0===e.length)throw new Error("'domain' must be a string of non-zero length");const t={"m.homeserver":{state:i.FAIL_ERROR,error:i.ERROR_INVALID,base_url:null},"m.identity_server":{state:i.PROMPT,error:null,base_url:null}},n=await this._fetchWellKnownObject(`https://${e}/.well-known/matrix/client`);return n&&"SUCCESS"===n.action?i.fromDiscoveryConfig(n.raw):(r.logger.error("No response or error when parsing .well-known"),n.reason&&r.logger.error(n.reason),"IGNORE"===n.action?t["m.homeserver"]={state:i.PROMPT,error:null,base_url:null}:(t["m.homeserver"].state=i.FAIL_PROMPT,t["m.homeserver"].error=i.ERROR_INVALID),Promise.resolve(t))}static async getRawClientConfig(e){if(!e||"string"!=typeof e||0===e.length)throw new Error("'domain' must be a string of non-zero length");const t=await this._fetchWellKnownObject(`https://${e}/.well-known/matrix/client`);return t&&t.raw||{}}static _sanitizeWellKnownUrl(e){if(!e)return!1;try{let t=null;try{t=o.URL?new o.URL(e):new URL(e)}catch(n){t=new URL(e)}if(!t||!t.hostname)return!1;if("http:"!==t.protocol&&"https:"!==t.protocol)return!1;const n=t.port?`:${t.port}`:"",r=t.pathname?t.pathname:"";let i=`${t.protocol}//${t.hostname}${n}${r}`;return i.endsWith("/")&&(i=i.substring(0,i.length-1)),i}catch(e){return r.logger.error(e),!1}}static async _fetchWellKnownObject(e){return new Promise((function(t,r){const o=n(31).getRequest();if(!o)throw new Error("No request library available");o({method:"GET",uri:e,timeout:5e3},(e,n,r)=>{if(e||n.statusCode<200||n.statusCode>=300){let r="FAIL_PROMPT",o=(e?e.message:null)||"General failure";return 404===n.statusCode&&(r="IGNORE",o=i.ERROR_MISSING_WELLKNOWN),void t({raw:{},action:r,reason:o,error:e})}try{t({raw:JSON.parse(r),action:"SUCCESS"})}catch(e){let n=i.ERROR_INVALID;"SyntaxError"===e.name&&(n=i.ERROR_INVALID_JSON),t({raw:{},action:"FAIL_PROMPT",reason:n,error:e})}})}))}}t.AutoDiscovery=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TimelineWindow=i,t.TimelineIndex=s;var r=n(8);n(0);const o=function(){};function i(e,t,n){n=n||{},this._client=e,this._timelineSet=t,this._start=null,this._end=null,this._eventCount=0,this._windowLimit=n.windowLimit||1e3}function s(e,t){this.timeline=e,this.index=t}i.prototype.load=function(e,t){const n=this;t=t||20;const r=function(r){let o;const i=r.getEvents();if(e){for(let t=0;t<i.length;t++)if(i[t].getId()==e){o=t;break}if(void 0===o)throw new Error("getEventTimeline result didn't include requested event")}else o=i.length;const a=Math.min(i.length,o+Math.ceil(t/2)),c=Math.max(0,a-t);n._start=new s(r,c-r.getBaseIndex()),n._end=new s(r,a-r.getBaseIndex()),n._eventCount=a-c};if(e){const t=this._timelineSet.getTimelineForEvent(e);return t?(r(t),Promise.resolve(t)):this._client.getEventTimeline(this._timelineSet,e).then(r)}return r(this._timelineSet.getLiveTimeline()),Promise.resolve()},i.prototype.canPaginate=function(e){let t;if(e==r.EventTimeline.BACKWARDS)t=this._start;else{if(e!=r.EventTimeline.FORWARDS)throw new Error("Invalid direction '"+e+"'");t=this._end}if(!t)return o("TimelineWindow: no timeline yet"),!1;if(e==r.EventTimeline.BACKWARDS){if(t.index>t.minIndex())return!0}else if(t.index<t.maxIndex())return!0;return Boolean(t.timeline.getNeighbouringTimeline(e)||t.timeline.getPaginationToken(e))},i.prototype.paginate=function(e,t,n,i){let s;if(void 0===n&&(n=!0),void 0===i&&(i=5),e==r.EventTimeline.BACKWARDS)s=this._start;else{if(e!=r.EventTimeline.FORWARDS)throw new Error("Invalid direction '"+e+"'");s=this._end}if(!s)return o("TimelineWindow: no timeline yet"),Promise.resolve(!1);if(s.pendingPaginate)return s.pendingPaginate;const a=e==r.EventTimeline.BACKWARDS?s.retreat(t):s.advance(t);if(a){this._eventCount+=a,o("TimelineWindow: increased cap by "+a+" (now "+this._eventCount+")");const t=this._eventCount-this._windowLimit;return t>0&&this.unpaginate(t,e!=r.EventTimeline.BACKWARDS),Promise.resolve(!0)}if(!n||0===i)return Promise.resolve(!1);if(!s.timeline.getPaginationToken(e))return o("TimelineWindow: no token"),Promise.resolve(!1);o("TimelineWindow: starting request");const c=this,u=this._client.paginateEventTimeline(s.timeline,{backwards:e==r.EventTimeline.BACKWARDS,limit:t}).finally((function(){s.pendingPaginate=null})).then((function(n){return o("TimelineWindow: request completed with result "+n),!!n&&c.paginate(e,t,!0,i-1)}));return s.pendingPaginate=u,u},i.prototype.unpaginate=function(e,t){const n=t?this._start:this._end;if(e>this._eventCount||e<0)throw new Error("Attemting to unpaginate "+e+" events, but only have "+this._eventCount+" in the timeline");for(;e>0;){const r=t?n.advance(e):n.retreat(e);if(r<=0)throw new Error("Unable to unpaginate any further, but still have "+this._eventCount+" events");e-=r,this._eventCount-=r,o("TimelineWindow.unpaginate: dropped "+r+" (now "+this._eventCount+")")}},i.prototype.getEvents=function(){if(!this._start)return[];const e=[];let t=this._start.timeline;for(;;){const n=t.getEvents();let o=0,i=n.length;t===this._start.timeline&&(o=this._start.index+t.getBaseIndex()),t===this._end.timeline&&(i=this._end.index+t.getBaseIndex());for(let t=o;t<i;t++)e.push(n[t]);if(t===this._end.timeline)break;t=t.getNeighbouringTimeline(r.EventTimeline.FORWARDS)}return e},s.prototype.minIndex=function(){return-1*this.timeline.getBaseIndex()},s.prototype.maxIndex=function(){return this.timeline.getEvents().length-this.timeline.getBaseIndex()},s.prototype.advance=function(e){if(!e)return 0;let t;if(e<0){if((t=Math.max(e,this.minIndex()-this.index))<0)return this.index+=t,t}else if((t=Math.min(e,this.maxIndex()-this.index))>0)return this.index+=t,t;const n=this.timeline.getNeighbouringTimeline(e<0?r.EventTimeline.BACKWARDS:r.EventTimeline.FORWARDS);return n?(this.timeline=n,this.index=e<0?this.maxIndex():this.minIndex(),o("paginate: switched to new neighbour"),this.advance(e)):0},s.prototype.retreat=function(e){return-1*this.advance(-1*e)}},function(e,t,n){"use strict";var r=n(1),o=n(5);Object.defineProperty(t,"__esModule",{value:!0}),t.InteractiveAuth=c;var i=o(n(18)),s=r(n(2)),a=n(0);function c(e){this._matrixClient=e.matrixClient,this._data=e.authData||{},this._requestCallback=e.doRequest,this._busyChangedCallback=e.busyChanged,this._stateUpdatedCallback=e.stateUpdated||e.startAuthStage,this._resolveFunc=null,this._rejectFunc=null,this._inputs=e.inputs||{},this._requestEmailTokenCallback=e.requestEmailToken,e.sessionId&&(this._data.session=e.sessionId),this._clientSecret=e.clientSecret||this._matrixClient.generateClientSecret(),this._emailSid=e.emailSid,void 0===this._emailSid&&(this._emailSid=null),this._requestingEmailToken=!1,this._chosenFlow=null,this._currentStage=null,this._submitPromise=null}c.prototype={attemptAuth:function(){return new Promise((e,t)=>{this._resolveFunc=e,this._rejectFunc=t,this._data.flows?this._startNextAuthStage():(this._busyChangedCallback&&this._busyChangedCallback(!0),this._doRequest(this._data).finally(()=>{this._busyChangedCallback&&this._busyChangedCallback(!1)}))})},poll:async function(){if(!this._data.session)return;if(this._submitPromise)return;let e={};if("m.login.email.identity"==this._currentStage&&this._emailSid){const t={sid:this._emailSid,client_secret:this._clientSecret};if(await this._matrixClient.doesServerRequireIdServerParam()){const e=i.default.parse(this._matrixClient.getIdentityServerUrl());t.id_server=e.host}e={type:"m.login.email.identity",threepid_creds:t}}this.submitAuthDict(e,!0)},getSessionId:function(){return this._data?this._data.session:void 0},getClientSecret:function(){return this._clientSecret},getStageParams:function(e){let t={};return this._data&&this._data.params&&(t=this._data.params),t[e]},getChosenFlow(){return this._chosenFlow},submitAuthDict:async function(e,t){if(!this._resolveFunc)throw new Error("submitAuthDict() called before attemptAuth()");for(!t&&this._busyChangedCallback&&this._busyChangedCallback(!0);this._submitPromise;)try{await this._submitPromise}catch(e){}const n={session:this._data.session};s.extend(n,e);try{this._submitPromise=this._doRequest(n,t),await this._submitPromise}finally{this._submitPromise=null,!t&&this._busyChangedCallback&&this._busyChangedCallback(!1)}},getEmailSid:function(){return this._emailSid},setEmailSid:function(e){this._emailSid=e},_doRequest:async function(e,t){try{const n=await this._requestCallback(e,t);this._resolveFunc(n)}catch(e){const n=e.data?e.data.flows:null,r=Boolean(this._data.flows)||Boolean(n);if(401===e.httpStatus&&e.data&&r||(t?a.logger.log("Background poll request failed doing UI auth: ignoring",e):this._rejectFunc(e)),e.data.flows||e.data.completed||e.data.session||(e.data.flows=this._data.flows,e.data.completed=this._data.completed,e.data.session=this._data.session),this._data=e.data,this._startNextAuthStage(),!this._emailSid&&!this._requestingEmailToken&&this._chosenFlow.stages.includes("m.login.email.identity")){this._requestingEmailToken=!0;try{const e=await this._requestEmailTokenCallback(this._inputs.emailAddress,this._clientSecret,1,this._data.session);this._emailSid=e.sid}catch(e){this._rejectFunc(e)}finally{this._requestingEmailToken=!1}}}},_startNextAuthStage:function(){const e=this._chooseStage();if(!e)throw new Error("No incomplete flows from the server");if(this._currentStage=e,"m.login.dummy"===e)return void this.submitAuthDict({type:"m.login.dummy"});if(this._data.errcode||this._data.error)return void this._stateUpdatedCallback(e,{errcode:this._data.errcode||"",error:this._data.error||""});const t={};"m.login.email.identity"==e&&(t.emailSid=this._emailSid),this._stateUpdatedCallback(e,t)},_chooseStage:function(){null===this._chosenFlow&&(this._chosenFlow=this._chooseFlow()),a.logger.log("Active flow => %s",JSON.stringify(this._chosenFlow));const e=this._firstUncompletedStage(this._chosenFlow);return a.logger.log("Next stage: %s",e),e},_chooseFlow:function(){const e=this._data.flows||[],t=Boolean(this._inputs.emailAddress)||Boolean(this._emailSid),n=Boolean(this._inputs.phoneCountry)&&Boolean(this._inputs.phoneNumber);for(const r of e){let e=!1,o=!1;for(const t of r.stages)"m.login.email.identity"===t?e=!0:"m.login.msisdn"==t&&(o=!0);if(e==t&&o==n)return r}const r=new Error("No appropriate authentication flow found");throw r.name="NoAuthFlowFoundError",r.required_stages=[],t&&r.required_stages.push("m.login.email.identity"),n&&r.required_stages.push("m.login.msisdn"),r.available_flows=e,r},_firstUncompletedStage:function(e){const t=(this._data||{}).completed||[];for(let n=0;n<e.stages.length;++n){const r=e.stages[n];if(-1===t.indexOf(r))return r}}}},function(e,t,n){"use strict";(function(e){var r=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedDBStore=h;var o=n(32),i=r(n(2)),s=n(4),a=n(109),c=n(110),u=n(12),l=n(6),d=n(0);function h(t){if(o.MemoryStore.call(this,t),!t.indexedDB)throw new Error("Missing required option: indexedDB");if(t.workerScript){let n=t.workerApi;n||(n=e.Worker),this.backend=new c.RemoteIndexedDBStoreBackend(t.workerScript,t.dbName,n)}else this.backend=new a.LocalIndexedDBStoreBackend(t.indexedDB,t.dbName);this.startedUp=!1,this._syncTs=0,this._userModifiedMap={}}function f(e,t){return async function(...n){try{return await e.call(this,...n)}catch(e){d.logger.error("IndexedDBStore failure, degrading to MemoryStore",e),this.emit("degraded",e);try{d.logger.log("IndexedDBStore trying to delete degraded data"),await this.backend.clearDatabase(),d.logger.log("IndexedDBStore delete after degrading succeeeded")}catch(e){d.logger.warn("IndexedDBStore delete after degrading failed",e)}if(Object.setPrototypeOf(this,o.MemoryStore.prototype),t)return await o.MemoryStore.prototype[t].call(this,...n)}}}i.inherits(h,o.MemoryStore),i.extend(h.prototype,s.EventEmitter.prototype),h.exists=function(e,t){return a.LocalIndexedDBStoreBackend.exists(e,t)},h.prototype.startup=function(){return this.startedUp?(d.logger.log("IndexedDBStore.startup: already started"),Promise.resolve()):(d.logger.log("IndexedDBStore.startup: connecting to backend"),this.backend.connect().then(()=>(d.logger.log("IndexedDBStore.startup: loading presence events"),this.backend.getUserPresenceEvents())).then(e=>{d.logger.log("IndexedDBStore.startup: processing presence events"),e.forEach(([e,t])=>{const n=new u.User(e);t&&n.setPresenceEvent(new l.MatrixEvent(t)),this._userModifiedMap[n.userId]=n.getLastModifiedTime(),this.storeUser(n)})}))},h.prototype.getSavedSync=f((function(){return this.backend.getSavedSync()}),"getSavedSync"),h.prototype.isNewlyCreated=f((function(){return this.backend.isNewlyCreated()}),"isNewlyCreated"),h.prototype.getSavedSyncToken=f((function(){return this.backend.getNextBatchToken()}),"getSavedSyncToken"),h.prototype.deleteAllData=f((function(){return o.MemoryStore.prototype.deleteAllData.call(this),this.backend.clearDatabase().then(()=>{d.logger.log("Deleted indexeddb data.")},e=>{throw d.logger.error(`Failed to delete indexeddb data: ${e}`),e})})),h.prototype.wantsSave=function(){return Date.now()-this._syncTs>3e5},h.prototype.save=function(e){return e||this.wantsSave()?this._reallySave():Promise.resolve()},h.prototype._reallySave=f((function(){this._syncTs=Date.now();const e=[];for(const t of this.getUsers())this._userModifiedMap[t.userId]!==t.getLastModifiedTime()&&t.events.presence&&(e.push([t.userId,t.events.presence.event]),this._userModifiedMap[t.userId]=t.getLastModifiedTime());return this.backend.syncToDatabase(e)})),h.prototype.setSyncData=f((function(e){return this.backend.setSyncData(e)}),"setSyncData"),h.prototype.getOutOfBandMembers=f((function(e){return this.backend.getOutOfBandMembers(e)}),"getOutOfBandMembers"),h.prototype.setOutOfBandMembers=f((function(e,t){return o.MemoryStore.prototype.setOutOfBandMembers.call(this,e,t),this.backend.setOutOfBandMembers(e,t)}),"setOutOfBandMembers"),h.prototype.clearOutOfBandMembers=f((function(e){return o.MemoryStore.prototype.clearOutOfBandMembers.call(this),this.backend.clearOutOfBandMembers(e)}),"clearOutOfBandMembers"),h.prototype.getClientOptions=f((function(){return this.backend.getClientOptions()}),"getClientOptions"),h.prototype.storeClientOptions=f((function(e){return o.MemoryStore.prototype.storeClientOptions.call(this,e),this.backend.storeClientOptions(e)}),"storeClientOptions")}).call(this,n(3))},function(e,t,n){"use strict";var r=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.LocalIndexedDBStoreBackend=h;var o=n(47),i=r(n(2)),s=r(n(40)),a=n(0);function c(e,t,n){const r=e.openCursor(t);return new Promise((e,t)=>{const o=[];r.onerror=e=>{t(new Error("Query failed: "+e.target.errorCode))},r.onsuccess=t=>{const r=t.target.result;r?(o.push(n(r)),r.continue()):e(o)}})}function u(e){return new Promise((t,n)=>{e.oncomplete=function(e){t(e)},e.onerror=function(e){n(e.target.error)}})}function l(e){return new Promise((t,n)=>{e.onsuccess=function(e){t(e)},e.onerror=function(e){n(e.target.error)}})}function d(e){return l(e).then(e=>e.target.result)}function h(e,t){this.indexedDB=e,this._dbName="matrix-js-sdk:"+(t||"default"),this.db=null,this._disconnected=!0,this._syncAccumulator=new o.SyncAccumulator,this._isNewlyCreated=!1}h.exists=function(e,t){return t="matrix-js-sdk:"+(t||"default"),s.exists(e,t)},h.prototype={connect:function(){if(!this._disconnected)return a.logger.log("LocalIndexedDBStoreBackend.connect: already connected or connecting"),Promise.resolve();this._disconnected=!1,a.logger.log("LocalIndexedDBStoreBackend.connect: connecting...");const e=this.indexedDB.open(this._dbName,3);return e.onupgradeneeded=e=>{const t=e.target.result,n=e.oldVersion;a.logger.log(`LocalIndexedDBStoreBackend.connect: upgrading from ${n}`),n<1&&(this._isNewlyCreated=!0,function(e){e.createObjectStore("users",{keyPath:["userId"]}),e.createObjectStore("accountData",{keyPath:["type"]}),e.createObjectStore("sync",{keyPath:["clobber"]})}(t)),n<2&&function(e){e.createObjectStore("oob_membership_events",{keyPath:["room_id","state_key"]}).createIndex("room","room_id")}(t),n<3&&function(e){e.createObjectStore("client_options",{keyPath:["clobber"]})}(t)},e.onblocked=()=>{a.logger.log("can't yet open LocalIndexedDBStoreBackend because it is open elsewhere")},a.logger.log("LocalIndexedDBStoreBackend.connect: awaiting connection..."),l(e).then(e=>(a.logger.log("LocalIndexedDBStoreBackend.connect: connected"),this.db=e.target.result,this.db.onversionchange=()=>{this.db.close()},this._init()))},isNewlyCreated:function(){return Promise.resolve(this._isNewlyCreated)},_init:function(){return Promise.all([this._loadAccountData(),this._loadSyncData()]).then(([e,t])=>{a.logger.log("LocalIndexedDBStoreBackend: loaded initial data"),this._syncAccumulator.accumulate({next_batch:t.nextBatch,rooms:t.roomsData,groups:t.groupsData,account_data:{events:e}})})},getOutOfBandMembers:function(e){return new Promise((t,n)=>{const r=this.db.transaction(["oob_membership_events"],"readonly").objectStore("oob_membership_events").index("room"),o=IDBKeyRange.only(e),i=r.openCursor(o),s=[];let a=!1;i.onsuccess=e=>{const n=e.target.result;if(!n)return s.length||a?t(s):t(null);const r=n.value;r.oob_written?a=!0:s.push(r),n.continue()},i.onerror=e=>{n(e)}}).then(t=>(a.logger.log(`LL: got ${t&&t.length}`+` membershipEvents from storage for room ${e} ...`),t))},setOutOfBandMembers:async function(e,t){a.logger.log(`LL: backend about to store ${t.length}`+` members for ${e}`);const n=this.db.transaction(["oob_membership_events"],"readwrite"),r=n.objectStore("oob_membership_events");t.forEach(e=>{r.put(e)});const o={room_id:e,oob_written:!0,state_key:0};r.put(o),await u(n),a.logger.log(`LL: backend done storing for ${e}!`)},clearOutOfBandMembers:async function(e){const t=this.db.transaction(["oob_membership_events"],"readonly").objectStore("oob_membership_events").index("room"),n=IDBKeyRange.only(e),r=d(t.openKeyCursor(n,"next")).then(e=>e&&e.primaryKey[1]),o=d(t.openKeyCursor(n,"prev")).then(e=>e&&e.primaryKey[1]),[i,s]=await Promise.all([r,o]),c=this.db.transaction(["oob_membership_events"],"readwrite").objectStore("oob_membership_events"),u=IDBKeyRange.bound([e,i],[e,s]);var l;a.logger.log("LL: Deleting all users + marker in storage for "+`room ${e}, with key range:`,[e,i],[e,s]),await(l=c.delete(u),new Promise((e,t)=>{l.onsuccess=()=>e(l),l.onerror=e=>t(e)}))},clearDatabase:function(){return new Promise((e,t)=>{a.logger.log(`Removing indexeddb instance: ${this._dbName}`);const n=this.indexedDB.deleteDatabase(this._dbName);n.onblocked=()=>{a.logger.log(`can't yet delete indexeddb ${this._dbName}`+" because it is open elsewhere")},n.onerror=t=>{a.logger.warn(`unable to delete js-sdk store indexeddb: ${t.target.error}`),e()},n.onsuccess=()=>{a.logger.log(`Removed indexeddb instance: ${this._dbName}`),e()}})},getSavedSync:function(e){void 0===e&&(e=!0);const t=this._syncAccumulator.getJSON();return t.nextBatch?e?Promise.resolve(i.deepCopy(t)):Promise.resolve(t):Promise.resolve(null)},getNextBatchToken:function(){return Promise.resolve(this._syncAccumulator.getNextBatchToken())},setSyncData:function(e){return Promise.resolve().then(()=>{this._syncAccumulator.accumulate(e)})},syncToDatabase:function(e){const t=this._syncAccumulator.getJSON();return Promise.all([this._persistUserPresenceEvents(e),this._persistAccountData(t.accountData),this._persistSyncData(t.nextBatch,t.roomsData,t.groupsData)])},_persistSyncData:function(e,t,n){return a.logger.log("Persisting sync data up to ",e),i.promiseTry(()=>{const r=this.db.transaction(["sync"],"readwrite");return r.objectStore("sync").put({clobber:"-",nextBatch:e,roomsData:t,groupsData:n}),u(r)})},_persistAccountData:function(e){return i.promiseTry(()=>{const t=this.db.transaction(["accountData"],"readwrite"),n=t.objectStore("accountData");for(let t=0;t<e.length;t++)n.put(e[t]);return u(t)})},_persistUserPresenceEvents:function(e){return i.promiseTry(()=>{const t=this.db.transaction(["users"],"readwrite"),n=t.objectStore("users");for(const t of e)n.put({userId:t[0],event:t[1]});return u(t)})},getUserPresenceEvents:function(){return i.promiseTry(()=>{return c(this.db.transaction(["users"],"readonly").objectStore("users"),void 0,e=>[e.value.userId,e.value.event])})},_loadAccountData:function(){return a.logger.log("LocalIndexedDBStoreBackend: loading account data..."),i.promiseTry(()=>{return c(this.db.transaction(["accountData"],"readonly").objectStore("accountData"),void 0,e=>e.value).then(e=>(a.logger.log("LocalIndexedDBStoreBackend: loaded account data"),e))})},_loadSyncData:function(){return a.logger.log("LocalIndexedDBStoreBackend: loading sync data..."),i.promiseTry(()=>{return c(this.db.transaction(["sync"],"readonly").objectStore("sync"),void 0,e=>e.value).then(e=>(a.logger.log("LocalIndexedDBStoreBackend: loaded sync data"),e.length>1&&a.logger.warn("loadSyncData: More than 1 sync row found."),e.length>0?e[0]:{}))})},getClientOptions:function(){return Promise.resolve().then(()=>{return c(this.db.transaction(["client_options"],"readonly").objectStore("client_options"),void 0,e=>{if(e.value&&e.value&&e.value.options)return e.value.options}).then(e=>e[0])})},storeClientOptions:async function(e){const t=this.db.transaction(["client_options"],"readwrite");t.objectStore("client_options").put({clobber:"-",options:e}),await u(t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteIndexedDBStoreBackend=i;var r=n(0),o=n(2);function i(e,t,n){this._workerScript=e,this._dbName=t,this._workerApi=n,this._worker=null,this._nextSeq=0,this._inFlight={},this._startPromise=null}i.prototype={connect:function(){return this._ensureStarted().then(()=>this._doCmd("connect"))},clearDatabase:function(){return this._ensureStarted().then(()=>this._doCmd("clearDatabase"))},isNewlyCreated:function(){return this._doCmd("isNewlyCreated")},getSavedSync:function(){return this._doCmd("getSavedSync")},getNextBatchToken:function(){return this._doCmd("getNextBatchToken")},setSyncData:function(e){return this._doCmd("setSyncData",[e])},syncToDatabase:function(e){return this._doCmd("syncToDatabase",[e])},getOutOfBandMembers:function(e){return this._doCmd("getOutOfBandMembers",[e])},setOutOfBandMembers:function(e,t){return this._doCmd("setOutOfBandMembers",[e,t])},clearOutOfBandMembers:function(e){return this._doCmd("clearOutOfBandMembers",[e])},getClientOptions:function(){return this._doCmd("getClientOptions")},storeClientOptions:function(e){return this._doCmd("storeClientOptions",[e])},getUserPresenceEvents:function(){return this._doCmd("getUserPresenceEvents")},_ensureStarted:function(){return null===this._startPromise&&(this._worker=new this._workerApi(this._workerScript),this._worker.onmessage=this._onWorkerMessage.bind(this),this._startPromise=this._doCmd("_setupWorker",[this._dbName]).then(()=>{r.logger.log("IndexedDB worker is ready")})),this._startPromise},_doCmd:function(e,t){return Promise.resolve().then(()=>{const n=this._nextSeq++,r=(0,o.defer)();return this._inFlight[n]=r,this._worker.postMessage({command:e,seq:n,args:t}),r.promise})},_onWorkerMessage:function(e){const t=e.data;if("cmd_success"==t.command||"cmd_fail"==t.command){if(void 0===t.seq)return void r.logger.error("Got reply from worker with no seq");const e=this._inFlight[t.seq];if(void 0===e)return void r.logger.error("Got reply for unknown seq "+t.seq);if(delete this._inFlight[t.seq],"cmd_success"==t.command)e.resolve(t.result);else{const n=new Error(t.error.message);n.name=t.error.name,e.reject(n)}}else r.logger.warn("Unrecognised message from worker: "+t)}}},function(e,t,n){"use strict";var r=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.WebStorageSessionStore=c;var o=r(n(2)),i=n(0);const s=!1,a="session.e2e.";function c(e){if(this.store=e,!(o.isFunction(e.getItem)&&o.isFunction(e.setItem)&&o.isFunction(e.removeItem)&&o.isFunction(e.key)&&"number"==typeof e.length))throw new Error("Supplied webStore does not meet the WebStorage API interface")}c.prototype={removeEndToEndAccount:function(){this.store.removeItem(u)},getEndToEndAccount:function(){return this.store.getItem(u)},getAllEndToEndDevices:function(){const e=f(""),t={};for(let n=0;n<this.store.length;++n){const r=this.store.key(n),o=r.substr(e.length);r.startsWith(e)&&(t[o]=m(this.store,r))}return t},getEndToEndDeviceTrackingStatus:function(){return m(this.store,d)},getEndToEndDeviceSyncToken:function(){return m(this.store,l)},removeEndToEndDeviceData:function(){v(this.store,f("")),v(this.store,d),v(this.store,l)},getEndToEndSessions:function(e){return m(this.store,p(e))},getAllEndToEndSessions:function(){const e=y(this.store,p("")),t={};for(const n of e){t[n.substr(p("").length)]=m(this.store,n)}return t},removeAllEndToEndSessions:function(){v(this.store,p(""))},getAllEndToEndInboundGroupSessionKeys:function(){const e=a+"inboundgroupsessions/",t=[];for(let n=0;n<this.store.length;n++){const r=this.store.key(n);r.startsWith(e)&&t.push({senderKey:r.substr(e.length,43),sessionId:r.substr(e.length+44)})}return t},getEndToEndInboundGroupSession:function(e,t){const n=function(e,t){return a+"inboundgroupsessions/"+e+"/"+t}(e,t);return this.store.getItem(n)},removeAllEndToEndInboundGroupSessions:function(){v(this.store,a+"inboundgroupsessions/")},getAllEndToEndRooms:function(){const e=y(this.store,g("")),t={};for(const n of e){t[n.substr(g("").length)]=m(this.store,n)}return t},removeAllEndToEndRooms:function(){v(this.store,g(""))},setLocalTrustedBackupPubKey:function(e){this.store.setItem(h,e)},getLocalTrustedBackupPubKey:function(){return this.store.getItem(h)}};const u=a+"account",l=a+"device_sync_token",d=a+"device_tracking",h=a+"trusted_backup_pubkey";function f(e){return a+"devices/"+e}function p(e){return a+"sessions/"+e}function g(e){return a+"rooms/"+e}function m(e,t){try{return JSON.parse(e.getItem(t))}catch(e){_("Failed to get key %s: %s",t,e),_(e.stack)}return null}function y(e,t){const n=[];for(let r=0;r<e.length;++r){const o=e.key(r);o.startsWith(t)&&n.push(o)}return n}function v(e,t){const n=[];for(let r=0;r<e.length;++r){const o=e.key(r);o.startsWith(t)&&n.push(o)}for(const t of n)e.removeItem(t)}function _(){s&&i.logger.log(...arguments)}},function(e,t,n){var r,o,i;o=[],void 0===(i="function"==typeof(r=function(){var e=XMLHttpRequest;if(!e)throw new Error("missing XMLHttpRequest");function t(i,s){if("function"!=typeof s)throw new Error("Bad callback given: "+s);if(!i)throw new Error("No options given");var a=i.onResponse;if((i="string"==typeof i?{uri:i}:JSON.parse(JSON.stringify(i))).onResponse=a,i.verbose&&(t.log=function(){var e,t,n={},i=["trace","debug","info","warn","error"];for(t=0;t<i.length;t++)n[e=i[t]]=r,"undefined"!=typeof console&&console&&console[e]&&(n[e]=o(console,e));return n}()),i.url&&(i.uri=i.url,delete i.url),!i.uri&&""!==i.uri)throw new Error("options.uri is a required argument");if("string"!=typeof i.uri)throw new Error("options.uri must be a string");for(var c=["proxy","_redirectsFollowed","maxRedirects","followRedirect"],u=0;u<c.length;u++)if(i[c[u]])throw new Error("options."+c[u]+" is not supported");if(i.callback=s,i.method=i.method||"GET",i.headers=i.headers||{},i.body=i.body||null,i.timeout=i.timeout||t.DEFAULT_TIMEOUT,i.headers.host)throw new Error("Options.headers.host is not supported");i.json&&(i.headers.accept=i.headers.accept||"application/json","GET"!==i.method&&(i.headers["content-type"]="application/json"),"boolean"!=typeof i.json?i.body=JSON.stringify(i.json):"string"!=typeof i.body&&(i.body=JSON.stringify(i.body)));var l=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")};if(i.qs){var d="string"==typeof i.qs?i.qs:l(i.qs);-1!==i.uri.indexOf("?")?i.uri=i.uri+"&"+d:i.uri=i.uri+"?"+d}if(i.form){if("string"==typeof i.form)throw"form name unsupported";if("POST"===i.method){var h=(i.encoding||"application/x-www-form-urlencoded").toLowerCase();switch(i.headers["content-type"]=h,h){case"application/x-www-form-urlencoded":i.body=l(i.form).replace(/%20/g,"+");break;case"multipart/form-data":var f=function(e){var t={};t.boundry="-------------------------------"+Math.floor(1e9*Math.random());var n=[];for(var r in e)e.hasOwnProperty(r)&&n.push("--"+t.boundry+'\nContent-Disposition: form-data; name="'+r+'"\n\n'+e[r]+"\n");return n.push("--"+t.boundry+"--"),t.body=n.join(""),t.length=t.body.length,t.type="multipart/form-data; boundary="+t.boundry,t}(i.form);i.body=f.body,i.headers["content-type"]=f.type;break;default:throw new Error("unsupported encoding:"+h)}}}return i.onResponse=i.onResponse||r,!0===i.onResponse&&(i.onResponse=s,i.callback=r),!i.headers.authorization&&i.auth&&(i.headers.authorization="Basic "+function(e){var t,n,r,o,i,s,a,c,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=0,d=0,h="",f=[];if(!e)return e;do{t=e.charCodeAt(l++),n=e.charCodeAt(l++),r=e.charCodeAt(l++),o=(c=t<<16|n<<8|r)>>18&63,i=c>>12&63,s=c>>6&63,a=63&c,f[d++]=u.charAt(o)+u.charAt(i)+u.charAt(s)+u.charAt(a)}while(l<e.length);switch(h=f.join(""),e.length%3){case 1:h=h.slice(0,-2)+"==";break;case 2:h=h.slice(0,-1)+"="}return h}(i.auth.username+":"+i.auth.password)),function(r){var o=new e,i=!1,s=function(e){var t,n=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/;try{t=location.href}catch(e){(t=document.createElement("a")).href="",t=t.href}var r=n.exec(t.toLowerCase())||[],o=n.exec(e.toLowerCase());return!(!o||o[1]==r[1]&&o[2]==r[2]&&(o[3]||("http:"===o[1]?80:443))==(r[3]||("http:"===r[1]?80:443)))}(r.uri),a="withCredentials"in o;if(n+=1,o.seq_id=n,o.id=n+": "+r.method+" "+r.uri,o._id=o.id,s&&!a){var c=new Error("Browser does not support cross-origin request: "+r.uri);return c.cors="unsupported",r.callback(c,o)}o.timeoutTimer=setTimeout((function(){i=!0;var e=new Error("ETIMEDOUT");return e.code="ETIMEDOUT",e.duration=r.timeout,t.log.error("Timeout",{id:o._id,milliseconds:r.timeout}),r.callback(e,o)}),r.timeout);var u={response:!1,loading:!1,end:!1};return o.onreadystatechange=function(n){if(i)return t.log.debug("Ignoring timed out state change",{state:o.readyState,id:o.id});if(t.log.debug("State change",{state:o.readyState,id:o.id,timed_out:i}),o.readyState===e.OPENED)for(var s in t.log.debug("Request started",{id:o.id}),r.headers)o.setRequestHeader(s,r.headers[s]);else o.readyState===e.HEADERS_RECEIVED?l():o.readyState===e.LOADING?(l(),d()):o.readyState===e.DONE&&(l(),d(),function(){if(!u.end){if(u.end=!0,t.log.debug("Request done",{id:o.id}),o.body=o.responseText,r.json)try{o.body=JSON.parse(o.responseText)}catch(e){return r.callback(e,o)}r.callback(null,o,o.body)}}())},o.open(r.method,r.uri,!0),s&&(o.withCredentials=!!r.withCredentials),o.send(r.body),o;function l(){if(!u.response){if(u.response=!0,t.log.debug("Got response",{id:o.id,status:o.status}),clearTimeout(o.timeoutTimer),o.statusCode=o.status,s&&0==o.statusCode){var e=new Error("CORS request rejected: "+r.uri);return e.cors="rejected",u.loading=!0,u.end=!0,r.callback(e,o)}r.onResponse(null,o)}}function d(){u.loading||(u.loading=!0,t.log.debug("Response body loading",{id:o.id}))}}(i)}t.log={trace:r,debug:r,info:r,warn:r,error:r};var n=0;function r(){}function o(e,t){return function(n,r){return"object"==typeof r&&(n+=" "+JSON.stringify(r)),e[t].call(e,n)}}return t.withCredentials=!1,t.DEFAULT_TIMEOUT=18e4,t.defaults=function(e,n){var r=function(t){return function(n,r){for(var o in n="string"==typeof n?{uri:n}:JSON.parse(JSON.stringify(n)),e)void 0===n[o]&&(n[o]=e[o]);return t(n,r)}},o=r(t);return o.get=r(t.get),o.post=r(t.post),o.put=r(t.put),o.head=r(t.head),o},["get","put","post","head"].forEach((function(e){var n=e.toUpperCase();t[e.toLowerCase()]=function(e){"string"==typeof e?e={method:n,uri:e}:(e=JSON.parse(JSON.stringify(e))).method=n;var r=[e].concat(Array.prototype.slice.apply(arguments,[1]));return t.apply(this,r)}})),t.couch=function(e,n){return"string"==typeof e&&(e={uri:e}),e.json=!0,e.body&&(e.json=e.body),delete e.body,n=n||r,t(e,(function(e,t,r){if(e)return n(e,t,r);if((t.statusCode<200||t.statusCode>299)&&r.error){for(var o in e=new Error("CouchDB error: "+(r.error.reason||r.error.error)),r)e[o]=r[o];return n(e,t,r)}return n(e,t,r)}))},t})?r.apply(t,o):r)||(e.exports=i)},function(e,t,n){"use strict";var r=n(114),o=n(115),i=n(48);e.exports={formats:i,parse:o,stringify:r}},function(e,t,n){"use strict";var r=n(28),o=n(48),i=Object.prototype.hasOwnProperty,s={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},a=Array.isArray,c=Array.prototype.push,u=function(e,t){c.apply(e,a(t)?t:[t])},l=Date.prototype.toISOString,d=o.default,h={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:r.encode,encodeValuesOnly:!1,format:d,formatter:o.formatters[d],indices:!1,serializeDate:function(e){return l.call(e)},skipNulls:!1,strictNullHandling:!1},f=function e(t,n,o,i,s,c,l,d,f,p,g,m,y){var v,_=t;if("function"==typeof l?_=l(n,_):_ instanceof Date?_=p(_):"comma"===o&&a(_)&&(_=_.join(",")),null===_){if(i)return c&&!m?c(n,h.encoder,y,"key"):n;_=""}if("string"==typeof(v=_)||"number"==typeof v||"boolean"==typeof v||"symbol"==typeof v||"bigint"==typeof v||r.isBuffer(_))return c?[g(m?n:c(n,h.encoder,y,"key"))+"="+g(c(_,h.encoder,y,"value"))]:[g(n)+"="+g(String(_))];var b,E=[];if(void 0===_)return E;if(a(l))b=l;else{var S=Object.keys(_);b=d?S.sort(d):S}for(var w=0;w<b.length;++w){var k=b[w];s&&null===_[k]||(a(_)?u(E,e(_[k],"function"==typeof o?o(n,k):n,o,i,s,c,l,d,f,p,g,m,y)):u(E,e(_[k],n+(f?"."+k:"["+k+"]"),o,i,s,c,l,d,f,p,g,m,y)))}return E};e.exports=function(e,t){var n,r=e,c=function(e){if(!e)return h;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||h.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=o.default;if(void 0!==e.format){if(!i.call(o.formatters,e.format))throw new TypeError("Unknown format option provided.");n=e.format}var r=o.formatters[n],s=h.filter;return("function"==typeof e.filter||a(e.filter))&&(s=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:h.addQueryPrefix,allowDots:void 0===e.allowDots?h.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:h.charsetSentinel,delimiter:void 0===e.delimiter?h.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:h.encode,encoder:"function"==typeof e.encoder?e.encoder:h.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:h.encodeValuesOnly,filter:s,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:h.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:h.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:h.strictNullHandling}}(t);"function"==typeof c.filter?r=(0,c.filter)("",r):a(c.filter)&&(n=c.filter);var l,d=[];if("object"!=typeof r||null===r)return"";l=t&&t.arrayFormat in s?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var p=s[l];n||(n=Object.keys(r)),c.sort&&n.sort(c.sort);for(var g=0;g<n.length;++g){var m=n[g];c.skipNulls&&null===r[m]||u(d,f(r[m],m,p,c.strictNullHandling,c.skipNulls,c.encode?c.encoder:null,c.filter,c.sort,c.allowDots,c.serializeDate,c.formatter,c.encodeValuesOnly,c.charset))}var y=d.join(c.delimiter),v=!0===c.addQueryPrefix?"?":"";return c.charsetSentinel&&("iso-8859-1"===c.charset?v+="utf8=%26%2310003%3B&":v+="utf8=%E2%9C%93&"),y.length>0?v+y:""}},function(e,t,n){"use strict";var r=n(28),o=Object.prototype.hasOwnProperty,i=Array.isArray,s={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:r.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},a=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},c=function(e,t,n){if(e){var r=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,i=/(\[[^[\]]*])/g,s=n.depth>0&&/(\[[^[\]]*])/.exec(r),a=s?r.slice(0,s.index):r,c=[];if(a){if(!n.plainObjects&&o.call(Object.prototype,a)&&!n.allowPrototypes)return;c.push(a)}for(var u=0;n.depth>0&&null!==(s=i.exec(r))&&u<n.depth;){if(u+=1,!n.plainObjects&&o.call(Object.prototype,s[1].slice(1,-1))&&!n.allowPrototypes)return;c.push(s[1])}return s&&c.push("["+r.slice(s.index)+"]"),function(e,t,n){for(var r=t,o=e.length-1;o>=0;--o){var i,s=e[o];if("[]"===s&&n.parseArrays)i=[].concat(r);else{i=n.plainObjects?Object.create(null):{};var a="["===s.charAt(0)&&"]"===s.charAt(s.length-1)?s.slice(1,-1):s,c=parseInt(a,10);n.parseArrays||""!==a?!isNaN(c)&&s!==a&&String(c)===a&&c>=0&&n.parseArrays&&c<=n.arrayLimit?(i=[])[c]=r:i[a]=r:i={0:r}}r=i}return r}(c,t,n)}};e.exports=function(e,t){var n=function(e){if(!e)return s;if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new Error("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?s.charset:e.charset;return{allowDots:void 0===e.allowDots?s.allowDots:!!e.allowDots,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:s.allowPrototypes,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:s.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:s.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:s.comma,decoder:"function"==typeof e.decoder?e.decoder:s.decoder,delimiter:"string"==typeof e.delimiter||r.isRegExp(e.delimiter)?e.delimiter:s.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:s.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:s.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:s.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:s.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:s.strictNullHandling}}(t);if(""===e||null==e)return n.plainObjects?Object.create(null):{};for(var u="string"==typeof e?function(e,t){var n,c={},u=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,l=t.parameterLimit===1/0?void 0:t.parameterLimit,d=u.split(t.delimiter,l),h=-1,f=t.charset;if(t.charsetSentinel)for(n=0;n<d.length;++n)0===d[n].indexOf("utf8=")&&("utf8=%E2%9C%93"===d[n]?f="utf-8":"utf8=%26%2310003%3B"===d[n]&&(f="iso-8859-1"),h=n,n=d.length);for(n=0;n<d.length;++n)if(n!==h){var p,g,m=d[n],y=m.indexOf("]="),v=-1===y?m.indexOf("="):y+1;-1===v?(p=t.decoder(m,s.decoder,f,"key"),g=t.strictNullHandling?null:""):(p=t.decoder(m.slice(0,v),s.decoder,f,"key"),g=t.decoder(m.slice(v+1),s.decoder,f,"value")),g&&t.interpretNumericEntities&&"iso-8859-1"===f&&(g=a(g)),g&&"string"==typeof g&&t.comma&&g.indexOf(",")>-1&&(g=g.split(",")),m.indexOf("[]=")>-1&&(g=i(g)?[g]:g),o.call(c,p)?c[p]=r.combine(c[p],g):c[p]=g}return c}(e,n):e,l=n.plainObjects?Object.create(null):{},d=Object.keys(u),h=0;h<d.length;++h){var f=d[h],p=c(f,u[f],n);l=r.merge(l,p,n)}return r.compact(l)}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(117)),i=r(n(119));t.uuid=function(){return o.default()};const s={v4:/(?:^[a-f0-9]{8}-[a-f0-9]{4}-4[a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}$)|(?:^0{8}-0{4}-0{4}-0{4}-0{12}$)/u,v5:/(?:^[a-f0-9]{8}-[a-f0-9]{4}-5[a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}$)|(?:^0{8}-0{4}-0{4}-0{4}-0{12}$)/u};t.regex=s;t.isUuid=function(e){return s.v4.test(e)||s.v5.test(e)};t.empty=function(){return"00000000-0000-0000-0000-000000000000"};t.fromString=function(e){return i.default(e,"bb5d0ffa-9a4c-4d7c-8fc2-0a7d2220ba45")}},function(e,t,n){var r=n(118),o=n(49);e.exports=function(e,t,n){var i=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||r)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[i+a]=s[a];return t||o(s)}},function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);e.exports=function(){return n(r),r}}else{var o=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}},function(e,t,n){var r=n(120),o=n(121);e.exports=r("v5",80,o)},function(e,t,n){var r=n(49);e.exports=function(e,t,n){var o=function(e,o,i,s){var a=i&&s||0;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=new Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(e)),"string"==typeof o&&(o=function(e){var t=[];return e.replace(/[a-fA-F0-9]{2}/g,(function(e){t.push(parseInt(e,16))})),t}(o)),!Array.isArray(e))throw TypeError("value must be an array of bytes");if(!Array.isArray(o)||16!==o.length)throw TypeError("namespace must be uuid string or an Array of 16 byte values");var c=n(o.concat(e));if(c[6]=15&c[6]|t,c[8]=63&c[8]|128,i)for(var u=0;u<16;++u)i[a+u]=c[u];return i||r(c)};try{o.name=e}catch(e){}return o.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",o.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",o}},function(e,t,n){"use strict";function r(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:return t^n^r;case 2:return t&n^t&r^n&r;case 3:return t^n^r}}function o(e,t){return e<<t|e>>>32-t}e.exports=function(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var i=unescape(encodeURIComponent(e));e=new Array(i.length);for(var s=0;s<i.length;s++)e[s]=i.charCodeAt(s)}e.push(128);var a=e.length/4+2,c=Math.ceil(a/16),u=new Array(c);for(s=0;s<c;s++){u[s]=new Array(16);for(var l=0;l<16;l++)u[s][l]=e[64*s+4*l]<<24|e[64*s+4*l+1]<<16|e[64*s+4*l+2]<<8|e[64*s+4*l+3]}for(u[c-1][14]=8*(e.length-1)/Math.pow(2,32),u[c-1][14]=Math.floor(u[c-1][14]),u[c-1][15]=8*(e.length-1)&4294967295,s=0;s<c;s++){for(var d=new Array(80),h=0;h<16;h++)d[h]=u[s][h];for(h=16;h<80;h++)d[h]=o(d[h-3]^d[h-8]^d[h-14]^d[h-16],1);var f=n[0],p=n[1],g=n[2],m=n[3],y=n[4];for(h=0;h<80;h++){var v=Math.floor(h/20),_=o(f,5)+r(v,p,g,m)+y+t[v]+d[h]>>>0;y=m,m=g,g=o(p,30)>>>0,p=f,f=_}n[0]=n[0]+f>>>0,n[1]=n[1]+p>>>0,n[2]=n[2]+g>>>0,n[3]=n[3]+m>>>0,n[4]=n[4]+y>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(n(11));o(n(30));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){var t=e.message,n=e.user_id,o=t.sender.userId===n;return r.default.createElement("div",{className:"message "+(o?"from-me":"from-support")},r.default.createElement("div",{className:"text"},t.event.content.body))}},function(e,t,n){var r=n(124);"string"==typeof r&&(r=[[e.i,r,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(51)(r,o);r.locals&&(e.exports=r.locals)},function(e,t,n){(t=e.exports=n(50)(!1)).push([e.i,"@import url(https://fonts.googleapis.com/css?family=Assistant&display=swap);",""]),t.push([e.i,'.loader,.loader:before,.loader:after{border-radius:50%;width:2.5em;height:2.5em;-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation:load7 1.8s infinite ease-in-out;animation:load7 1.8s infinite ease-in-out}.loader{color:teal;font-size:10px;margin:1rem auto;margin-bottom:2rem;position:relative;text-indent:-9999em;-webkit-transform:translateZ(0);-ms-transform:translateZ(0);transform:translateZ(0);-webkit-animation-delay:-0.16s;animation-delay:-0.16s}.loader:before,.loader:after{content:\'\';position:absolute;top:0}.loader:before{left:-3.5em;-webkit-animation-delay:-0.32s;animation-delay:-0.32s}.loader:after{left:3.5em}@-webkit-keyframes load7{0%,80%,100%{box-shadow:0 2.5em 0 -1.3em}40%{box-shadow:0 2.5em 0 0}}@keyframes load7{0%,80%,100%{box-shadow:0 2.5em 0 -1.3em}40%{box-shadow:0 2.5em 0 0}}#ocrcc-chatbox{font-family:"Assistant","Helvetica",sans-serif;display:flex;flex-direction:column;min-height:50vh;outline:1px solid teal;outline-offset:-1px}#ocrcc-chatbox .message-window{background-color:#FFF8F0;flex:1 0 auto;padding:0.5rem}#ocrcc-chatbox .message .sender{font-weight:bold;color:teal}#ocrcc-chatbox .message .text{padding:0.5rem 0.75rem;margin-top:0.5rem;margin-bottom:0.5rem;width:fit-content}#ocrcc-chatbox .message.from-me{display:flex;justify-content:flex-end}#ocrcc-chatbox .message.from-me .text{background-color:teal;color:#fff;border-radius:15px 15px 0 15px;margin-left:10%}#ocrcc-chatbox .message.from-support{display:flex;justify-content:flex-start}#ocrcc-chatbox .message.from-support .text{background-color:#fff;color:#22333B;border:1px solid teal;border-radius:15px 15px 15px 0;margin-right:10%}#ocrcc-chatbox .input-window{flex:0 0 auto}#ocrcc-chatbox .input-window form{display:flex;align-items:center;margin-bottom:0}#ocrcc-chatbox .input-window input[type="text"]{font-size:1rem;padding:1rem;border:none;flex:1 0 auto;border:none;outline:1px solid teal;outline-offset:-1px;color:#22333B;font-family:"Assistant","Helvetica",sans-serif}#ocrcc-chatbox .input-window input[type="text"]:focus{border:none}#ocrcc-chatbox .input-window input[type="submit"]{background-color:teal;height:100%;padding:1em;font-size:1rem;color:#fff;font-weight:bold;border:none;font-family:"Assistant","Helvetica",sans-serif;cursor:pointer}\n',""])},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,r=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var o,i=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(i)?e:(o=0===i.indexOf("//")?i:0===i.indexOf("/")?n+i:r+i.replace(/^\.\//,""),"url("+JSON.stringify(o)+")")}))}},function(e,t,n){var r=n(127);"string"==typeof r&&(r=[[e.i,r,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(51)(r,o);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(50)(!1)).push([e.i,"body{margin:0;padding:0;font-family:'Montserrat', 'Helvetica Neue', Arial, sans-serif}h1,h2,h3,h4,h5{margin-top:0}h1{font-size:4rem;color:#008080}a{color:#008080}.wrapper{max-width:1100px;margin:0 auto}.flex-container{display:flex;flex-wrap:wrap}.flex-item{flex:1 1 40%;min-width:300px;padding:10px;margin-bottom:1em}.header-content{display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%}.header-content label{margin-left:10px}.demo-items{margin-top:20px;margin-bottom:20px}footer{padding:2rem 3rem;background:#FFFACD;text-align:center;position:absolute;bottom:0;left:0;width:100%}hr{margin-top:1rem;margin-bottom:1rem;border:0;border-top:1px solid rgba(0,0,0,0.1)}code{display:block;background-color:#eee;border-radius:3px;font-family:courier, monospace;padding:20px;overflow:auto}p{overflow-wrap:break-word}fieldset{margin-bottom:1em;padding:1em}input[type=\"checkbox\"],input[type=\"radio\"]{margin-right:1em}\n",""])}]);